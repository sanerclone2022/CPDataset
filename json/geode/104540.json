[{"authorTime":"2018-07-18 03:54:18","codes":[{"authorDate":"2018-07-18 03:54:18","commitOrder":1,"curCode":"  public void testStatsForCompactMapRangeIndex() throws Exception {\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", \"/portfolio p\");\n    assertTrue(keyIndex3 instanceof CompactMapRangeIndex);\n\n    Object[] indexes =\n        ((CompactMapRangeIndex) keyIndex3).getRangeIndexHolderForTesting().values().toArray();\n    assertTrue(indexes[0] instanceof CompactRangeIndex);\n    assertTrue(indexes[1] instanceof CompactRangeIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(100, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from /portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    assertEquals(0, keyIndexStats.getReadLockCount());\n\n    assertEquals(100, keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(250, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(250, keyIndexStats.getNumUpdates());\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","date":"2018-07-18 03:54:18","endLine":398,"groupId":"39172","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testStatsForCompactMapRangeIndex","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/d8/c65522e784f76fce9aa7817a34482b139020a3.src","preCode":"  public void testStatsForCompactMapRangeIndex() throws Exception {\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", \"/portfolio p\");\n    assertTrue(keyIndex3 instanceof CompactMapRangeIndex);\n\n    Object[] indexes =\n        ((CompactMapRangeIndex) keyIndex3).getRangeIndexHolderForTesting().values().toArray();\n    assertTrue(indexes[0] instanceof CompactRangeIndex);\n    assertTrue(indexes[1] instanceof CompactRangeIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(100, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from /portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    assertEquals(0, keyIndexStats.getReadLockCount());\n\n    assertEquals(100, keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(250, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(250, keyIndexStats.getNumUpdates());\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/internal/index/IndexStatisticsJUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":330,"status":"B"},{"authorDate":"2018-07-18 03:54:18","commitOrder":1,"curCode":"  public void testStatsForMapRangeIndex() throws Exception {\n    IndexManager.TEST_RANGEINDEX_ONLY = true;\n    createAndPopulateRegion();\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", \"/portfolio\");\n\n    assertTrue(keyIndex3 instanceof PartitionedIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n    assertTrue(keyIndexStats instanceof IndexStatistics);\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(100, keyIndexStats.getNumUpdates());\n\n    Position.cnt = 0;\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from /portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    \r\n    assertEquals(100 , keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(400, keyIndexStats.getNumUpdates());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","date":"2018-07-18 03:54:18","endLine":378,"groupId":"14765","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testStatsForMapRangeIndex","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/9d/eb88e5a9b9f91c6f1be606362dbe1aa6677b02.src","preCode":"  public void testStatsForMapRangeIndex() throws Exception {\n    IndexManager.TEST_RANGEINDEX_ONLY = true;\n    createAndPopulateRegion();\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", \"/portfolio\");\n\n    assertTrue(keyIndex3 instanceof PartitionedIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n    assertTrue(keyIndexStats instanceof IndexStatistics);\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(100, keyIndexStats.getNumUpdates());\n\n    Position.cnt = 0;\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from /portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    \r\n    assertEquals(100 , keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(400, keyIndexStats.getNumUpdates());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/partitioned/PRIndexStatisticsJUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":310,"status":"B"}],"commitId":"cb202f25b93e0a56f4776813da0bf6dcbba231cd","commitMessage":"@@@GEODE-5363: Moves all non-unit tests into specific isolated source sets. (#2126)\n\n* Creates integrationTest source set.\n* Creates distributedTest source set.\n* Creates acceptanceTest source set.\n* Creates uiTest source set.\n* Removes old categories.","date":"2018-07-18 03:54:18","modifiedFileCount":"697","status":"B","submitter":"Jacob Barrett"},{"authorTime":"2020-05-29 00:37:39","codes":[{"authorDate":"2020-05-29 00:37:39","commitOrder":2,"curCode":"  public void testStatsForCompactMapRangeIndex() throws Exception {\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", SEPARATOR + \"portfolio p\");\n    assertTrue(keyIndex3 instanceof CompactMapRangeIndex);\n\n    Object[] indexes =\n        ((CompactMapRangeIndex) keyIndex3).getRangeIndexHolderForTesting().values().toArray();\n    assertTrue(indexes[0] instanceof CompactRangeIndex);\n    assertTrue(indexes[1] instanceof CompactRangeIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(100, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from \" + SEPARATOR\n            + \"portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    assertEquals(0, keyIndexStats.getReadLockCount());\n\n    assertEquals(100, keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(250, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(250, keyIndexStats.getNumUpdates());\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","date":"2020-05-29 00:37:39","endLine":404,"groupId":"39172","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testStatsForCompactMapRangeIndex","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/6d/982a00d4ae9af33a19c2d006ef931d554e74d9.src","preCode":"  public void testStatsForCompactMapRangeIndex() throws Exception {\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", \"/portfolio p\");\n    assertTrue(keyIndex3 instanceof CompactMapRangeIndex);\n\n    Object[] indexes =\n        ((CompactMapRangeIndex) keyIndex3).getRangeIndexHolderForTesting().values().toArray();\n    assertTrue(indexes[0] instanceof CompactRangeIndex);\n    assertTrue(indexes[1] instanceof CompactRangeIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(100, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from /portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    assertEquals(0, keyIndexStats.getReadLockCount());\n\n    assertEquals(100, keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(250, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(250, keyIndexStats.getNumUpdates());\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/internal/index/IndexStatisticsJUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":335,"status":"M"},{"authorDate":"2020-05-29 00:37:39","commitOrder":2,"curCode":"  public void testStatsForMapRangeIndex() throws Exception {\n    IndexManager.TEST_RANGEINDEX_ONLY = true;\n    createAndPopulateRegion();\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", SEPARATOR + \"portfolio\");\n\n    assertTrue(keyIndex3 instanceof PartitionedIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n    assertTrue(keyIndexStats instanceof IndexStatistics);\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(100, keyIndexStats.getNumUpdates());\n\n    Position.cnt = 0;\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from \" + SEPARATOR\n            + \"portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    \r\n    assertEquals(100 , keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(400, keyIndexStats.getNumUpdates());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","date":"2020-05-29 00:37:39","endLine":383,"groupId":"39172","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testStatsForMapRangeIndex","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/be/4178e06022c25d3634729ecdcfad014a65428a.src","preCode":"  public void testStatsForMapRangeIndex() throws Exception {\n    IndexManager.TEST_RANGEINDEX_ONLY = true;\n    createAndPopulateRegion();\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", \"/portfolio\");\n\n    assertTrue(keyIndex3 instanceof PartitionedIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n    assertTrue(keyIndexStats instanceof IndexStatistics);\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(100, keyIndexStats.getNumUpdates());\n\n    Position.cnt = 0;\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from /portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    \r\n    assertEquals(100 , keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(400, keyIndexStats.getNumUpdates());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/partitioned/PRIndexStatisticsJUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":314,"status":"M"}],"commitId":"0fd56e418752c14ed8ebebe5a370164034aafc39","commitMessage":"@@@GEODE-7846: Replace all uses of hardcoded / with Region.SEPARATOR (#5157)\n\nAuthored-by: Donal Evans <doevans@pivotal.io>","date":"2020-05-29 00:37:39","modifiedFileCount":"489","status":"M","submitter":"Donal Evans"},{"authorTime":"2021-05-07 15:06:45","codes":[{"authorDate":"2021-05-07 15:06:45","commitOrder":3,"curCode":"  public void testStatsForCompactMapRangeIndex() throws Exception {\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", SEPARATOR + \"portfolio p\");\n    assertTrue(keyIndex3 instanceof CompactMapRangeIndex);\n\n    Object[] indexes =\n        ((CompactMapRangeIndex) keyIndex3).getRangeIndexHolderForTesting().values().toArray();\n    assertTrue(indexes[0] instanceof CompactRangeIndex);\n    assertTrue(indexes[1] instanceof CompactRangeIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(200, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(200, keyIndexStats.getNumberOfValues());\n    assertEquals(400, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from \" + SEPARATOR\n            + \"portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    assertEquals(0, keyIndexStats.getReadLockCount());\n\n    assertEquals(100, keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(500, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(500, keyIndexStats.getNumUpdates());\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(600, keyIndexStats.getNumUpdates());\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","date":"2021-05-07 15:06:45","endLine":403,"groupId":"104540","id":5,"instanceNumber":1,"isCurCommit":1,"methodName":"testStatsForCompactMapRangeIndex","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/03/3dd88b9093b2c2938b25005f430264c1297f68.src","preCode":"  public void testStatsForCompactMapRangeIndex() throws Exception {\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", SEPARATOR + \"portfolio p\");\n    assertTrue(keyIndex3 instanceof CompactMapRangeIndex);\n\n    Object[] indexes =\n        ((CompactMapRangeIndex) keyIndex3).getRangeIndexHolderForTesting().values().toArray();\n    assertTrue(indexes[0] instanceof CompactRangeIndex);\n    assertTrue(indexes[1] instanceof CompactRangeIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(100, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from \" + SEPARATOR\n            + \"portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    assertEquals(0, keyIndexStats.getReadLockCount());\n\n    assertEquals(100, keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(250, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(250, keyIndexStats.getNumUpdates());\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/internal/index/IndexStatisticsJUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":335,"status":"M"},{"authorDate":"2021-05-07 15:06:45","commitOrder":3,"curCode":"  public void testStatsForMapRangeIndex() throws Exception {\n    IndexManager.TEST_RANGEINDEX_ONLY = true;\n    createAndPopulateRegion();\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", SEPARATOR + \"portfolio\");\n\n    assertTrue(keyIndex3 instanceof PartitionedIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n    assertTrue(keyIndexStats instanceof IndexStatistics);\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(200, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    Position.cnt = 0;\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(200, keyIndexStats.getNumberOfValues());\n    assertEquals(400, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from \" + SEPARATOR\n            + \"portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    \r\n    assertEquals(100 , keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(600, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(600, keyIndexStats.getNumUpdates());\n\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(800, keyIndexStats.getNumUpdates());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","date":"2021-05-07 15:06:45","endLine":383,"groupId":"104540","id":6,"instanceNumber":2,"isCurCommit":1,"methodName":"testStatsForMapRangeIndex","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/e0/3df479e94f8f166a8856d669e06b48b406a207.src","preCode":"  public void testStatsForMapRangeIndex() throws Exception {\n    IndexManager.TEST_RANGEINDEX_ONLY = true;\n    createAndPopulateRegion();\n    keyIndex3 = (IndexProtocol) qs.createIndex(\"multiKeyIndex3\", IndexType.FUNCTIONAL,\n        \"positions['DELL', 'YHOO']\", SEPARATOR + \"portfolio\");\n\n    assertTrue(keyIndex3 instanceof PartitionedIndex);\n\n    IndexStatistics keyIndexStats = keyIndex3.getStatistics();\n    assertTrue(keyIndexStats instanceof IndexStatistics);\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n\n    assertEquals(89, keyIndexStats.getNumberOfBucketIndexes());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(100, keyIndexStats.getNumUpdates());\n\n    Position.cnt = 0;\n    for (int i = 0; i < 100; i++) {\n      region.put(Integer.toString(i), new Portfolio(i, i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(100, keyIndexStats.getNumberOfKeys());\n    assertEquals(100, keyIndexStats.getNumberOfValues());\n    assertEquals(200, keyIndexStats.getNumUpdates());\n\n    String queryStr =\n        \"select * from \" + SEPARATOR\n            + \"portfolio where positions['DELL'] != NULL OR positions['YHOO'] != NULL\";\n    Query query = qs.newQuery(queryStr);\n\n    for (int i = 0; i < 50; i++) {\n      query.execute();\n    }\n\n    \r\n    assertEquals(100 , keyIndexStats.getTotalUses());\n\n    for (int i = 0; i < 50; i++) {\n      region.invalidate(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n    for (int i = 0; i < 50; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n    assertEquals(50, keyIndexStats.getNumberOfKeys());\n    assertEquals(50, keyIndexStats.getNumberOfValues());\n    assertEquals(300, keyIndexStats.getNumUpdates());\n\n\n    for (int i = 50; i < 100; i++) {\n      region.destroy(Integer.toString(i));\n    }\n\n    assertEquals(400, keyIndexStats.getNumUpdates());\n    assertEquals(0, keyIndexStats.getNumberOfKeys());\n    assertEquals(2, keyIndexStats.getNumberOfMapIndexKeys());\n\n    qs.removeIndex(keyIndex3);\n    region.destroyRegion();\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/partitioned/PRIndexStatisticsJUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":314,"status":"M"}],"commitId":"884d399d58912864d36161e06a47c8d8af93a641","commitMessage":"@@@GEODE-9004: Align results of queries with and without map indexes (#6279)\n\n* GEODE-9004: Align results of queries with and without map indexes\n\nQueries in which map fields are involved\nin the condition.  sometimes do not return the same entries\nif map indexes are used.  compared to when map indexes\nare not used.\n\nDifferences were found when the condition on the\nmap field was of type '!=' and also when the condition\non the map field was comparing the value with null.\n\nExample1:\nRunning a query with the following condition:\npositions['SUN'] = null\n\nin a region with the following entries:\nentry1.positions=null\nentry2.positions={'a'=>'b'}\nentry3.positions={'SUN'=>null}\n\n- will return entry1 and entry3 if there are no\n  indexes defined.\n- will return no entries if the following index is defined:\n  positions['SUN'. 'c']\n- will return entry3 if the following index is defined:\n  positions[*]\n\nExample2:\nRunning a query with the following condition:\npositions['SUN'] != '3'\n\nin a region with the following entries:\nentry1.positions=null\nentry2.positions={'a'=>'b'}\nentry3.positions={'SUN'=>'4'}\nentry4.positions={'SUN'=>'3'}\nentry5.positions={'SUN'=>null}\n\n- will return all entries except for entry4 if:\n  there are no indexes defined.\n- will return entry3 if the following index is defined:\n  positions['SUN'. 'c']\n- will return entry3 and entry5 if the following index is defined:\n  positions[*]\n\nIn order to have the same results for these\nqueries no matter if indexes are used. \nthe following changes have been made:\n\n- When using compact map indexes or map indexes\nan index entry will be created for every entry\nadded to the region even if the entry does not\ncontain the indexed map (the map is null) or\nit does not contain any of the indexed keys.\nThe above will not apply to indexes of type\n\"allkeys\" (e.g. positions[*]).\n\n- As a consequence of the statement above\nabout indexes of type \"allkeys\".  when the index\nconfigured is of \"allkeys\" type and the query\nis of type \"!=\" (e.g. positions['SUN'] != \"3\"\nor the query is comparing against a null value\n(e.g. positions['SUN'] = null) the index will\nnot be used.\nThis is a limitation of this solution\nas allowing the index to be used in this case\nwould require bigger and more complex changes that\nhave not been considered in this solution.\n\n* GEODE-9004: Fix stats for number of keys in compact map indexes\n\n* GEODE-9004: Fix failing test cases polluted by other test cases changing a System Property\n\n* GEODE-9004: Changes after review and some refactorings\n\n* GEODE-9004: Add documentation changes\n\n* GEODE-9004: Small change in doc. after review","date":"2021-05-07 15:06:45","modifiedFileCount":"12","status":"M","submitter":"Alberto Gomez"}]
