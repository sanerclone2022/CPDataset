[{"authorTime":"2018-07-04 07:26:40","codes":[{"authorDate":"2018-07-04 07:26:40","commitOrder":1,"curCode":"  public void verifySequentialPutHAEventWrapperWithRegion() throws Exception {\n    HAContainerWrapper haContainerWrapper = createHAContainerRegion();\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    final int numQueues = 10;\n\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertEquals(1, haContainerWrapper.size());\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertEquals(numQueues, wrapperInContainer.getReferenceCount());\n  }\n","date":"2018-08-02 02:25:34","endLine":338,"groupId":"29421","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"verifySequentialPutHAEventWrapperWithRegion","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/a1/b71a1b2ccc06a5f7a63bee92c465221bcc9bba.src","preCode":"  public void verifySequentialPutHAEventWrapperWithRegion() throws Exception {\n    HAContainerWrapper haContainerWrapper = createHAContainerRegion();\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    final int numQueues = 10;\n\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertEquals(1, haContainerWrapper.size());\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertEquals(numQueues, wrapperInContainer.getReferenceCount());\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/internal/cache/ha/HARegionQueueIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":320,"status":"B"},{"authorDate":"2018-07-04 07:26:40","commitOrder":1,"curCode":"  public void verifySequentialPutHAEventWrapperWithMap() throws Exception {\n    HAContainerWrapper haContainerWrapper = new HAContainerMap(new ConcurrentHashMap());\n    when(ccn.getHaContainer()).thenReturn(haContainerWrapper);\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    final int numQueues = 10;\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertEquals(1, haContainerWrapper.size());\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertEquals(numQueues, wrapperInContainer.getReferenceCount());\n  }\n","date":"2018-08-02 02:25:34","endLine":379,"groupId":"29421","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"verifySequentialPutHAEventWrapperWithMap","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/a1/b71a1b2ccc06a5f7a63bee92c465221bcc9bba.src","preCode":"  public void verifySequentialPutHAEventWrapperWithMap() throws Exception {\n    HAContainerWrapper haContainerWrapper = new HAContainerMap(new ConcurrentHashMap());\n    when(ccn.getHaContainer()).thenReturn(haContainerWrapper);\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    final int numQueues = 10;\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertEquals(1, haContainerWrapper.size());\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertEquals(numQueues, wrapperInContainer.getReferenceCount());\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/internal/cache/ha/HARegionQueueIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":361,"status":"B"}],"commitId":"103b467ab6205f6c9d180d5ad28705ce47c7b5bb","commitMessage":"@@@GEODE-5420: Protect events in HAContainer from premature modification\n\n- Updated putInProgress boolean in HAWrapper to a counter to prevent prematurely setting ClientUpdateMessage to null when events are temporarily queued during a GII or message dispatcher initialization\n- decAndRemoveFromHAContainer only removes when putInProgress counter and ref count are 0\n- Refactored putEventInHARegion/putConditionallyInHAContainer to prevent overwriting an existing entry in the HAContainer.  Also reduces simplifies the code and reduces duplicated logic.\n- Wrote missing basic HARegionQueue unit/integration tests.  and an integration test to capture setting the ClientUpdateMessage property on HAEventWrapper to null prematurely\n- Added new event tracing messages at debug logging level to help track similar issues in the future\n\nCo-authored-by: Ryan McMahon <rmcmahon@pivotal.io>\nCo-authored-by: Lynn Hughes-Godfrey <lhughesgodfrey@pivotal.io>\n","date":"2018-08-02 02:25:34","modifiedFileCount":"8","status":"B","submitter":"Ryan McMahon"},{"authorTime":"2018-12-21 02:06:56","codes":[{"authorDate":"2018-07-04 07:26:40","commitOrder":2,"curCode":"  public void verifySequentialPutHAEventWrapperWithRegion() throws Exception {\n    HAContainerWrapper haContainerWrapper = createHAContainerRegion();\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    final int numQueues = 10;\n\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertEquals(1, haContainerWrapper.size());\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertEquals(numQueues, wrapperInContainer.getReferenceCount());\n  }\n","date":"2018-08-02 02:25:34","endLine":338,"groupId":"29421","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"verifySequentialPutHAEventWrapperWithRegion","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/a1/b71a1b2ccc06a5f7a63bee92c465221bcc9bba.src","preCode":"  public void verifySequentialPutHAEventWrapperWithRegion() throws Exception {\n    HAContainerWrapper haContainerWrapper = createHAContainerRegion();\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    final int numQueues = 10;\n\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertEquals(1, haContainerWrapper.size());\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertEquals(numQueues, wrapperInContainer.getReferenceCount());\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/internal/cache/ha/HARegionQueueIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":320,"status":"N"},{"authorDate":"2018-12-21 02:06:56","commitOrder":2,"curCode":"  public void verifySequentialPutHAEventWrapperWithMap() throws Exception {\n    HAContainerWrapper haContainerWrapper = (HAContainerWrapper) ccn.getHaContainer();\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    final int numQueues = 10;\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertEquals(1, haContainerWrapper.size());\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertEquals(numQueues, wrapperInContainer.getReferenceCount());\n  }\n","date":"2018-12-21 02:06:56","endLine":353,"groupId":"29421","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"verifySequentialPutHAEventWrapperWithMap","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/f5/4962b4ec42598227bd9c1f8dde157ccdcfcbb9.src","preCode":"  public void verifySequentialPutHAEventWrapperWithMap() throws Exception {\n    HAContainerWrapper haContainerWrapper = new HAContainerMap(new ConcurrentHashMap());\n    when(ccn.getHaContainer()).thenReturn(haContainerWrapper);\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    final int numQueues = 10;\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertEquals(1, haContainerWrapper.size());\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertEquals(numQueues, wrapperInContainer.getReferenceCount());\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/internal/cache/ha/HARegionQueueIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":336,"status":"M"}],"commitId":"c588614471c3c874bd205793fe104c3d2f607a02","commitMessage":"@@@Merge pull request #3013 from apache/feature/GEODE-6143-9\n\nGEODE-6143: remove PowerMock from HARegionQueueIntegrationTest","date":"2018-12-21 02:06:56","modifiedFileCount":"3","status":"M","submitter":"Xiaojian Zhou"},{"authorTime":"2020-04-25 00:20:21","codes":[{"authorDate":"2020-04-25 00:20:21","commitOrder":3,"curCode":"  public void verifySequentialPutHAEventWrapperWithRegion() throws Exception {\n    HAContainerWrapper haContainerWrapper = createHAContainerRegion();\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    int numQueues = 10;\n\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertThat(haContainerWrapper).hasSize(1);\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertThat(wrapperInContainer.getReferenceCount()).isEqualTo(numQueues);\n  }\n","date":"2020-04-25 00:20:21","endLine":258,"groupId":"104044","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"verifySequentialPutHAEventWrapperWithRegion","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/47/78608c6fdfe14806a0b76e91c62a288b71148e.src","preCode":"  public void verifySequentialPutHAEventWrapperWithRegion() throws Exception {\n    HAContainerWrapper haContainerWrapper = createHAContainerRegion();\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    final int numQueues = 10;\n\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertEquals(1, haContainerWrapper.size());\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertEquals(numQueues, wrapperInContainer.getReferenceCount());\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/internal/cache/ha/HARegionQueueIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":240,"status":"M"},{"authorDate":"2020-04-25 00:20:21","commitOrder":3,"curCode":"  public void verifySequentialPutHAEventWrapperWithMap() throws Exception {\n    HAContainerWrapper haContainerWrapper = (HAContainerWrapper) ccn.getHaContainer();\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    int numQueues = 10;\n\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertThat(haContainerWrapper).hasSize(1);\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertThat(wrapperInContainer.getReferenceCount()).isEqualTo(numQueues);\n  }\n","date":"2020-04-25 00:20:21","endLine":297,"groupId":"104044","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"verifySequentialPutHAEventWrapperWithMap","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/47/78608c6fdfe14806a0b76e91c62a288b71148e.src","preCode":"  public void verifySequentialPutHAEventWrapperWithMap() throws Exception {\n    HAContainerWrapper haContainerWrapper = (HAContainerWrapper) ccn.getHaContainer();\n\n    ClientUpdateMessage message = new ClientUpdateMessageImpl(EnumListenerEvent.AFTER_UPDATE,\n        (LocalRegion) dataRegion, \"key\", \"value\".getBytes(), (byte) 0x01, null,\n        new ClientProxyMembershipID(), new EventID(new byte[] {1}, 1, 2));\n    HAEventWrapper haEventWrapper = new HAEventWrapper(message);\n    haEventWrapper.setHAContainer(haContainerWrapper);\n\n    final int numQueues = 10;\n    createAndPutHARegionQueuesSequentially(haContainerWrapper, haEventWrapper, numQueues);\n\n    assertEquals(1, haContainerWrapper.size());\n\n    HAEventWrapper wrapperInContainer =\n        (HAEventWrapper) haContainerWrapper.getKey(haEventWrapper);\n    assertEquals(numQueues, wrapperInContainer.getReferenceCount());\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/internal/cache/ha/HARegionQueueIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":279,"status":"M"}],"commitId":"0a1701e92dc09bcd6b79edd3b52f20ee9e9a867c","commitMessage":"@@@GEODE-7964: Upgrade Mockito to 3.3.3 (#4924)\n\n","date":"2020-04-25 00:20:21","modifiedFileCount":"34","status":"M","submitter":"Kirk Lund"}]
