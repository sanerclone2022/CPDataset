[{"authorTime":"2018-07-18 03:54:18","codes":[{"authorDate":"2018-07-18 03:54:18","commitOrder":1,"curCode":"  public void testServerEventsInPeerSystem() throws Exception {\n    boolean[] firedSystem = new boolean[3];\n    DistributedMember[] memberSystem = new DistributedMember[3];\n    String[] memberIdSystem = new String[3];\n    boolean[] isClientSystem = new boolean[3];\n\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedSystemDuplicate = new boolean[3];\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    MembershipListener systemListener = new MembershipListener() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedSystemDuplicate[JOINED] = firedSystem[JOINED];\n        firedSystem[JOINED] = true;\n        memberSystem[JOINED] = event.getDistributedMember();\n        memberIdSystem[JOINED] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedSystemDuplicate[LEFT] = firedSystem[LEFT];\n        firedSystem[LEFT] = true;\n        memberSystem[LEFT] = event.getDistributedMember();\n        memberIdSystem[LEFT] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedSystemDuplicate[CRASHED] = firedSystem[CRASHED];\n        firedSystem[CRASHED] = true;\n        memberSystem[CRASHED] = event.getDistributedMember();\n        memberIdSystem[CRASHED] = event.getMemberId();\n        notifyAll();\n      }\n    };\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = this.getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    \r\n    getSystem();\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    Region region = createRegion(name, factory.create());\n    assertThat(region).isNotNull();\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    ports[0] = startBridgeServer(0);\n    assertThat(ports[0] != 0).isTrue();\n\n    DistributedMember serverMember = getMemberId();\n    String serverMemberId = serverMember.getId();\n    Properties serverProperties = getSystem().getProperties();\n\n    serverProperties.remove(CLUSTER_SSL_ENABLED);\n    serverProperties.remove(CLUSTER_SSL_CIPHERS);\n    serverProperties.remove(CLUSTER_SSL_PROTOCOLS);\n    serverProperties.remove(CLUSTER_SSL_REQUIRE_AUTHENTICATION);\n\n    InternalCache cache = getInternalCache();\n    ManagementService service = ManagementService.getExistingManagementService(cache);\n    \r\n    service.addMembershipListener(systemListener);\n\n    \r\n    adapter.registerMembershipListener(service);\n\n    \r\n    SerializableCallable createPeerCache = new SerializableCallable(\"Create Peer Cache\") {\n      @Override\n      public Object call() {\n        getSystem(serverProperties);\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    DistributedMember peerMember = (DistributedMember) vm0.invoke(createPeerCache);\n    String peerMemberId = peerMember.getId();\n\n    synchronized (systemListener) {\n      if (!firedSystem[JOINED]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[JOINED]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    assertArrayFalse(firedSystemDuplicate);\n\n    assertThat(firedSystem[JOINED]).isTrue();\n    assertThat(memberSystem[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isFalse();\n    assertThat(memberSystem[LEFT]).isNull();\n    assertThat(memberIdSystem[LEFT]).isNull();\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(memberAdapter[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    addIgnoredException(ServerConnectivityException.class.getName());\n    addIgnoredException(IOException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect Peer server\") {\n      @Override\n      public void run() {\n        disconnectFromDS();\n      }\n    });\n\n    synchronized (systemListener) {\n      if (!firedSystem[LEFT]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[LEFT]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    \r\n\n    assertArrayFalse(firedSystemDuplicate);\n    assertArrayFalse(firedAdapterDuplicate);\n\n    assertThat(firedSystem[JOINED]).isFalse();\n    assertThat(memberSystem[JOINED]).isNull();\n    assertThat(memberIdSystem[JOINED]).isNull();\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isTrue();\n    assertThat(memberSystem[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    \r\n    assertThat(firedAdapter[LEFT]).isTrue();\n    assertThat(memberAdapter[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[LEFT]).isFalse();\n\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","date":"2018-07-18 03:54:18","endLine":1324,"groupId":"34929","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testServerEventsInPeerSystem","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/43/ba84933ab2f0f3523ff119ab90428a8ff762c9.src","preCode":"  public void testServerEventsInPeerSystem() throws Exception {\n    boolean[] firedSystem = new boolean[3];\n    DistributedMember[] memberSystem = new DistributedMember[3];\n    String[] memberIdSystem = new String[3];\n    boolean[] isClientSystem = new boolean[3];\n\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedSystemDuplicate = new boolean[3];\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    MembershipListener systemListener = new MembershipListener() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedSystemDuplicate[JOINED] = firedSystem[JOINED];\n        firedSystem[JOINED] = true;\n        memberSystem[JOINED] = event.getDistributedMember();\n        memberIdSystem[JOINED] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedSystemDuplicate[LEFT] = firedSystem[LEFT];\n        firedSystem[LEFT] = true;\n        memberSystem[LEFT] = event.getDistributedMember();\n        memberIdSystem[LEFT] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedSystemDuplicate[CRASHED] = firedSystem[CRASHED];\n        firedSystem[CRASHED] = true;\n        memberSystem[CRASHED] = event.getDistributedMember();\n        memberIdSystem[CRASHED] = event.getMemberId();\n        notifyAll();\n      }\n    };\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = this.getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    \r\n    getSystem();\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    Region region = createRegion(name, factory.create());\n    assertThat(region).isNotNull();\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    ports[0] = startBridgeServer(0);\n    assertThat(ports[0] != 0).isTrue();\n\n    DistributedMember serverMember = getMemberId();\n    String serverMemberId = serverMember.getId();\n    Properties serverProperties = getSystem().getProperties();\n\n    serverProperties.remove(CLUSTER_SSL_ENABLED);\n    serverProperties.remove(CLUSTER_SSL_CIPHERS);\n    serverProperties.remove(CLUSTER_SSL_PROTOCOLS);\n    serverProperties.remove(CLUSTER_SSL_REQUIRE_AUTHENTICATION);\n\n    InternalCache cache = getInternalCache();\n    ManagementService service = ManagementService.getExistingManagementService(cache);\n    \r\n    service.addMembershipListener(systemListener);\n\n    \r\n    adapter.registerMembershipListener(service);\n\n    \r\n    SerializableCallable createPeerCache = new SerializableCallable(\"Create Peer Cache\") {\n      @Override\n      public Object call() {\n        getSystem(serverProperties);\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    DistributedMember peerMember = (DistributedMember) vm0.invoke(createPeerCache);\n    String peerMemberId = peerMember.getId();\n\n    synchronized (systemListener) {\n      if (!firedSystem[JOINED]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[JOINED]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    assertArrayFalse(firedSystemDuplicate);\n\n    assertThat(firedSystem[JOINED]).isTrue();\n    assertThat(memberSystem[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isFalse();\n    assertThat(memberSystem[LEFT]).isNull();\n    assertThat(memberIdSystem[LEFT]).isNull();\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(memberAdapter[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    addIgnoredException(ServerConnectivityException.class.getName());\n    addIgnoredException(IOException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect Peer server\") {\n      @Override\n      public void run() {\n        disconnectFromDS();\n      }\n    });\n\n    synchronized (systemListener) {\n      if (!firedSystem[LEFT]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[LEFT]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    \r\n\n    assertArrayFalse(firedSystemDuplicate);\n    assertArrayFalse(firedAdapterDuplicate);\n\n    assertThat(firedSystem[JOINED]).isFalse();\n    assertThat(memberSystem[JOINED]).isNull();\n    assertThat(memberIdSystem[JOINED]).isNull();\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isTrue();\n    assertThat(memberSystem[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    \r\n    assertThat(firedAdapter[LEFT]).isTrue();\n    assertThat(memberAdapter[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[LEFT]).isFalse();\n\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","realPath":"geode-core/src/distributedTest/java/org/apache/geode/management/UniversalMembershipListenerAdapterDUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":1078,"status":"B"},{"authorDate":"2018-07-18 03:54:18","commitOrder":1,"curCode":"  public void testServerEventsInLonerClient() throws Exception {\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    ClientMembershipListener bridgeListener = new ClientMembershipListener() {\n      @Override\n      public synchronized void memberJoined(ClientMembershipEvent event) {\n        firedBridgeDuplicate[JOINED] = firedBridge[JOINED];\n        firedBridge[JOINED] = true;\n        memberBridge[JOINED] = event.getMember();\n        memberIdBridge[JOINED] = event.getMemberId();\n        isClientBridge[JOINED] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(ClientMembershipEvent event) {\n        firedBridgeDuplicate[LEFT] = firedBridge[LEFT];\n        firedBridge[LEFT] = true;\n        memberBridge[LEFT] = event.getMember();\n        memberIdBridge[LEFT] = event.getMemberId();\n        isClientBridge[LEFT] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(ClientMembershipEvent event) {\n        firedBridgeDuplicate[CRASHED] = firedBridge[CRASHED];\n        firedBridge[CRASHED] = true;\n        memberBridge[CRASHED] = event.getMember();\n        memberIdBridge[CRASHED] = event.getMemberId();\n        isClientBridge[CRASHED] = event.isClient();\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    Properties config = new Properties();\n    config.put(MCAST_PORT, \"0\");\n    config.put(LOCATORS, \"\");\n    config.setProperty(ENABLE_NETWORK_PARTITION_DETECTION, \"false\");\n    getSystem(config);\n\n    \r\n    ClientMembership.registerClientMembershipListener(bridgeListener);\n\n    \r\n    SerializableCallable createBridgeServer = new SerializableCallable(\"Create BridgeServer\") {\n      @Override\n      public Object call() {\n        getSystem();\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n        try {\n          serverPort = startBridgeServer(ports[0]);\n        } catch (IOException e) {\n          throw new AssertionError(e);\n        }\n\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(\"getServerPort\", () -> serverPort)).isEqualTo(ports[0]);\n\n    \r\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    configureConnectionPool(factory, getServerHostName(host), ports, false, -1, -1, null);\n    createRegion(name, factory.create());\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    String poolName = getRootRegion().getSubregion(name).getAttributes().getPoolName();\n    PoolImpl pool = (PoolImpl) PoolManager.find(poolName);\n    waitForClientToFullyConnect(pool);\n\n    addIgnoredException(IOException.class.getName());\n    addIgnoredException(ConnectException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect bridge server\") {\n      @Override\n      public void run() {\n        closeCache();\n      }\n    });\n\n    await(\"wait for server to leave\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[LEFT] || firedAdapter[CRASHED];\n      }\n    });\n    await(\"wait for server to leave\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[LEFT] || firedBridge[CRASHED];\n      }\n    });\n\n    \r\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isFalse();\n    assertThat(memberIdBridge[JOINED]).isNull();\n    assertThat(memberBridge[JOINED]).isNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isTrue();\n    assertThat(memberBridge[CRASHED]).isNotNull();\n    assertThat(memberIdBridge[CRASHED]).isNotNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberAdapter[JOINED]).isNull();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    \r\n    assertThat(firedAdapter[CRASHED]).isTrue();\n    assertThat(memberAdapter[CRASHED]).isNotNull();\n    assertThat(memberIdAdapter[CRASHED]).isNotNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    \r\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(() -> serverPort)).isEqualTo(ports[0]);\n\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","date":"2018-07-18 03:54:18","endLine":1615,"groupId":"13092","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testServerEventsInLonerClient","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/43/ba84933ab2f0f3523ff119ab90428a8ff762c9.src","preCode":"  public void testServerEventsInLonerClient() throws Exception {\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    ClientMembershipListener bridgeListener = new ClientMembershipListener() {\n      @Override\n      public synchronized void memberJoined(ClientMembershipEvent event) {\n        firedBridgeDuplicate[JOINED] = firedBridge[JOINED];\n        firedBridge[JOINED] = true;\n        memberBridge[JOINED] = event.getMember();\n        memberIdBridge[JOINED] = event.getMemberId();\n        isClientBridge[JOINED] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(ClientMembershipEvent event) {\n        firedBridgeDuplicate[LEFT] = firedBridge[LEFT];\n        firedBridge[LEFT] = true;\n        memberBridge[LEFT] = event.getMember();\n        memberIdBridge[LEFT] = event.getMemberId();\n        isClientBridge[LEFT] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(ClientMembershipEvent event) {\n        firedBridgeDuplicate[CRASHED] = firedBridge[CRASHED];\n        firedBridge[CRASHED] = true;\n        memberBridge[CRASHED] = event.getMember();\n        memberIdBridge[CRASHED] = event.getMemberId();\n        isClientBridge[CRASHED] = event.isClient();\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    Properties config = new Properties();\n    config.put(MCAST_PORT, \"0\");\n    config.put(LOCATORS, \"\");\n    config.setProperty(ENABLE_NETWORK_PARTITION_DETECTION, \"false\");\n    getSystem(config);\n\n    \r\n    ClientMembership.registerClientMembershipListener(bridgeListener);\n\n    \r\n    SerializableCallable createBridgeServer = new SerializableCallable(\"Create BridgeServer\") {\n      @Override\n      public Object call() {\n        getSystem();\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n        try {\n          serverPort = startBridgeServer(ports[0]);\n        } catch (IOException e) {\n          throw new AssertionError(e);\n        }\n\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(\"getServerPort\", () -> serverPort)).isEqualTo(ports[0]);\n\n    \r\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    configureConnectionPool(factory, getServerHostName(host), ports, false, -1, -1, null);\n    createRegion(name, factory.create());\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    String poolName = getRootRegion().getSubregion(name).getAttributes().getPoolName();\n    PoolImpl pool = (PoolImpl) PoolManager.find(poolName);\n    waitForClientToFullyConnect(pool);\n\n    addIgnoredException(IOException.class.getName());\n    addIgnoredException(ConnectException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect bridge server\") {\n      @Override\n      public void run() {\n        closeCache();\n      }\n    });\n\n    await(\"wait for server to leave\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[LEFT] || firedAdapter[CRASHED];\n      }\n    });\n    await(\"wait for server to leave\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[LEFT] || firedBridge[CRASHED];\n      }\n    });\n\n    \r\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isFalse();\n    assertThat(memberIdBridge[JOINED]).isNull();\n    assertThat(memberBridge[JOINED]).isNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isTrue();\n    assertThat(memberBridge[CRASHED]).isNotNull();\n    assertThat(memberIdBridge[CRASHED]).isNotNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberAdapter[JOINED]).isNull();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    \r\n    assertThat(firedAdapter[CRASHED]).isTrue();\n    assertThat(memberAdapter[CRASHED]).isNotNull();\n    assertThat(memberIdAdapter[CRASHED]).isNotNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    \r\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(() -> serverPort)).isEqualTo(ports[0]);\n\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","realPath":"geode-core/src/distributedTest/java/org/apache/geode/management/UniversalMembershipListenerAdapterDUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":1330,"status":"B"}],"commitId":"cb202f25b93e0a56f4776813da0bf6dcbba231cd","commitMessage":"@@@GEODE-5363: Moves all non-unit tests into specific isolated source sets. (#2126)\n\n* Creates integrationTest source set.\n* Creates distributedTest source set.\n* Creates acceptanceTest source set.\n* Creates uiTest source set.\n* Removes old categories.","date":"2018-07-18 03:54:18","modifiedFileCount":"697","status":"B","submitter":"Jacob Barrett"},{"authorTime":"2018-10-05 06:38:58","codes":[{"authorDate":"2018-07-18 03:54:18","commitOrder":2,"curCode":"  public void testServerEventsInPeerSystem() throws Exception {\n    boolean[] firedSystem = new boolean[3];\n    DistributedMember[] memberSystem = new DistributedMember[3];\n    String[] memberIdSystem = new String[3];\n    boolean[] isClientSystem = new boolean[3];\n\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedSystemDuplicate = new boolean[3];\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    MembershipListener systemListener = new MembershipListener() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedSystemDuplicate[JOINED] = firedSystem[JOINED];\n        firedSystem[JOINED] = true;\n        memberSystem[JOINED] = event.getDistributedMember();\n        memberIdSystem[JOINED] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedSystemDuplicate[LEFT] = firedSystem[LEFT];\n        firedSystem[LEFT] = true;\n        memberSystem[LEFT] = event.getDistributedMember();\n        memberIdSystem[LEFT] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedSystemDuplicate[CRASHED] = firedSystem[CRASHED];\n        firedSystem[CRASHED] = true;\n        memberSystem[CRASHED] = event.getDistributedMember();\n        memberIdSystem[CRASHED] = event.getMemberId();\n        notifyAll();\n      }\n    };\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = this.getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    \r\n    getSystem();\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    Region region = createRegion(name, factory.create());\n    assertThat(region).isNotNull();\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    ports[0] = startBridgeServer(0);\n    assertThat(ports[0] != 0).isTrue();\n\n    DistributedMember serverMember = getMemberId();\n    String serverMemberId = serverMember.getId();\n    Properties serverProperties = getSystem().getProperties();\n\n    serverProperties.remove(CLUSTER_SSL_ENABLED);\n    serverProperties.remove(CLUSTER_SSL_CIPHERS);\n    serverProperties.remove(CLUSTER_SSL_PROTOCOLS);\n    serverProperties.remove(CLUSTER_SSL_REQUIRE_AUTHENTICATION);\n\n    InternalCache cache = getInternalCache();\n    ManagementService service = ManagementService.getExistingManagementService(cache);\n    \r\n    service.addMembershipListener(systemListener);\n\n    \r\n    adapter.registerMembershipListener(service);\n\n    \r\n    SerializableCallable createPeerCache = new SerializableCallable(\"Create Peer Cache\") {\n      @Override\n      public Object call() {\n        getSystem(serverProperties);\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    DistributedMember peerMember = (DistributedMember) vm0.invoke(createPeerCache);\n    String peerMemberId = peerMember.getId();\n\n    synchronized (systemListener) {\n      if (!firedSystem[JOINED]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[JOINED]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    assertArrayFalse(firedSystemDuplicate);\n\n    assertThat(firedSystem[JOINED]).isTrue();\n    assertThat(memberSystem[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isFalse();\n    assertThat(memberSystem[LEFT]).isNull();\n    assertThat(memberIdSystem[LEFT]).isNull();\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(memberAdapter[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    addIgnoredException(ServerConnectivityException.class.getName());\n    addIgnoredException(IOException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect Peer server\") {\n      @Override\n      public void run() {\n        disconnectFromDS();\n      }\n    });\n\n    synchronized (systemListener) {\n      if (!firedSystem[LEFT]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[LEFT]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    \r\n\n    assertArrayFalse(firedSystemDuplicate);\n    assertArrayFalse(firedAdapterDuplicate);\n\n    assertThat(firedSystem[JOINED]).isFalse();\n    assertThat(memberSystem[JOINED]).isNull();\n    assertThat(memberIdSystem[JOINED]).isNull();\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isTrue();\n    assertThat(memberSystem[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    \r\n    assertThat(firedAdapter[LEFT]).isTrue();\n    assertThat(memberAdapter[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[LEFT]).isFalse();\n\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","date":"2018-07-18 03:54:18","endLine":1324,"groupId":"34929","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testServerEventsInPeerSystem","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/43/ba84933ab2f0f3523ff119ab90428a8ff762c9.src","preCode":"  public void testServerEventsInPeerSystem() throws Exception {\n    boolean[] firedSystem = new boolean[3];\n    DistributedMember[] memberSystem = new DistributedMember[3];\n    String[] memberIdSystem = new String[3];\n    boolean[] isClientSystem = new boolean[3];\n\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedSystemDuplicate = new boolean[3];\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    MembershipListener systemListener = new MembershipListener() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedSystemDuplicate[JOINED] = firedSystem[JOINED];\n        firedSystem[JOINED] = true;\n        memberSystem[JOINED] = event.getDistributedMember();\n        memberIdSystem[JOINED] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedSystemDuplicate[LEFT] = firedSystem[LEFT];\n        firedSystem[LEFT] = true;\n        memberSystem[LEFT] = event.getDistributedMember();\n        memberIdSystem[LEFT] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedSystemDuplicate[CRASHED] = firedSystem[CRASHED];\n        firedSystem[CRASHED] = true;\n        memberSystem[CRASHED] = event.getDistributedMember();\n        memberIdSystem[CRASHED] = event.getMemberId();\n        notifyAll();\n      }\n    };\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = this.getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    \r\n    getSystem();\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    Region region = createRegion(name, factory.create());\n    assertThat(region).isNotNull();\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    ports[0] = startBridgeServer(0);\n    assertThat(ports[0] != 0).isTrue();\n\n    DistributedMember serverMember = getMemberId();\n    String serverMemberId = serverMember.getId();\n    Properties serverProperties = getSystem().getProperties();\n\n    serverProperties.remove(CLUSTER_SSL_ENABLED);\n    serverProperties.remove(CLUSTER_SSL_CIPHERS);\n    serverProperties.remove(CLUSTER_SSL_PROTOCOLS);\n    serverProperties.remove(CLUSTER_SSL_REQUIRE_AUTHENTICATION);\n\n    InternalCache cache = getInternalCache();\n    ManagementService service = ManagementService.getExistingManagementService(cache);\n    \r\n    service.addMembershipListener(systemListener);\n\n    \r\n    adapter.registerMembershipListener(service);\n\n    \r\n    SerializableCallable createPeerCache = new SerializableCallable(\"Create Peer Cache\") {\n      @Override\n      public Object call() {\n        getSystem(serverProperties);\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    DistributedMember peerMember = (DistributedMember) vm0.invoke(createPeerCache);\n    String peerMemberId = peerMember.getId();\n\n    synchronized (systemListener) {\n      if (!firedSystem[JOINED]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[JOINED]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    assertArrayFalse(firedSystemDuplicate);\n\n    assertThat(firedSystem[JOINED]).isTrue();\n    assertThat(memberSystem[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isFalse();\n    assertThat(memberSystem[LEFT]).isNull();\n    assertThat(memberIdSystem[LEFT]).isNull();\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(memberAdapter[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    addIgnoredException(ServerConnectivityException.class.getName());\n    addIgnoredException(IOException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect Peer server\") {\n      @Override\n      public void run() {\n        disconnectFromDS();\n      }\n    });\n\n    synchronized (systemListener) {\n      if (!firedSystem[LEFT]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[LEFT]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    \r\n\n    assertArrayFalse(firedSystemDuplicate);\n    assertArrayFalse(firedAdapterDuplicate);\n\n    assertThat(firedSystem[JOINED]).isFalse();\n    assertThat(memberSystem[JOINED]).isNull();\n    assertThat(memberIdSystem[JOINED]).isNull();\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isTrue();\n    assertThat(memberSystem[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    \r\n    assertThat(firedAdapter[LEFT]).isTrue();\n    assertThat(memberAdapter[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[LEFT]).isFalse();\n\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","realPath":"geode-core/src/distributedTest/java/org/apache/geode/management/UniversalMembershipListenerAdapterDUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":1078,"status":"N"},{"authorDate":"2018-10-05 06:38:58","commitOrder":2,"curCode":"  public void testServerEventsInLonerClient() throws Exception {\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    ClientMembershipListener bridgeListener = new ClientMembershipListener() {\n      @Override\n      public synchronized void memberJoined(ClientMembershipEvent event) {\n        firedBridgeDuplicate[JOINED] = firedBridge[JOINED];\n        firedBridge[JOINED] = true;\n        memberBridge[JOINED] = event.getMember();\n        memberIdBridge[JOINED] = event.getMemberId();\n        isClientBridge[JOINED] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(ClientMembershipEvent event) {\n        firedBridgeDuplicate[LEFT] = firedBridge[LEFT];\n        firedBridge[LEFT] = true;\n        memberBridge[LEFT] = event.getMember();\n        memberIdBridge[LEFT] = event.getMemberId();\n        isClientBridge[LEFT] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(ClientMembershipEvent event) {\n        firedBridgeDuplicate[CRASHED] = firedBridge[CRASHED];\n        firedBridge[CRASHED] = true;\n        memberBridge[CRASHED] = event.getMember();\n        memberIdBridge[CRASHED] = event.getMemberId();\n        isClientBridge[CRASHED] = event.isClient();\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    Properties config = new Properties();\n    config.put(MCAST_PORT, \"0\");\n    config.put(LOCATORS, \"\");\n    config.setProperty(ENABLE_NETWORK_PARTITION_DETECTION, \"false\");\n    getSystem(config);\n\n    \r\n    ClientMembership.registerClientMembershipListener(bridgeListener);\n\n    \r\n    SerializableCallable createBridgeServer = new SerializableCallable(\"Create BridgeServer\") {\n      @Override\n      public Object call() {\n        getSystem();\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n        try {\n          serverPort = startBridgeServer(ports[0]);\n        } catch (IOException e) {\n          throw new AssertionError(e);\n        }\n\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(\"getServerPort\", () -> serverPort)).isEqualTo(ports[0]);\n\n    \r\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    configureConnectionPool(factory, getServerHostName(host), ports, false, -1, -1, null);\n    createRegion(name, factory.create());\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    await(\"wait for join\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    String poolName = getRootRegion().getSubregion(name).getAttributes().getPoolName();\n    PoolImpl pool = (PoolImpl) PoolManager.find(poolName);\n    waitForClientToFullyConnect(pool);\n\n    addIgnoredException(IOException.class.getName());\n    addIgnoredException(ConnectException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect bridge server\") {\n      @Override\n      public void run() {\n        closeCache();\n      }\n    });\n\n    await(\"wait for server to leave\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[LEFT] || firedAdapter[CRASHED];\n      }\n    });\n    await(\"wait for server to leave\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[LEFT] || firedBridge[CRASHED];\n      }\n    });\n\n    \r\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isFalse();\n    assertThat(memberIdBridge[JOINED]).isNull();\n    assertThat(memberBridge[JOINED]).isNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isTrue();\n    assertThat(memberBridge[CRASHED]).isNotNull();\n    assertThat(memberIdBridge[CRASHED]).isNotNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberAdapter[JOINED]).isNull();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    \r\n    assertThat(firedAdapter[CRASHED]).isTrue();\n    assertThat(memberAdapter[CRASHED]).isNotNull();\n    assertThat(memberIdAdapter[CRASHED]).isNotNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    \r\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(() -> serverPort)).isEqualTo(ports[0]);\n\n    await(\"wait for join\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","date":"2018-10-19 08:01:02","endLine":1601,"groupId":"13092","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testServerEventsInLonerClient","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/ac/fe49ca4589927acb27702459272a17ebf47bb2.src","preCode":"  public void testServerEventsInLonerClient() throws Exception {\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    ClientMembershipListener bridgeListener = new ClientMembershipListener() {\n      @Override\n      public synchronized void memberJoined(ClientMembershipEvent event) {\n        firedBridgeDuplicate[JOINED] = firedBridge[JOINED];\n        firedBridge[JOINED] = true;\n        memberBridge[JOINED] = event.getMember();\n        memberIdBridge[JOINED] = event.getMemberId();\n        isClientBridge[JOINED] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(ClientMembershipEvent event) {\n        firedBridgeDuplicate[LEFT] = firedBridge[LEFT];\n        firedBridge[LEFT] = true;\n        memberBridge[LEFT] = event.getMember();\n        memberIdBridge[LEFT] = event.getMemberId();\n        isClientBridge[LEFT] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(ClientMembershipEvent event) {\n        firedBridgeDuplicate[CRASHED] = firedBridge[CRASHED];\n        firedBridge[CRASHED] = true;\n        memberBridge[CRASHED] = event.getMember();\n        memberIdBridge[CRASHED] = event.getMemberId();\n        isClientBridge[CRASHED] = event.isClient();\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    Properties config = new Properties();\n    config.put(MCAST_PORT, \"0\");\n    config.put(LOCATORS, \"\");\n    config.setProperty(ENABLE_NETWORK_PARTITION_DETECTION, \"false\");\n    getSystem(config);\n\n    \r\n    ClientMembership.registerClientMembershipListener(bridgeListener);\n\n    \r\n    SerializableCallable createBridgeServer = new SerializableCallable(\"Create BridgeServer\") {\n      @Override\n      public Object call() {\n        getSystem();\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n        try {\n          serverPort = startBridgeServer(ports[0]);\n        } catch (IOException e) {\n          throw new AssertionError(e);\n        }\n\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(\"getServerPort\", () -> serverPort)).isEqualTo(ports[0]);\n\n    \r\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    configureConnectionPool(factory, getServerHostName(host), ports, false, -1, -1, null);\n    createRegion(name, factory.create());\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    String poolName = getRootRegion().getSubregion(name).getAttributes().getPoolName();\n    PoolImpl pool = (PoolImpl) PoolManager.find(poolName);\n    waitForClientToFullyConnect(pool);\n\n    addIgnoredException(IOException.class.getName());\n    addIgnoredException(ConnectException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect bridge server\") {\n      @Override\n      public void run() {\n        closeCache();\n      }\n    });\n\n    await(\"wait for server to leave\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[LEFT] || firedAdapter[CRASHED];\n      }\n    });\n    await(\"wait for server to leave\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[LEFT] || firedBridge[CRASHED];\n      }\n    });\n\n    \r\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isFalse();\n    assertThat(memberIdBridge[JOINED]).isNull();\n    assertThat(memberBridge[JOINED]).isNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isTrue();\n    assertThat(memberBridge[CRASHED]).isNotNull();\n    assertThat(memberIdBridge[CRASHED]).isNotNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberAdapter[JOINED]).isNull();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    \r\n    assertThat(firedAdapter[CRASHED]).isTrue();\n    assertThat(memberAdapter[CRASHED]).isNotNull();\n    assertThat(memberIdAdapter[CRASHED]).isNotNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    \r\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(() -> serverPort)).isEqualTo(ports[0]);\n\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").atMost(ASYNC_EVENT_WAIT_MILLIS, MILLISECONDS).until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","realPath":"geode-core/src/distributedTest/java/org/apache/geode/management/UniversalMembershipListenerAdapterDUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":1316,"status":"M"}],"commitId":"239c532f8338c9d8e9bb8062fab9fadd3376ec73","commitMessage":"@@@GEODE-5424: Changing all awaitility calls to use consistent timings\n\nWe have a lot of Awaitility calls in our tests. Each test was picking\nits own timeout. That lead to some tests picking too small of a timeout\nand failing spuriously.\n\nWith this change.  all tests will use a new factory. \nGeodeAwaility.await().  rather than Awaitility.await(). This new factory\nsets a default timeout of 5 minutes. It also sets a sensible pollDelay\nand pollInterval.\n\nThe custom timeouts used in all tests have been removed.  in favor of\nthis new factory.  except for a couple of tests that had waits greater\nthan 5 minutes.\n","date":"2018-10-19 08:01:02","modifiedFileCount":"334","status":"M","submitter":"Dan Smith"},{"authorTime":"2018-11-02 04:59:55","codes":[{"authorDate":"2018-07-18 03:54:18","commitOrder":3,"curCode":"  public void testServerEventsInPeerSystem() throws Exception {\n    boolean[] firedSystem = new boolean[3];\n    DistributedMember[] memberSystem = new DistributedMember[3];\n    String[] memberIdSystem = new String[3];\n    boolean[] isClientSystem = new boolean[3];\n\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedSystemDuplicate = new boolean[3];\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    MembershipListener systemListener = new MembershipListener() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedSystemDuplicate[JOINED] = firedSystem[JOINED];\n        firedSystem[JOINED] = true;\n        memberSystem[JOINED] = event.getDistributedMember();\n        memberIdSystem[JOINED] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedSystemDuplicate[LEFT] = firedSystem[LEFT];\n        firedSystem[LEFT] = true;\n        memberSystem[LEFT] = event.getDistributedMember();\n        memberIdSystem[LEFT] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedSystemDuplicate[CRASHED] = firedSystem[CRASHED];\n        firedSystem[CRASHED] = true;\n        memberSystem[CRASHED] = event.getDistributedMember();\n        memberIdSystem[CRASHED] = event.getMemberId();\n        notifyAll();\n      }\n    };\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = this.getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    \r\n    getSystem();\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    Region region = createRegion(name, factory.create());\n    assertThat(region).isNotNull();\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    ports[0] = startBridgeServer(0);\n    assertThat(ports[0] != 0).isTrue();\n\n    DistributedMember serverMember = getMemberId();\n    String serverMemberId = serverMember.getId();\n    Properties serverProperties = getSystem().getProperties();\n\n    serverProperties.remove(CLUSTER_SSL_ENABLED);\n    serverProperties.remove(CLUSTER_SSL_CIPHERS);\n    serverProperties.remove(CLUSTER_SSL_PROTOCOLS);\n    serverProperties.remove(CLUSTER_SSL_REQUIRE_AUTHENTICATION);\n\n    InternalCache cache = getInternalCache();\n    ManagementService service = ManagementService.getExistingManagementService(cache);\n    \r\n    service.addMembershipListener(systemListener);\n\n    \r\n    adapter.registerMembershipListener(service);\n\n    \r\n    SerializableCallable createPeerCache = new SerializableCallable(\"Create Peer Cache\") {\n      @Override\n      public Object call() {\n        getSystem(serverProperties);\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    DistributedMember peerMember = (DistributedMember) vm0.invoke(createPeerCache);\n    String peerMemberId = peerMember.getId();\n\n    synchronized (systemListener) {\n      if (!firedSystem[JOINED]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[JOINED]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    assertArrayFalse(firedSystemDuplicate);\n\n    assertThat(firedSystem[JOINED]).isTrue();\n    assertThat(memberSystem[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isFalse();\n    assertThat(memberSystem[LEFT]).isNull();\n    assertThat(memberIdSystem[LEFT]).isNull();\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(memberAdapter[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    addIgnoredException(ServerConnectivityException.class.getName());\n    addIgnoredException(IOException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect Peer server\") {\n      @Override\n      public void run() {\n        disconnectFromDS();\n      }\n    });\n\n    synchronized (systemListener) {\n      if (!firedSystem[LEFT]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[LEFT]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    \r\n\n    assertArrayFalse(firedSystemDuplicate);\n    assertArrayFalse(firedAdapterDuplicate);\n\n    assertThat(firedSystem[JOINED]).isFalse();\n    assertThat(memberSystem[JOINED]).isNull();\n    assertThat(memberIdSystem[JOINED]).isNull();\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isTrue();\n    assertThat(memberSystem[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    \r\n    assertThat(firedAdapter[LEFT]).isTrue();\n    assertThat(memberAdapter[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[LEFT]).isFalse();\n\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","date":"2018-07-18 03:54:18","endLine":1324,"groupId":"34929","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testServerEventsInPeerSystem","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/43/ba84933ab2f0f3523ff119ab90428a8ff762c9.src","preCode":"  public void testServerEventsInPeerSystem() throws Exception {\n    boolean[] firedSystem = new boolean[3];\n    DistributedMember[] memberSystem = new DistributedMember[3];\n    String[] memberIdSystem = new String[3];\n    boolean[] isClientSystem = new boolean[3];\n\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedSystemDuplicate = new boolean[3];\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    MembershipListener systemListener = new MembershipListener() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedSystemDuplicate[JOINED] = firedSystem[JOINED];\n        firedSystem[JOINED] = true;\n        memberSystem[JOINED] = event.getDistributedMember();\n        memberIdSystem[JOINED] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedSystemDuplicate[LEFT] = firedSystem[LEFT];\n        firedSystem[LEFT] = true;\n        memberSystem[LEFT] = event.getDistributedMember();\n        memberIdSystem[LEFT] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedSystemDuplicate[CRASHED] = firedSystem[CRASHED];\n        firedSystem[CRASHED] = true;\n        memberSystem[CRASHED] = event.getDistributedMember();\n        memberIdSystem[CRASHED] = event.getMemberId();\n        notifyAll();\n      }\n    };\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = this.getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    \r\n    getSystem();\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    Region region = createRegion(name, factory.create());\n    assertThat(region).isNotNull();\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    ports[0] = startBridgeServer(0);\n    assertThat(ports[0] != 0).isTrue();\n\n    DistributedMember serverMember = getMemberId();\n    String serverMemberId = serverMember.getId();\n    Properties serverProperties = getSystem().getProperties();\n\n    serverProperties.remove(CLUSTER_SSL_ENABLED);\n    serverProperties.remove(CLUSTER_SSL_CIPHERS);\n    serverProperties.remove(CLUSTER_SSL_PROTOCOLS);\n    serverProperties.remove(CLUSTER_SSL_REQUIRE_AUTHENTICATION);\n\n    InternalCache cache = getInternalCache();\n    ManagementService service = ManagementService.getExistingManagementService(cache);\n    \r\n    service.addMembershipListener(systemListener);\n\n    \r\n    adapter.registerMembershipListener(service);\n\n    \r\n    SerializableCallable createPeerCache = new SerializableCallable(\"Create Peer Cache\") {\n      @Override\n      public Object call() {\n        getSystem(serverProperties);\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    DistributedMember peerMember = (DistributedMember) vm0.invoke(createPeerCache);\n    String peerMemberId = peerMember.getId();\n\n    synchronized (systemListener) {\n      if (!firedSystem[JOINED]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[JOINED]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    assertArrayFalse(firedSystemDuplicate);\n\n    assertThat(firedSystem[JOINED]).isTrue();\n    assertThat(memberSystem[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isFalse();\n    assertThat(memberSystem[LEFT]).isNull();\n    assertThat(memberIdSystem[LEFT]).isNull();\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(memberAdapter[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    addIgnoredException(ServerConnectivityException.class.getName());\n    addIgnoredException(IOException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect Peer server\") {\n      @Override\n      public void run() {\n        disconnectFromDS();\n      }\n    });\n\n    synchronized (systemListener) {\n      if (!firedSystem[LEFT]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[LEFT]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    \r\n\n    assertArrayFalse(firedSystemDuplicate);\n    assertArrayFalse(firedAdapterDuplicate);\n\n    assertThat(firedSystem[JOINED]).isFalse();\n    assertThat(memberSystem[JOINED]).isNull();\n    assertThat(memberIdSystem[JOINED]).isNull();\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isTrue();\n    assertThat(memberSystem[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    \r\n    assertThat(firedAdapter[LEFT]).isTrue();\n    assertThat(memberAdapter[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[LEFT]).isFalse();\n\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","realPath":"geode-core/src/distributedTest/java/org/apache/geode/management/UniversalMembershipListenerAdapterDUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":1078,"status":"N"},{"authorDate":"2018-11-02 04:59:55","commitOrder":3,"curCode":"  public void testServerEventsInLonerClient() throws Exception {\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    ClientMembershipListener bridgeListener = new ClientMembershipListener() {\n      @Override\n      public synchronized void memberJoined(ClientMembershipEvent event) {\n        firedBridgeDuplicate[JOINED] = firedBridge[JOINED];\n        firedBridge[JOINED] = true;\n        memberBridge[JOINED] = event.getMember();\n        memberIdBridge[JOINED] = event.getMemberId();\n        isClientBridge[JOINED] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(ClientMembershipEvent event) {\n        firedBridgeDuplicate[LEFT] = firedBridge[LEFT];\n        firedBridge[LEFT] = true;\n        memberBridge[LEFT] = event.getMember();\n        memberIdBridge[LEFT] = event.getMemberId();\n        isClientBridge[LEFT] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(ClientMembershipEvent event) {\n        firedBridgeDuplicate[CRASHED] = firedBridge[CRASHED];\n        firedBridge[CRASHED] = true;\n        memberBridge[CRASHED] = event.getMember();\n        memberIdBridge[CRASHED] = event.getMemberId();\n        isClientBridge[CRASHED] = event.isClient();\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    Properties config = new Properties();\n    config.put(MCAST_PORT, \"0\");\n    config.put(LOCATORS, \"\");\n    config.setProperty(ENABLE_NETWORK_PARTITION_DETECTION, \"false\");\n    getSystem(config);\n\n    \r\n    ClientMembership.registerClientMembershipListener(bridgeListener);\n\n    \r\n    SerializableCallable createBridgeServer = new SerializableCallable(\"Create BridgeServer\") {\n      @Override\n      public Object call() {\n        getSystem();\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n        try {\n          serverPort = startBridgeServer(ports[0]);\n        } catch (IOException e) {\n          throw new AssertionError(e);\n        }\n\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(\"getServerPort\", () -> serverPort)).isEqualTo(ports[0]);\n\n    \r\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    configureConnectionPool(factory, getServerHostName(host), ports, false, -1, -1, null);\n    createRegion(name, factory.create());\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    await(\"wait for join\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    String poolName = getRootRegion().getSubregion(name).getAttributes().getPoolName();\n    PoolImpl pool = (PoolImpl) PoolManager.find(poolName);\n    waitForClientToFullyConnect(pool);\n\n    addIgnoredException(IOException.class.getName());\n    addIgnoredException(ConnectException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect cache server\") {\n      @Override\n      public void run() {\n        closeCache();\n      }\n    });\n\n    await(\"wait for server to leave\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[LEFT] || firedAdapter[CRASHED];\n      }\n    });\n    await(\"wait for server to leave\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[LEFT] || firedBridge[CRASHED];\n      }\n    });\n\n    \r\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isFalse();\n    assertThat(memberIdBridge[JOINED]).isNull();\n    assertThat(memberBridge[JOINED]).isNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isTrue();\n    assertThat(memberBridge[CRASHED]).isNotNull();\n    assertThat(memberIdBridge[CRASHED]).isNotNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberAdapter[JOINED]).isNull();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    \r\n    assertThat(firedAdapter[CRASHED]).isTrue();\n    assertThat(memberAdapter[CRASHED]).isNotNull();\n    assertThat(memberIdAdapter[CRASHED]).isNotNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    \r\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(() -> serverPort)).isEqualTo(ports[0]);\n\n    await(\"wait for join\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","date":"2018-11-02 04:59:55","endLine":1601,"groupId":"13092","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testServerEventsInLonerClient","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/ab/8ea708c8d3a24ca799e43b501463adb1a1279f.src","preCode":"  public void testServerEventsInLonerClient() throws Exception {\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    ClientMembershipListener bridgeListener = new ClientMembershipListener() {\n      @Override\n      public synchronized void memberJoined(ClientMembershipEvent event) {\n        firedBridgeDuplicate[JOINED] = firedBridge[JOINED];\n        firedBridge[JOINED] = true;\n        memberBridge[JOINED] = event.getMember();\n        memberIdBridge[JOINED] = event.getMemberId();\n        isClientBridge[JOINED] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(ClientMembershipEvent event) {\n        firedBridgeDuplicate[LEFT] = firedBridge[LEFT];\n        firedBridge[LEFT] = true;\n        memberBridge[LEFT] = event.getMember();\n        memberIdBridge[LEFT] = event.getMemberId();\n        isClientBridge[LEFT] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(ClientMembershipEvent event) {\n        firedBridgeDuplicate[CRASHED] = firedBridge[CRASHED];\n        firedBridge[CRASHED] = true;\n        memberBridge[CRASHED] = event.getMember();\n        memberIdBridge[CRASHED] = event.getMemberId();\n        isClientBridge[CRASHED] = event.isClient();\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    Properties config = new Properties();\n    config.put(MCAST_PORT, \"0\");\n    config.put(LOCATORS, \"\");\n    config.setProperty(ENABLE_NETWORK_PARTITION_DETECTION, \"false\");\n    getSystem(config);\n\n    \r\n    ClientMembership.registerClientMembershipListener(bridgeListener);\n\n    \r\n    SerializableCallable createBridgeServer = new SerializableCallable(\"Create BridgeServer\") {\n      @Override\n      public Object call() {\n        getSystem();\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n        try {\n          serverPort = startBridgeServer(ports[0]);\n        } catch (IOException e) {\n          throw new AssertionError(e);\n        }\n\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(\"getServerPort\", () -> serverPort)).isEqualTo(ports[0]);\n\n    \r\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    configureConnectionPool(factory, getServerHostName(host), ports, false, -1, -1, null);\n    createRegion(name, factory.create());\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    await(\"wait for join\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    String poolName = getRootRegion().getSubregion(name).getAttributes().getPoolName();\n    PoolImpl pool = (PoolImpl) PoolManager.find(poolName);\n    waitForClientToFullyConnect(pool);\n\n    addIgnoredException(IOException.class.getName());\n    addIgnoredException(ConnectException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect bridge server\") {\n      @Override\n      public void run() {\n        closeCache();\n      }\n    });\n\n    await(\"wait for server to leave\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[LEFT] || firedAdapter[CRASHED];\n      }\n    });\n    await(\"wait for server to leave\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[LEFT] || firedBridge[CRASHED];\n      }\n    });\n\n    \r\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isFalse();\n    assertThat(memberIdBridge[JOINED]).isNull();\n    assertThat(memberBridge[JOINED]).isNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isTrue();\n    assertThat(memberBridge[CRASHED]).isNotNull();\n    assertThat(memberIdBridge[CRASHED]).isNotNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberAdapter[JOINED]).isNull();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    \r\n    assertThat(firedAdapter[CRASHED]).isTrue();\n    assertThat(memberAdapter[CRASHED]).isNotNull();\n    assertThat(memberIdAdapter[CRASHED]).isNotNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    \r\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(() -> serverPort)).isEqualTo(ports[0]);\n\n    await(\"wait for join\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","realPath":"geode-core/src/distributedTest/java/org/apache/geode/management/UniversalMembershipListenerAdapterDUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":1316,"status":"M"}],"commitId":"75c40cf18b830b2213de0c5ef1ea731238d29d5a","commitMessage":"@@@GEODE-5686: Remove LocalizedStrings\n\nFixing problems found by lgtm.com\n\nThere were a lot of logging calls that were improperly converted from\n(MessageFormatString.  Argument.  Exception) to a form that treated the\nException as part of the String.format() call.\n\nThere were a number of errors in format strings or number of arguments.\nMessageFormat was more forgiving about this than String.format().\n\nThere were a few dangling MessageFormat specs that needed to be\nconverted to String.format() specs.\n\nThis closes #2757\n","date":"2018-11-02 04:59:55","modifiedFileCount":"250","status":"M","submitter":"Bruce Schuchardt"},{"authorTime":"2020-12-18 03:10:55","codes":[{"authorDate":"2020-12-18 03:10:55","commitOrder":4,"curCode":"  public void testServerEventsInPeerSystem() throws Exception {\n    boolean[] firedSystem = new boolean[3];\n    DistributedMember[] memberSystem = new DistributedMember[3];\n    String[] memberIdSystem = new String[3];\n    boolean[] isClientSystem = new boolean[3];\n\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedSystemDuplicate = new boolean[3];\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    MembershipListener systemListener = new MembershipListener() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedSystemDuplicate[JOINED] = firedSystem[JOINED];\n        firedSystem[JOINED] = true;\n        memberSystem[JOINED] = event.getDistributedMember();\n        memberIdSystem[JOINED] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedSystemDuplicate[LEFT] = firedSystem[LEFT];\n        firedSystem[LEFT] = true;\n        memberSystem[LEFT] = event.getDistributedMember();\n        memberIdSystem[LEFT] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedSystemDuplicate[CRASHED] = firedSystem[CRASHED];\n        firedSystem[CRASHED] = true;\n        memberSystem[CRASHED] = event.getDistributedMember();\n        memberIdSystem[CRASHED] = event.getMemberId();\n        notifyAll();\n      }\n    };\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = this.getUniqueName();\n    int[] ports = getRandomAvailableTCPPorts(1);\n    assertThat(ports[0] != 0).isTrue();\n\n    \r\n    getSystem();\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    Region region = createRegion(name, factory.create());\n    assertThat(region).isNotNull();\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    ports[0] = startBridgeServer(0);\n    assertThat(ports[0] != 0).isTrue();\n\n    DistributedMember serverMember = getMemberId();\n    String serverMemberId = serverMember.getId();\n    Properties serverProperties = getSystem().getProperties();\n\n    serverProperties.remove(CLUSTER_SSL_ENABLED);\n    serverProperties.remove(CLUSTER_SSL_CIPHERS);\n    serverProperties.remove(CLUSTER_SSL_PROTOCOLS);\n    serverProperties.remove(CLUSTER_SSL_REQUIRE_AUTHENTICATION);\n\n    InternalCache cache = getInternalCache();\n    ManagementService service = ManagementService.getExistingManagementService(cache);\n    \r\n    service.addMembershipListener(systemListener);\n\n    \r\n    adapter.registerMembershipListener(service);\n\n    \r\n    SerializableCallable createPeerCache = new SerializableCallable(\"Create Peer Cache\") {\n      @Override\n      public Object call() {\n        getSystem(serverProperties);\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    DistributedMember peerMember = (DistributedMember) vm0.invoke(createPeerCache);\n    String peerMemberId = peerMember.getId();\n\n    synchronized (systemListener) {\n      if (!firedSystem[JOINED]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[JOINED]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    assertArrayFalse(firedSystemDuplicate);\n\n    assertThat(firedSystem[JOINED]).isTrue();\n    assertThat(memberSystem[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isFalse();\n    assertThat(memberSystem[LEFT]).isNull();\n    assertThat(memberIdSystem[LEFT]).isNull();\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(memberAdapter[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    addIgnoredException(ServerConnectivityException.class.getName());\n    addIgnoredException(IOException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect Peer server\") {\n      @Override\n      public void run() {\n        disconnectFromDS();\n      }\n    });\n\n    synchronized (systemListener) {\n      if (!firedSystem[LEFT]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[LEFT]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    \r\n\n    assertArrayFalse(firedSystemDuplicate);\n    assertArrayFalse(firedAdapterDuplicate);\n\n    assertThat(firedSystem[JOINED]).isFalse();\n    assertThat(memberSystem[JOINED]).isNull();\n    assertThat(memberIdSystem[JOINED]).isNull();\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isTrue();\n    assertThat(memberSystem[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    \r\n    assertThat(firedAdapter[LEFT]).isTrue();\n    assertThat(memberAdapter[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[LEFT]).isFalse();\n\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","date":"2020-12-18 03:10:55","endLine":1309,"groupId":"105376","id":7,"instanceNumber":1,"isCurCommit":1,"methodName":"testServerEventsInPeerSystem","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/9e/2de28bfd87cad2f1a1b0b71423a6f3a8c4d0ea.src","preCode":"  public void testServerEventsInPeerSystem() throws Exception {\n    boolean[] firedSystem = new boolean[3];\n    DistributedMember[] memberSystem = new DistributedMember[3];\n    String[] memberIdSystem = new String[3];\n    boolean[] isClientSystem = new boolean[3];\n\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedSystemDuplicate = new boolean[3];\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    MembershipListener systemListener = new MembershipListener() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedSystemDuplicate[JOINED] = firedSystem[JOINED];\n        firedSystem[JOINED] = true;\n        memberSystem[JOINED] = event.getDistributedMember();\n        memberIdSystem[JOINED] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedSystemDuplicate[LEFT] = firedSystem[LEFT];\n        firedSystem[LEFT] = true;\n        memberSystem[LEFT] = event.getDistributedMember();\n        memberIdSystem[LEFT] = event.getMemberId();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedSystemDuplicate[CRASHED] = firedSystem[CRASHED];\n        firedSystem[CRASHED] = true;\n        memberSystem[CRASHED] = event.getDistributedMember();\n        memberIdSystem[CRASHED] = event.getMemberId();\n        notifyAll();\n      }\n    };\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = this.getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    \r\n    getSystem();\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    Region region = createRegion(name, factory.create());\n    assertThat(region).isNotNull();\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    ports[0] = startBridgeServer(0);\n    assertThat(ports[0] != 0).isTrue();\n\n    DistributedMember serverMember = getMemberId();\n    String serverMemberId = serverMember.getId();\n    Properties serverProperties = getSystem().getProperties();\n\n    serverProperties.remove(CLUSTER_SSL_ENABLED);\n    serverProperties.remove(CLUSTER_SSL_CIPHERS);\n    serverProperties.remove(CLUSTER_SSL_PROTOCOLS);\n    serverProperties.remove(CLUSTER_SSL_REQUIRE_AUTHENTICATION);\n\n    InternalCache cache = getInternalCache();\n    ManagementService service = ManagementService.getExistingManagementService(cache);\n    \r\n    service.addMembershipListener(systemListener);\n\n    \r\n    adapter.registerMembershipListener(service);\n\n    \r\n    SerializableCallable createPeerCache = new SerializableCallable(\"Create Peer Cache\") {\n      @Override\n      public Object call() {\n        getSystem(serverProperties);\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    DistributedMember peerMember = (DistributedMember) vm0.invoke(createPeerCache);\n    String peerMemberId = peerMember.getId();\n\n    synchronized (systemListener) {\n      if (!firedSystem[JOINED]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[JOINED]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    assertArrayFalse(firedSystemDuplicate);\n\n    assertThat(firedSystem[JOINED]).isTrue();\n    assertThat(memberSystem[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isFalse();\n    assertThat(memberSystem[LEFT]).isNull();\n    assertThat(memberIdSystem[LEFT]).isNull();\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(memberAdapter[JOINED]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[JOINED]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    addIgnoredException(ServerConnectivityException.class.getName());\n    addIgnoredException(IOException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect Peer server\") {\n      @Override\n      public void run() {\n        disconnectFromDS();\n      }\n    });\n\n    synchronized (systemListener) {\n      if (!firedSystem[LEFT]) {\n        systemListener.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n    synchronized (adapter) {\n      if (!firedAdapter[LEFT]) {\n        adapter.wait(ASYNC_EVENT_WAIT_MILLIS);\n      }\n    }\n\n    \r\n\n    assertArrayFalse(firedSystemDuplicate);\n    assertArrayFalse(firedAdapterDuplicate);\n\n    assertThat(firedSystem[JOINED]).isFalse();\n    assertThat(memberSystem[JOINED]).isNull();\n    assertThat(memberIdSystem[JOINED]).isNull();\n    assertThat(isClientSystem[JOINED]).isFalse();\n    assertThat(firedSystem[LEFT]).isTrue();\n    assertThat(memberSystem[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdSystem[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientSystem[LEFT]).isFalse();\n    assertThat(firedSystem[CRASHED]).isFalse();\n    assertThat(memberSystem[CRASHED]).isNull();\n    assertThat(memberIdSystem[CRASHED]).isNull();\n    assertThat(isClientSystem[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedSystem, memberSystem, memberIdSystem, isClientSystem);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    \r\n    assertThat(firedAdapter[LEFT]).isTrue();\n    assertThat(memberAdapter[LEFT]).isEqualTo(peerMember);\n    assertThat(memberIdAdapter[LEFT]).isEqualTo(peerMemberId);\n    assertThat(isClientAdapter[LEFT]).isFalse();\n\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","realPath":"geode-core/src/distributedTest/java/org/apache/geode/management/UniversalMembershipListenerAdapterDUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":1063,"status":"M"},{"authorDate":"2020-12-18 03:10:55","commitOrder":4,"curCode":"  public void testServerEventsInLonerClient() throws Exception {\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    ClientMembershipListener bridgeListener = new ClientMembershipListener() {\n      @Override\n      public synchronized void memberJoined(ClientMembershipEvent event) {\n        firedBridgeDuplicate[JOINED] = firedBridge[JOINED];\n        firedBridge[JOINED] = true;\n        memberBridge[JOINED] = event.getMember();\n        memberIdBridge[JOINED] = event.getMemberId();\n        isClientBridge[JOINED] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(ClientMembershipEvent event) {\n        firedBridgeDuplicate[LEFT] = firedBridge[LEFT];\n        firedBridge[LEFT] = true;\n        memberBridge[LEFT] = event.getMember();\n        memberIdBridge[LEFT] = event.getMemberId();\n        isClientBridge[LEFT] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(ClientMembershipEvent event) {\n        firedBridgeDuplicate[CRASHED] = firedBridge[CRASHED];\n        firedBridge[CRASHED] = true;\n        memberBridge[CRASHED] = event.getMember();\n        memberIdBridge[CRASHED] = event.getMemberId();\n        isClientBridge[CRASHED] = event.isClient();\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = getUniqueName();\n    int[] ports = getRandomAvailableTCPPorts(1);\n    assertThat(ports[0] != 0).isTrue();\n\n    Properties config = new Properties();\n    config.put(MCAST_PORT, \"0\");\n    config.put(LOCATORS, \"\");\n    config.setProperty(ENABLE_NETWORK_PARTITION_DETECTION, \"false\");\n    getSystem(config);\n\n    \r\n    ClientMembership.registerClientMembershipListener(bridgeListener);\n\n    \r\n    SerializableCallable createBridgeServer = new SerializableCallable(\"Create BridgeServer\") {\n      @Override\n      public Object call() {\n        getSystem();\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n        try {\n          serverPort = startBridgeServer(ports[0]);\n        } catch (IOException e) {\n          throw new AssertionError(e);\n        }\n\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(\"getServerPort\", () -> serverPort)).isEqualTo(ports[0]);\n\n    \r\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    configureConnectionPool(factory, getServerHostName(host), ports, false, -1, -1, null);\n    createRegion(name, factory.create());\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    await(\"wait for join\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    String poolName = getRootRegion().getSubregion(name).getAttributes().getPoolName();\n    PoolImpl pool = (PoolImpl) PoolManager.find(poolName);\n    waitForClientToFullyConnect(pool);\n\n    addIgnoredException(IOException.class.getName());\n    addIgnoredException(ConnectException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect cache server\") {\n      @Override\n      public void run() {\n        closeCache();\n      }\n    });\n\n    await(\"wait for server to leave\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[LEFT] || firedAdapter[CRASHED];\n      }\n    });\n    await(\"wait for server to leave\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[LEFT] || firedBridge[CRASHED];\n      }\n    });\n\n    \r\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isFalse();\n    assertThat(memberIdBridge[JOINED]).isNull();\n    assertThat(memberBridge[JOINED]).isNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isTrue();\n    assertThat(memberBridge[CRASHED]).isNotNull();\n    assertThat(memberIdBridge[CRASHED]).isNotNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberAdapter[JOINED]).isNull();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    \r\n    assertThat(firedAdapter[CRASHED]).isTrue();\n    assertThat(memberAdapter[CRASHED]).isNotNull();\n    assertThat(memberIdAdapter[CRASHED]).isNotNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    \r\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(() -> serverPort)).isEqualTo(ports[0]);\n\n    await(\"wait for join\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","date":"2020-12-18 03:10:55","endLine":1600,"groupId":"105376","id":8,"instanceNumber":2,"isCurCommit":1,"methodName":"testServerEventsInLonerClient","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/9e/2de28bfd87cad2f1a1b0b71423a6f3a8c4d0ea.src","preCode":"  public void testServerEventsInLonerClient() throws Exception {\n    boolean[] firedAdapter = new boolean[3];\n    DistributedMember[] memberAdapter = new DistributedMember[3];\n    String[] memberIdAdapter = new String[3];\n    boolean[] isClientAdapter = new boolean[3];\n\n    boolean[] firedBridge = new boolean[3];\n    DistributedMember[] memberBridge = new DistributedMember[3];\n    String[] memberIdBridge = new String[3];\n    boolean[] isClientBridge = new boolean[3];\n\n    boolean[] firedAdapterDuplicate = new boolean[3];\n    boolean[] firedBridgeDuplicate = new boolean[3];\n\n    UniversalMembershipListenerAdapter adapter = new UniversalMembershipListenerAdapter() {\n      @Override\n      public synchronized void memberJoined(MembershipEvent event) {\n        firedAdapterDuplicate[JOINED] = firedAdapter[JOINED];\n        firedAdapter[JOINED] = true;\n        memberAdapter[JOINED] = event.getDistributedMember();\n        memberIdAdapter[JOINED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[JOINED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(MembershipEvent event) {\n        firedAdapterDuplicate[LEFT] = firedAdapter[LEFT];\n        firedAdapter[LEFT] = true;\n        memberAdapter[LEFT] = event.getDistributedMember();\n        memberIdAdapter[LEFT] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[LEFT] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(MembershipEvent event) {\n        firedAdapterDuplicate[CRASHED] = firedAdapter[CRASHED];\n        firedAdapter[CRASHED] = true;\n        memberAdapter[CRASHED] = event.getDistributedMember();\n        memberIdAdapter[CRASHED] = event.getMemberId();\n        if (event instanceof AdaptedMembershipEvent) {\n          isClientAdapter[CRASHED] = ((AdaptedMembershipEvent) event).isClient();\n        }\n        notifyAll();\n      }\n    };\n\n    ClientMembershipListener bridgeListener = new ClientMembershipListener() {\n      @Override\n      public synchronized void memberJoined(ClientMembershipEvent event) {\n        firedBridgeDuplicate[JOINED] = firedBridge[JOINED];\n        firedBridge[JOINED] = true;\n        memberBridge[JOINED] = event.getMember();\n        memberIdBridge[JOINED] = event.getMemberId();\n        isClientBridge[JOINED] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberLeft(ClientMembershipEvent event) {\n        firedBridgeDuplicate[LEFT] = firedBridge[LEFT];\n        firedBridge[LEFT] = true;\n        memberBridge[LEFT] = event.getMember();\n        memberIdBridge[LEFT] = event.getMemberId();\n        isClientBridge[LEFT] = event.isClient();\n        notifyAll();\n      }\n\n      @Override\n      public synchronized void memberCrashed(ClientMembershipEvent event) {\n        firedBridgeDuplicate[CRASHED] = firedBridge[CRASHED];\n        firedBridge[CRASHED] = true;\n        memberBridge[CRASHED] = event.getMember();\n        memberIdBridge[CRASHED] = event.getMemberId();\n        isClientBridge[CRASHED] = event.isClient();\n        notifyAll();\n      }\n    };\n\n    Host host = Host.getHost(0);\n    VM vm0 = host.getVM(0);\n    String name = getUniqueName();\n    int[] ports = new int[] {getRandomAvailablePort(SOCKET)};\n    assertThat(ports[0] != 0).isTrue();\n\n    Properties config = new Properties();\n    config.put(MCAST_PORT, \"0\");\n    config.put(LOCATORS, \"\");\n    config.setProperty(ENABLE_NETWORK_PARTITION_DETECTION, \"false\");\n    getSystem(config);\n\n    \r\n    ClientMembership.registerClientMembershipListener(bridgeListener);\n\n    \r\n    SerializableCallable createBridgeServer = new SerializableCallable(\"Create BridgeServer\") {\n      @Override\n      public Object call() {\n        getSystem();\n        AttributesFactory factory = new AttributesFactory();\n        factory.setScope(Scope.LOCAL);\n        Region region = createRegion(name, factory.create());\n        assertThat(region).isNotNull();\n        assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n        try {\n          serverPort = startBridgeServer(ports[0]);\n        } catch (IOException e) {\n          throw new AssertionError(e);\n        }\n\n        return basicGetSystem().getDistributedMember();\n      }\n    };\n\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(\"getServerPort\", () -> serverPort)).isEqualTo(ports[0]);\n\n    \r\n    AttributesFactory factory = new AttributesFactory();\n    factory.setScope(Scope.LOCAL);\n    configureConnectionPool(factory, getServerHostName(host), ports, false, -1, -1, null);\n    createRegion(name, factory.create());\n    assertThat(getRootRegion().getSubregion(name)).isNotNull();\n\n    await(\"wait for join\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    String poolName = getRootRegion().getSubregion(name).getAttributes().getPoolName();\n    PoolImpl pool = (PoolImpl) PoolManager.find(poolName);\n    waitForClientToFullyConnect(pool);\n\n    addIgnoredException(IOException.class.getName());\n    addIgnoredException(ConnectException.class.getName());\n\n    vm0.invoke(new SerializableRunnable(\"Disconnect cache server\") {\n      @Override\n      public void run() {\n        closeCache();\n      }\n    });\n\n    await(\"wait for server to leave\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[LEFT] || firedAdapter[CRASHED];\n      }\n    });\n    await(\"wait for server to leave\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[LEFT] || firedBridge[CRASHED];\n      }\n    });\n\n    \r\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isFalse();\n    assertThat(memberIdBridge[JOINED]).isNull();\n    assertThat(memberBridge[JOINED]).isNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isTrue();\n    assertThat(memberBridge[CRASHED]).isNotNull();\n    assertThat(memberIdBridge[CRASHED]).isNotNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isFalse();\n    assertThat(memberAdapter[JOINED]).isNull();\n    assertThat(memberIdAdapter[JOINED]).isNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    \r\n    assertThat(firedAdapter[CRASHED]).isTrue();\n    assertThat(memberAdapter[CRASHED]).isNotNull();\n    assertThat(memberIdAdapter[CRASHED]).isNotNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n\n    \r\n    vm0.invoke(createBridgeServer);\n\n    \r\n    assertThat((int) vm0.invoke(() -> serverPort)).isEqualTo(ports[0]);\n\n    await(\"wait for join\").until(() -> {\n      synchronized (adapter) {\n        return firedAdapter[JOINED];\n      }\n    });\n    await(\"wait for join\").until(() -> {\n      synchronized (bridgeListener) {\n        return firedBridge[JOINED];\n      }\n    });\n\n    assertArrayFalse(firedAdapterDuplicate);\n    assertArrayFalse(firedBridgeDuplicate);\n\n    assertThat(firedBridge[JOINED]).isTrue();\n    assertThat(memberBridge[JOINED]).isNotNull();\n    assertThat(memberIdBridge[JOINED]).isNotNull();\n    assertThat(isClientBridge[JOINED]).isFalse();\n    assertThat(firedBridge[LEFT]).isFalse();\n    assertThat(memberBridge[LEFT]).isNull();\n    assertThat(memberIdBridge[LEFT]).isNull();\n    assertThat(isClientBridge[LEFT]).isFalse();\n    assertThat(firedBridge[CRASHED]).isFalse();\n    assertThat(memberBridge[CRASHED]).isNull();\n    assertThat(memberIdBridge[CRASHED]).isNull();\n    assertThat(isClientBridge[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedBridge, memberBridge, memberIdBridge, isClientBridge);\n\n    assertThat(firedAdapter[JOINED]).isTrue();\n    assertThat(memberAdapter[JOINED]).isNotNull();\n    assertThat(memberIdAdapter[JOINED]).isNotNull();\n    assertThat(isClientAdapter[JOINED]).isFalse();\n    assertThat(firedAdapter[LEFT]).isFalse();\n    assertThat(memberAdapter[LEFT]).isNull();\n    assertThat(memberIdAdapter[LEFT]).isNull();\n    assertThat(isClientAdapter[LEFT]).isFalse();\n    assertThat(firedAdapter[CRASHED]).isFalse();\n    assertThat(memberAdapter[CRASHED]).isNull();\n    assertThat(memberIdAdapter[CRASHED]).isNull();\n    assertThat(isClientAdapter[CRASHED]).isFalse();\n\n    resetArraysForTesting(firedAdapter, memberAdapter, memberIdAdapter, isClientAdapter);\n  }\n","realPath":"geode-core/src/distributedTest/java/org/apache/geode/management/UniversalMembershipListenerAdapterDUnitTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":1315,"status":"M"}],"commitId":"b3867a8a466db8d7812c62bbafc4c668b14ea9fe","commitMessage":"@@@Make tests use AvailablePortHelper.  not AvailablePort (#5861)\n\nMake nearly all tests use AvailablePortHelper instead of AvailablePort\nto obtain ports. See the rationale below.\n\nAlso: Remove unused methods from AvailablePort.\n\nRationale:\n\nAvailablePort is inherently risky as a source of ports for tests.\nEach \"get available port\" method obtains candidate port numbers from the\ndesired range by randomly sampling with replacement. This means that\nmultiple calls can return the same port number if the port is not put\ninto use between calls.\n\nSome tests failed intermittently because they made multiple calls to\nAvailablePort.  received the same port on multiple calls.  and unknowingly\nattempted bind multiple sockets to the same port number.  resulting in a\nBindException. See GEODE-6622 for examples.\n\nAvailablePortHelper does not have this problem. It obtains candidate\nport numbers round robin. After returning an available port. \nAvailablePortHelper will not return that port again in that JVM until it\nhas tested every other port in the range for availability.\n\nTo reduce the chance of different JVMs selecting each other's ports. \nAvailablePortHelper selects a random starting point for its round robin\nsearch in each JVM.\n\nFor distributed tests.  DUnit further arranges for the\nAvailablePortHelper in each JVM to start its round robin search in a\ndistinct place.  maximally distant from the starting points of all other\nJVMs. Because AvailablePort selects randomly from the full port range. \nit cannot benefit from this techique.\n\nThe problems caused by AvailablePort are rare.  but inevitable.  with a\nfrequency determined by the total size of the port range. An upcoming\nchange will make the available port range much smaller (~400 ports\ninstead of the current ~10000 ports).  which will greatly increase the\nfrequency of this problem. But the problem exists now.  and results in\nintermittent BindExceptions.","date":"2020-12-18 03:10:55","modifiedFileCount":"98","status":"M","submitter":"Dale Emery"}]
