[{"authorTime":"2019-09-04 16:34:18","codes":[{"authorDate":"2019-09-04 16:34:18","commitOrder":1,"curCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 50\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 50).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(DISTINCT p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(PortfolioPdx::getID))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(DISTINCT p.shortID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT DISTINCT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n\n    \r\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n  }\n","date":"2019-09-04 16:34:18","endLine":227,"groupId":"45597","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"prepareStructuresWithPdx","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/ff/517104a8a413d838c35fd3720e05b69df11916.src","preCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 50\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 50).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(DISTINCT p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(PortfolioPdx::getID))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(DISTINCT p.shortID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT DISTINCT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n\n    \r\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/internal/aggregate/AvgIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":137,"status":"B"},{"authorDate":"2019-09-04 16:34:18","commitOrder":1,"curCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.ID <= 100\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.getID() <= 100)\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(DISTINCT p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0)\n            .filter(distinctByKey(PortfolioPdx::getID)).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(DISTINCT p.shortID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT DISTINCT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).sum()));\n  }\n","date":"2019-09-04 16:34:18","endLine":218,"groupId":"45597","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"prepareStructuresWithPdx","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/58/85a41db6e00737af56bcfdbbabb0b7d1ae8780.src","preCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.ID <= 100\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.getID() <= 100)\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(DISTINCT p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0)\n            .filter(distinctByKey(PortfolioPdx::getID)).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(DISTINCT p.shortID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT DISTINCT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).sum()));\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/internal/aggregate/SumIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":133,"status":"B"}],"commitId":"245f285ffb23d61e0c64ada5e68f0f6fa4a57bcd","commitMessage":"@@@GEODE-6916: Add Aggregate Functions Tests (#3953)\n\n- Fixed minor warnings.\n- Added integration tests for the OQL aggregate functions.\n- Added distributed tests for the OQL aggregate functions.\n- Deleted several old test classes and refactored the logic in favor\n  of the new Geode rules.","date":"2019-09-04 16:34:18","modifiedFileCount":"1","status":"B","submitter":"Juan Jos? Ramos"},{"authorTime":"2019-10-15 16:55:22","codes":[{"authorDate":"2019-10-15 16:55:22","commitOrder":2,"curCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 50\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 50).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(DISTINCT p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(PortfolioPdx::getID))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(DISTINCT p.shortID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT DISTINCT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p WHERE p.ID IN (SELECT MIN(o.ID) FROM /\" + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).min().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p WHERE p.ID = ELEMENT(SELECT MAX(o.ID) FROM /\" + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).max().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n\n    \r\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n  }\n","date":"2019-10-15 16:55:22","endLine":253,"groupId":"45597","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"prepareStructuresWithPdx","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/16/1070b0a52f32f5bd97efa6d40cd544e3f49902.src","preCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 50\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 50).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(DISTINCT p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(PortfolioPdx::getID))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(DISTINCT p.shortID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT DISTINCT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n\n    \r\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/internal/aggregate/AvgIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":149,"status":"M"},{"authorDate":"2019-10-15 16:55:22","commitOrder":2,"curCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.ID <= 100\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.getID() <= 100)\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(DISTINCT p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0)\n            .filter(distinctByKey(PortfolioPdx::getID)).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(DISTINCT p.shortID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT DISTINCT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p WHERE p.ID IN (SELECT MIN(o.ID) FROM /\" + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).min().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p WHERE p.ID = ELEMENT(SELECT MAX(o.ID) FROM /\" + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).max().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).sum()));\n  }\n","date":"2019-10-15 16:55:22","endLine":244,"groupId":"45597","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"prepareStructuresWithPdx","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/34/7a7ac32d6f792e2073b705109f4c66995b8d19.src","preCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.ID <= 100\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.getID() <= 100)\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(DISTINCT p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0)\n            .filter(distinctByKey(PortfolioPdx::getID)).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(DISTINCT p.shortID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT DISTINCT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).sum()));\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/internal/aggregate/SumIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":145,"status":"M"}],"commitId":"db9565d0fb603d6ae5e809cf860e2d2289745be8","commitMessage":"@@@GEODE-7240: Prevent Aggregates in query criteria (#4103)\n\nUnless they are used within a nested SELECT query.  aggregate functions\nshould not be allowed as part of the query criteria. The query parser\nnow throws an exception whenever the required conditions are not met.\n\n- Fixed minor warnings.\n- Replaced usages of 'junit.Assert' by 'assertj'.\n- Refactored old test classes to use Geode rules.","date":"2019-10-15 16:55:22","modifiedFileCount":"7","status":"M","submitter":"Juan Jos? Ramos"},{"authorTime":"2020-05-29 00:37:39","codes":[{"authorDate":"2020-05-29 00:37:39","commitOrder":3,"curCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName + \" p WHERE p.ID > 50\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 50).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName\n            + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName\n            + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\n        \"SELECT AVG(DISTINCT p.ID) FROM \" + SEPARATOR + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(PortfolioPdx::getID))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(DISTINCT p.shortID) FROM \" + SEPARATOR + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT DISTINCT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p WHERE p.ID IN (SELECT MIN(o.ID) FROM \" + SEPARATOR + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).min().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p WHERE p.ID = ELEMENT(SELECT MAX(o.ID) FROM \" + SEPARATOR + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).max().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n\n    \r\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from \" + SEPARATOR + firstRegionName + \" p, \" + SEPARATOR\n        + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from \" + SEPARATOR + firstRegionName + \" p, \" + SEPARATOR\n        + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from \" + SEPARATOR + firstRegionName + \" p, \" + SEPARATOR\n        + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n  }\n","date":"2020-05-29 00:37:39","endLine":270,"groupId":"104772","id":5,"instanceNumber":1,"isCurCommit":1,"methodName":"prepareStructuresWithPdx","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/b3/6705d5d994cb7f506cdc6cfa1f7e9730147069.src","preCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 50\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 50).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\n        \"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID)\n            .average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(DISTINCT p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(PortfolioPdx::getID))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(DISTINCT p.shortID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT DISTINCT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n\n    \r\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p WHERE p.ID IN (SELECT MIN(o.ID) FROM /\" + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).min().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n    queries.put(\"SELECT AVG(p.ID) FROM /\" + firstRegionName\n        + \" p WHERE p.ID = ELEMENT(SELECT MAX(o.ID) FROM /\" + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).max().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).average().orElse(Double.NaN)));\n\n    \r\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n    equiJoinQueries.put(\"SELECT AVG(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).average()\n            .orElse(Double.NaN)));\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/internal/aggregate/AvgIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":158,"status":"M"},{"authorDate":"2020-05-29 00:37:39","commitOrder":3,"curCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName + \" p WHERE p.ID > 0 OR p.ID <= 100\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.getID() <= 100)\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName\n            + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName\n            + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    queries.put(\n        \"SELECT SUM(DISTINCT p.ID) FROM \" + SEPARATOR + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0)\n            .filter(distinctByKey(PortfolioPdx::getID)).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(DISTINCT p.shortID) FROM \" + SEPARATOR + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT DISTINCT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p WHERE p.ID IN (SELECT MIN(o.ID) FROM \" + SEPARATOR + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).min().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM \" + SEPARATOR + firstRegionName\n        + \" p WHERE p.ID = ELEMENT(SELECT MAX(o.ID) FROM \" + SEPARATOR + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).max().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from \" + SEPARATOR + firstRegionName + \" p, \" + SEPARATOR\n        + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from \" + SEPARATOR + firstRegionName + \" p, \" + SEPARATOR\n        + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from \" + SEPARATOR + firstRegionName + \" p, \" + SEPARATOR\n        + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).sum()));\n  }\n","date":"2020-05-29 00:37:39","endLine":263,"groupId":"104772","id":6,"instanceNumber":2,"isCurCommit":1,"methodName":"prepareStructuresWithPdx","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-geode-10-0.7/blobInfo/CC_OUT/blobs/b9/e8ce1483ef33202ca8a5112c532fb7be3a9734.src","preCode":"  private void prepareStructuresWithPdx() {\n    Supplier<Stream<PortfolioPdx>> supplierOne =\n        () -> regionOneLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n    Supplier<Stream<PortfolioPdx>> supplierTwo =\n        () -> regionTwoLocalCopy.values().stream().map(PortfolioPdx.class::cast);\n\n    for (int i = 1; i <= 70; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionOneLocalCopy.put(i, portfolio);\n    }\n\n    for (int i = 50; i <= 100; i++) {\n      PortfolioPdx portfolio = new PortfolioPdx(i);\n      portfolio.shortID = (short) ((short) i / 5);\n      regionTwoLocalCopy.put(i, portfolio);\n    }\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p\",\n        downCast(supplierOne.get().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.ID <= 100\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.getID() <= 100)\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status='active'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.isActive())\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\n        \"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0 OR p.status LIKE 'ina%'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 || p.status.startsWith(\"ina\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID IN SET(1, 2, 3, 4, 5)\",\n        downCast(supplierOne.get().filter(p -> Arrays.asList(1, 2, 3, 4, 5).contains(p.getID()))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName + \" p WHERE NOT (p.ID > 5)\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() <= 5).mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(DISTINCT p.ID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0)\n            .filter(distinctByKey(PortfolioPdx::getID)).mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(DISTINCT p.shortID) FROM /\" + firstRegionName + \" p WHERE p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0).filter(distinctByKey(p -> p.shortID))\n            .mapToInt(p -> p.shortID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID < 100 AND pos.secId = 'IBM'\",\n        downCast(\n            supplierOne.get().filter(p -> p.getID() < 100 && p.getPositions().containsKey(\"IBM\"))\n                .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT DISTINCT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get().filter(p -> p.getID() > 0 && p.getPositions().containsKey(\"IBM\"))\n            .distinct().mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p, p.positions.values pos WHERE p.ID > 0 AND p.status = 'active' AND pos.secId = 'IBM'\",\n        downCast(supplierOne.get()\n            .filter(p -> p.getID() > 0 && p.isActive() && p.getPositions().containsKey(\"IBM\"))\n            .mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p WHERE p.ID IN (SELECT MIN(o.ID) FROM /\" + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).min().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).sum()));\n    queries.put(\"SELECT SUM(p.ID) FROM /\" + firstRegionName\n        + \" p WHERE p.ID = ELEMENT(SELECT MAX(o.ID) FROM /\" + firstRegionName + \" o)\",\n        downCast(supplierOne.get()\n            .filter(\n                p -> p.getID() == supplierOne.get().mapToInt(PortfolioPdx::getID).max().orElse(-1))\n            .mapToInt(PortfolioPdx::getID).sum()));\n\n    \r\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 20 AND e.ID > 40\",\n        downCast(supplierOne.get()\n            .filter(p -> supplierTwo.get().filter(e -> e.getID() > 40)\n                .collect(Collectors.toMap(PortfolioPdx::getID, Function.identity()))\n                .containsKey(p.getID()))\n            .filter(p -> p.getID() > 20).mapToInt(PortfolioPdx::getID).sum()));\n    equiJoinQueries.put(\"SELECT SUM(p.ID) from /\" + firstRegionName + \" p, /\" + secondRegionName\n        + \" e WHERE p.ID = e.ID AND p.ID > 0 AND p.status = 'active'\",\n        downCast(supplierOne.get().filter(p -> regionTwoLocalCopy.containsKey(p.getID()))\n            .filter(p -> p.getID() > 0 && p.isActive()).mapToInt(PortfolioPdx::getID).sum()));\n  }\n","realPath":"geode-core/src/integrationTest/java/org/apache/geode/cache/query/internal/aggregate/SumIntegrationTest.java","repoName":"geode","snippetEndLine":0,"snippetStartLine":0,"startLine":155,"status":"M"}],"commitId":"0fd56e418752c14ed8ebebe5a370164034aafc39","commitMessage":"@@@GEODE-7846: Replace all uses of hardcoded / with Region.SEPARATOR (#5157)\n\nAuthored-by: Donal Evans <doevans@pivotal.io>","date":"2020-05-29 00:37:39","modifiedFileCount":"489","status":"M","submitter":"Donal Evans"}]
