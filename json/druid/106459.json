[{"authorTime":"2018-08-31 00:56:26","codes":[{"authorDate":"2018-08-31 00:56:26","commitOrder":1,"curCode":"  public void testGroupByTimeExtraction()\n  {\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(new DefaultDimensionSpec(\"market\", \"market\"), new ExtractionDimensionSpec(\n            Column.TIME_COLUMN_NAME,\n            \"dayOfWeek\",\n            new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n        )).setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"\");\n  }\n","date":"2018-08-31 00:56:26","endLine":6017,"groupId":"8896","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testGroupByTimeExtraction","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/76/97506dd7d87c44ca1fada8cf624753ca12a2ea.src","preCode":"  public void testGroupByTimeExtraction()\n  {\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(new DefaultDimensionSpec(\"market\", \"market\"), new ExtractionDimensionSpec(\n            Column.TIME_COLUMN_NAME,\n            \"dayOfWeek\",\n            new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n        )).setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":5807,"status":"B"},{"authorDate":"2018-08-31 00:56:26","commitOrder":1,"curCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(new DefaultDimensionSpec(\"market\", \"market\"), new ExtractionDimensionSpec(\n            Column.TIME_COLUMN_NAME,\n            \"dayOfWeek\",\n            new CascadeExtractionFn(\n                new ExtractionFn[]{\n                    new TimeFormatExtractionFn(\"EEEE\", null, null, null, false),\n                    nullWednesdays,\n                    }\n            )\n        )).setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"\");\n  }\n","date":"2018-08-31 00:56:26","endLine":6267,"groupId":"2631","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testGroupByTimeExtractionWithNulls","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/76/97506dd7d87c44ca1fada8cf624753ca12a2ea.src","preCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(new DefaultDimensionSpec(\"market\", \"market\"), new ExtractionDimensionSpec(\n            Column.TIME_COLUMN_NAME,\n            \"dayOfWeek\",\n            new CascadeExtractionFn(\n                new ExtractionFn[]{\n                    new TimeFormatExtractionFn(\"EEEE\", null, null, null, false),\n                    nullWednesdays,\n                    }\n            )\n        )).setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":6021,"status":"B"}],"commitId":"431d3d8497f9079857c3baa7ae7ab4cb44a22355","commitMessage":"@@@Rename io.druid to org.apache.druid. (#6266)\n\n* Rename io.druid to org.apache.druid.\n\n* Fix META-INF files and remove some benchmark results.\n\n* MonitorsConfig update for metrics package migration.\n\n* Reorder some dimensions in inner queries for some reason.\n\n* Fix protobuf tests.\n","date":"2018-08-31 00:56:26","modifiedFileCount":"5","status":"B","submitter":"Gian Merlino"},{"authorTime":"2018-10-03 01:50:22","codes":[{"authorDate":"2018-10-03 01:50:22","commitOrder":2,"curCode":"  public void testGroupByTimeExtraction()\n  {\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"\");\n  }\n","date":"2018-10-03 01:50:22","endLine":6025,"groupId":"8896","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testGroupByTimeExtraction","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/20/a8efd398228ef8c81834e9096f9d501d6ba250.src","preCode":"  public void testGroupByTimeExtraction()\n  {\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(new DefaultDimensionSpec(\"market\", \"market\"), new ExtractionDimensionSpec(\n            Column.TIME_COLUMN_NAME,\n            \"dayOfWeek\",\n            new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n        )).setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":5811,"status":"M"},{"authorDate":"2018-10-03 01:50:22","commitOrder":2,"curCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new CascadeExtractionFn(\n                    new ExtractionFn[]{new TimeFormatExtractionFn(\"EEEE\", null, null, null, false), nullWednesdays}\n                )\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"\");\n  }\n","date":"2018-10-03 01:50:22","endLine":6276,"groupId":"2631","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testGroupByTimeExtractionWithNulls","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/20/a8efd398228ef8c81834e9096f9d501d6ba250.src","preCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(new DefaultDimensionSpec(\"market\", \"market\"), new ExtractionDimensionSpec(\n            Column.TIME_COLUMN_NAME,\n            \"dayOfWeek\",\n            new CascadeExtractionFn(\n                new ExtractionFn[]{\n                    new TimeFormatExtractionFn(\"EEEE\", null, null, null, false),\n                    nullWednesdays,\n                    }\n            )\n        )).setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":6029,"status":"M"}],"commitId":"3ae563263a23000560749071d262727d47296856","commitMessage":"@@@Renamed 'Generic Column' -> 'Numeric Column'; Fixed a few resource leaks in processing; misc refinements (#5957)\n\nThis PR accumulates many refactorings and small improvements that I did while preparing the next change set of https://github.com/druid-io/druid/projects/2. I finally decided to make them a separate PR to minimize the volume of the main PR.\n\nSome of the changes:\n - Renamed confusing \"Generic Column\" term to \"Numeric Column\" (what it actually implies) in many class names.\n - Generified `ComplexMetricExtractor`","date":"2018-10-03 01:50:22","modifiedFileCount":"776","status":"M","submitter":"Roman Leventov"},{"authorTime":"2018-12-12 00:05:50","codes":[{"authorDate":"2018-12-12 00:05:50","commitOrder":3,"curCode":"  public void testGroupByTimeExtraction()\n  {\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","date":"2018-12-12 00:05:50","endLine":6121,"groupId":"8896","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testGroupByTimeExtraction","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/64/6e2d33a4e2dcc89f87c320ca62cdd241ff9479.src","preCode":"  public void testGroupByTimeExtraction()\n  {\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":5907,"status":"M"},{"authorDate":"2018-12-12 00:05:50","commitOrder":3,"curCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new CascadeExtractionFn(\n                    new ExtractionFn[]{new TimeFormatExtractionFn(\"EEEE\", null, null, null, false), nullWednesdays}\n                )\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","date":"2018-12-12 00:05:50","endLine":6372,"groupId":"2631","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testGroupByTimeExtractionWithNulls","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/64/6e2d33a4e2dcc89f87c320ca62cdd241ff9479.src","preCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new CascadeExtractionFn(\n                    new ExtractionFn[]{new TimeFormatExtractionFn(\"EEEE\", null, null, null, false), nullWednesdays}\n                )\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":6125,"status":"M"}],"commitId":"86e3ae5b48bca7cbb9bf05e9e66d013f34dabf16","commitMessage":"@@@Add fail message (#6720)\n\n","date":"2018-12-12 00:05:50","modifiedFileCount":"4","status":"M","submitter":"Atul Mohan"},{"authorTime":"2019-01-22 03:11:10","codes":[{"authorDate":"2019-01-22 03:11:10","commitOrder":4,"curCode":"  public void testGroupByTimeExtraction()\n  {\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","date":"2019-01-22 03:11:10","endLine":7587,"groupId":"8896","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"testGroupByTimeExtraction","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/3a/2d5324e53bb1e6db9aa94f99f59fd95c69d21f.src","preCode":"  public void testGroupByTimeExtraction()\n  {\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":7373,"status":"M"},{"authorDate":"2019-01-22 03:11:10","commitOrder":4,"curCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new CascadeExtractionFn(\n                    new ExtractionFn[]{new TimeFormatExtractionFn(\"EEEE\", null, null, null, false), nullWednesdays}\n                )\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","date":"2019-01-22 03:11:10","endLine":7838,"groupId":"2631","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testGroupByTimeExtractionWithNulls","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/3a/2d5324e53bb1e6db9aa94f99f59fd95c69d21f.src","preCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnInterval)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new CascadeExtractionFn(\n                    new ExtractionFn[]{new TimeFormatExtractionFn(\"EEEE\", null, null, null, false), nullWednesdays}\n                )\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":7591,"status":"M"}],"commitId":"8eae26fd4e7572060d112864dd3d5f6a865b9c89","commitMessage":"@@@Introduce SegmentId class (#6370)\n\n* Introduce SegmentId class\n\n* tmp\n\n* Fix SelectQueryRunnerTest\n\n* Fix indentation\n\n* Fixes\n\n* Remove Comparators.inverse() tests\n\n* Refinements\n\n* Fix tests\n\n* Fix more tests\n\n* Remove duplicate DataSegmentTest.  fixes #6064\n\n* SegmentDescriptor doc\n\n* Fix SQLMetadataStorageUpdaterJobHandler\n\n* Fix DataSegment deserialization for ignoring id\n\n* Add comments\n\n* More comments\n\n* Address more comments\n\n* Fix compilation\n\n* Restore segment2 in SystemSchemaTest according to a comment\n\n* Fix style\n\n* fix testServerSegmentsTable\n\n* Fix compilation\n\n* Add comments about why SegmentId and SegmentIdWithShardSpec are separate classes\n\n* Fix SystemSchemaTest\n\n* Fix style\n\n* Compare SegmentDescriptor with SegmentId in Javadoc and comments rather than with DataSegment\n\n* Remove a link.  see https://youtrack.jetbrains.com/issue/IDEA-205164\n\n* Fix compilation\n","date":"2019-01-22 03:11:10","modifiedFileCount":"308","status":"M","submitter":"Roman Leventov"},{"authorTime":"2019-07-13 03:54:07","codes":[{"authorDate":"2019-07-13 03:54:07","commitOrder":5,"curCode":"  public void testGroupByTimeExtraction()\n  {\n    \r\n    cannotVectorize();\n\n    GroupByQuery query = makeQueryBuilder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","date":"2019-07-13 03:54:07","endLine":7657,"groupId":"8896","id":9,"instanceNumber":1,"isCurCommit":0,"methodName":"testGroupByTimeExtraction","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/3e/b69c0dda419ff55b78ba723f929d5a15f00f96.src","preCode":"  public void testGroupByTimeExtraction()\n  {\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":7441,"status":"M"},{"authorDate":"2019-07-13 03:54:07","commitOrder":5,"curCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    \r\n    cannotVectorize();\n\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = makeQueryBuilder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new CascadeExtractionFn(\n                    new ExtractionFn[]{new TimeFormatExtractionFn(\"EEEE\", null, null, null, false), nullWednesdays}\n                )\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","date":"2019-07-13 03:54:07","endLine":7910,"groupId":"2631","id":10,"instanceNumber":2,"isCurCommit":0,"methodName":"testGroupByTimeExtractionWithNulls","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/3e/b69c0dda419ff55b78ba723f929d5a15f00f96.src","preCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = GroupByQuery\n        .builder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new CascadeExtractionFn(\n                    new ExtractionFn[]{new TimeFormatExtractionFn(\"EEEE\", null, null, null, false), nullWednesdays}\n                )\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":7661,"status":"M"}],"commitId":"ffa25b78321a56b210a8ad5b6c9ca61b3b737153","commitMessage":"@@@Query vectorization. (#6794)\n\n* Benchmarks: New SqlBenchmark.  add caching & vectorization to some others.\n\n- Introduce a new SqlBenchmark geared towards benchmarking a wide\n  variety of SQL queries. Rename the old SqlBenchmark to\n  SqlVsNativeBenchmark.\n- Add (optional) caching to SegmentGenerator to enable easier\n  benchmarking of larger segments.\n- Add vectorization to FilteredAggregatorBenchmark and GroupByBenchmark.\n\n* Query vectorization.\n\nThis patch includes vectorized timeseries and groupBy engines.  as well\nas some analogs of your favorite Druid classes:\n\n- VectorCursor is like Cursor. (It comes from StorageAdapter.makeVectorCursor.)\n- VectorColumnSelectorFactory is like ColumnSelectorFactory.  and it has\n  methods to create analogs of the column selectors you know and love.\n- VectorOffset and ReadableVectorOffset are like Offset and ReadableOffset.\n- VectorAggregator is like BufferAggregator.\n- VectorValueMatcher is like ValueMatcher.\n\nThere are some noticeable differences between vectorized and regular\nexecution:\n\n- Unlike regular cursors.  vector cursors do not understand time\n  granularity. They expect query engines to handle this on their own. \n  which a new VectorCursorGranularizer class helps with. This is to\n  avoid too much batch-splitting and to respect the fact that vector\n  selectors are somewhat more heavyweight than regular selectors.\n- Unlike FilteredOffset.  FilteredVectorOffset does not leverage indexes\n  for filters that might partially support them (like an OR of one\n  filter that supports indexing and another that doesn't). I'm not sure\n  that this behavior is desirable anyway (it is potentially too eager)\n  but.  at any rate.  it'd be better to harmonize it between the two\n  classes. Potentially they should both do some different thing that\n  is smarter than what either of them is doing right now.\n- When vector cursors are created by QueryableIndexCursorSequenceBuilder. \n  they use a morphing binary-then-linear search to find their start and\n  end rows.  rather than linear search.\n\nLimitations in this patch are:\n\n- Only timeseries and groupBy have vectorized engines.\n- GroupBy doesn't handle multi-value dimensions yet.\n- Vector cursors cannot handle virtual columns or descending order.\n- Only some filters have vectorized matchers: \"selector\".  \"bound\".  \"in\". \n  \"like\".  \"regex\".  \"search\".  \"and\".  \"or\".  and \"not\".\n- Only some aggregators have vectorized implementations: \"count\". \n  \"doubleSum\".  \"floatSum\".  \"longSum\".  \"hyperUnique\".  and \"filtered\".\n- Dimension specs other than \"default\" don't work yet (no extraction\n  functions or filtered dimension specs).\n\nCurrently.  the testing strategy includes adding vectorization-enabled\ntests to TimeseriesQueryRunnerTest.  GroupByQueryRunnerTest. \nGroupByTimeseriesQueryRunnerTest.  CalciteQueryTest.  and all of the\nfiltering tests that extend BaseFilterTest. In all of those classes. \nthere are some test cases that don't support vectorization. They are\nmarked by special function calls like \"cannotVectorize\" or \"skipVectorize\"\nthat tell the test harness to either expect an exception or to skip the\ntest case.\n\nTesting should be expanded in the future -- a project in and of itself.\n\nRelated to #3011.\n\n* WIP\n\n* Adjustments for unused things.\n\n* Adjust javadocs.\n\n* DimensionDictionarySelector adjustments.\n\n* Add \"clone\" to BatchIteratorAdapter.\n\n* ValueMatcher javadocs.\n\n* Fix benchmark.\n\n* Fixups post-merge.\n\n* Expect exception on testGroupByWithStringVirtualColumn for IncrementalIndex.\n\n* BloomDimFilterSqlTest: Tag two non-vectorizable tests.\n\n* Minor adjustments.\n\n* Update surefire.  bump up Xmx in Travis.\n\n* Some more adjustments.\n\n* Javadoc adjustments\n\n* AggregatorAdapters adjustments.\n\n* Additional comments.\n\n* Remove switching search.\n\n* Only missiles.\n","date":"2019-07-13 03:54:07","modifiedFileCount":"143","status":"M","submitter":"Gian Merlino"},{"authorTime":"2019-08-01 07:15:12","codes":[{"authorDate":"2019-08-01 07:15:12","commitOrder":6,"curCode":"  public void testGroupByTimeExtraction()\n  {\n    \r\n    cannotVectorize();\n\n    GroupByQuery query = makeQueryBuilder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<ResultRow> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","date":"2019-08-01 07:15:12","endLine":7866,"groupId":"13935","id":11,"instanceNumber":1,"isCurCommit":0,"methodName":"testGroupByTimeExtraction","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/d1/574885a60d20d8c6aaa2ff4f2d57758cf04e59.src","preCode":"  public void testGroupByTimeExtraction()\n  {\n    \r\n    cannotVectorize();\n\n    GroupByQuery query = makeQueryBuilder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":7636,"status":"M"},{"authorDate":"2019-08-01 07:15:12","commitOrder":6,"curCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    \r\n    cannotVectorize();\n\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = makeQueryBuilder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new CascadeExtractionFn(\n                    new ExtractionFn[]{new TimeFormatExtractionFn(\"EEEE\", null, null, null, false), nullWednesdays}\n                )\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<ResultRow> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","date":"2019-08-01 07:15:12","endLine":8133,"groupId":"13935","id":12,"instanceNumber":2,"isCurCommit":0,"methodName":"testGroupByTimeExtractionWithNulls","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/d1/574885a60d20d8c6aaa2ff4f2d57758cf04e59.src","preCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    \r\n    cannotVectorize();\n\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = makeQueryBuilder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new CascadeExtractionFn(\n                    new ExtractionFn[]{new TimeFormatExtractionFn(\"EEEE\", null, null, null, false), nullWednesdays}\n                )\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<Row> expectedResults = Arrays.asList(\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        GroupByQueryRunnerTestHelper.createExpectedRow(\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<Row> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":7870,"status":"M"}],"commitId":"77297f4e6f2e9d617c96cd46852bb5a772961e85","commitMessage":"@@@GroupBy array-based result rows. (#8196)\n\n* GroupBy array-based result rows.\n\nFixes #8118; see that proposal for details.\n\nOther than the GroupBy changes.  the main other \"interesting\" classes are:\n\n- ResultRow: The array-based result type.\n- BaseQuery: T is no longer required to be Comparable.\n- QueryToolChest: Adds \"decorateObjectMapper\" to enable query-aware serialization\n  and deserialization of result rows (necessary due to their positional nature).\n- QueryResource: Uses the new decoration functionality.\n- DirectDruidClient: Also uses the new decoration functionality.\n- QueryMaker (in Druid SQL): Modifications to read ResultRows.\n\nThese classes weren't changed.  but got some new javadocs:\n\n- BySegmentQueryRunner\n- FinalizeResultsQueryRunner\n- Query\n\n* Adjustments for TC stuff.\n","date":"2019-08-01 07:15:12","modifiedFileCount":"111","status":"M","submitter":"Gian Merlino"},{"authorTime":"2019-08-23 18:13:54","codes":[{"authorDate":"2019-08-23 18:13:54","commitOrder":7,"curCode":"  public void testGroupByTimeExtraction()\n  {\n    \r\n    cannotVectorize();\n\n    GroupByQuery query = makeQueryBuilder()\n        .setDataSource(QueryRunnerTestHelper.DATA_SOURCE)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.FULL_ON_INTERVAL_SPEC)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.ROWS_COUNT, QueryRunnerTestHelper.INDEX_DOUBLE_SUM)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.ADD_ROWS_INDEX_CONSTANT))\n        .setGranularity(QueryRunnerTestHelper.ALL_GRAN)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<ResultRow> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","date":"2019-08-23 18:13:54","endLine":7574,"groupId":"106459","id":13,"instanceNumber":1,"isCurCommit":0,"methodName":"testGroupByTimeExtraction","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/62/70f6bf822e9df520831f224e31e00bb9d44650.src","preCode":"  public void testGroupByTimeExtraction()\n  {\n    \r\n    cannotVectorize();\n\n    GroupByQuery query = makeQueryBuilder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new TimeFormatExtractionFn(\"EEEE\", null, null, null, false)\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Wednesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        )\n    );\n\n    Iterable<ResultRow> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":7344,"status":"M"},{"authorDate":"2019-08-23 18:13:54","commitOrder":7,"curCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    \r\n    cannotVectorize();\n\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = makeQueryBuilder()\n        .setDataSource(QueryRunnerTestHelper.DATA_SOURCE)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.FULL_ON_INTERVAL_SPEC)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new CascadeExtractionFn(\n                    new ExtractionFn[]{new TimeFormatExtractionFn(\"EEEE\", null, null, null, false), nullWednesdays}\n                )\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.ROWS_COUNT, QueryRunnerTestHelper.INDEX_DOUBLE_SUM)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.ADD_ROWS_INDEX_CONSTANT))\n        .setGranularity(QueryRunnerTestHelper.ALL_GRAN)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<ResultRow> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","date":"2019-08-23 18:13:54","endLine":7841,"groupId":"106459","id":14,"instanceNumber":2,"isCurCommit":0,"methodName":"testGroupByTimeExtractionWithNulls","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/62/70f6bf822e9df520831f224e31e00bb9d44650.src","preCode":"  public void testGroupByTimeExtractionWithNulls()\n  {\n    \r\n    cannotVectorize();\n\n    final DimExtractionFn nullWednesdays = new DimExtractionFn()\n    {\n      @Override\n      public String apply(String dimValue)\n      {\n        if (\"Wednesday\".equals(dimValue)) {\n          return null;\n        } else {\n          return dimValue;\n        }\n      }\n\n      @Override\n      public byte[] getCacheKey()\n      {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public boolean preservesOrdering()\n      {\n        return false;\n      }\n\n      @Override\n      public ExtractionType getExtractionType()\n      {\n        return ExtractionType.MANY_TO_ONE;\n      }\n    };\n\n    GroupByQuery query = makeQueryBuilder()\n        .setDataSource(QueryRunnerTestHelper.dataSource)\n        .setQuerySegmentSpec(QueryRunnerTestHelper.fullOnIntervalSpec)\n        .setDimensions(\n            new DefaultDimensionSpec(\"market\", \"market\"),\n            new ExtractionDimensionSpec(\n                ColumnHolder.TIME_COLUMN_NAME,\n                \"dayOfWeek\",\n                new CascadeExtractionFn(\n                    new ExtractionFn[]{new TimeFormatExtractionFn(\"EEEE\", null, null, null, false), nullWednesdays}\n                )\n            )\n        )\n        .setAggregatorSpecs(QueryRunnerTestHelper.rowsCount, QueryRunnerTestHelper.indexDoubleSum)\n        .setPostAggregatorSpecs(Collections.singletonList(QueryRunnerTestHelper.addRowsIndexConstant))\n        .setGranularity(QueryRunnerTestHelper.allGran)\n        .setDimFilter(\n            new OrDimFilter(\n                Arrays.asList(\n                    new SelectorDimFilter(\"market\", \"spot\", null),\n                    new SelectorDimFilter(\"market\", \"upfront\", null)\n                )\n            )\n        )\n        .build();\n\n    List<ResultRow> expectedResults = Arrays.asList(\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"spot\",\n            \"index\",\n            14271.368591308594,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14398.368591308594\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13219.574157714844,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13337.574157714844\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13557.738830566406,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13675.738830566406\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13493.751281738281,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13611.751281738281\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13585.541015625,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13703.541015625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            14279.127197265625,\n            \"rows\",\n            126L,\n            \"addRowsIndexConstant\",\n            14406.127197265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"spot\",\n            \"index\",\n            13199.471435546875,\n            \"rows\",\n            117L,\n            \"addRowsIndexConstant\",\n            13317.471435546875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            null,\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28985.5751953125,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            29014.5751953125\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Friday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27297.8623046875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27324.8623046875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Monday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27619.58447265625,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27646.58447265625\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Saturday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            27820.83154296875,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            27847.83154296875\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Sunday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            24791.223876953125,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            24818.223876953125\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Thursday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            28562.748901367188,\n            \"rows\",\n            28L,\n            \"addRowsIndexConstant\",\n            28591.748901367188\n        ),\n        makeRow(\n            query,\n            \"1970-01-01\",\n            \"dayOfWeek\",\n            \"Tuesday\",\n            \"market\",\n            \"upfront\",\n            \"index\",\n            26968.280639648438,\n            \"rows\",\n            26L,\n            \"addRowsIndexConstant\",\n            26995.280639648438\n        )\n    );\n\n    Iterable<ResultRow> results = GroupByQueryRunnerTestHelper.runQuery(factory, runner, query);\n    TestHelper.assertExpectedObjects(expectedResults, results, \"time-extraction\");\n  }\n","realPath":"processing/src/test/java/org/apache/druid/query/groupby/GroupByQueryRunnerTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":7578,"status":"M"}],"commitId":"33f0753a70361e7d345a488034f76a889f7c3682","commitMessage":"@@@Add Checkstyle for constant name static final (#8060)\n\n* check ctyle for constant field name\n\n* check ctyle for constant field name\n\n* check ctyle for constant field name\n\n* check ctyle for constant field name\n\n* check ctyle for constant field name\n\n* check ctyle for constant field name\n\n* check ctyle for constant field name\n\n* check ctyle for constant field name\n\n* check ctyle for constant field name\n\n* merging with upstream\n\n* review-1\n\n* unknow changes\n\n* unknow changes\n\n* review-2\n\n* merging with master\n\n* review-2 1 changes\n\n* review changes-2 2\n\n* bug fix\n","date":"2019-08-23 18:13:54","modifiedFileCount":"298","status":"M","submitter":"SandishKumarHN"}]
