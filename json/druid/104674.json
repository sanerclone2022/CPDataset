[{"authorTime":"2018-11-21 05:42:44","codes":[{"authorDate":"2018-11-21 05:42:44","commitOrder":1,"curCode":"  private List<TaskInfo<Task, TaskStatus>> getRecentlyCreatedAlreadyFinishedTaskInfoSince(\n      DateTime start,\n      Ordering<TaskStuff> createdDateDesc\n  )\n  {\n    giant.lock();\n\n    try {\n      List<TaskStuff> list = createdDateDesc\n          .sortedCopy(tasks.values())\n          .stream()\n          .filter(taskStuff -> taskStuff.getStatus().isComplete() && taskStuff.createdDate.isAfter(start))\n          .collect(Collectors.toList());\n      final ImmutableList.Builder<TaskInfo<Task, TaskStatus>> listBuilder = ImmutableList.builder();\n      for (final TaskStuff taskStuff : list) {\n        String id = taskStuff.getTask().getId();\n        TaskInfo t = new TaskInfo(\n            id,\n            taskStuff.getCreatedDate(),\n            taskStuff.getStatus(),\n            taskStuff.getDataSource(),\n            taskStuff.getTask()\n        );\n        listBuilder.add(t);\n      }\n      return listBuilder.build();\n    }\n    finally {\n      giant.unlock();\n    }\n  }\n","date":"2018-11-21 05:42:44","endLine":284,"groupId":"14863","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"getRecentlyCreatedAlreadyFinishedTaskInfoSince","params":"(DateTimestart@Ordering<TaskStuff>createdDateDesc)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/51/b38d026095003ec6bd25040e9de8b63bddf0e4.src","preCode":"  private List<TaskInfo<Task, TaskStatus>> getRecentlyCreatedAlreadyFinishedTaskInfoSince(\n      DateTime start,\n      Ordering<TaskStuff> createdDateDesc\n  )\n  {\n    giant.lock();\n\n    try {\n      List<TaskStuff> list = createdDateDesc\n          .sortedCopy(tasks.values())\n          .stream()\n          .filter(taskStuff -> taskStuff.getStatus().isComplete() && taskStuff.createdDate.isAfter(start))\n          .collect(Collectors.toList());\n      final ImmutableList.Builder<TaskInfo<Task, TaskStatus>> listBuilder = ImmutableList.builder();\n      for (final TaskStuff taskStuff : list) {\n        String id = taskStuff.getTask().getId();\n        TaskInfo t = new TaskInfo(\n            id,\n            taskStuff.getCreatedDate(),\n            taskStuff.getStatus(),\n            taskStuff.getDataSource(),\n            taskStuff.getTask()\n        );\n        listBuilder.add(t);\n      }\n      return listBuilder.build();\n    }\n    finally {\n      giant.unlock();\n    }\n  }\n","realPath":"indexing-service/src/main/java/org/apache/druid/indexing/overlord/HeapMemoryTaskStorage.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":254,"status":"B"},{"authorDate":"2018-11-21 05:42:44","commitOrder":1,"curCode":"  private List<TaskInfo<Task, TaskStatus>> getNRecentlyCreatedAlreadyFinishedTaskInfo(int n, Ordering<TaskStuff> createdDateDesc)\n  {\n    giant.lock();\n\n    try {\n      List<TaskStuff> list = createdDateDesc\n          .sortedCopy(tasks.values())\n          .stream()\n          .filter(taskStuff -> taskStuff.getStatus().isComplete())\n          .limit(n)\n          .collect(Collectors.toList());\n      final ImmutableList.Builder<TaskInfo<Task, TaskStatus>> listBuilder = ImmutableList.builder();\n      for (final TaskStuff taskStuff : list) {\n        String id = taskStuff.getTask().getId();\n        TaskInfo t = new TaskInfo<>(\n            id,\n            taskStuff.getCreatedDate(),\n            taskStuff.getStatus(),\n            taskStuff.getDataSource(),\n            taskStuff.getTask()\n        );\n        listBuilder.add(t);\n      }\n      return listBuilder.build();\n    }\n    finally {\n      giant.unlock();\n    }\n  }\n","date":"2018-11-21 05:42:44","endLine":314,"groupId":"14861","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"getNRecentlyCreatedAlreadyFinishedTaskInfo","params":"(intn@Ordering<TaskStuff>createdDateDesc)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/51/b38d026095003ec6bd25040e9de8b63bddf0e4.src","preCode":"  private List<TaskInfo<Task, TaskStatus>> getNRecentlyCreatedAlreadyFinishedTaskInfo(int n, Ordering<TaskStuff> createdDateDesc)\n  {\n    giant.lock();\n\n    try {\n      List<TaskStuff> list = createdDateDesc\n          .sortedCopy(tasks.values())\n          .stream()\n          .filter(taskStuff -> taskStuff.getStatus().isComplete())\n          .limit(n)\n          .collect(Collectors.toList());\n      final ImmutableList.Builder<TaskInfo<Task, TaskStatus>> listBuilder = ImmutableList.builder();\n      for (final TaskStuff taskStuff : list) {\n        String id = taskStuff.getTask().getId();\n        TaskInfo t = new TaskInfo<>(\n            id,\n            taskStuff.getCreatedDate(),\n            taskStuff.getStatus(),\n            taskStuff.getDataSource(),\n            taskStuff.getTask()\n        );\n        listBuilder.add(t);\n      }\n      return listBuilder.build();\n    }\n    finally {\n      giant.unlock();\n    }\n  }\n","realPath":"indexing-service/src/main/java/org/apache/druid/indexing/overlord/HeapMemoryTaskStorage.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":286,"status":"B"}],"commitId":"81c9a6177cc6958942eaa9ea294fe96c4a3708f4","commitMessage":"@@@Added support for filtering by unused parameter for HeapMemoryTaskStorage (#6510)\n\n* 1. added support for unused DateTime start parameter in getRecentlyFinishedTaskInfoSince method:\n HeapMemoryTaskStorage.getRecentlyFinishedTaskInfoSince return the finished tasks by comparing TaskStuff.createdDate with the start time\n2. added filtering by status complete to TaskStuff list stream in HeapMemoryTaskStorage.getNRecentlyFinishedTaskInfo method.\n3. changed names of methods and parameters to present that public API method OverlordResource.getTasks return the list of completed tasks.  which createdDate.  not date of completion.  belongs to the interval parameter.\n\n* 1. added support for unused DateTime start parameter in getRecentlyFinishedTaskInfoSince method:\n HeapMemoryTaskStorage.getRecentlyFinishedTaskInfoSince return the finished tasks by comparing TaskStuff.createdDate with the start time\n2. added filtering by status complete to TaskStuff list stream in HeapMemoryTaskStorage.getNRecentlyFinishedTaskInfo method.\n3. changed names of methods and parameters to present that public API method OverlordResource.getTasks return the list of completed tasks.  which createdDate.  not date of completion.  belongs to the interval parameter.\n\n* Fixed OverlordResourceTest to Support changed methods names\n\n* Changed methods and parameters names to make them more obvious to understand.\n\n* Changed String.replace() for the StringUtils.replace()(#6607)\n\n* Fixed checkstyle error\n","date":"2018-11-21 05:42:44","modifiedFileCount":"6","status":"B","submitter":"Marat"},{"authorTime":"2018-11-21 05:42:44","codes":[{"authorDate":"2019-08-23 06:28:23","commitOrder":2,"curCode":"  private List<TaskInfo<Task, TaskStatus>> getRecentlyCreatedAlreadyFinishedTaskInfoSince(\n      DateTime start,\n      Ordering<TaskStuff> createdDateDesc\n  )\n  {\n    giant.lock();\n\n    try {\n      List<TaskStuff> list = createdDateDesc\n          .sortedCopy(tasks.values())\n          .stream()\n          .filter(taskStuff -> taskStuff.getStatus().isComplete() && taskStuff.createdDate.isAfter(start))\n          .collect(Collectors.toList());\n      final ImmutableList.Builder<TaskInfo<Task, TaskStatus>> listBuilder = ImmutableList.builder();\n      for (final TaskStuff taskStuff : list) {\n        String id = taskStuff.getTask().getId();\n        TaskInfo t = new TaskInfo<>(\n            id,\n            taskStuff.getCreatedDate(),\n            taskStuff.getStatus(),\n            taskStuff.getDataSource(),\n            taskStuff.getTask()\n        );\n        listBuilder.add(t);\n      }\n      return listBuilder.build();\n    }\n    finally {\n      giant.unlock();\n    }\n  }\n","date":"2019-08-23 06:28:23","endLine":284,"groupId":"14863","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"getRecentlyCreatedAlreadyFinishedTaskInfoSince","params":"(DateTimestart@Ordering<TaskStuff>createdDateDesc)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/fe/22f82be19ebe3c69da71fb6d9a43413847f13e.src","preCode":"  private List<TaskInfo<Task, TaskStatus>> getRecentlyCreatedAlreadyFinishedTaskInfoSince(\n      DateTime start,\n      Ordering<TaskStuff> createdDateDesc\n  )\n  {\n    giant.lock();\n\n    try {\n      List<TaskStuff> list = createdDateDesc\n          .sortedCopy(tasks.values())\n          .stream()\n          .filter(taskStuff -> taskStuff.getStatus().isComplete() && taskStuff.createdDate.isAfter(start))\n          .collect(Collectors.toList());\n      final ImmutableList.Builder<TaskInfo<Task, TaskStatus>> listBuilder = ImmutableList.builder();\n      for (final TaskStuff taskStuff : list) {\n        String id = taskStuff.getTask().getId();\n        TaskInfo t = new TaskInfo(\n            id,\n            taskStuff.getCreatedDate(),\n            taskStuff.getStatus(),\n            taskStuff.getDataSource(),\n            taskStuff.getTask()\n        );\n        listBuilder.add(t);\n      }\n      return listBuilder.build();\n    }\n    finally {\n      giant.unlock();\n    }\n  }\n","realPath":"indexing-service/src/main/java/org/apache/druid/indexing/overlord/HeapMemoryTaskStorage.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":254,"status":"M"},{"authorDate":"2018-11-21 05:42:44","commitOrder":2,"curCode":"  private List<TaskInfo<Task, TaskStatus>> getNRecentlyCreatedAlreadyFinishedTaskInfo(int n, Ordering<TaskStuff> createdDateDesc)\n  {\n    giant.lock();\n\n    try {\n      List<TaskStuff> list = createdDateDesc\n          .sortedCopy(tasks.values())\n          .stream()\n          .filter(taskStuff -> taskStuff.getStatus().isComplete())\n          .limit(n)\n          .collect(Collectors.toList());\n      final ImmutableList.Builder<TaskInfo<Task, TaskStatus>> listBuilder = ImmutableList.builder();\n      for (final TaskStuff taskStuff : list) {\n        String id = taskStuff.getTask().getId();\n        TaskInfo t = new TaskInfo<>(\n            id,\n            taskStuff.getCreatedDate(),\n            taskStuff.getStatus(),\n            taskStuff.getDataSource(),\n            taskStuff.getTask()\n        );\n        listBuilder.add(t);\n      }\n      return listBuilder.build();\n    }\n    finally {\n      giant.unlock();\n    }\n  }\n","date":"2018-11-21 05:42:44","endLine":314,"groupId":"14861","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"getNRecentlyCreatedAlreadyFinishedTaskInfo","params":"(intn@Ordering<TaskStuff>createdDateDesc)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/51/b38d026095003ec6bd25040e9de8b63bddf0e4.src","preCode":"  private List<TaskInfo<Task, TaskStatus>> getNRecentlyCreatedAlreadyFinishedTaskInfo(int n, Ordering<TaskStuff> createdDateDesc)\n  {\n    giant.lock();\n\n    try {\n      List<TaskStuff> list = createdDateDesc\n          .sortedCopy(tasks.values())\n          .stream()\n          .filter(taskStuff -> taskStuff.getStatus().isComplete())\n          .limit(n)\n          .collect(Collectors.toList());\n      final ImmutableList.Builder<TaskInfo<Task, TaskStatus>> listBuilder = ImmutableList.builder();\n      for (final TaskStuff taskStuff : list) {\n        String id = taskStuff.getTask().getId();\n        TaskInfo t = new TaskInfo<>(\n            id,\n            taskStuff.getCreatedDate(),\n            taskStuff.getStatus(),\n            taskStuff.getDataSource(),\n            taskStuff.getTask()\n        );\n        listBuilder.add(t);\n      }\n      return listBuilder.build();\n    }\n    finally {\n      giant.unlock();\n    }\n  }\n","realPath":"indexing-service/src/main/java/org/apache/druid/indexing/overlord/HeapMemoryTaskStorage.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":286,"status":"N"}],"commitId":"cf2a2dd9174e975e180b18b5d4fc522a37ee4af5","commitMessage":"@@@Add group_id to the sys.tasks table (#8304)\n\n* Add group_id to overlord tasks API and sys.tasks table\n\n* adjust test\n\n* modify docs\n\n* Make groupId nullable\n\n* fix integration test\n\n* fix toString\n\n* Remove groupId from TaskInfo\n\n* Modify docs and tests\n\n* modify TaskMonitorTest\n","date":"2019-08-23 06:28:23","modifiedFileCount":"11","status":"M","submitter":"Surekha"},{"authorTime":"2021-07-05 10:07:26","codes":[{"authorDate":"2021-07-05 10:07:26","commitOrder":3,"curCode":"  private List<TaskInfo<Task, TaskStatus>> getRecentlyCreatedAlreadyFinishedTaskInfoSince(\n      DateTime start,\n      Ordering<TaskStuff> createdDateDesc\n  )\n  {\n    List<TaskInfo<Task, TaskStatus>> list = tasks.values()\n        .stream()\n        .filter(taskStuff -> taskStuff.getStatus().isComplete() && taskStuff.getCreatedDate().isAfter(start))\n        .sorted(createdDateDesc)\n        .map(TaskStuff::toTaskInfo)\n        .collect(Collectors.toList());\n    return Collections.unmodifiableList(list);\n  }\n","date":"2021-07-05 10:07:26","endLine":219,"groupId":"104674","id":5,"instanceNumber":1,"isCurCommit":1,"methodName":"getRecentlyCreatedAlreadyFinishedTaskInfoSince","params":"(DateTimestart@Ordering<TaskStuff>createdDateDesc)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/d9/49faa7638a85350a26609e85a819b93e5dd10d.src","preCode":"  private List<TaskInfo<Task, TaskStatus>> getRecentlyCreatedAlreadyFinishedTaskInfoSince(\n      DateTime start,\n      Ordering<TaskStuff> createdDateDesc\n  )\n  {\n    giant.lock();\n\n    try {\n      List<TaskStuff> list = createdDateDesc\n          .sortedCopy(tasks.values())\n          .stream()\n          .filter(taskStuff -> taskStuff.getStatus().isComplete() && taskStuff.createdDate.isAfter(start))\n          .collect(Collectors.toList());\n      final ImmutableList.Builder<TaskInfo<Task, TaskStatus>> listBuilder = ImmutableList.builder();\n      for (final TaskStuff taskStuff : list) {\n        String id = taskStuff.getTask().getId();\n        TaskInfo t = new TaskInfo<>(\n            id,\n            taskStuff.getCreatedDate(),\n            taskStuff.getStatus(),\n            taskStuff.getDataSource(),\n            taskStuff.getTask()\n        );\n        listBuilder.add(t);\n      }\n      return listBuilder.build();\n    }\n    finally {\n      giant.unlock();\n    }\n  }\n","realPath":"indexing-service/src/main/java/org/apache/druid/indexing/overlord/HeapMemoryTaskStorage.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":207,"status":"M"},{"authorDate":"2021-07-05 10:07:26","commitOrder":3,"curCode":"  private List<TaskInfo<Task, TaskStatus>> getNRecentlyCreatedAlreadyFinishedTaskInfo(\n      int n,\n      Ordering<TaskStuff> createdDateDesc\n  )\n  {\n    List<TaskInfo<Task, TaskStatus>> list = tasks.values()\n        .stream()\n        .filter(taskStuff -> taskStuff.getStatus().isComplete())\n        .sorted(createdDateDesc)\n        .limit(n)\n        .map(TaskStuff::toTaskInfo)\n        .collect(Collectors.toList());\n    return Collections.unmodifiableList(list);\n  }\n","date":"2021-07-05 10:07:26","endLine":234,"groupId":"104674","id":6,"instanceNumber":2,"isCurCommit":1,"methodName":"getNRecentlyCreatedAlreadyFinishedTaskInfo","params":"(intn@Ordering<TaskStuff>createdDateDesc)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/d9/49faa7638a85350a26609e85a819b93e5dd10d.src","preCode":"  private List<TaskInfo<Task, TaskStatus>> getNRecentlyCreatedAlreadyFinishedTaskInfo(\n      int n,\n      Ordering<TaskStuff> createdDateDesc\n  )\n  {\n    giant.lock();\n\n    try {\n      List<TaskStuff> list = createdDateDesc\n          .sortedCopy(tasks.values())\n          .stream()\n          .filter(taskStuff -> taskStuff.getStatus().isComplete())\n          .limit(n)\n          .collect(Collectors.toList());\n      final ImmutableList.Builder<TaskInfo<Task, TaskStatus>> listBuilder = ImmutableList.builder();\n      for (final TaskStuff taskStuff : list) {\n        String id = taskStuff.getTask().getId();\n        TaskInfo t = new TaskInfo<>(\n            id,\n            taskStuff.getCreatedDate(),\n            taskStuff.getStatus(),\n            taskStuff.getDataSource(),\n            taskStuff.getTask()\n        );\n        listBuilder.add(t);\n      }\n      return listBuilder.build();\n    }\n    finally {\n      giant.unlock();\n    }\n  }\n","realPath":"indexing-service/src/main/java/org/apache/druid/indexing/overlord/HeapMemoryTaskStorage.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":221,"status":"M"}],"commitId":"d3220693f3728dd28244d810cb18edc18de9df39","commitMessage":"@@@perf: improve concurrency and improve perf for task query in HeapMemoryTaskStorage (#11272)\n\n* perf: improve concurrency and reduce algorithmic cost for task querying in HeapMemoryTaskStorage\n\n* fix: address intellij linter concern regarding use of ConcurrentMap interface\n\n* nit: document thread safety of HeapMemoryTaskStorage\n\n* empty to trigger ci","date":"2021-07-05 10:07:26","modifiedFileCount":"1","status":"M","submitter":"Jason Koch"}]
