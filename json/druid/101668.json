[{"authorTime":"2021-03-09 13:20:26","codes":[{"authorDate":"2021-03-09 13:20:26","commitOrder":1,"curCode":"  public void testUnionAllTwoQueriesLeftQueryIsJoin() throws Exception\n  {\n    cannotVectorize();\n\n    testQuery(\n        \"(SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k)  UNION ALL SELECT SUM(cnt) FROM foo\",\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                      new TableDataSource(CalciteTests.DATASOURCE1),\n                      new LookupDataSource(\"lookyloo\"),\n                      \"j0.\",\n                      equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                      JoinType.INNER\n                  ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build(),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n        ),\n        ImmutableList.of(new Object[]{1L}, new Object[]{6L})\n    );\n  }\n","date":"2021-03-09 13:20:26","endLine":4303,"groupId":"1752","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testUnionAllTwoQueriesLeftQueryIsJoin","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/88/fd1dcceb40e4b5babea6e7cc90905660be7f34.src","preCode":"  public void testUnionAllTwoQueriesLeftQueryIsJoin() throws Exception\n  {\n    cannotVectorize();\n\n    testQuery(\n        \"(SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k)  UNION ALL SELECT SUM(cnt) FROM foo\",\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                      new TableDataSource(CalciteTests.DATASOURCE1),\n                      new LookupDataSource(\"lookyloo\"),\n                      \"j0.\",\n                      equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                      JoinType.INNER\n                  ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build(),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n        ),\n        ImmutableList.of(new Object[]{1L}, new Object[]{6L})\n    );\n  }\n","realPath":"sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":4272,"status":"B"},{"authorDate":"2021-03-09 13:20:26","commitOrder":1,"curCode":"  public void testUnionAllTwoQueriesRightQueryIsJoin() throws Exception\n  {\n    cannotVectorize();\n\n    testQuery(\n        \"(SELECT SUM(cnt) FROM foo UNION ALL SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k) \",\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build(),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                          new TableDataSource(CalciteTests.DATASOURCE1),\n                          new LookupDataSource(\"lookyloo\"),\n                          \"j0.\",\n                          equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                          JoinType.INNER\n                      ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n        ),\n        ImmutableList.of(new Object[]{6L}, new Object[]{1L})\n    );\n  }\n","date":"2021-03-09 13:20:26","endLine":4337,"groupId":"8643","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testUnionAllTwoQueriesRightQueryIsJoin","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/88/fd1dcceb40e4b5babea6e7cc90905660be7f34.src","preCode":"  public void testUnionAllTwoQueriesRightQueryIsJoin() throws Exception\n  {\n    cannotVectorize();\n\n    testQuery(\n        \"(SELECT SUM(cnt) FROM foo UNION ALL SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k) \",\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build(),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                          new TableDataSource(CalciteTests.DATASOURCE1),\n                          new LookupDataSource(\"lookyloo\"),\n                          \"j0.\",\n                          equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                          JoinType.INNER\n                      ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n        ),\n        ImmutableList.of(new Object[]{6L}, new Object[]{1L})\n    );\n  }\n","realPath":"sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":4306,"status":"B"}],"commitId":"ae620921df2230dfb05a4396012cb72aae428069","commitMessage":"@@@Fix classCastException when inputs to union are join (#10950)\n\n* Fix union queries\n\n* Add tests","date":"2021-03-09 13:20:26","modifiedFileCount":"3","status":"B","submitter":"Abhishek Agarwal"},{"authorTime":"2021-04-15 01:49:27","codes":[{"authorDate":"2021-04-15 01:49:27","commitOrder":2,"curCode":"  public void testUnionAllTwoQueriesLeftQueryIsJoin(Map<String, Object> queryContext) throws Exception\n  {\n    \r\n    if (!isRewriteJoinToFilter(queryContext)) {\n      cannotVectorize();\n    }\n\n    testQuery(\n        \"(SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k)  UNION ALL SELECT SUM(cnt) FROM foo\",\n        queryContext,\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                      new TableDataSource(CalciteTests.DATASOURCE1),\n                      new LookupDataSource(\"lookyloo\"),\n                      \"j0.\",\n                      equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                      JoinType.INNER\n                  ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext)\n        ),\n        ImmutableList.of(new Object[]{1L}, new Object[]{6L})\n    );\n  }\n","date":"2021-04-15 01:49:27","endLine":4353,"groupId":"1752","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testUnionAllTwoQueriesLeftQueryIsJoin","params":"(Map<String@Object>queryContext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/e4/7a89a5f784d8e7b5f15645a5dacf38a7460d1d.src","preCode":"  public void testUnionAllTwoQueriesLeftQueryIsJoin() throws Exception\n  {\n    cannotVectorize();\n\n    testQuery(\n        \"(SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k)  UNION ALL SELECT SUM(cnt) FROM foo\",\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                      new TableDataSource(CalciteTests.DATASOURCE1),\n                      new LookupDataSource(\"lookyloo\"),\n                      \"j0.\",\n                      equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                      JoinType.INNER\n                  ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build(),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n        ),\n        ImmutableList.of(new Object[]{1L}, new Object[]{6L})\n    );\n  }\n","realPath":"sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":4316,"status":"M"},{"authorDate":"2021-04-15 01:49:27","commitOrder":2,"curCode":"  public void testUnionAllTwoQueriesRightQueryIsJoin(Map<String, Object> queryContext) throws Exception\n  {\n    \r\n    if (!isRewriteJoinToFilter(queryContext)) {\n      cannotVectorize();\n    }\n\n    testQuery(\n        \"(SELECT SUM(cnt) FROM foo UNION ALL SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k) \",\n        queryContext,\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                          new TableDataSource(CalciteTests.DATASOURCE1),\n                          new LookupDataSource(\"lookyloo\"),\n                          \"j0.\",\n                          equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                          JoinType.INNER\n                      ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext)\n        ),\n        ImmutableList.of(new Object[]{6L}, new Object[]{1L})\n    );\n  }\n","date":"2021-04-15 01:49:27","endLine":4394,"groupId":"8643","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testUnionAllTwoQueriesRightQueryIsJoin","params":"(Map<String@Object>queryContext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/e4/7a89a5f784d8e7b5f15645a5dacf38a7460d1d.src","preCode":"  public void testUnionAllTwoQueriesRightQueryIsJoin() throws Exception\n  {\n    cannotVectorize();\n\n    testQuery(\n        \"(SELECT SUM(cnt) FROM foo UNION ALL SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k) \",\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build(),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                          new TableDataSource(CalciteTests.DATASOURCE1),\n                          new LookupDataSource(\"lookyloo\"),\n                          \"j0.\",\n                          equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                          JoinType.INNER\n                      ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n        ),\n        ImmutableList.of(new Object[]{6L}, new Object[]{1L})\n    );\n  }\n","realPath":"sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":4357,"status":"M"}],"commitId":"202c78c8f32bd3ec5e70e021b1494d878f38d678","commitMessage":"@@@Enable rewriting certain inner joins as filters. (#11068)\n\n* Enable rewriting certain inner joins as filters.\n\nThe main logic for doing the rewrite is in JoinableFactoryWrapper's\nsegmentMapFn method. The requirements are:\n\n- It must be an inner equi-join.\n- The right-hand columns referenced by the condition must not contain any\n  duplicate values. (If they did.  the inner join would not be guaranteed\n  to return at most one row for each left-hand-side row.)\n- No columns from the right-hand side can be used by anything other than\n  the join condition itself.\n\nHashJoinSegmentStorageAdapter is also modified to pass through to\nthe base adapter (even allowing vectorization!) in the case where 100%\nof join clauses could be rewritten as filters.\n\nIn support of this goal:\n\n- Add Query getRequiredColumns() method to help us figure out whether\n  the right-hand side of a join datasource is being used or not.\n- Add JoinConditionAnalysis getRequiredColumns() method to help us\n  figure out if the right-hand side of a join is being used by later\n  join clauses acting on the same base.\n- Add Joinable getNonNullColumnValuesIfAllUnique method to enable\n  retrieving the set of values that will form the \"in\" filter.\n- Add LookupExtractor canGetKeySet() and keySet() methods to support\n  LookupJoinable in its efforts to implement the new Joinable method.\n- Add \"enableRewriteJoinToFilter\" feature flag to\n  JoinFilterRewriteConfig. The default is disabled.\n\n* Test improvements.\n\n* Test fixes.\n\n* Avoid slow size() call.\n\n* Remove invalid test.\n\n* Fix style.\n\n* Fix mistaken default.\n\n* Small fixes.\n\n* Fix logic error.","date":"2021-04-15 01:49:27","modifiedFileCount":"38","status":"M","submitter":"Gian Merlino"},{"authorTime":"2021-05-11 01:13:37","codes":[{"authorDate":"2021-05-11 01:13:37","commitOrder":3,"curCode":"  public void testUnionAllTwoQueriesLeftQueryIsJoin(Map<String, Object> queryContext) throws Exception\n  {\n    \r\n    if (!isRewriteJoinToFilter(queryContext)) {\n      cannotVectorize();\n    }\n\n    testQuery(\n        \"(SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k)  UNION ALL SELECT SUM(cnt) FROM foo\",\n        queryContext,\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                      new TableDataSource(CalciteTests.DATASOURCE1),\n                      new LookupDataSource(\"lookyloo\"),\n                      \"j0.\",\n                      equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                      JoinType.INNER\n                  ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(QUERY_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(QUERY_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext)\n        ),\n        ImmutableList.of(new Object[]{1L}, new Object[]{6L})\n    );\n  }\n","date":"2021-05-11 01:13:37","endLine":4421,"groupId":"101668","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testUnionAllTwoQueriesLeftQueryIsJoin","params":"(Map<String@Object>queryContext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/1e/fd99b05ebe6da94fffaa752ce8de0e97ef485f.src","preCode":"  public void testUnionAllTwoQueriesLeftQueryIsJoin(Map<String, Object> queryContext) throws Exception\n  {\n    \r\n    if (!isRewriteJoinToFilter(queryContext)) {\n      cannotVectorize();\n    }\n\n    testQuery(\n        \"(SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k)  UNION ALL SELECT SUM(cnt) FROM foo\",\n        queryContext,\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                      new TableDataSource(CalciteTests.DATASOURCE1),\n                      new LookupDataSource(\"lookyloo\"),\n                      \"j0.\",\n                      equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                      JoinType.INNER\n                  ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext)\n        ),\n        ImmutableList.of(new Object[]{1L}, new Object[]{6L})\n    );\n  }\n","realPath":"sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":4384,"status":"M"},{"authorDate":"2021-05-11 01:13:37","commitOrder":3,"curCode":"  public void testUnionAllTwoQueriesRightQueryIsJoin(Map<String, Object> queryContext) throws Exception\n  {\n    \r\n    if (!isRewriteJoinToFilter(queryContext)) {\n      cannotVectorize();\n    }\n\n    testQuery(\n        \"(SELECT SUM(cnt) FROM foo UNION ALL SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k) \",\n        queryContext,\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(QUERY_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                          new TableDataSource(CalciteTests.DATASOURCE1),\n                          new LookupDataSource(\"lookyloo\"),\n                          \"j0.\",\n                          equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                          JoinType.INNER\n                      ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(QUERY_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext)\n        ),\n        ImmutableList.of(new Object[]{6L}, new Object[]{1L})\n    );\n  }\n","date":"2021-05-11 01:13:37","endLine":4462,"groupId":"101668","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testUnionAllTwoQueriesRightQueryIsJoin","params":"(Map<String@Object>queryContext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/1e/fd99b05ebe6da94fffaa752ce8de0e97ef485f.src","preCode":"  public void testUnionAllTwoQueriesRightQueryIsJoin(Map<String, Object> queryContext) throws Exception\n  {\n    \r\n    if (!isRewriteJoinToFilter(queryContext)) {\n      cannotVectorize();\n    }\n\n    testQuery(\n        \"(SELECT SUM(cnt) FROM foo UNION ALL SELECT COUNT(*) FROM foo INNER JOIN lookup.lookyloo ON foo.dim1 = lookyloo.k) \",\n        queryContext,\n        ImmutableList.of(\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(CalciteTests.DATASOURCE1)\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new LongSumAggregatorFactory(\"a0\", \"cnt\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext),\n            Druids.newTimeseriesQueryBuilder()\n                  .dataSource(\n                      join(\n                          new TableDataSource(CalciteTests.DATASOURCE1),\n                          new LookupDataSource(\"lookyloo\"),\n                          \"j0.\",\n                          equalsCondition(DruidExpression.fromColumn(\"dim1\"), DruidExpression.fromColumn(\"j0.k\")),\n                          JoinType.INNER\n                      ))\n                  .intervals(querySegmentSpec(Filtration.eternity()))\n                  .granularity(Granularities.ALL)\n                  .aggregators(aggregators(new CountAggregatorFactory(\"a0\")))\n                  .context(TIMESERIES_CONTEXT_DEFAULT)\n                  .build()\n                  .withOverriddenContext(queryContext)\n        ),\n        ImmutableList.of(new Object[]{6L}, new Object[]{1L})\n    );\n  }\n","realPath":"sql/src/test/java/org/apache/druid/sql/calcite/CalciteQueryTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":4425,"status":"M"}],"commitId":"691d7a1d548909951468005348a603380f4d6d74","commitMessage":"@@@SQL timeseries no longer skip empty buckets with all granularity (#11188)\n\n* SQL timeseries no longer skip empty buckets with all granularity\n\n* add comment.  fix tests\n\n* the ol switcheroo\n\n* revert unintended change\n\n* docs and more tests\n\n* style\n\n* make checkstyle happy\n\n* docs fixes and more tests\n\n* add docs.  tests for array_agg\n\n* fixes\n\n* oops\n\n* doc stuffs\n\n* fix compile.  match doc style","date":"2021-05-11 01:13:37","modifiedFileCount":"16","status":"M","submitter":"Clint Wylie"}]
