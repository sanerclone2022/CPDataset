[{"authorTime":"2019-11-08 03:58:46","codes":[{"authorDate":"2019-11-08 03:58:46","commitOrder":1,"curCode":"  public void testAllInSingleBatch() throws Exception\n  {\n    \r\n    List<Sequence<IntPair>> input = new ArrayList<>();\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(6));\n    assertResult(input, 10, 20);\n\n    input.clear();\n\n    \r\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(6));\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(8));\n    input.add(nonBlockingSequence(4));\n    input.add(nonBlockingSequence(6));\n    assertResult(input, 10, 20);\n  }\n","date":"2019-11-08 03:58:46","endLine":305,"groupId":"8032","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testAllInSingleBatch","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/15/6447505c4b507bddb7469914202cce98e1b3f6.src","preCode":"  public void testAllInSingleBatch() throws Exception\n  {\n    \r\n    List<Sequence<IntPair>> input = new ArrayList<>();\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(6));\n    assertResult(input, 10, 20);\n\n    input.clear();\n\n    \r\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(6));\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(8));\n    input.add(nonBlockingSequence(4));\n    input.add(nonBlockingSequence(6));\n    assertResult(input, 10, 20);\n  }\n","realPath":"core/src/test/java/org/apache/druid/java/util/common/guava/ParallelMergeCombiningSequenceTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":287,"status":"B"},{"authorDate":"2019-11-08 03:58:46","commitOrder":1,"curCode":"  public void testMultiBatchMultiYield() throws Exception\n  {\n    \r\n    List<Sequence<IntPair>> input = new ArrayList<>();\n    input.add(nonBlockingSequence(15));\n    input.add(nonBlockingSequence(26));\n\n    assertResult(input, 5, 10);\n\n    \r\n    input.add(nonBlockingSequence(15));\n    input.add(nonBlockingSequence(33));\n    input.add(nonBlockingSequence(17));\n    input.add(nonBlockingSequence(14));\n\n    assertResult(input, 5, 10);\n  }\n","date":"2019-11-08 03:58:46","endLine":346,"groupId":"8032","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testMultiBatchMultiYield","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/15/6447505c4b507bddb7469914202cce98e1b3f6.src","preCode":"  public void testMultiBatchMultiYield() throws Exception\n  {\n    \r\n    List<Sequence<IntPair>> input = new ArrayList<>();\n    input.add(nonBlockingSequence(15));\n    input.add(nonBlockingSequence(26));\n\n    assertResult(input, 5, 10);\n\n    \r\n    input.add(nonBlockingSequence(15));\n    input.add(nonBlockingSequence(33));\n    input.add(nonBlockingSequence(17));\n    input.add(nonBlockingSequence(14));\n\n    assertResult(input, 5, 10);\n  }\n","realPath":"core/src/test/java/org/apache/druid/java/util/common/guava/ParallelMergeCombiningSequenceTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":330,"status":"B"}],"commitId":"7aafcf8bcae3d57a8992a2634c7b73869c9a4117","commitMessage":"@@@parallel broker merges on fork join pool (#8578)\n\n* sketch of broker parallel merges done in small batches on fork join pool\n\n* fix non-terminating sequences.  auto compute parallelism\n\n* adjust benches\n\n* adjust benchmarks\n\n* now hella more faster.  fixed dumb\n\n* fix\n\n* remove comments\n\n* log.info for debug\n\n* javadoc\n\n* safer block for sequence to yielder conversion\n\n* refactor LifecycleForkJoinPool into LifecycleForkJoinPoolProvider which wraps a ForkJoinPool\n\n* smooth yield rate adjustment.  more logs to help tune\n\n* cleanup.  less logs\n\n* error handling.  bug fixes.  on by default.  more parallel.  more tests\n\n* remove unused var\n\n* comments\n\n* timeboundary mergeFn\n\n* simplify.  more javadoc\n\n* formatting\n\n* pushdown config\n\n* use nanos consistently.  move logs back to debug level.  bit more javadoc\n\n* static terminal result batch\n\n* javadoc for nullability of createMergeFn\n\n* cleanup\n\n* oops\n\n* fix race.  add docs\n\n* spelling.  remove todo.  add unhandled exception log\n\n* cleanup.  revert unintended change\n\n* another unintended change\n\n* review stuff\n\n* add ParallelMergeCombiningSequenceBenchmark.  fixes\n\n* hyper-threading is the enemy\n\n* fix initial start delay.  lol\n\n* parallelism computer now balances partition sizes to partition counts using sqrt of sequence count instead of sequence count by 2\n\n* fix those important style issues with the benchmarks code\n\n* lazy sequence creation for benchmarks\n\n* more benchmark comments\n\n* stable sequence generation time\n\n* update defaults to use 100ms target time.  4096 batch size.  16384 initial yield.  also update user docs\n\n* add jmh thread based benchmarks.  cleanup some stuff\n\n* oops\n\n* style\n\n* add spread to jmh thread benchmark start range.  more comments to benchmarks parameters and purpose\n\n* retool benchmark to allow modeling more typical heterogenous heavy workloads\n\n* spelling\n\n* fix\n\n* refactor benchmarks\n\n* formatting\n\n* docs\n\n* add maxThreadStartDelay parameter to threaded benchmark\n\n* why does catch need to be on its own line but else doesnt\n","date":"2019-11-08 03:58:46","modifiedFileCount":"16","status":"B","submitter":"Clint Wylie"},{"authorTime":"2019-12-07 05:42:53","codes":[{"authorDate":"2019-12-07 05:42:53","commitOrder":2,"curCode":"  public void testAllInSingleBatch() throws Exception\n  {\n    \r\n    List<Sequence<IntPair>> input = new ArrayList<>();\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(6));\n    assertResult(input, 10, 20, reportMetrics -> {\n      Assert.assertEquals(1, reportMetrics.getParallelism());\n      Assert.assertEquals(2, reportMetrics.getInputSequences());\n      Assert.assertEquals(11, reportMetrics.getInputRows());\n      \r\n      Assert.assertEquals(6, reportMetrics.getOutputRows(), 5);\n      Assert.assertEquals(4, reportMetrics.getTaskCount());\n    });\n\n    input.clear();\n\n    \r\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(6));\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(8));\n    input.add(nonBlockingSequence(4));\n    input.add(nonBlockingSequence(6));\n    assertResult(input, 10, 20, reportMetrics -> {\n      Assert.assertEquals(2, reportMetrics.getParallelism());\n      Assert.assertEquals(6, reportMetrics.getInputSequences());\n      Assert.assertEquals(34, reportMetrics.getInputRows());\n      \r\n      Assert.assertEquals(16, reportMetrics.getOutputRows(), 15);\n      Assert.assertEquals(10, reportMetrics.getTaskCount(), 2);\n    });\n  }\n","date":"2019-12-07 05:42:53","endLine":321,"groupId":"105017","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testAllInSingleBatch","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/e9/6e1e3a0aa1a5c7007d3a2dd79e610ff863f6ed.src","preCode":"  public void testAllInSingleBatch() throws Exception\n  {\n    \r\n    List<Sequence<IntPair>> input = new ArrayList<>();\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(6));\n    assertResult(input, 10, 20);\n\n    input.clear();\n\n    \r\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(6));\n    input.add(nonBlockingSequence(5));\n    input.add(nonBlockingSequence(8));\n    input.add(nonBlockingSequence(4));\n    input.add(nonBlockingSequence(6));\n    assertResult(input, 10, 20);\n  }\n","realPath":"core/src/test/java/org/apache/druid/java/util/common/guava/ParallelMergeCombiningSequenceTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":289,"status":"M"},{"authorDate":"2019-12-07 05:42:53","commitOrder":2,"curCode":"  public void testMultiBatchMultiYield() throws Exception\n  {\n    \r\n    List<Sequence<IntPair>> input = new ArrayList<>();\n    input.add(nonBlockingSequence(15));\n    input.add(nonBlockingSequence(26));\n\n    assertResult(input, 5, 10, reportMetrics -> {\n      Assert.assertEquals(1, reportMetrics.getParallelism());\n      Assert.assertEquals(2, reportMetrics.getInputSequences());\n      Assert.assertEquals(41, reportMetrics.getInputRows());\n      \r\n      Assert.assertEquals(21, reportMetrics.getOutputRows(), 20);\n      Assert.assertEquals(4, reportMetrics.getTaskCount(), 2);\n    });\n\n    \r\n    input.add(nonBlockingSequence(15));\n    input.add(nonBlockingSequence(33));\n    input.add(nonBlockingSequence(17));\n    input.add(nonBlockingSequence(14));\n\n    assertResult(input, 5, 10, reportMetrics -> {\n      Assert.assertEquals(2, reportMetrics.getParallelism());\n      Assert.assertEquals(6, reportMetrics.getInputSequences());\n      Assert.assertEquals(120, reportMetrics.getInputRows());\n      \r\n      Assert.assertEquals(60, reportMetrics.getOutputRows(), 59);\n      Assert.assertEquals(10, reportMetrics.getTaskCount(), 5);\n    });\n  }\n","date":"2019-12-07 05:42:53","endLine":390,"groupId":"105017","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testMultiBatchMultiYield","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/e9/6e1e3a0aa1a5c7007d3a2dd79e610ff863f6ed.src","preCode":"  public void testMultiBatchMultiYield() throws Exception\n  {\n    \r\n    List<Sequence<IntPair>> input = new ArrayList<>();\n    input.add(nonBlockingSequence(15));\n    input.add(nonBlockingSequence(26));\n\n    assertResult(input, 5, 10);\n\n    \r\n    input.add(nonBlockingSequence(15));\n    input.add(nonBlockingSequence(33));\n    input.add(nonBlockingSequence(17));\n    input.add(nonBlockingSequence(14));\n\n    assertResult(input, 5, 10);\n  }\n","realPath":"core/src/test/java/org/apache/druid/java/util/common/guava/ParallelMergeCombiningSequenceTest.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":360,"status":"M"}],"commitId":"06cd30460ef51f9e316e86d4b417882efc9b861c","commitMessage":"@@@add query metrics for broker parallel merges.  off by default (#8981)\n\n* add a bunch of metrics for broker parallel merges.  off by default.  and tests\n\n* fix tests\n\n* review stuffs\n\n* propogateIfPossible\n","date":"2019-12-07 05:42:53","modifiedFileCount":"12","status":"M","submitter":"Clint Wylie"}]
