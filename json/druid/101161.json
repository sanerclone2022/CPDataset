[{"authorTime":"2021-04-21 08:10:43","codes":[{"authorDate":"2021-05-07 13:25:23","commitOrder":2,"curCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    if ((lastKillTime + period) < System.currentTimeMillis()) {\n      lastKillTime = System.currentTimeMillis();\n\n      long timestamp = System.currentTimeMillis() - retainDuration;\n      int supervisorRemoved = metadataSupervisorManager.removeTerminatedSupervisorsOlderThan(timestamp);\n      ServiceEmitter emitter = params.getEmitter();\n      emitter.emit(\n          new ServiceMetricEvent.Builder().build(\n              \"metadata/kill/supervisor/count\",\n              supervisorRemoved\n          )\n      );\n      log.info(\"Finished running KillSupervisors duty. Removed %,d supervisor\", supervisorRemoved);\n    }\n    return params;\n  }\n","date":"2021-05-07 13:25:23","endLine":83,"groupId":"22457","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"run","params":"(DruidCoordinatorRuntimeParamsparams)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/a1/c2a3f283267532e7d3d59e1089a6ccaee2924c.src","preCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    if ((lastKillTime + period) < System.currentTimeMillis()) {\n      lastKillTime = System.currentTimeMillis();\n\n      long timestamp = System.currentTimeMillis() - retainDuration;\n      int supervisorRemoved = metadataSupervisorManager.removeTerminatedSupervisorsOlderThan(timestamp);\n      ServiceEmitter emitter = params.getEmitter();\n      emitter.emit(\n          new ServiceMetricEvent.Builder().build(\n              \"metadata/kill/supervisor/count\",\n              supervisorRemoved\n          )\n      );\n      log.info(\"Finished running KillSupervisors duty. Removed %,d supervisor\", supervisorRemoved);\n    }\n    return params;\n  }\n","realPath":"server/src/main/java/org/apache/druid/server/coordinator/duty/KillSupervisors.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":66,"status":"B"},{"authorDate":"2021-04-21 08:10:43","commitOrder":2,"curCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    if ((lastKillTime + period) < System.currentTimeMillis()) {\n      lastKillTime = System.currentTimeMillis();\n\n      long timestamp = System.currentTimeMillis() - retainDuration;\n      int auditRemoved = auditManager.removeAuditLogsOlderThan(timestamp);\n      ServiceEmitter emitter = params.getEmitter();\n      emitter.emit(\n          new ServiceMetricEvent.Builder().build(\n              \"metadata/kill/audit/count\",\n              auditRemoved\n          )\n      );\n      log.info(\"Finished running KillAuditLog duty. Removed %,d audit logs\", auditRemoved);\n    }\n    return params;\n  }\n","date":"2021-04-21 08:10:43","endLine":80,"groupId":"22457","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"run","params":"(DruidCoordinatorRuntimeParamsparams)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/65/1cf6b60c964396a74d518bc8f5703889166da8.src","preCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    if ((lastKillTime + period) < System.currentTimeMillis()) {\n      lastKillTime = System.currentTimeMillis();\n\n      long timestamp = System.currentTimeMillis() - retainDuration;\n      int auditRemoved = auditManager.removeAuditLogsOlderThan(timestamp);\n      ServiceEmitter emitter = params.getEmitter();\n      emitter.emit(\n          new ServiceMetricEvent.Builder().build(\n              \"metadata/kill/audit/count\",\n              auditRemoved\n          )\n      );\n      log.info(\"Finished running KillAuditLog duty. Removed %,d audit logs\", auditRemoved);\n    }\n    return params;\n  }\n","realPath":"server/src/main/java/org/apache/druid/server/coordinator/duty/KillAuditLog.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":63,"status":"NB"}],"commitId":"d73f72e50892fe0b7450d8d4bf5678c3f8270cfe","commitMessage":"@@@Add feature to automatically remove supervisor based on retention period (#11200)\n\n* add auto clean up\n\n* add test\n\n* add test\n\n* fix test\n\n* Address comments\n\n* Address comments","date":"2021-05-07 13:25:23","modifiedFileCount":"14","status":"M","submitter":"Maytas Monsereenusorn"},{"authorTime":"2021-05-11 16:22:33","codes":[{"authorDate":"2021-05-11 16:22:33","commitOrder":3,"curCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    long currentTimeMillis = System.currentTimeMillis();\n    if ((lastKillTime + period) < currentTimeMillis) {\n      lastKillTime = currentTimeMillis;\n      long timestamp = currentTimeMillis - retainDuration;\n      try {\n        int supervisorRemoved = metadataSupervisorManager.removeTerminatedSupervisorsOlderThan(timestamp);\n        ServiceEmitter emitter = params.getEmitter();\n        emitter.emit(\n            new ServiceMetricEvent.Builder().build(\n                \"metadata/kill/supervisor/count\",\n                supervisorRemoved\n            )\n        );\n        log.info(\"Finished running KillSupervisors duty. Removed %,d supervisor\", supervisorRemoved);\n      }\n      catch (Exception e) {\n        log.error(e, \"Failed to kill terminated supervisor metadata\");\n      }\n    }\n    return params;\n  }\n","date":"2021-05-11 16:22:33","endLine":89,"groupId":"2296","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"run","params":"(DruidCoordinatorRuntimeParamsparams)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/8a/0b484f3eaa19b99cea6258e2e4ed325b57c24f.src","preCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    if ((lastKillTime + period) < System.currentTimeMillis()) {\n      lastKillTime = System.currentTimeMillis();\n\n      long timestamp = System.currentTimeMillis() - retainDuration;\n      int supervisorRemoved = metadataSupervisorManager.removeTerminatedSupervisorsOlderThan(timestamp);\n      ServiceEmitter emitter = params.getEmitter();\n      emitter.emit(\n          new ServiceMetricEvent.Builder().build(\n              \"metadata/kill/supervisor/count\",\n              supervisorRemoved\n          )\n      );\n      log.info(\"Finished running KillSupervisors duty. Removed %,d supervisor\", supervisorRemoved);\n    }\n    return params;\n  }\n","realPath":"server/src/main/java/org/apache/druid/server/coordinator/duty/KillSupervisors.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":67,"status":"M"},{"authorDate":"2021-05-11 16:22:33","commitOrder":3,"curCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    long currentTimeMillis = System.currentTimeMillis();\n    if ((lastKillTime + period) < currentTimeMillis) {\n      lastKillTime = currentTimeMillis;\n      long timestamp = currentTimeMillis - retainDuration;\n      try {\n        int auditRemoved = auditManager.removeAuditLogsOlderThan(timestamp);\n        ServiceEmitter emitter = params.getEmitter();\n        emitter.emit(\n            new ServiceMetricEvent.Builder().build(\n                \"metadata/kill/audit/count\",\n                auditRemoved\n            )\n        );\n        log.info(\"Finished running KillAuditLog duty. Removed %,d audit logs\", auditRemoved);\n      }\n      catch (Exception e) {\n        log.error(e, \"Failed to kill audit log\");\n      }\n    }\n    return params;\n  }\n","date":"2021-05-11 16:22:33","endLine":86,"groupId":"2296","id":4,"instanceNumber":2,"isCurCommit":1,"methodName":"run","params":"(DruidCoordinatorRuntimeParamsparams)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/ac/735c6594aaec4a7a5191fb02a463ee89efda2f.src","preCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    if ((lastKillTime + period) < System.currentTimeMillis()) {\n      lastKillTime = System.currentTimeMillis();\n\n      long timestamp = System.currentTimeMillis() - retainDuration;\n      int auditRemoved = auditManager.removeAuditLogsOlderThan(timestamp);\n      ServiceEmitter emitter = params.getEmitter();\n      emitter.emit(\n          new ServiceMetricEvent.Builder().build(\n              \"metadata/kill/audit/count\",\n              auditRemoved\n          )\n      );\n      log.info(\"Finished running KillAuditLog duty. Removed %,d audit logs\", auditRemoved);\n    }\n    return params;\n  }\n","realPath":"server/src/main/java/org/apache/druid/server/coordinator/duty/KillAuditLog.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":64,"status":"M"}],"commitId":"4326e699bd3e146e1899f014e8765c52241f3cd3","commitMessage":"@@@Add feature to automatically remove datasource metadata based on retention period (#11227)\n\n* add auto clean up datasource metadata\n\n* add test\n\n* fix checkstyle\n\n* add comments\n\n* fix error\n\n* address comments\n\n* Address comments\n\n* fix test\n\n* fix test\n\n* fix typo\n\n* add comment\n\n* fix test\n\n* fix test","date":"2021-05-11 16:22:33","modifiedFileCount":"22","status":"M","submitter":"Maytas Monsereenusorn"},{"authorTime":"2021-05-11 16:22:33","codes":[{"authorDate":"2021-07-13 10:47:49","commitOrder":4,"curCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    long currentTimeMillis = System.currentTimeMillis();\n    if ((lastKillTime + period) < currentTimeMillis) {\n      lastKillTime = currentTimeMillis;\n      long timestamp = currentTimeMillis - retainDuration;\n      try {\n        int supervisorRemoved = metadataSupervisorManager.removeTerminatedSupervisorsOlderThan(timestamp);\n        ServiceEmitter emitter = params.getEmitter();\n        emitter.emit(\n            new ServiceMetricEvent.Builder().build(\n                \"metadata/kill/supervisor/count\",\n                supervisorRemoved\n            )\n        );\n        log.info(\"Finished running KillSupervisors duty. Removed %,d supervisor specs\", supervisorRemoved);\n      }\n      catch (Exception e) {\n        log.error(e, \"Failed to kill terminated supervisor metadata\");\n      }\n    }\n    return params;\n  }\n","date":"2021-07-13 10:47:49","endLine":89,"groupId":"101161","id":5,"instanceNumber":1,"isCurCommit":1,"methodName":"run","params":"(DruidCoordinatorRuntimeParamsparams)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/3f/87f5dee82436a9027cabaa405f2eb9579d5b9d.src","preCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    long currentTimeMillis = System.currentTimeMillis();\n    if ((lastKillTime + period) < currentTimeMillis) {\n      lastKillTime = currentTimeMillis;\n      long timestamp = currentTimeMillis - retainDuration;\n      try {\n        int supervisorRemoved = metadataSupervisorManager.removeTerminatedSupervisorsOlderThan(timestamp);\n        ServiceEmitter emitter = params.getEmitter();\n        emitter.emit(\n            new ServiceMetricEvent.Builder().build(\n                \"metadata/kill/supervisor/count\",\n                supervisorRemoved\n            )\n        );\n        log.info(\"Finished running KillSupervisors duty. Removed %,d supervisor\", supervisorRemoved);\n      }\n      catch (Exception e) {\n        log.error(e, \"Failed to kill terminated supervisor metadata\");\n      }\n    }\n    return params;\n  }\n","realPath":"server/src/main/java/org/apache/druid/server/coordinator/duty/KillSupervisors.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":67,"status":"M"},{"authorDate":"2021-05-11 16:22:33","commitOrder":4,"curCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    long currentTimeMillis = System.currentTimeMillis();\n    if ((lastKillTime + period) < currentTimeMillis) {\n      lastKillTime = currentTimeMillis;\n      long timestamp = currentTimeMillis - retainDuration;\n      try {\n        int auditRemoved = auditManager.removeAuditLogsOlderThan(timestamp);\n        ServiceEmitter emitter = params.getEmitter();\n        emitter.emit(\n            new ServiceMetricEvent.Builder().build(\n                \"metadata/kill/audit/count\",\n                auditRemoved\n            )\n        );\n        log.info(\"Finished running KillAuditLog duty. Removed %,d audit logs\", auditRemoved);\n      }\n      catch (Exception e) {\n        log.error(e, \"Failed to kill audit log\");\n      }\n    }\n    return params;\n  }\n","date":"2021-05-11 16:22:33","endLine":86,"groupId":"101161","id":6,"instanceNumber":2,"isCurCommit":1,"methodName":"run","params":"(DruidCoordinatorRuntimeParamsparams)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-druid-10-0.7/blobInfo/CC_OUT/blobs/ac/735c6594aaec4a7a5191fb02a463ee89efda2f.src","preCode":"  public DruidCoordinatorRuntimeParams run(DruidCoordinatorRuntimeParams params)\n  {\n    long currentTimeMillis = System.currentTimeMillis();\n    if ((lastKillTime + period) < currentTimeMillis) {\n      lastKillTime = currentTimeMillis;\n      long timestamp = currentTimeMillis - retainDuration;\n      try {\n        int auditRemoved = auditManager.removeAuditLogsOlderThan(timestamp);\n        ServiceEmitter emitter = params.getEmitter();\n        emitter.emit(\n            new ServiceMetricEvent.Builder().build(\n                \"metadata/kill/audit/count\",\n                auditRemoved\n            )\n        );\n        log.info(\"Finished running KillAuditLog duty. Removed %,d audit logs\", auditRemoved);\n      }\n      catch (Exception e) {\n        log.error(e, \"Failed to kill audit log\");\n      }\n    }\n    return params;\n  }\n","realPath":"server/src/main/java/org/apache/druid/server/coordinator/duty/KillAuditLog.java","repoName":"druid","snippetEndLine":0,"snippetStartLine":0,"startLine":64,"status":"N"}],"commitId":"f5d53569ca82c073d3af973dfedaf98a4eb96e83","commitMessage":"@@@Supervisor metadata auto cleanup failing as missing Guice injection (#11424)\n\n* Fix Supervisor metadata auto cleanup failing as missing Guice injection\n\n* Fix Supervisor metadata auto cleanup failing as missing Guice injection\n\n* fix IT\n\n* fix IT\n\n* Update services/src/main/java/org/apache/druid/cli/CliCoordinator.java\n\nCo-authored-by: Clint Wylie <cjwylie@gmail.com>\n\n* fix\n\n* fix\n\n* fix\n\n* fix\n\n* fix\n\n* fix\n\n* fix\n\nCo-authored-by: Clint Wylie <cjwylie@gmail.com>","date":"2021-07-13 10:47:49","modifiedFileCount":"5","status":"M","submitter":"Maytas Monsereenusorn"}]
