[{"authorTime":"2019-07-24 09:50:27","codes":[{"authorDate":"2019-06-07 04:18:29","commitOrder":2,"curCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.marker\");\n        msgMetadataBuilder.setSequenceId(0);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n\n        if (restrictToCluster.isPresent()) {\n            msgMetadataBuilder.addReplicateTo(restrictToCluster.get());\n        }\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","date":"2019-06-07 04:18:29","endLine":64,"groupId":"8039","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"newMessage","params":"(MarkerTypemarkerType@Optional<String>restrictToCluster@ByteBufpayload)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/48/843489a8fe965031ace4d63e266c59a1a35f4d.src","preCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.marker\");\n        msgMetadataBuilder.setSequenceId(0);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n\n        if (restrictToCluster.isPresent()) {\n            msgMetadataBuilder.addReplicateTo(restrictToCluster.get());\n        }\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":46,"status":"NB"},{"authorDate":"2019-07-24 09:50:27","commitOrder":2,"curCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.txn.marker\");\n        msgMetadataBuilder.setSequenceId(sequenceId);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n        msgMetadataBuilder.setTxnidMostBits(txnMostBits);\n        msgMetadataBuilder.setTxnidLeastBits(txnLeastBits);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n\n        ByteBuf payload = PooledByteBufAllocator.DEFAULT.buffer();\n\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            payload.release();\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","date":"2019-07-24 09:50:27","endLine":301,"groupId":"4568","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"newTxnMarker","params":"(MarkerTypemarkerType@longsequenceId@longtxnMostBits@longtxnLeastBits)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/c2/c1f5796e3832a0fb905437b20ccabbbced0727.src","preCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.txn.marker\");\n        msgMetadataBuilder.setSequenceId(sequenceId);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n        msgMetadataBuilder.setTxnidMostBits(txnMostBits);\n        msgMetadataBuilder.setTxnidLeastBits(txnLeastBits);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n\n        ByteBuf payload = PooledByteBufAllocator.DEFAULT.buffer();\n\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            payload.release();\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":280,"status":"B"}],"commitId":"e8a95e5ba57107c1e08a2610b7c55361a09f812b","commitMessage":"@@@[Transaction][Buffer]Add new marker to show which message belongs to transaction (#4776)\n\n* [Transaction][Buffer]Add new marker to show which message belongs to transaction\n---\n\n*Motivation*\n\nAdd new message type in the transaction including data and commit and abort maker in the transaction log.\n\n*Modifications*\n\nAdd two new types of transaction messages.\nTXN_COMMIT is the commit marker of the transaction.\nTXN_ABORT is the abort marker of the transaction.\n\n","date":"2019-07-24 09:50:27","modifiedFileCount":"4","status":"M","submitter":"Yong Zhang"},{"authorTime":"2019-07-30 22:48:13","codes":[{"authorDate":"2019-06-07 04:18:29","commitOrder":3,"curCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.marker\");\n        msgMetadataBuilder.setSequenceId(0);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n\n        if (restrictToCluster.isPresent()) {\n            msgMetadataBuilder.addReplicateTo(restrictToCluster.get());\n        }\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","date":"2019-06-07 04:18:29","endLine":64,"groupId":"8039","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"newMessage","params":"(MarkerTypemarkerType@Optional<String>restrictToCluster@ByteBufpayload)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/48/843489a8fe965031ace4d63e266c59a1a35f4d.src","preCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.marker\");\n        msgMetadataBuilder.setSequenceId(0);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n\n        if (restrictToCluster.isPresent()) {\n            msgMetadataBuilder.addReplicateTo(restrictToCluster.get());\n        }\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":46,"status":"N"},{"authorDate":"2019-07-30 22:48:13","commitOrder":3,"curCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits, Optional<MessageIdData> messageIdData) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.txn.marker\");\n        msgMetadataBuilder.setSequenceId(sequenceId);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n        msgMetadataBuilder.setTxnidMostBits(txnMostBits);\n        msgMetadataBuilder.setTxnidLeastBits(txnLeastBits);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n\n        ByteBuf payload;\n        if (messageIdData.isPresent()) {\n            PulsarMarkers.TxnCommitMarker commitMarker = PulsarMarkers.TxnCommitMarker.newBuilder()\n                                                                                      .setMessageId(messageIdData.get())\n                                                                                      .build();\n            int size = commitMarker.getSerializedSize();\n            payload = PooledByteBufAllocator.DEFAULT.buffer(size);\n            ByteBufCodedOutputStream outStream = ByteBufCodedOutputStream.get(payload);\n            commitMarker.writeTo(outStream);\n        } else {\n            payload = PooledByteBufAllocator.DEFAULT.buffer();\n        }\n\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            payload.release();\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","date":"2019-07-30 22:48:13","endLine":328,"groupId":"4568","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"newTxnMarker","params":"(MarkerTypemarkerType@longsequenceId@longtxnMostBits@longtxnLeastBits@Optional<MessageIdData>messageIdData)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/59/7ae9b14374661e7bee6ca60a1862edc986691e.src","preCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.txn.marker\");\n        msgMetadataBuilder.setSequenceId(sequenceId);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n        msgMetadataBuilder.setTxnidMostBits(txnMostBits);\n        msgMetadataBuilder.setTxnidLeastBits(txnLeastBits);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n\n        ByteBuf payload = PooledByteBufAllocator.DEFAULT.buffer();\n\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            payload.release();\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":296,"status":"M"}],"commitId":"3a06c97a10cc4dcf42b62f41a6add0d6ffa01ca4","commitMessage":"@@@[Transaction][buffer] Add data ledger position in txn commit marker (#4826)\n\n* [Transaction][buffer] Add data ledger position in txn commit marker\n---\n\n*Motivation*\n\nAdd the data ledger position into the commit marker of the transaction log.\n\n*Modifications*\n\nCreate a new TxnCommitMarker in the proto.\n\n","date":"2019-07-30 22:48:13","modifiedFileCount":"3","status":"M","submitter":"Yong Zhang"},{"authorTime":"2019-07-30 22:48:13","codes":[{"authorDate":"2020-03-28 18:33:17","commitOrder":4,"curCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.marker\");\n        msgMetadataBuilder.setSequenceId(0);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n\n        restrictToCluster.ifPresent(msgMetadataBuilder::addReplicateTo);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","date":"2020-03-28 18:33:17","endLine":61,"groupId":"10073","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"newMessage","params":"(MarkerTypemarkerType@Optional<String>restrictToCluster@ByteBufpayload)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/34/942daf1f0ac611139dc77037e8d48e5733b606.src","preCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.marker\");\n        msgMetadataBuilder.setSequenceId(0);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n\n        if (restrictToCluster.isPresent()) {\n            msgMetadataBuilder.addReplicateTo(restrictToCluster.get());\n        }\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":45,"status":"M"},{"authorDate":"2019-07-30 22:48:13","commitOrder":4,"curCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits, Optional<MessageIdData> messageIdData) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.txn.marker\");\n        msgMetadataBuilder.setSequenceId(sequenceId);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n        msgMetadataBuilder.setTxnidMostBits(txnMostBits);\n        msgMetadataBuilder.setTxnidLeastBits(txnLeastBits);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n\n        ByteBuf payload;\n        if (messageIdData.isPresent()) {\n            PulsarMarkers.TxnCommitMarker commitMarker = PulsarMarkers.TxnCommitMarker.newBuilder()\n                                                                                      .setMessageId(messageIdData.get())\n                                                                                      .build();\n            int size = commitMarker.getSerializedSize();\n            payload = PooledByteBufAllocator.DEFAULT.buffer(size);\n            ByteBufCodedOutputStream outStream = ByteBufCodedOutputStream.get(payload);\n            commitMarker.writeTo(outStream);\n        } else {\n            payload = PooledByteBufAllocator.DEFAULT.buffer();\n        }\n\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            payload.release();\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","date":"2019-07-30 22:48:13","endLine":328,"groupId":"4568","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"newTxnMarker","params":"(MarkerTypemarkerType@longsequenceId@longtxnMostBits@longtxnLeastBits@Optional<MessageIdData>messageIdData)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/59/7ae9b14374661e7bee6ca60a1862edc986691e.src","preCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits, Optional<MessageIdData> messageIdData) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.txn.marker\");\n        msgMetadataBuilder.setSequenceId(sequenceId);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n        msgMetadataBuilder.setTxnidMostBits(txnMostBits);\n        msgMetadataBuilder.setTxnidLeastBits(txnLeastBits);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n\n        ByteBuf payload;\n        if (messageIdData.isPresent()) {\n            PulsarMarkers.TxnCommitMarker commitMarker = PulsarMarkers.TxnCommitMarker.newBuilder()\n                                                                                      .setMessageId(messageIdData.get())\n                                                                                      .build();\n            int size = commitMarker.getSerializedSize();\n            payload = PooledByteBufAllocator.DEFAULT.buffer(size);\n            ByteBufCodedOutputStream outStream = ByteBufCodedOutputStream.get(payload);\n            commitMarker.writeTo(outStream);\n        } else {\n            payload = PooledByteBufAllocator.DEFAULT.buffer();\n        }\n\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            payload.release();\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":296,"status":"N"}],"commitId":"acc161b4e233264292abdce865cc42cde423414a","commitMessage":"@@@[cleanup] Optional usage (#6613)\n\nThis PR aims to fix or simplify `Optional` type usage logic:\n- Null value used for optional type.\n- Optional.isPresent() can be replaced with functional style expression\n- Optional call chain that can be simplified.","date":"2020-03-28 18:33:17","modifiedFileCount":"21","status":"M","submitter":"Yijie Shen"},{"authorTime":"2020-10-30 09:21:22","codes":[{"authorDate":"2020-03-28 18:33:17","commitOrder":5,"curCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.marker\");\n        msgMetadataBuilder.setSequenceId(0);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n\n        restrictToCluster.ifPresent(msgMetadataBuilder::addReplicateTo);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","date":"2020-03-28 18:33:17","endLine":61,"groupId":"10073","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"newMessage","params":"(MarkerTypemarkerType@Optional<String>restrictToCluster@ByteBufpayload)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/34/942daf1f0ac611139dc77037e8d48e5733b606.src","preCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.marker\");\n        msgMetadataBuilder.setSequenceId(0);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n\n        restrictToCluster.ifPresent(msgMetadataBuilder::addReplicateTo);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":45,"status":"N"},{"authorDate":"2020-10-30 09:21:22","commitOrder":5,"curCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits, Optional<List<MessageIdData>> messageIdDataList) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.txn.marker\");\n        msgMetadataBuilder.setSequenceId(sequenceId);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n        msgMetadataBuilder.setTxnidMostBits(txnMostBits);\n        msgMetadataBuilder.setTxnidLeastBits(txnLeastBits);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n\n        ByteBuf payload;\n        PulsarMarkers.TxnCommitMarker.Builder commitMarkerBuilder = PulsarMarkers.TxnCommitMarker.newBuilder();\n\n        messageIdDataList.ifPresent(commitMarkerBuilder::addAllMessageId);\n        PulsarMarkers.TxnCommitMarker commitMarker = commitMarkerBuilder.build();\n        int size = commitMarker.getSerializedSize();\n        payload = PooledByteBufAllocator.DEFAULT.buffer(size);\n        ByteBufCodedOutputStream outStream = ByteBufCodedOutputStream.get(payload);\n        commitMarker.writeTo(outStream);\n\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            payload.release();\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n            commitMarkerBuilder.recycle();\n            if (messageIdDataList.isPresent()) {\n                for (MessageIdData messageIdData : messageIdDataList.get()) {\n                    messageIdData.recycle();\n                }\n            }\n        }\n    }\n","date":"2020-10-30 09:21:22","endLine":331,"groupId":"4568","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"newTxnMarker","params":"(MarkerTypemarkerType@longsequenceId@longtxnMostBits@longtxnLeastBits@Optional<List<MessageIdData>>messageIdDataList)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/f7/b6ed40e458fcc8d5000fd9249111fcc46ec01c.src","preCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits, Optional<MessageIdData> messageIdData) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.txn.marker\");\n        msgMetadataBuilder.setSequenceId(sequenceId);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n        msgMetadataBuilder.setTxnidMostBits(txnMostBits);\n        msgMetadataBuilder.setTxnidLeastBits(txnLeastBits);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n\n        ByteBuf payload;\n        if (messageIdData.isPresent()) {\n            PulsarMarkers.TxnCommitMarker commitMarker = PulsarMarkers.TxnCommitMarker.newBuilder()\n                                                                                      .setMessageId(messageIdData.get())\n                                                                                      .build();\n            int size = commitMarker.getSerializedSize();\n            payload = PooledByteBufAllocator.DEFAULT.buffer(size);\n            ByteBufCodedOutputStream outStream = ByteBufCodedOutputStream.get(payload);\n            commitMarker.writeTo(outStream);\n        } else {\n            payload = PooledByteBufAllocator.DEFAULT.buffer();\n        }\n\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            payload.release();\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":296,"status":"M"}],"commitId":"91731743fc64712fabbc62e00c674c42586bb985","commitMessage":"@@@[Transaction] TransactionBuffer Refactor (#8347)\n\nFix https://github.com/streamnative/pulsar/issues/1575\nFix issue #8378 \n\n\n Motivation\n\n![image](https://user-images.githubusercontent.com/15029908/96908159-d38d3f80-14ce-11eb-9e52-ee066434d960.png)\n\nUse the above approach instead of the sidecar approach.\n\n\n Modifications\n\n1. Produce transaction messages to the topic partition.\n2. The commit marker needs to record the related message-id list of its transaction.\n3. When the dispatcher read a transaction marker.  get the messages of the transaction by message-id list in the marker and send them to the consumer.\n2. TransactionBuffer doesn't maintain any index data.","date":"2020-10-30 09:21:22","modifiedFileCount":"44","status":"M","submitter":"ran"},{"authorTime":"2021-01-06 08:42:31","codes":[{"authorDate":"2021-01-06 08:42:31","commitOrder":6,"curCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata msgMetadata = LOCAL_MESSAGE_METADATA.get()\n                .clear()\n                .setPublishTime(System.currentTimeMillis())\n                .setProducerName(\"pulsar.marker\")\n                .setSequenceId(0)\n                .setMarkerType(markerType.getValue());\n\n        restrictToCluster.ifPresent(msgMetadata::addReplicateTo);\n\n        return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n    }\n","date":"2021-01-06 08:42:31","endLine":98,"groupId":"729","id":9,"instanceNumber":1,"isCurCommit":0,"methodName":"newMessage","params":"(MarkerTypemarkerType@Optional<String>restrictToCluster@ByteBufpayload)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/3f/68a5245e6644f3f6963393970dddcc34240f97.src","preCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.marker\");\n        msgMetadataBuilder.setSequenceId(0);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n\n        restrictToCluster.ifPresent(msgMetadataBuilder::addReplicateTo);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n        }\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":87,"status":"M"},{"authorDate":"2021-01-06 08:42:31","commitOrder":6,"curCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits, Optional<List<MarkersMessageIdData>> messageIdDataList) {\n        MessageMetadata msgMetadata = LOCAL_MESSAGE_METADATA.get()\n                .clear()\n                .setPublishTime(System.currentTimeMillis())\n                .setProducerName(\"pulsar.txn.marker\")\n                .setSequenceId(sequenceId)\n                .setMarkerType(markerType.getValue())\n                .setTxnidMostBits(txnMostBits)\n                .setTxnidLeastBits(txnLeastBits);\n\n        TxnCommitMarker commitMarker = LOCAL_TXN_COMMIT_MARKER.get()\n                .clear();\n\n        messageIdDataList.ifPresent(commitMarker::addAllMessageIds);\n\n        ByteBuf payload = PooledByteBufAllocator.DEFAULT.buffer(commitMarker.getSerializedSize());\n\n        try {\n            commitMarker.writeTo(payload);\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            payload.release();\n        }\n    }\n","date":"2021-01-06 08:42:31","endLine":288,"groupId":"737","id":10,"instanceNumber":2,"isCurCommit":0,"methodName":"newTxnMarker","params":"(MarkerTypemarkerType@longsequenceId@longtxnMostBits@longtxnLeastBits@Optional<List<MarkersMessageIdData>>messageIdDataList)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/3f/68a5245e6644f3f6963393970dddcc34240f97.src","preCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits, Optional<List<MessageIdData>> messageIdDataList) {\n        MessageMetadata.Builder msgMetadataBuilder = MessageMetadata.newBuilder();\n        msgMetadataBuilder.setPublishTime(System.currentTimeMillis());\n        msgMetadataBuilder.setProducerName(\"pulsar.txn.marker\");\n        msgMetadataBuilder.setSequenceId(sequenceId);\n        msgMetadataBuilder.setMarkerType(markerType.getNumber());\n        msgMetadataBuilder.setTxnidMostBits(txnMostBits);\n        msgMetadataBuilder.setTxnidLeastBits(txnLeastBits);\n\n        MessageMetadata msgMetadata = msgMetadataBuilder.build();\n\n        ByteBuf payload;\n        PulsarMarkers.TxnCommitMarker.Builder commitMarkerBuilder = PulsarMarkers.TxnCommitMarker.newBuilder();\n\n        messageIdDataList.ifPresent(commitMarkerBuilder::addAllMessageId);\n        PulsarMarkers.TxnCommitMarker commitMarker = commitMarkerBuilder.build();\n        int size = commitMarker.getSerializedSize();\n        payload = PooledByteBufAllocator.DEFAULT.buffer(size);\n        ByteBufCodedOutputStream outStream = ByteBufCodedOutputStream.get(payload);\n        commitMarker.writeTo(outStream);\n\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            payload.release();\n            msgMetadata.recycle();\n            msgMetadataBuilder.recycle();\n            commitMarkerBuilder.recycle();\n            if (messageIdDataList.isPresent()) {\n                for (MessageIdData messageIdData : messageIdDataList.get()) {\n                    messageIdData.recycle();\n                }\n            }\n        }\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":264,"status":"M"}],"commitId":"c12765a0530bcefca8e840d2f8f43383d7478778","commitMessage":"@@@PIP-75: Perform serialization/deserialization with LightProto (#9046)\n\n","date":"2021-01-06 08:42:31","modifiedFileCount":"185","status":"M","submitter":"Matteo Merli"},{"authorTime":"2021-01-18 17:25:09","codes":[{"authorDate":"2021-01-06 08:42:31","commitOrder":7,"curCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata msgMetadata = LOCAL_MESSAGE_METADATA.get()\n                .clear()\n                .setPublishTime(System.currentTimeMillis())\n                .setProducerName(\"pulsar.marker\")\n                .setSequenceId(0)\n                .setMarkerType(markerType.getValue());\n\n        restrictToCluster.ifPresent(msgMetadata::addReplicateTo);\n\n        return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n    }\n","date":"2021-01-06 08:42:31","endLine":98,"groupId":"10192","id":11,"instanceNumber":1,"isCurCommit":0,"methodName":"newMessage","params":"(MarkerTypemarkerType@Optional<String>restrictToCluster@ByteBufpayload)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/3f/68a5245e6644f3f6963393970dddcc34240f97.src","preCode":"    private static ByteBuf newMessage(MarkerType markerType, Optional<String> restrictToCluster, ByteBuf payload) {\n        MessageMetadata msgMetadata = LOCAL_MESSAGE_METADATA.get()\n                .clear()\n                .setPublishTime(System.currentTimeMillis())\n                .setProducerName(\"pulsar.marker\")\n                .setSequenceId(0)\n                .setMarkerType(markerType.getValue());\n\n        restrictToCluster.ifPresent(msgMetadata::addReplicateTo);\n\n        return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":87,"status":"N"},{"authorDate":"2021-01-18 17:25:09","commitOrder":7,"curCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits) {\n        MessageMetadata msgMetadata = LOCAL_MESSAGE_METADATA.get()\n                .clear()\n                .setPublishTime(System.currentTimeMillis())\n                .setProducerName(\"pulsar.txn.marker\")\n                .setSequenceId(sequenceId)\n                .setMarkerType(markerType.getValue())\n                .setTxnidMostBits(txnMostBits)\n                .setTxnidLeastBits(txnLeastBits);\n\n        ByteBuf payload = PooledByteBufAllocator.DEFAULT.buffer(0);\n\n        try {\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c,\n                    msgMetadata, payload);\n        } finally {\n            payload.release();\n        }\n    }\n","date":"2021-01-18 17:25:09","endLine":272,"groupId":"10192","id":12,"instanceNumber":2,"isCurCommit":1,"methodName":"newTxnMarker","params":"(MarkerTypemarkerType@longsequenceId@longtxnMostBits@longtxnLeastBits)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-pulsar-10-0.7/blobInfo/CC_OUT/blobs/24/8f6e8ef07b7f7379894849456f59676e730f39.src","preCode":"    private static ByteBuf newTxnMarker(MarkerType markerType, long sequenceId, long txnMostBits,\n                                        long txnLeastBits, Optional<List<MarkersMessageIdData>> messageIdDataList) {\n        MessageMetadata msgMetadata = LOCAL_MESSAGE_METADATA.get()\n                .clear()\n                .setPublishTime(System.currentTimeMillis())\n                .setProducerName(\"pulsar.txn.marker\")\n                .setSequenceId(sequenceId)\n                .setMarkerType(markerType.getValue())\n                .setTxnidMostBits(txnMostBits)\n                .setTxnidLeastBits(txnLeastBits);\n\n        TxnCommitMarker commitMarker = LOCAL_TXN_COMMIT_MARKER.get()\n                .clear();\n\n        messageIdDataList.ifPresent(commitMarker::addAllMessageIds);\n\n        ByteBuf payload = PooledByteBufAllocator.DEFAULT.buffer(commitMarker.getSerializedSize());\n\n        try {\n            commitMarker.writeTo(payload);\n            return Commands.serializeMetadataAndPayload(ChecksumType.Crc32c, msgMetadata, payload);\n        } finally {\n            payload.release();\n        }\n    }\n","realPath":"pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Markers.java","repoName":"pulsar","snippetEndLine":0,"snippetStartLine":0,"startLine":253,"status":"M"}],"commitId":"ed5d94ccfdf4eba77678454945a2c3719dce2268","commitMessage":"@@@[Transaction] Transaction buffer stable position and lowWaterMark implementation. (#9195)\n\n## Motivation\nTransaction buffer stable position and lowWaterMark implementation.\n\n## implement\nDetails view https://github.com/streamnative/community/pull/3","date":"2021-01-18 17:25:09","modifiedFileCount":"51","status":"M","submitter":"congbo"}]
