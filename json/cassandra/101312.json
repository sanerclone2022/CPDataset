[{"authorTime":"2011-03-03 03:39:49","codes":[{"authorDate":"2011-03-03 03:39:49","commitOrder":13,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        IPartitioner oldPartitioner = ss.setPartitionerUnsafe(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(endpointTokens.get(2)));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(2)));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.left(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(4)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n\n        ss.setPartitionerUnsafe(oldPartitioner);\n    }\n","date":"2011-03-03 03:39:49","endLine":516,"groupId":"31685","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/ef/7037e981a97645c5d130bc908dbfa1dcea5e54.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        IPartitioner oldPartitioner = ss.setPartitionerUnsafe(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(endpointTokens.get(2)));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(2)));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.left(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(4)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n\n        ss.setPartitionerUnsafe(oldPartitioner);\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":477,"status":"B"},{"authorDate":"2011-03-03 03:39:49","commitOrder":13,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        IPartitioner oldPartitioner = ss.setPartitionerUnsafe(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        ss.setPartitionerUnsafe(oldPartitioner);\n    }\n","date":"2011-03-03 03:39:49","endLine":495,"groupId":"26853","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/88/fb54f44f5cf6326da4ce1aed986211ea822638.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        IPartitioner oldPartitioner = ss.setPartitionerUnsafe(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        ss.setPartitionerUnsafe(oldPartitioner);\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":455,"status":"MB"}],"commitId":"133acbb5910a47767adb6bcd198d5671fe1af611","commitMessage":"@@@optimize node movement within the same arc of the ring\npatch by Pavel Yaskevich; reviewed by Nick Bailey for CASSANDRA-1427\n\ngit-svn-id: https://svn.apache.org/repos/asf/cassandra/trunk@1076349 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2011-03-03 03:39:49","modifiedFileCount":"9","status":"M","submitter":"Jonathan Ellis"},{"authorTime":"2011-03-03 03:39:49","codes":[{"authorDate":"2011-10-13 13:14:05","commitOrder":14,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        IPartitioner oldPartitioner = ss.setPartitionerUnsafe(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(endpointTokens.get(2)));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(2)));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(keyTokens.get(2), Gossiper.computeExpireTime()));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(4)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n\n        ss.setPartitionerUnsafe(oldPartitioner);\n    }\n","date":"2011-10-13 13:14:05","endLine":521,"groupId":"31685","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/80/47841bf1307a6177fc164d6c72d5a43a6d1a28.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        IPartitioner oldPartitioner = ss.setPartitionerUnsafe(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(endpointTokens.get(2)));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(2)));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.left(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(4)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n\n        ss.setPartitionerUnsafe(oldPartitioner);\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":481,"status":"M"},{"authorDate":"2011-03-03 03:39:49","commitOrder":14,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        IPartitioner oldPartitioner = ss.setPartitionerUnsafe(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        ss.setPartitionerUnsafe(oldPartitioner);\n    }\n","date":"2011-03-03 03:39:49","endLine":495,"groupId":"26853","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/88/fb54f44f5cf6326da4ce1aed986211ea822638.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        IPartitioner oldPartitioner = ss.setPartitionerUnsafe(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        ss.setPartitionerUnsafe(oldPartitioner);\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":455,"status":"N"}],"commitId":"e32c9879a1324e09d445d9cb8d71930359619616","commitMessage":"@@@merge from 1.0\n\ngit-svn-id: https://svn.apache.org/repos/asf/cassandra/trunk@1182654 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2011-10-13 13:14:05","modifiedFileCount":"64","status":"M","submitter":"Jonathan Ellis"},{"authorTime":"2012-03-18 18:17:28","codes":[{"authorDate":"2012-03-18 18:17:28","commitOrder":15,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(endpointTokens.get(2)));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(2)));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(keyTokens.get(2), Gossiper.computeExpireTime()));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(4)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n    }\n","date":"2012-03-18 18:17:28","endLine":525,"groupId":"31685","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/fa/a9e18b6c3375bd54e06d67257b975250924af3.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        IPartitioner oldPartitioner = ss.setPartitionerUnsafe(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(endpointTokens.get(2)));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(2)));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(keyTokens.get(2), Gossiper.computeExpireTime()));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(4)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n\n        ss.setPartitionerUnsafe(oldPartitioner);\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":489,"status":"M"},{"authorDate":"2012-03-18 18:17:28","commitOrder":15,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n    }\n","date":"2012-03-18 18:17:28","endLine":509,"groupId":"26853","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/cb/dad15522d0c2e04622048c4ead425197c53077.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        IPartitioner oldPartitioner = ss.setPartitionerUnsafe(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        ss.setPartitionerUnsafe(oldPartitioner);\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":473,"status":"M"}],"commitId":"15ae2f6306406e8c68dbffe2987886c314665114","commitMessage":"@@@Merge branch 'cassandra-1.1' into trunk\n\nConflicts:\n\tsrc/java/org/apache/cassandra/db/migration/AddColumnFamily.java\n\tsrc/java/org/apache/cassandra/db/migration/AddKeyspace.java\n\tsrc/java/org/apache/cassandra/db/migration/DropColumnFamily.java\n\tsrc/java/org/apache/cassandra/db/migration/DropKeyspace.java\n\tsrc/java/org/apache/cassandra/db/migration/Migration.java\n\tsrc/java/org/apache/cassandra/db/migration/MigrationHelper.java\n\tsrc/java/org/apache/cassandra/db/migration/UpdateColumnFamily.java\n\tsrc/java/org/apache/cassandra/db/migration/UpdateKeyspace.java\n\ttest/unit/org/apache/cassandra/io/sstable/SSTableTest.java\n","date":"2012-03-18 18:17:28","modifiedFileCount":"79","status":"M","submitter":"Sylvain Lebresne"},{"authorTime":"2012-05-03 07:47:13","codes":[{"authorDate":"2012-05-03 07:47:13","commitOrder":16,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(endpointTokens.get(2)));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(2), hostIds.get(2)));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(keyTokens.get(2), Gossiper.computeExpireTime()));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(4), hostIds.get(2)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n    }\n","date":"2012-05-03 07:47:13","endLine":530,"groupId":"13016","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/be/53b530e020e3edc15511fa006483b901591b28.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(endpointTokens.get(2)));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(2)));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(keyTokens.get(2), Gossiper.computeExpireTime()));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(4)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":493,"status":"M"},{"authorDate":"2012-05-03 07:47:13","commitOrder":16,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken, hostIds.get(2)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken, hostIds.get(2)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n    }\n","date":"2012-05-03 07:47:13","endLine":512,"groupId":"5640","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/b4/4fa328e90e9c626cff3f7ece8aed1e47aa8897.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":475,"status":"M"}],"commitId":"ad685c4615b08725488fdf26c1dd248cfe196cf8","commitMessage":"@@@gossip host ID; Maintain a mapping of endpoint to ID\n\nPatch by eevans; reviewed by Brandon Williams for CASSANDRA-4120\n","date":"2012-05-03 07:47:13","modifiedFileCount":"13","status":"M","submitter":"Eric Evans"},{"authorTime":"2012-07-19 02:27:56","codes":[{"authorDate":"2012-07-19 02:27:56","commitOrder":17,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2)),\n                                                                               hostIds.get(2)));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4)),\n                                                                               hostIds.get(2)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n    }\n","date":"2012-07-19 02:27:56","endLine":550,"groupId":"5017","id":9,"instanceNumber":1,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/3b/76c2ce6e52524a36af9cb9358c2dcdfe8e32e9.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(endpointTokens.get(2)));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(2), hostIds.get(2)));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(keyTokens.get(2)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(keyTokens.get(2), Gossiper.computeExpireTime()));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(keyTokens.get(4), hostIds.get(2)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":511,"status":"M"},{"authorDate":"2012-07-19 02:27:56","commitOrder":17,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken),\n                                                                               hostIds.get(2)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken),\n                                                                               hostIds.get(2)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n    }\n","date":"2012-07-19 02:27:56","endLine":524,"groupId":"5640","id":10,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/cf/42564af5962e1476be391bf72f4625642851f4.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken, hostIds.get(2)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(newToken, hostIds.get(2)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":485,"status":"M"}],"commitId":"66b96ee5357b639729b6f220b1d5453027b866c6","commitMessage":"@@@virtual nodes support for bootstrap and decommission\n\nPatch by Sam Overton and eevans; reviewed by Brandon Williams for CASSANDRA-4122\n","date":"2012-07-19 02:27:56","modifiedFileCount":"16","status":"M","submitter":"Eric Evans"},{"authorTime":"2012-09-04 23:41:58","codes":[{"authorDate":"2012-09-04 23:41:58","commitOrder":18,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n    }\n","date":"2012-09-04 23:41:58","endLine":554,"groupId":"5017","id":11,"instanceNumber":1,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/7e/2130c0f275c79a5e80a61d671cdac78954403b.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2)),\n                                                                               hostIds.get(2)));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4)),\n                                                                               hostIds.get(2)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":515,"status":"M"},{"authorDate":"2012-09-04 23:41:58","commitOrder":18,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n    }\n","date":"2012-09-04 23:41:58","endLine":526,"groupId":"5640","id":12,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/ce/7864cc876bcd2ea7ed017a8734efb855fb9d5b.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken),\n                                                                               hostIds.get(2)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken),\n                                                                               hostIds.get(2)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":487,"status":"M"}],"commitId":"b475bc69b7e6d08e6d12527578552e67e8c0f88a","commitMessage":"@@@Binary encoding of tokens.\nAlso promotes new gossip states: HOST_ID and TOKENS\nPatch by brandonwilliams.  reviewed by eevans for CASSANDRA-4383\n","date":"2012-09-04 23:41:58","modifiedFileCount":"12","status":"M","submitter":"Brandon Williams"},{"authorTime":"2013-10-20 09:09:18","codes":[{"authorDate":"2013-10-20 09:09:18","commitOrder":19,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(4), tmd.getToken(hosts.get(2)));\n    }\n","date":"2013-10-20 09:09:18","endLine":554,"groupId":"5017","id":13,"instanceNumber":1,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/9f/f08154d0c6ccd32246b281660ab5f3cc2f8bcb.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(keyTokens.get(4)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":515,"status":"M"},{"authorDate":"2013-10-20 09:09:18","commitOrder":19,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n    }\n","date":"2013-10-20 09:09:18","endLine":531,"groupId":"5640","id":14,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/fe/db6b031aaa726fa285cf84f7e0615931bfadb9.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertTrue(tmd.getToken(hosts.get(2)).equals(endpointTokens.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertTrue(tmd.getToken(hosts.get(2)).equals(newToken));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":492,"status":"M"}],"commitId":"d32f1eb2128296b2077db6bffa226535852c47b9","commitMessage":"@@@merge\n","date":"2013-10-20 09:09:18","modifiedFileCount":"5","status":"M","submitter":"Jonathan Ellis"},{"authorTime":"2014-07-10 04:51:51","codes":[{"authorDate":"2013-10-20 09:09:18","commitOrder":20,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(4), tmd.getToken(hosts.get(2)));\n    }\n","date":"2013-10-20 09:09:18","endLine":554,"groupId":"5017","id":15,"instanceNumber":1,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/9f/f08154d0c6ccd32246b281660ab5f3cc2f8bcb.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(4), tmd.getToken(hosts.get(2)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":515,"status":"N"},{"authorDate":"2014-07-10 04:51:51","commitOrder":20,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n    }\n","date":"2014-07-10 04:51:51","endLine":543,"groupId":"5640","id":16,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/1e/e71dd29c88881d1c66b00444979bb76c44ca92.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":505,"status":"M"}],"commitId":"ae03e1bab709bcadcd973899be04e0c06a7df7a9","commitMessage":"@@@Fix race condition during pending range calculation\n\nPatch by Josh McKenzie; reviewed by Tyler Hobbs for CASSANDRA-7390\n","date":"2014-07-10 04:51:51","modifiedFileCount":"3","status":"M","submitter":"Josh McKenzie"},{"authorTime":"2014-11-21 23:58:28","codes":[{"authorDate":"2014-11-21 23:58:28","commitOrder":21,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(4), tmd.getToken(hosts.get(2)));\n    }\n","date":"2014-11-21 23:58:28","endLine":565,"groupId":"5017","id":17,"instanceNumber":1,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/4a/09b7ad0b29a15938d4bf396d054f3d1fd5f01c.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(4), tmd.getToken(hosts.get(2)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":526,"status":"M"},{"authorDate":"2014-11-21 23:58:28","commitOrder":21,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n    }\n","date":"2014-11-21 23:58:28","endLine":544,"groupId":"5640","id":18,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/6c/9e589630383754ba88364dfcb4310809e8602a.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        IPartitioner partitioner = new RandomPartitioner();\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":506,"status":"M"}],"commitId":"07893d704598f7cbbc316c9a65a8c415e5404dfa","commitMessage":"@@@Remove hidden references to partitioner in Tokens\n\nPatch by blambov; reviewed by jmckenzie for CASSANDRA-8244\n","date":"2014-11-21 23:58:28","modifiedFileCount":"65","status":"M","submitter":"Branimir Lambov"},{"authorTime":"2016-12-10 08:18:33","codes":[{"authorDate":"2016-12-10 08:18:33","commitOrder":22,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getSizeOfLeavingEndpoints() == 0);\n        assertEquals(keyTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getSizeOfLeavingEndpoints() == 0);\n        assertEquals(keyTokens.get(4), tmd.getToken(hosts.get(2)));\n    }\n","date":"2016-12-10 08:19:06","endLine":572,"groupId":"5017","id":19,"instanceNumber":1,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/75/4def95717a184f90218fb6bacb9b8c5aaf8e56.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getLeavingEndpoints().isEmpty());\n        assertEquals(keyTokens.get(4), tmd.getToken(hosts.get(2)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":533,"status":"M"},{"authorDate":"2016-12-10 08:18:33","commitOrder":22,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getSizeOfMovingEndpoints() == 0);\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getSizeOfMovingEndpoints() == 0);\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n    }\n","date":"2016-12-10 08:19:06","endLine":998,"groupId":"5640","id":20,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/90/d546c121e0b16d8ac911add6faf2d7fa2717fe.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getMovingEndpoints().isEmpty());\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":960,"status":"M"}],"commitId":"d8049ae105fa37e1f8f28e8630f8a390f9a25fbb","commitMessage":"@@@Merge branch 'cassandra-3.X' into trunk\n\n* cassandra-3.X:\n  add method to get size of endpoints to TokenMetadata\n","date":"2016-12-10 08:19:06","modifiedFileCount":"9","status":"M","submitter":"Dikang Gu"},{"authorTime":"2017-11-10 00:33:48","codes":[{"authorDate":"2017-11-10 00:33:48","commitOrder":23,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddressAndPort> hosts = new ArrayList<>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getSizeOfLeavingEndpoints() == 0);\n        assertEquals(keyTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getSizeOfLeavingEndpoints() == 0);\n        assertEquals(keyTokens.get(4), tmd.getToken(hosts.get(2)));\n    }\n","date":"2018-01-26 03:32:24","endLine":580,"groupId":"5017","id":21,"instanceNumber":1,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/8d/dc4f03df2c0dbf50fd7ecf0d869e3f7ac955af.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getSizeOfLeavingEndpoints() == 0);\n        assertEquals(keyTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getSizeOfLeavingEndpoints() == 0);\n        assertEquals(keyTokens.get(4), tmd.getToken(hosts.get(2)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":541,"status":"M"},{"authorDate":"2017-11-10 00:33:48","commitOrder":23,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddressAndPort> hosts = new ArrayList<>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getSizeOfMovingEndpoints() == 0);\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getSizeOfMovingEndpoints() == 0);\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n    }\n","date":"2018-01-26 03:32:24","endLine":1002,"groupId":"5640","id":22,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/73/21fbaf8d930269929a37295e22123c87949262.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddress> hosts = new ArrayList<InetAddress>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getSizeOfMovingEndpoints() == 0);\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getSizeOfMovingEndpoints() == 0);\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":964,"status":"M"}],"commitId":"59b5b6bef0fa76bf5740b688fcd4d9cf525760d0","commitMessage":"@@@Allow storage port to be configurable per node\n\nPatch by Ariel Weisberg; Reviewed by Jason Brown for CASSANDRA-7544\n","date":"2018-01-26 03:32:24","modifiedFileCount":"308","status":"M","submitter":"Ariel Weisberg"},{"authorTime":"2017-11-10 00:33:48","codes":[{"authorDate":"2021-06-16 03:53:17","commitOrder":24,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        Gossiper.instance.clearUnsafe();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddressAndPort> hosts = new ArrayList<>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getSizeOfLeavingEndpoints() == 0);\n        assertEquals(keyTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getSizeOfLeavingEndpoints() == 0);\n        assertEquals(keyTokens.get(4), tmd.getToken(hosts.get(2)));\n    }\n","date":"2021-06-16 03:53:17","endLine":579,"groupId":"101312","id":23,"instanceNumber":1,"isCurCommit":1,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/02/d625c05961c8b046c7a67039aa10feb8eb0bec.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        tmd.clearUnsafe();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddressAndPort> hosts = new ArrayList<>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(endpointTokens.get(2))));\n\n        assertTrue(tmd.isLeaving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(2))));\n\n        assertTrue(tmd.getSizeOfLeavingEndpoints() == 0);\n        assertEquals(keyTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.leaving(Collections.singleton(keyTokens.get(2))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS,\n                valueFactory.left(Collections.singleton(keyTokens.get(2)), Gossiper.computeExpireTime()));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(keyTokens.get(4))));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(keyTokens.get(4))));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getSizeOfLeavingEndpoints() == 0);\n        assertEquals(keyTokens.get(4), tmd.getToken(hosts.get(2)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/LeaveAndBootstrapTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":539,"status":"M"},{"authorDate":"2017-11-10 00:33:48","commitOrder":24,"curCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddressAndPort> hosts = new ArrayList<>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getSizeOfMovingEndpoints() == 0);\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getSizeOfMovingEndpoints() == 0);\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n    }\n","date":"2018-01-26 03:32:24","endLine":1002,"groupId":"101312","id":24,"instanceNumber":2,"isCurCommit":0,"methodName":"testStateJumpToNormal","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cassandra-10-0.7/blobInfo/CC_OUT/blobs/73/21fbaf8d930269929a37295e22123c87949262.src","preCode":"    public void testStateJumpToNormal() throws UnknownHostException\n    {\n        StorageService ss = StorageService.instance;\n        TokenMetadata tmd = ss.getTokenMetadata();\n        IPartitioner partitioner = RandomPartitioner.instance;\n        VersionedValue.VersionedValueFactory valueFactory = new VersionedValue.VersionedValueFactory(partitioner);\n\n        ArrayList<Token> endpointTokens = new ArrayList<Token>();\n        ArrayList<Token> keyTokens = new ArrayList<Token>();\n        List<InetAddressAndPort> hosts = new ArrayList<>();\n        List<UUID> hostIds = new ArrayList<UUID>();\n\n        \r\n        Util.createInitialRing(ss, partitioner, endpointTokens, keyTokens, hosts, hostIds, 6);\n\n        \r\n        Token newToken = positionToken(7);\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n\n        assertTrue(tmd.isMoving(hosts.get(2)));\n        assertEquals(endpointTokens.get(2), tmd.getToken(hosts.get(2)));\n\n        \r\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getSizeOfMovingEndpoints() == 0);\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n\n        newToken = positionToken(8);\n        \r\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.moving(newToken));\n        Gossiper.instance.injectApplicationState(hosts.get(2), ApplicationState.TOKENS, valueFactory.tokens(Collections.singleton(newToken)));\n        ss.onChange(hosts.get(2), ApplicationState.STATUS, valueFactory.normal(Collections.singleton(newToken)));\n\n        assertTrue(tmd.getBootstrapTokens().isEmpty());\n        assertTrue(tmd.getSizeOfMovingEndpoints() == 0);\n        assertEquals(newToken, tmd.getToken(hosts.get(2)));\n    }\n","realPath":"test/unit/org/apache/cassandra/service/MoveTest.java","repoName":"cassandra","snippetEndLine":0,"snippetStartLine":0,"startLine":964,"status":"N"}],"commitId":"597558f4e3743c8887434b526377900de3ba3f3f","commitMessage":"@@@Merge branch 'cassandra-4.0' into trunk\n","date":"2021-06-16 03:53:17","modifiedFileCount":"2","status":"M","submitter":"Brandon Williams"}]
