[{"authorTime":"2018-07-19 02:10:12","codes":[{"authorDate":"2018-07-19 02:10:12","commitOrder":1,"curCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                        TypeFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertTrue(nested.getDocCount() > 0);\n                assertEquals(nested, aliasNested);\n            }\n        }\n    }\n","date":"2018-07-19 02:10:12","endLine":697,"groupId":"49349","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/45/55809bad9e52c6173fd3d3e39f012c1fe062b8.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                        TypeFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertTrue(nested.getDocCount() > 0);\n                assertEquals(nested, aliasNested);\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":656,"status":"B"},{"authorDate":"2018-07-19 02:10:12","commitOrder":1,"curCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(TypeFieldMapper.NAME, \"__\" + NESTED_OBJECT,\n                                TypeFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                            TypeFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertTrue(reverseNested.getDocCount() > 0);\n                assertEquals(reverseNested, aliasReverseNested);\n            }\n        }\n    }\n","date":"2018-07-19 02:10:12","endLine":227,"groupId":"59678","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/bc/870bf4dca6f7aa32d4b0e593b5c0b60318f031.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(TypeFieldMapper.NAME, \"__\" + NESTED_OBJECT,\n                                TypeFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                            TypeFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertTrue(reverseNested.getDocCount() > 0);\n                assertEquals(reverseNested, aliasReverseNested);\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":170,"status":"B"}],"commitId":"a019e723b5475f0ca77063dab45fbcccd1d6559a","commitMessage":"@@@Merge branch 'master' into index-lifecycle\n","date":"2018-07-19 02:10:12","modifiedFileCount":"121","status":"B","submitter":"Tal Levy"},{"authorTime":"2018-07-24 20:13:52","codes":[{"authorDate":"2018-07-24 20:13:52","commitOrder":2,"curCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n        int expectedNestedDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    expectedNestedDocs += numNestedDocs;\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                        TypeFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertEquals(nested, aliasNested);\n                assertEquals(expectedNestedDocs, nested.getDocCount());\n            }\n        }\n    }\n","date":"2018-07-24 20:13:52","endLine":698,"groupId":"49349","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/e1/206cb8d15523720e6d47b091b24baab5e87813.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                        TypeFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertTrue(nested.getDocCount() > 0);\n                assertEquals(nested, aliasNested);\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":656,"status":"M"},{"authorDate":"2018-07-24 20:13:52","commitOrder":2,"curCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n        int expectedParentDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    if (numNestedDocs > 0) {\n                        expectedParentDocs++;\n                    }\n\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(TypeFieldMapper.NAME, \"__\" + NESTED_OBJECT,\n                                TypeFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                            TypeFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertEquals(reverseNested, aliasReverseNested);\n                assertEquals(expectedParentDocs, reverseNested.getDocCount());\n            }\n        }\n    }\n","date":"2018-07-24 20:13:52","endLine":231,"groupId":"59678","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/fd/831e5076caa476fa0c9e43c85d45b09daade26.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(TypeFieldMapper.NAME, \"__\" + NESTED_OBJECT,\n                                TypeFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                            TypeFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertTrue(reverseNested.getDocCount() > 0);\n                assertEquals(reverseNested, aliasReverseNested);\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":170,"status":"M"}],"commitId":"a2abc8659595bc51e46550bf32b3c78ca071d664","commitMessage":"@@@Merge branch 'master' into index-lifecycle\n","date":"2018-07-24 20:13:52","modifiedFileCount":"55","status":"M","submitter":"Colin Goodheart-Smithe"},{"authorTime":"2018-07-24 20:13:52","codes":[{"authorDate":"2019-01-23 01:38:55","commitOrder":3,"curCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n        int expectedNestedDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    expectedNestedDocs += numNestedDocs;\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                        TypeFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                InternalNested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertEquals(nested, aliasNested);\n                assertEquals(expectedNestedDocs, nested.getDocCount());\n            }\n        }\n    }\n","date":"2019-01-23 01:38:55","endLine":704,"groupId":"49349","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/1e/ef8de86b304b0bb2eb8f2486221794e3b64189.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n        int expectedNestedDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    expectedNestedDocs += numNestedDocs;\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                        TypeFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertEquals(nested, aliasNested);\n                assertEquals(expectedNestedDocs, nested.getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":662,"status":"M"},{"authorDate":"2018-07-24 20:13:52","commitOrder":3,"curCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n        int expectedParentDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    if (numNestedDocs > 0) {\n                        expectedParentDocs++;\n                    }\n\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(TypeFieldMapper.NAME, \"__\" + NESTED_OBJECT,\n                                TypeFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                            TypeFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertEquals(reverseNested, aliasReverseNested);\n                assertEquals(expectedParentDocs, reverseNested.getDocCount());\n            }\n        }\n    }\n","date":"2018-07-24 20:13:52","endLine":231,"groupId":"59678","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/fd/831e5076caa476fa0c9e43c85d45b09daade26.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n        int expectedParentDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    if (numNestedDocs > 0) {\n                        expectedParentDocs++;\n                    }\n\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(TypeFieldMapper.NAME, \"__\" + NESTED_OBJECT,\n                                TypeFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                            TypeFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertEquals(reverseNested, aliasReverseNested);\n                assertEquals(expectedParentDocs, reverseNested.getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":170,"status":"N"}],"commitId":"2ba9e361aba7df6e9c0b5fa8fae3d219d50ddf09","commitMessage":"@@@Add helper classes to determine if aggs have a value (#36020)\n\nThis adds a set of helper classes to determine if an agg \"has a value\". \nThis is needed because InternalAggs represent \"empty\" in different \nmanners according to convention. Some use `NaN`.  `+/- Inf`.  `0.0`.  etc.\n\nA user can pass the Internal agg type to one of these helper methods\nand it will report if the agg contains a value or not.  which allows the\nuser to differentiate \"empty\" from a real `NaN`.\n\nThese helpers are best-effort in some cases.  For example.  several\npipeline aggs share a single return class but use different conventions\nto mark \"empty\".  so the helper uses the loosest definition that applies\nto all the aggs that use the class.\n\nSums in particular are unreliable.  The InternalSum simply returns 0.0\nif the agg is empty (which is correct.  no values == sum of zero).  But this\nalso means the helper cannot differentiate from \"empty\" and `+1 + -1`.","date":"2019-01-23 01:38:55","modifiedFileCount":"45","status":"M","submitter":"Zachary Tong"},{"authorTime":"2020-01-23 00:31:34","codes":[{"authorDate":"2020-01-23 00:31:34","commitOrder":4,"curCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n        int expectedNestedDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    expectedNestedDocs += numNestedDocs;\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                InternalNested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertEquals(nested, aliasNested);\n                assertEquals(expectedNestedDocs, nested.getDocCount());\n            }\n        }\n    }\n","date":"2020-01-23 00:31:34","endLine":736,"groupId":"49349","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/a9/4c5c34a7a7726a05d3c6a189a60192b14d2f46.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n        int expectedNestedDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    expectedNestedDocs += numNestedDocs;\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                        TypeFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                InternalNested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertEquals(nested, aliasNested);\n                assertEquals(expectedNestedDocs, nested.getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":694,"status":"M"},{"authorDate":"2020-01-23 00:31:34","commitOrder":4,"curCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n        int expectedParentDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    if (numNestedDocs > 0) {\n                        expectedParentDocs++;\n                    }\n\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(NestedPathFieldMapper.NAME, NESTED_OBJECT,\n                            NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertEquals(reverseNested, aliasReverseNested);\n                assertEquals(expectedParentDocs, reverseNested.getDocCount());\n            }\n        }\n    }\n","date":"2020-01-23 00:31:34","endLine":231,"groupId":"59678","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/5f/1edcfded8135894de7ac73853a1eaff9841743.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n        int expectedParentDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    if (numNestedDocs > 0) {\n                        expectedParentDocs++;\n                    }\n\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(TypeFieldMapper.NAME, \"__\" + NESTED_OBJECT,\n                                TypeFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(TypeFieldMapper.NAME, \"test\",\n                            TypeFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertEquals(reverseNested, aliasReverseNested);\n                assertEquals(expectedParentDocs, reverseNested.getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":170,"status":"M"}],"commitId":"1dc9dd42235e876fde8c3b31934f1bc88d668896","commitMessage":"@@@Add NestedPathFieldMapper to store nested path information (#51100)\n\nCurrently nested documents repurpose the _type field to store their nested paths.\nThis commit adds a dedicated _nested_path field instead.  which decouples this\ninformation from types and will allow the removal of the _type field entirely further\ndown the line. To preserve backwards compatibility.  references to this field are\nmediated via methods that take an index settings object.  and indexes created before\n8x still use the _type field.\n\nRelates to #41059\nCloses #24362","date":"2020-01-23 00:31:34","modifiedFileCount":"21","status":"M","submitter":"Alan Woodward"},{"authorTime":"2020-05-09 03:39:49","codes":[{"authorDate":"2020-05-09 03:39:49","commitOrder":5,"curCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n        int expectedNestedDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    expectedNestedDocs += numNestedDocs;\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrapInMockESDirectoryReader(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                InternalNested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertEquals(nested, aliasNested);\n                assertEquals(expectedNestedDocs, nested.getDocCount());\n            }\n        }\n    }\n","date":"2020-05-09 03:39:49","endLine":753,"groupId":"49349","id":9,"instanceNumber":1,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/8f/485509778f7d21a76a48dc69f5015b0e2cb75c.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n        int expectedNestedDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    expectedNestedDocs += numNestedDocs;\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                InternalNested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertEquals(nested, aliasNested);\n                assertEquals(expectedNestedDocs, nested.getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":711,"status":"M"},{"authorDate":"2020-05-09 03:39:49","commitOrder":5,"curCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n        int expectedParentDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    if (numNestedDocs > 0) {\n                        expectedParentDocs++;\n                    }\n\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(NestedPathFieldMapper.NAME, NESTED_OBJECT,\n                            NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrapInMockESDirectoryReader(DirectoryReader.open(directory))) {\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertEquals(reverseNested, aliasReverseNested);\n                assertEquals(expectedParentDocs, reverseNested.getDocCount());\n            }\n        }\n    }\n","date":"2020-05-09 03:39:49","endLine":247,"groupId":"59678","id":10,"instanceNumber":2,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/4d/55db28a916ee4220759eb41eba5cf13eb06ca8.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n        int expectedParentDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    if (numNestedDocs > 0) {\n                        expectedParentDocs++;\n                    }\n\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(NestedPathFieldMapper.NAME, NESTED_OBJECT,\n                            NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrap(DirectoryReader.open(directory))) {\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertEquals(reverseNested, aliasReverseNested);\n                assertEquals(expectedParentDocs, reverseNested.getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":186,"status":"M"}],"commitId":"0d7320499d77e57e16b1789b9d1e91e42f4638c9","commitMessage":"@@@Save memory when numeric terms agg is not top (#55873)\n\nRight now all implementations of the `terms` agg allocate a new\n`Aggregator` per bucket. This uses a bunch of memory. Exactly how much\nisn't clear but each `Aggregator` ends up making its own objects to read\ndoc values which have non-trivial buffers. And it forces all of it\nsub-aggregations to do the same. We allocate a new `Aggregator` per\nbucket for two reasons:\n\n1. We didn't have an appropriate data structure to track the\n   sub-ordinals of each parent bucket.\n2. You can only make a single call to `runDeferredCollections(long...)`\n   per `Aggregator` which was the only way to delay collection of\n   sub-aggregations.\n\nThis change switches the method that builds aggregation results from\nbuilding them one at a time to building all of the results for the\nentire aggregator at the same time.\n\nIt also adds a fairly simplistic data structure to track the sub-ordinals\nfor `long`-keyed buckets.\n\nIt uses both of those to power numeric `terms` aggregations and removes\nthe per-bucket allocation of their `Aggregator`. This fairly\nsubstantially reduces memory consumption of numeric `terms` aggregations\nthat are not the \"top level\".  especially when those aggregations contain\nmany sub-aggregations. It also is a pretty big speed up.  especially when\nthe aggregation is under a non-selective aggregation like\nthe `date_histogram`.\n\nI picked numeric `terms` aggregations because those have the simplest\nimplementation. At least.  I could kind of fit it in my head. And I\nhaven't fully understood the \"bytes\"-based terms aggregations.  but I\nimagine I'll be able to make similar optimizations to them in follow up\nchanges.\n","date":"2020-05-09 03:39:49","modifiedFileCount":"62","status":"M","submitter":"Nik Everett"},{"authorTime":"2020-06-16 00:47:15","codes":[{"authorDate":"2020-06-16 00:47:15","commitOrder":6,"curCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n        int expectedNestedDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(VALUE_FIELD_NAME, NumberFieldMapper.NumberType.LONG);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    expectedNestedDocs += numNestedDocs;\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrapInMockESDirectoryReader(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                InternalNested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertEquals(nested, aliasNested);\n                assertEquals(expectedNestedDocs, nested.getDocCount());\n            }\n        }\n    }\n","date":"2020-06-16 00:47:15","endLine":733,"groupId":"49349","id":11,"instanceNumber":1,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ff/9184ae7230b579e812d711701e81551c72d600.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n        int expectedNestedDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    expectedNestedDocs += numNestedDocs;\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrapInMockESDirectoryReader(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                InternalNested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertEquals(nested, aliasNested);\n                assertEquals(expectedNestedDocs, nested.getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":693,"status":"M"},{"authorDate":"2020-06-16 00:47:15","commitOrder":6,"curCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n        int expectedParentDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(VALUE_FIELD_NAME, NumberFieldMapper.NumberType.LONG);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    if (numNestedDocs > 0) {\n                        expectedParentDocs++;\n                    }\n\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(NestedPathFieldMapper.NAME, NESTED_OBJECT,\n                            NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrapInMockESDirectoryReader(DirectoryReader.open(directory))) {\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertEquals(reverseNested, aliasReverseNested);\n                assertEquals(expectedParentDocs, reverseNested.getDocCount());\n            }\n        }\n    }\n","date":"2020-06-16 00:47:15","endLine":241,"groupId":"59678","id":12,"instanceNumber":2,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/77/36fcf129fc7ff8d9d1886935d2b1fa6ab37066.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n        int expectedParentDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(\n            NumberFieldMapper.NumberType.LONG);\n        fieldType.setName(VALUE_FIELD_NAME);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    if (numNestedDocs > 0) {\n                        expectedParentDocs++;\n                    }\n\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(NestedPathFieldMapper.NAME, NESTED_OBJECT,\n                            NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrapInMockESDirectoryReader(DirectoryReader.open(directory))) {\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertEquals(reverseNested, aliasReverseNested);\n                assertEquals(expectedParentDocs, reverseNested.getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":182,"status":"M"}],"commitId":"3b696828ada5953bb1669b972a353736383edf08","commitMessage":"@@@MappedFieldType should not extend FieldType (#57666)\n\nMappedFieldType is a combination of two concerns:\n\n* an extension of lucene's FieldType.  defining how a field should be indexed\n* a set of query factory methods.  defining how a field should be searched\n\nWe want to break these two concerns apart. This commit is a first step to doing this.  breaking\nthe inheritance relationship between MappedFieldType and FieldType. MappedFieldType \ninstead has a series of boolean flags defining whether or not the field is searchable or \naggregatable.  and FieldMapper has a separate FieldType passed to its constructor defining \nhow indexing should be done.\n\nRelates to #56814","date":"2020-06-16 00:47:15","modifiedFileCount":"257","status":"M","submitter":"Alan Woodward"},{"authorTime":"2020-08-07 05:14:20","codes":[{"authorDate":"2020-08-07 05:14:20","commitOrder":7,"curCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n        int expectedNestedDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(VALUE_FIELD_NAME, NumberFieldMapper.NumberType.LONG);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    expectedNestedDocs += numNestedDocs;\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrapInMockESDirectoryReader(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                InternalNested nested = searchAndReduce(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = searchAndReduce(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertEquals(nested, aliasNested);\n                assertEquals(expectedNestedDocs, nested.getDocCount());\n            }\n        }\n    }\n","date":"2020-08-07 05:14:20","endLine":732,"groupId":"104820","id":13,"instanceNumber":1,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/07/8450445f546d232dbf12f0224b849ffaab5af2.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numRootDocs = randomIntBetween(1, 20);\n        int expectedNestedDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(VALUE_FIELD_NAME, NumberFieldMapper.NumberType.LONG);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numRootDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    expectedNestedDocs += numNestedDocs;\n                    generateDocuments(documents, numNestedDocs, i, NESTED_OBJECT, VALUE_FIELD_NAME);\n\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)), IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(sequenceIDFields.primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrapInMockESDirectoryReader(DirectoryReader.open(directory))) {\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\"));\n\n                InternalNested nested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                assertEquals(nested, aliasNested);\n                assertEquals(expectedNestedDocs, nested.getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":692,"status":"M"},{"authorDate":"2020-08-07 05:14:20","commitOrder":7,"curCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n        int expectedParentDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(VALUE_FIELD_NAME, NumberFieldMapper.NumberType.LONG);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    if (numNestedDocs > 0) {\n                        expectedParentDocs++;\n                    }\n\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(NestedPathFieldMapper.NAME, NESTED_OBJECT,\n                            NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrapInMockESDirectoryReader(DirectoryReader.open(directory))) {\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = searchAndReduce(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = searchAndReduce(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertEquals(reverseNested, aliasReverseNested);\n                assertEquals(expectedParentDocs, reverseNested.getDocCount());\n            }\n        }\n    }\n","date":"2020-08-07 05:14:20","endLine":239,"groupId":"104820","id":14,"instanceNumber":2,"isCurCommit":0,"methodName":"testFieldAlias","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/db/cfa73d895b8615586cc847232f774b774611b1.src","preCode":"    public void testFieldAlias() throws IOException {\n        int numParentDocs = randomIntBetween(1, 20);\n        int expectedParentDocs = 0;\n\n        MappedFieldType fieldType = new NumberFieldMapper.NumberFieldType(VALUE_FIELD_NAME, NumberFieldMapper.NumberType.LONG);\n\n        try (Directory directory = newDirectory()) {\n            try (RandomIndexWriter iw = new RandomIndexWriter(random(), directory)) {\n                for (int i = 0; i < numParentDocs; i++) {\n                    List<Document> documents = new ArrayList<>();\n                    int numNestedDocs = randomIntBetween(0, 20);\n                    if (numNestedDocs > 0) {\n                        expectedParentDocs++;\n                    }\n\n                    for (int nested = 0; nested < numNestedDocs; nested++) {\n                        Document document = new Document();\n                        document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                                IdFieldMapper.Defaults.NESTED_FIELD_TYPE));\n                        document.add(new Field(NestedPathFieldMapper.NAME, NESTED_OBJECT,\n                            NestedPathFieldMapper.Defaults.FIELD_TYPE));\n                        documents.add(document);\n                    }\n                    Document document = new Document();\n                    document.add(new Field(IdFieldMapper.NAME, Uid.encodeId(Integer.toString(i)),\n                            IdFieldMapper.Defaults.FIELD_TYPE));\n                    document.add(new Field(NestedPathFieldMapper.NAME, \"test\",\n                        NestedPathFieldMapper.Defaults.FIELD_TYPE));\n\n                    long value = randomNonNegativeLong() % 10000;\n                    document.add(new SortedNumericDocValuesField(VALUE_FIELD_NAME, value));\n                    document.add(SeqNoFieldMapper.SequenceIDFields.emptySeqID().primaryTerm);\n                    documents.add(document);\n                    iw.addDocuments(documents);\n                }\n                iw.commit();\n            }\n\n            try (IndexReader indexReader = wrapInMockESDirectoryReader(DirectoryReader.open(directory))) {\n                MaxAggregationBuilder maxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME);\n                MaxAggregationBuilder aliasMaxAgg = max(MAX_AGG_NAME).field(VALUE_FIELD_NAME + \"-alias\");\n\n                NestedAggregationBuilder agg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(maxAgg));\n                NestedAggregationBuilder aliasAgg = nested(NESTED_AGG, NESTED_OBJECT).subAggregation(\n                    reverseNested(REVERSE_AGG_NAME).subAggregation(aliasMaxAgg));\n\n                Nested nested = search(newSearcher(indexReader, false, true),\n                        new MatchAllDocsQuery(), agg, fieldType);\n                Nested aliasNested = search(newSearcher(indexReader, false, true),\n                    new MatchAllDocsQuery(), aliasAgg, fieldType);\n\n                ReverseNested reverseNested = nested.getAggregations().get(REVERSE_AGG_NAME);\n                ReverseNested aliasReverseNested = aliasNested.getAggregations().get(REVERSE_AGG_NAME);\n\n                assertEquals(reverseNested, aliasReverseNested);\n                assertEquals(expectedParentDocs, reverseNested.getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":180,"status":"M"}],"commitId":"5e3ea6eb11c68bdcc9adda51715a6e1fea9186d6","commitMessage":"@@@Merge branch 'master' into feature/runtime_fields\n","date":"2020-08-07 05:14:20","modifiedFileCount":"73","status":"M","submitter":"Nik Everett"}]
