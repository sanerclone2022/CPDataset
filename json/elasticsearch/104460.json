[{"authorTime":"2020-05-13 03:36:16","codes":[{"authorDate":"2020-05-13 03:36:16","commitOrder":5,"curCode":"    public void testActualCompoundProcessorWithOnFailure() throws Exception {\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", exception);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", ingestDocument -> {});\n        CompoundProcessor actualProcessor = new CompoundProcessor(false,\n            Arrays.asList(new CompoundProcessor(false,\n                Arrays.asList(failProcessor, onFailureProcessor),\n                Arrays.asList(onFailureProcessor, failProcessor))),\n            Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {});\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(resultList.size(), equalTo(4));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n\n        assertThat(resultList.get(2).getIngestDocument(), nullValue());\n        assertThat(resultList.get(2).getFailure(), equalTo(exception));\n        assertThat(resultList.get(2).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        metadata = resultList.get(3).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(3).getFailure(), nullValue());\n        assertThat(resultList.get(3).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","date":"2020-05-13 03:36:16","endLine":138,"groupId":"1740","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testActualCompoundProcessorWithOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/5a/ec8a5fcde0062c0dce0c265a0ef597f3532496.src","preCode":"    public void testActualCompoundProcessorWithOnFailure() throws Exception {\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", exception);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", ingestDocument -> {});\n        CompoundProcessor actualProcessor = new CompoundProcessor(false,\n            Arrays.asList(new CompoundProcessor(false,\n                Arrays.asList(failProcessor, onFailureProcessor),\n                Arrays.asList(onFailureProcessor, failProcessor))),\n            Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {});\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(resultList.size(), equalTo(4));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n\n        assertThat(resultList.get(2).getIngestDocument(), nullValue());\n        assertThat(resultList.get(2).getFailure(), equalTo(exception));\n        assertThat(resultList.get(2).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        metadata = resultList.get(3).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(3).getFailure(), nullValue());\n        assertThat(resultList.get(3).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/ingest/TrackingResultProcessorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":98,"status":"MB"},{"authorDate":"2020-05-13 03:36:16","commitOrder":5,"curCode":"    public void testActualCompoundProcessorWithOnFailureAndTrueCondition() throws Exception {\n        String scriptName = \"conditionalScript\";\n        ScriptService scriptService = new ScriptService(Settings.builder().build(), Collections.singletonMap(Script.DEFAULT_SCRIPT_LANG,\n            new MockScriptEngine(Script.DEFAULT_SCRIPT_LANG, Collections.singletonMap(scriptName, ctx -> true), Collections.emptyMap())),\n            new HashMap<>(ScriptModule.CORE_CONTEXTS)\n        );\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", exception);\n        ConditionalProcessor conditionalProcessor = new ConditionalProcessor(\n            randomAlphaOfLength(10),\n            new Script(ScriptType.INLINE, Script.DEFAULT_SCRIPT_LANG, scriptName, Collections.emptyMap()), scriptService,\n            failProcessor);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", ingestDocument -> {});\n        CompoundProcessor actualProcessor =\n            new CompoundProcessor(false,\n                Arrays.asList(conditionalProcessor),\n                Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {\n        });\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(resultList.size(), equalTo(2));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","date":"2020-05-13 03:36:16","endLine":178,"groupId":"35713","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testActualCompoundProcessorWithOnFailureAndTrueCondition","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/5a/ec8a5fcde0062c0dce0c265a0ef597f3532496.src","preCode":"    public void testActualCompoundProcessorWithOnFailureAndTrueCondition() throws Exception {\n        String scriptName = \"conditionalScript\";\n        ScriptService scriptService = new ScriptService(Settings.builder().build(), Collections.singletonMap(Script.DEFAULT_SCRIPT_LANG,\n            new MockScriptEngine(Script.DEFAULT_SCRIPT_LANG, Collections.singletonMap(scriptName, ctx -> true), Collections.emptyMap())),\n            new HashMap<>(ScriptModule.CORE_CONTEXTS)\n        );\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", exception);\n        ConditionalProcessor conditionalProcessor = new ConditionalProcessor(\n            randomAlphaOfLength(10),\n            new Script(ScriptType.INLINE, Script.DEFAULT_SCRIPT_LANG, scriptName, Collections.emptyMap()), scriptService,\n            failProcessor);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", ingestDocument -> {});\n        CompoundProcessor actualProcessor =\n            new CompoundProcessor(false,\n                Arrays.asList(conditionalProcessor),\n                Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {\n        });\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(resultList.size(), equalTo(2));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/ingest/TrackingResultProcessorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":140,"status":"B"}],"commitId":"db2c82c5a52b5c5b4dbaebaf9b6c8d41961608fc","commitMessage":"@@@Fix ingest simulate verbose on failure with conditional (#56478)\n\nIf a conditional is added to a processor.  and that processor fails.  and \nthat processor has an on_failure handler.  the full trace of all of the \nexecuted processors may not be displayed in simulate verbose. The \ninformation is correct.  but misses displaying some of the steps used \nto get there.\n\nThis happens because a processor that is conditional processor is a \nwrapper around the real processor and a processor with an on_failure \nhandler is also a wrapper around the processor(s). When decorating for \nsimulation we treat compound processor specially.  but if a compound processor\nis wrapped by a conditional processor that compound processor's processors \ncan be missed for decoration resulting in the missing displayed steps.\n\nThe fix to this is to treat the conditional processor specially and\nexplicitly seperate it from the processor it is wrapping. This requires\nus to keep track of 2 processors a possible conditional processor and\nthe actual processor it may be wrapping.\n\nrelated: #56004","date":"2020-05-13 03:36:16","modifiedFileCount":"3","status":"M","submitter":"Jake Landis"},{"authorTime":"2020-06-16 05:08:29","codes":[{"authorDate":"2020-06-16 05:08:29","commitOrder":6,"curCode":"    public void testActualCompoundProcessorWithOnFailure() throws Exception {\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", null, exception);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", null, ingestDocument -> {});\n        CompoundProcessor actualProcessor = new CompoundProcessor(false,\n            Arrays.asList(new CompoundProcessor(false,\n                Arrays.asList(failProcessor, onFailureProcessor),\n                Arrays.asList(onFailureProcessor, failProcessor))),\n            Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {});\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(resultList.size(), equalTo(4));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n\n        assertThat(resultList.get(2).getIngestDocument(), nullValue());\n        assertThat(resultList.get(2).getFailure(), equalTo(exception));\n        assertThat(resultList.get(2).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        metadata = resultList.get(3).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(3).getFailure(), nullValue());\n        assertThat(resultList.get(3).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","date":"2020-06-16 05:08:29","endLine":138,"groupId":"1740","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testActualCompoundProcessorWithOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/dc/e1e6d32559bb0a4ae068f2fc14a817960c2718.src","preCode":"    public void testActualCompoundProcessorWithOnFailure() throws Exception {\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", exception);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", ingestDocument -> {});\n        CompoundProcessor actualProcessor = new CompoundProcessor(false,\n            Arrays.asList(new CompoundProcessor(false,\n                Arrays.asList(failProcessor, onFailureProcessor),\n                Arrays.asList(onFailureProcessor, failProcessor))),\n            Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {});\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(resultList.size(), equalTo(4));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n\n        assertThat(resultList.get(2).getIngestDocument(), nullValue());\n        assertThat(resultList.get(2).getFailure(), equalTo(exception));\n        assertThat(resultList.get(2).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        metadata = resultList.get(3).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(3).getFailure(), nullValue());\n        assertThat(resultList.get(3).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/ingest/TrackingResultProcessorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":98,"status":"M"},{"authorDate":"2020-06-16 05:08:29","commitOrder":6,"curCode":"    public void testActualCompoundProcessorWithOnFailureAndTrueCondition() throws Exception {\n        String scriptName = \"conditionalScript\";\n        ScriptService scriptService = new ScriptService(Settings.builder().build(), Collections.singletonMap(Script.DEFAULT_SCRIPT_LANG,\n            new MockScriptEngine(Script.DEFAULT_SCRIPT_LANG, Collections.singletonMap(scriptName, ctx -> true), Collections.emptyMap())),\n            new HashMap<>(ScriptModule.CORE_CONTEXTS)\n        );\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", null, exception);\n        ConditionalProcessor conditionalProcessor = new ConditionalProcessor(\n            randomAlphaOfLength(10),\n            null,\n            new Script(ScriptType.INLINE, Script.DEFAULT_SCRIPT_LANG, scriptName, Collections.emptyMap()), scriptService,\n            failProcessor);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", null, ingestDocument -> {});\n        CompoundProcessor actualProcessor =\n            new CompoundProcessor(false,\n                Arrays.asList(conditionalProcessor),\n                Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {\n        });\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(resultList.size(), equalTo(2));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","date":"2020-06-16 05:08:29","endLine":179,"groupId":"35713","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testActualCompoundProcessorWithOnFailureAndTrueCondition","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/dc/e1e6d32559bb0a4ae068f2fc14a817960c2718.src","preCode":"    public void testActualCompoundProcessorWithOnFailureAndTrueCondition() throws Exception {\n        String scriptName = \"conditionalScript\";\n        ScriptService scriptService = new ScriptService(Settings.builder().build(), Collections.singletonMap(Script.DEFAULT_SCRIPT_LANG,\n            new MockScriptEngine(Script.DEFAULT_SCRIPT_LANG, Collections.singletonMap(scriptName, ctx -> true), Collections.emptyMap())),\n            new HashMap<>(ScriptModule.CORE_CONTEXTS)\n        );\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", exception);\n        ConditionalProcessor conditionalProcessor = new ConditionalProcessor(\n            randomAlphaOfLength(10),\n            new Script(ScriptType.INLINE, Script.DEFAULT_SCRIPT_LANG, scriptName, Collections.emptyMap()), scriptService,\n            failProcessor);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", ingestDocument -> {});\n        CompoundProcessor actualProcessor =\n            new CompoundProcessor(false,\n                Arrays.asList(conditionalProcessor),\n                Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {\n        });\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(resultList.size(), equalTo(2));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/ingest/TrackingResultProcessorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":140,"status":"M"}],"commitId":"69a6a18d8dc3f95001cfe6f55c1451ac616f7e84","commitMessage":"@@@Add optional description parameter to ingest processors. (#57906)\n\nThis commit adds an optional field.  `description`.  to all ingest processors\nso that users can explain the purpose of the specific processor instance.\n\nCloses #56000.","date":"2020-06-16 05:08:29","modifiedFileCount":"125","status":"M","submitter":"Tal Levy"},{"authorTime":"2020-07-22 18:29:36","codes":[{"authorDate":"2020-07-22 18:29:36","commitOrder":7,"curCode":"    public void testActualCompoundProcessorWithOnFailure() throws Exception {\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", null, exception);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", null, ingestDocument -> {});\n        CompoundProcessor actualProcessor = new CompoundProcessor(false,\n            Arrays.asList(new CompoundProcessor(false,\n                Arrays.asList(failProcessor, onFailureProcessor),\n                Arrays.asList(onFailureProcessor, failProcessor))),\n            Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {});\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(),\n            failProcessor.getDescription(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(),\n            failProcessor.getDescription(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(resultList.size(), equalTo(4));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n\n        assertThat(resultList.get(2).getIngestDocument(), nullValue());\n        assertThat(resultList.get(2).getFailure(), equalTo(exception));\n        assertThat(resultList.get(2).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        metadata = resultList.get(3).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(3).getFailure(), nullValue());\n        assertThat(resultList.get(3).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","date":"2020-07-22 18:29:36","endLine":142,"groupId":"1740","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testActualCompoundProcessorWithOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/a6/6aa815c916bf345279c803b11cb6c9d62068a5.src","preCode":"    public void testActualCompoundProcessorWithOnFailure() throws Exception {\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", null, exception);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", null, ingestDocument -> {});\n        CompoundProcessor actualProcessor = new CompoundProcessor(false,\n            Arrays.asList(new CompoundProcessor(false,\n                Arrays.asList(failProcessor, onFailureProcessor),\n                Arrays.asList(onFailureProcessor, failProcessor))),\n            Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {});\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(resultList.size(), equalTo(4));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n\n        assertThat(resultList.get(2).getIngestDocument(), nullValue());\n        assertThat(resultList.get(2).getFailure(), equalTo(exception));\n        assertThat(resultList.get(2).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        metadata = resultList.get(3).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(3).getFailure(), nullValue());\n        assertThat(resultList.get(3).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/ingest/TrackingResultProcessorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":100,"status":"M"},{"authorDate":"2020-07-22 18:29:36","commitOrder":7,"curCode":"    public void testActualCompoundProcessorWithOnFailureAndTrueCondition() throws Exception {\n        String scriptName = \"conditionalScript\";\n        ScriptService scriptService = new ScriptService(Settings.builder().build(), Collections.singletonMap(Script.DEFAULT_SCRIPT_LANG,\n            new MockScriptEngine(Script.DEFAULT_SCRIPT_LANG, Collections.singletonMap(scriptName, ctx -> true), Collections.emptyMap())),\n            new HashMap<>(ScriptModule.CORE_CONTEXTS)\n        );\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", null, exception);\n        ConditionalProcessor conditionalProcessor = new ConditionalProcessor(\n            randomAlphaOfLength(10),\n            null,\n            new Script(ScriptType.INLINE, Script.DEFAULT_SCRIPT_LANG, scriptName, Collections.emptyMap()), scriptService,\n            failProcessor);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", null, ingestDocument -> {});\n        CompoundProcessor actualProcessor =\n            new CompoundProcessor(false,\n                Arrays.asList(conditionalProcessor),\n                Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {\n        });\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(),\n            failProcessor.getDescription(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(),\n            onFailureProcessor.getDescription(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(resultList.size(), equalTo(2));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","date":"2020-07-22 18:29:36","endLine":185,"groupId":"9265","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testActualCompoundProcessorWithOnFailureAndTrueCondition","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/a6/6aa815c916bf345279c803b11cb6c9d62068a5.src","preCode":"    public void testActualCompoundProcessorWithOnFailureAndTrueCondition() throws Exception {\n        String scriptName = \"conditionalScript\";\n        ScriptService scriptService = new ScriptService(Settings.builder().build(), Collections.singletonMap(Script.DEFAULT_SCRIPT_LANG,\n            new MockScriptEngine(Script.DEFAULT_SCRIPT_LANG, Collections.singletonMap(scriptName, ctx -> true), Collections.emptyMap())),\n            new HashMap<>(ScriptModule.CORE_CONTEXTS)\n        );\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", null, exception);\n        ConditionalProcessor conditionalProcessor = new ConditionalProcessor(\n            randomAlphaOfLength(10),\n            null,\n            new Script(ScriptType.INLINE, Script.DEFAULT_SCRIPT_LANG, scriptName, Collections.emptyMap()), scriptService,\n            failProcessor);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", null, ingestDocument -> {});\n        CompoundProcessor actualProcessor =\n            new CompoundProcessor(false,\n                Arrays.asList(conditionalProcessor),\n                Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {\n        });\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(resultList.size(), equalTo(2));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/ingest/TrackingResultProcessorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":144,"status":"M"}],"commitId":"5fcef9a90090b170ef0e963f3e3e56b6fdeaf2d9","commitMessage":"@@@Merge branch 'master' into feature/runtime_fields\n","date":"2020-07-22 18:29:36","modifiedFileCount":"81","status":"M","submitter":"Luca Cavanna"},{"authorTime":"2020-08-06 04:58:53","codes":[{"authorDate":"2020-08-06 04:58:53","commitOrder":8,"curCode":"    public void testActualCompoundProcessorWithOnFailure() throws Exception {\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", null, exception);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", null, ingestDocument -> {});\n        CompoundProcessor actualProcessor = new CompoundProcessor(false,\n            Arrays.asList(new CompoundProcessor(false,\n                Arrays.asList(failProcessor, onFailureProcessor),\n                Arrays.asList(onFailureProcessor, failProcessor))),\n            Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {});\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getType(), failProcessor.getTag(),\n            failProcessor.getDescription(), ingestDocument, null);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getType(),\n            onFailureProcessor.getTag(), failProcessor.getDescription(), ingestDocument, null);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(resultList.size(), equalTo(4));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n\n        assertThat(resultList.get(2).getIngestDocument(), nullValue());\n        assertThat(resultList.get(2).getFailure(), equalTo(exception));\n        assertThat(resultList.get(2).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        metadata = resultList.get(3).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(3).getFailure(), nullValue());\n        assertThat(resultList.get(3).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","date":"2020-08-06 04:58:53","endLine":143,"groupId":"104460","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"testActualCompoundProcessorWithOnFailure","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/2d/5a6f184aa7ac47e10590ac509a41df2ecdc1ff.src","preCode":"    public void testActualCompoundProcessorWithOnFailure() throws Exception {\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", null, exception);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", null, ingestDocument -> {});\n        CompoundProcessor actualProcessor = new CompoundProcessor(false,\n            Arrays.asList(new CompoundProcessor(false,\n                Arrays.asList(failProcessor, onFailureProcessor),\n                Arrays.asList(onFailureProcessor, failProcessor))),\n            Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {});\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(),\n            failProcessor.getDescription(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(),\n            failProcessor.getDescription(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(2));\n        assertThat(resultList.size(), equalTo(4));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n\n        assertThat(resultList.get(2).getIngestDocument(), nullValue());\n        assertThat(resultList.get(2).getFailure(), equalTo(exception));\n        assertThat(resultList.get(2).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        metadata = resultList.get(3).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(3).getFailure(), nullValue());\n        assertThat(resultList.get(3).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/ingest/TrackingResultProcessorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":101,"status":"M"},{"authorDate":"2020-08-06 04:58:53","commitOrder":8,"curCode":"    public void testActualCompoundProcessorWithOnFailureAndTrueCondition() throws Exception {\n        String scriptName = \"conditionalScript\";\n        ScriptService scriptService = new ScriptService(Settings.builder().build(), Collections.singletonMap(Script.DEFAULT_SCRIPT_LANG,\n            new MockScriptEngine(Script.DEFAULT_SCRIPT_LANG, Collections.singletonMap(scriptName, ctx -> true), Collections.emptyMap())),\n            new HashMap<>(ScriptModule.CORE_CONTEXTS)\n        );\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", null, exception);\n        ConditionalProcessor conditionalProcessor = new ConditionalProcessor(\n            randomAlphaOfLength(10),\n            null,\n            new Script(ScriptType.INLINE, Script.DEFAULT_SCRIPT_LANG, scriptName, Collections.emptyMap()), scriptService,\n            failProcessor);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", null, ingestDocument -> {});\n        CompoundProcessor actualProcessor =\n            new CompoundProcessor(false,\n                Arrays.asList(conditionalProcessor),\n                Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {\n        });\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getType(), failProcessor.getTag(),\n            failProcessor.getDescription(), ingestDocument, null);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getType(),\n            onFailureProcessor.getTag(), onFailureProcessor.getDescription(), ingestDocument, null);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(1));\n\n        assertThat(resultList.size(), equalTo(2));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n        assertThat(resultList.get(0).getConditionalWithResult().v1(), equalTo(scriptName));\n        assertThat(resultList.get(0).getConditionalWithResult().v2(), is(Boolean.TRUE));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","date":"2020-08-06 04:58:53","endLine":189,"groupId":"104460","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testActualCompoundProcessorWithOnFailureAndTrueCondition","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/2d/5a6f184aa7ac47e10590ac509a41df2ecdc1ff.src","preCode":"    public void testActualCompoundProcessorWithOnFailureAndTrueCondition() throws Exception {\n        String scriptName = \"conditionalScript\";\n        ScriptService scriptService = new ScriptService(Settings.builder().build(), Collections.singletonMap(Script.DEFAULT_SCRIPT_LANG,\n            new MockScriptEngine(Script.DEFAULT_SCRIPT_LANG, Collections.singletonMap(scriptName, ctx -> true), Collections.emptyMap())),\n            new HashMap<>(ScriptModule.CORE_CONTEXTS)\n        );\n        RuntimeException exception = new RuntimeException(\"fail\");\n        TestProcessor failProcessor = new TestProcessor(\"fail\", \"test\", null, exception);\n        ConditionalProcessor conditionalProcessor = new ConditionalProcessor(\n            randomAlphaOfLength(10),\n            null,\n            new Script(ScriptType.INLINE, Script.DEFAULT_SCRIPT_LANG, scriptName, Collections.emptyMap()), scriptService,\n            failProcessor);\n        TestProcessor onFailureProcessor = new TestProcessor(\"success\", \"test\", null, ingestDocument -> {});\n        CompoundProcessor actualProcessor =\n            new CompoundProcessor(false,\n                Arrays.asList(conditionalProcessor),\n                Arrays.asList(onFailureProcessor));\n        CompoundProcessor trackingProcessor = decorate(actualProcessor, null, resultList);\n        trackingProcessor.execute(ingestDocument, (result, e) -> {\n        });\n\n        SimulateProcessorResult expectedFailResult = new SimulateProcessorResult(failProcessor.getTag(),\n            failProcessor.getDescription(), ingestDocument);\n        SimulateProcessorResult expectedSuccessResult = new SimulateProcessorResult(onFailureProcessor.getTag(),\n            onFailureProcessor.getDescription(), ingestDocument);\n\n        assertThat(failProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(onFailureProcessor.getInvokedCounter(), equalTo(1));\n        assertThat(resultList.size(), equalTo(2));\n\n        assertThat(resultList.get(0).getIngestDocument(), nullValue());\n        assertThat(resultList.get(0).getFailure(), equalTo(exception));\n        assertThat(resultList.get(0).getProcessorTag(), equalTo(expectedFailResult.getProcessorTag()));\n\n        Map<String, Object> metadata = resultList.get(1).getIngestDocument().getIngestMetadata();\n        assertThat(metadata.get(ON_FAILURE_MESSAGE_FIELD), equalTo(\"fail\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TYPE_FIELD), equalTo(\"test\"));\n        assertThat(metadata.get(ON_FAILURE_PROCESSOR_TAG_FIELD), equalTo(\"fail\"));\n        assertThat(resultList.get(1).getFailure(), nullValue());\n        assertThat(resultList.get(1).getProcessorTag(), equalTo(expectedSuccessResult.getProcessorTag()));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/ingest/TrackingResultProcessorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":145,"status":"M"}],"commitId":"45402118936d96100445723a849c869627cf1dc2","commitMessage":"@@@Merge branch 'master' into feature/runtime_fields\n","date":"2020-08-06 04:58:53","modifiedFileCount":"224","status":"M","submitter":"Nik Everett"}]
