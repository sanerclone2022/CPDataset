[{"authorTime":"2018-12-06 15:31:46","codes":[{"authorDate":"2018-12-06 15:31:46","commitOrder":1,"curCode":"    public void testHandleClientValueWithDifferentReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = new VotingConfiguration(Collections.singleton(node1.getId()));\n        ClusterState state1 = clusterState(0L, 1L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = new VotingConfiguration(Collections.singleton(node2.getId()));\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        VotingConfiguration newConfig2 = new VotingConfiguration(Collections.singleton(node3.getId()));\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig2, 42L);\n        assertThat(expectThrows(CoordinationStateRejectedException.class, () -> cs1.handleClientValue(state3)).getMessage(),\n            containsString(\"only allow reconfiguration while not already reconfiguring\"));\n    }\n","date":"2018-12-06 15:31:46","endLine":417,"groupId":"67153","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testHandleClientValueWithDifferentReconfigurationWhileAlreadyReconfiguring","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ab/2ad25e72152f573bcb0c1195cdb330c154ff7b.src","preCode":"    public void testHandleClientValueWithDifferentReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = new VotingConfiguration(Collections.singleton(node1.getId()));\n        ClusterState state1 = clusterState(0L, 1L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = new VotingConfiguration(Collections.singleton(node2.getId()));\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        VotingConfiguration newConfig2 = new VotingConfiguration(Collections.singleton(node3.getId()));\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig2, 42L);\n        assertThat(expectThrows(CoordinationStateRejectedException.class, () -> cs1.handleClientValue(state3)).getMessage(),\n            containsString(\"only allow reconfiguration while not already reconfiguring\"));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinationStateTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":398,"status":"B"},{"authorDate":"2018-12-06 15:31:46","commitOrder":1,"curCode":"    public void testHandleClientValueWithSameReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = new VotingConfiguration(Collections.singleton(node1.getId()));\n        ClusterState state1 = clusterState(0L, 1L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = new VotingConfiguration(Collections.singleton(node2.getId()));\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig1, 42L);\n        cs1.handleClientValue(state3);\n    }\n","date":"2018-12-06 15:31:46","endLine":436,"groupId":"67153","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testHandleClientValueWithSameReconfigurationWhileAlreadyReconfiguring","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ab/2ad25e72152f573bcb0c1195cdb330c154ff7b.src","preCode":"    public void testHandleClientValueWithSameReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = new VotingConfiguration(Collections.singleton(node1.getId()));\n        ClusterState state1 = clusterState(0L, 1L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = new VotingConfiguration(Collections.singleton(node2.getId()));\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig1, 42L);\n        cs1.handleClientValue(state3);\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinationStateTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":419,"status":"B"}],"commitId":"ee05ef131286eead295cf58ed4393af56f0d7ade","commitMessage":"@@@Merge branch 'zen2'\n","date":"2018-12-06 15:31:46","modifiedFileCount":"122","status":"B","submitter":"Yannick Welsch"},{"authorTime":"2019-01-04 17:09:16","codes":[{"authorDate":"2019-01-04 17:09:16","commitOrder":2,"curCode":"    public void testHandleClientValueWithDifferentReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = new VotingConfiguration(Collections.singleton(node1.getId()));\n        ClusterState state1 = clusterState(0L, 0L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = new VotingConfiguration(Collections.singleton(node2.getId()));\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        VotingConfiguration newConfig2 = new VotingConfiguration(Collections.singleton(node3.getId()));\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig2, 42L);\n        assertThat(expectThrows(CoordinationStateRejectedException.class, () -> cs1.handleClientValue(state3)).getMessage(),\n            containsString(\"only allow reconfiguration while not already reconfiguring\"));\n    }\n","date":"2019-01-04 17:09:16","endLine":417,"groupId":"67153","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testHandleClientValueWithDifferentReconfigurationWhileAlreadyReconfiguring","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/af/e2e065a875e41c3f8fe139738ea5cb889fbbe6.src","preCode":"    public void testHandleClientValueWithDifferentReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = new VotingConfiguration(Collections.singleton(node1.getId()));\n        ClusterState state1 = clusterState(0L, 1L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = new VotingConfiguration(Collections.singleton(node2.getId()));\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        VotingConfiguration newConfig2 = new VotingConfiguration(Collections.singleton(node3.getId()));\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig2, 42L);\n        assertThat(expectThrows(CoordinationStateRejectedException.class, () -> cs1.handleClientValue(state3)).getMessage(),\n            containsString(\"only allow reconfiguration while not already reconfiguring\"));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinationStateTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":398,"status":"M"},{"authorDate":"2019-01-04 17:09:16","commitOrder":2,"curCode":"    public void testHandleClientValueWithSameReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = new VotingConfiguration(Collections.singleton(node1.getId()));\n        ClusterState state1 = clusterState(0L, 0L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = new VotingConfiguration(Collections.singleton(node2.getId()));\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig1, 42L);\n        cs1.handleClientValue(state3);\n    }\n","date":"2019-01-04 17:09:16","endLine":436,"groupId":"67153","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testHandleClientValueWithSameReconfigurationWhileAlreadyReconfiguring","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/af/e2e065a875e41c3f8fe139738ea5cb889fbbe6.src","preCode":"    public void testHandleClientValueWithSameReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = new VotingConfiguration(Collections.singleton(node1.getId()));\n        ClusterState state1 = clusterState(0L, 1L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = new VotingConfiguration(Collections.singleton(node2.getId()));\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig1, 42L);\n        cs1.handleClientValue(state3);\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinationStateTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":419,"status":"M"}],"commitId":"3f7d6a989af09fb61a8904816ac644ddae1cdd46","commitMessage":"@@@[Zen2] Elect freshest master in upgrade (#37122)\n\nToday when electing a master in Zen2 we use the cluster state version to\ndetermine whether a node has a fresh-enough cluster state to become master.\nHowever the cluster state version is not a reliable measure of freshness in the\nZen1 world; furthermore in 6.x the cluster state version is not persisted. This\nmeans that when upgrading from 6.x via a full cluster restart a cluster state\nupdate may be lost if a stale master wins the initial election.\n\nThis change fixes this by using the metadata version as a measure of freshness\nwhen in term 0.  since this is persisted in 6.x and does more reliably indicate\nthe freshness of nodes.\n\nIt also makes changes parallel to elastic/elasticsearch-formal-models#40 to\nsupport situations in which nodes accept cluster state versions in term 0: this\ndoes not happen in a pure Zen2 cluster.  but can happen in mixed clusters and\nduring upgrades.","date":"2019-01-04 17:09:16","modifiedFileCount":"7","status":"M","submitter":"David Turner"},{"authorTime":"2020-04-01 02:05:47","codes":[{"authorDate":"2020-04-01 02:05:47","commitOrder":3,"curCode":"    public void testHandleClientValueWithDifferentReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = VotingConfiguration.of(node1);\n        ClusterState state1 = clusterState(0L, 0L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = VotingConfiguration.of(node2);\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        VotingConfiguration newConfig2 = VotingConfiguration.of(node3);\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig2, 42L);\n        assertThat(expectThrows(CoordinationStateRejectedException.class, () -> cs1.handleClientValue(state3)).getMessage(),\n            containsString(\"only allow reconfiguration while not already reconfiguring\"));\n    }\n","date":"2020-04-01 02:05:47","endLine":415,"groupId":"102328","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testHandleClientValueWithDifferentReconfigurationWhileAlreadyReconfiguring","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/00/e23d9d50992daf5da69205938c81d4f3fbabc7.src","preCode":"    public void testHandleClientValueWithDifferentReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = new VotingConfiguration(Collections.singleton(node1.getId()));\n        ClusterState state1 = clusterState(0L, 0L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = new VotingConfiguration(Collections.singleton(node2.getId()));\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        VotingConfiguration newConfig2 = new VotingConfiguration(Collections.singleton(node3.getId()));\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig2, 42L);\n        assertThat(expectThrows(CoordinationStateRejectedException.class, () -> cs1.handleClientValue(state3)).getMessage(),\n            containsString(\"only allow reconfiguration while not already reconfiguring\"));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinationStateTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":396,"status":"M"},{"authorDate":"2020-04-01 02:05:47","commitOrder":3,"curCode":"    public void testHandleClientValueWithSameReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = VotingConfiguration.of(node1);\n        ClusterState state1 = clusterState(0L, 0L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = VotingConfiguration.of(node2);\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig1, 42L);\n        cs1.handleClientValue(state3);\n    }\n","date":"2020-04-01 02:05:47","endLine":434,"groupId":"102328","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testHandleClientValueWithSameReconfigurationWhileAlreadyReconfiguring","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/00/e23d9d50992daf5da69205938c81d4f3fbabc7.src","preCode":"    public void testHandleClientValueWithSameReconfigurationWhileAlreadyReconfiguring() {\n        VotingConfiguration initialConfig = new VotingConfiguration(Collections.singleton(node1.getId()));\n        ClusterState state1 = clusterState(0L, 0L, node1, initialConfig, initialConfig, 42L);\n        cs1.setInitialState(state1);\n        StartJoinRequest startJoinRequest1 = new StartJoinRequest(node1, randomLongBetween(1, 5));\n        Join v1 = cs1.handleStartJoin(startJoinRequest1);\n        Join v2 = cs2.handleStartJoin(startJoinRequest1);\n        assertTrue(cs1.handleJoin(v1));\n        assertTrue(cs1.electionWon());\n        assertTrue(cs1.handleJoin(v2));\n\n        VotingConfiguration newConfig1 = new VotingConfiguration(Collections.singleton(node2.getId()));\n        ClusterState state2 = clusterState(startJoinRequest1.getTerm(), 2L, node1, initialConfig, newConfig1, 42L);\n        PublishRequest publishRequest = cs1.handleClientValue(state2);\n        cs1.handlePublishRequest(publishRequest);\n        ClusterState state3 = clusterState(startJoinRequest1.getTerm(), 3L, node1, initialConfig, newConfig1, 42L);\n        cs1.handleClientValue(state3);\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinationStateTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":417,"status":"M"}],"commitId":"2073d8c4b9003a6d8f3d7fac7cec22d0e5d47aa2","commitMessage":"@@@Use VotingConfiguration#of where possible (#54507)\n\nThis resolves a longstanding TODO in the cluster coordination subsystem.\n\nRelates #32006","date":"2020-04-01 02:05:47","modifiedFileCount":"6","status":"M","submitter":"David Turner"}]
