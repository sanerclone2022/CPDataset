[{"authorTime":"2018-04-26 03:22:53","codes":[{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    public static IndexOrdinalsFieldData build(final IndexReader indexReader, IndexOrdinalsFieldData indexFieldData,\n            IndexSettings indexSettings, CircuitBreakerService breakerService, Logger logger,\n            Function<SortedSetDocValues, ScriptDocValues<?>> scriptFunction) throws IOException {\n        assert indexReader.leaves().size() > 1;\n        long startTimeNS = System.nanoTime();\n\n        final AtomicOrdinalsFieldData[] atomicFD = new AtomicOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = indexFieldData.load(indexReader.leaves().get(i));\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        final long memorySizeInBytes = ordinalMap.ramBytesUsed();\n        breakerService.getBreaker(CircuitBreaker.FIELDDATA).addWithoutBreaking(memorySizeInBytes);\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"global-ordinals [{}][{}] took [{}]\",\n                    indexFieldData.getFieldName(),\n                    ordinalMap.getValueCount(),\n                    new TimeValue(System.nanoTime() - startTimeNS, TimeUnit.NANOSECONDS)\n            );\n        }\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(),\n                atomicFD, ordinalMap, memorySizeInBytes, scriptFunction\n        );\n    }\n","date":"2018-04-26 03:22:53","endLine":80,"groupId":"53005","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"build","params":"(finalIndexReaderindexReader@IndexOrdinalsFieldDataindexFieldData@IndexSettingsindexSettings@CircuitBreakerServicebreakerService@Loggerlogger@Function<SortedSetDocValues@ScriptDocValues<?>>scriptFunction)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/64/6c7adb40408ea622518231074a2f518e77c473.src","preCode":"    public static IndexOrdinalsFieldData build(final IndexReader indexReader, IndexOrdinalsFieldData indexFieldData,\n            IndexSettings indexSettings, CircuitBreakerService breakerService, Logger logger,\n            Function<SortedSetDocValues, ScriptDocValues<?>> scriptFunction) throws IOException {\n        assert indexReader.leaves().size() > 1;\n        long startTimeNS = System.nanoTime();\n\n        final AtomicOrdinalsFieldData[] atomicFD = new AtomicOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = indexFieldData.load(indexReader.leaves().get(i));\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        final long memorySizeInBytes = ordinalMap.ramBytesUsed();\n        breakerService.getBreaker(CircuitBreaker.FIELDDATA).addWithoutBreaking(memorySizeInBytes);\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"global-ordinals [{}][{}] took [{}]\",\n                    indexFieldData.getFieldName(),\n                    ordinalMap.getValueCount(),\n                    new TimeValue(System.nanoTime() - startTimeNS, TimeUnit.NANOSECONDS)\n            );\n        }\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(),\n                atomicFD, ordinalMap, memorySizeInBytes, scriptFunction\n        );\n    }\n","realPath":"server/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":53,"status":"B"},{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    public static IndexOrdinalsFieldData buildEmpty(IndexSettings indexSettings, final IndexReader indexReader, IndexOrdinalsFieldData indexFieldData) throws IOException {\n        assert indexReader.leaves().size() > 1;\n\n        final AtomicOrdinalsFieldData[] atomicFD = new AtomicOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = new AbstractAtomicOrdinalsFieldData(AbstractAtomicOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION) {\n                @Override\n                public SortedSetDocValues getOrdinalsValues() {\n                    return DocValues.emptySortedSet();\n                }\n\n                @Override\n                public long ramBytesUsed() {\n                    return 0;\n                }\n\n                @Override\n                public Collection<Accountable> getChildResources() {\n                    return Collections.emptyList();\n                }\n\n                @Override\n                public void close() {\n                }\n            };\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(),\n                atomicFD, ordinalMap, 0, AbstractAtomicOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION\n        );\n    }\n","date":"2018-04-26 03:22:53","endLine":114,"groupId":"45153","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"buildEmpty","params":"(IndexSettingsindexSettings@finalIndexReaderindexReader@IndexOrdinalsFieldDataindexFieldData)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/64/6c7adb40408ea622518231074a2f518e77c473.src","preCode":"    public static IndexOrdinalsFieldData buildEmpty(IndexSettings indexSettings, final IndexReader indexReader, IndexOrdinalsFieldData indexFieldData) throws IOException {\n        assert indexReader.leaves().size() > 1;\n\n        final AtomicOrdinalsFieldData[] atomicFD = new AtomicOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = new AbstractAtomicOrdinalsFieldData(AbstractAtomicOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION) {\n                @Override\n                public SortedSetDocValues getOrdinalsValues() {\n                    return DocValues.emptySortedSet();\n                }\n\n                @Override\n                public long ramBytesUsed() {\n                    return 0;\n                }\n\n                @Override\n                public Collection<Accountable> getChildResources() {\n                    return Collections.emptyList();\n                }\n\n                @Override\n                public void close() {\n                }\n            };\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(),\n                atomicFD, ordinalMap, 0, AbstractAtomicOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION\n        );\n    }\n","realPath":"server/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":82,"status":"B"}],"commitId":"d74fb9eb4559077e2d20b19a9ed62d9ff825027a","commitMessage":"@@@Opened x-pack ILM code\n","date":"2018-04-26 03:22:53","modifiedFileCount":"0","status":"B","submitter":"Tal Levy"},{"authorTime":"2020-03-17 20:25:51","codes":[{"authorDate":"2020-03-17 20:25:51","commitOrder":2,"curCode":"    public static IndexOrdinalsFieldData build(final IndexReader indexReader, IndexOrdinalsFieldData indexFieldData,\n            IndexSettings indexSettings, CircuitBreakerService breakerService, Logger logger,\n            Function<SortedSetDocValues, ScriptDocValues<?>> scriptFunction) throws IOException {\n        assert indexReader.leaves().size() > 1;\n        long startTimeNS = System.nanoTime();\n\n        final LeafOrdinalsFieldData[] atomicFD = new LeafOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = indexFieldData.load(indexReader.leaves().get(i));\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        final long memorySizeInBytes = ordinalMap.ramBytesUsed();\n        breakerService.getBreaker(CircuitBreaker.FIELDDATA).addWithoutBreaking(memorySizeInBytes);\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"global-ordinals [{}][{}] took [{}]\",\n                    indexFieldData.getFieldName(),\n                    ordinalMap.getValueCount(),\n                    new TimeValue(System.nanoTime() - startTimeNS, TimeUnit.NANOSECONDS)\n            );\n        }\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(),\n                atomicFD, ordinalMap, memorySizeInBytes, scriptFunction\n        );\n    }\n","date":"2020-03-17 20:25:51","endLine":80,"groupId":"53005","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"build","params":"(finalIndexReaderindexReader@IndexOrdinalsFieldDataindexFieldData@IndexSettingsindexSettings@CircuitBreakerServicebreakerService@Loggerlogger@Function<SortedSetDocValues@ScriptDocValues<?>>scriptFunction)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/d5/fd31cfd5be92ca2e742243e0b47403e0eaaeb4.src","preCode":"    public static IndexOrdinalsFieldData build(final IndexReader indexReader, IndexOrdinalsFieldData indexFieldData,\n            IndexSettings indexSettings, CircuitBreakerService breakerService, Logger logger,\n            Function<SortedSetDocValues, ScriptDocValues<?>> scriptFunction) throws IOException {\n        assert indexReader.leaves().size() > 1;\n        long startTimeNS = System.nanoTime();\n\n        final AtomicOrdinalsFieldData[] atomicFD = new AtomicOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = indexFieldData.load(indexReader.leaves().get(i));\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        final long memorySizeInBytes = ordinalMap.ramBytesUsed();\n        breakerService.getBreaker(CircuitBreaker.FIELDDATA).addWithoutBreaking(memorySizeInBytes);\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"global-ordinals [{}][{}] took [{}]\",\n                    indexFieldData.getFieldName(),\n                    ordinalMap.getValueCount(),\n                    new TimeValue(System.nanoTime() - startTimeNS, TimeUnit.NANOSECONDS)\n            );\n        }\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(),\n                atomicFD, ordinalMap, memorySizeInBytes, scriptFunction\n        );\n    }\n","realPath":"server/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":53,"status":"M"},{"authorDate":"2020-03-17 20:25:51","commitOrder":2,"curCode":"    public static IndexOrdinalsFieldData buildEmpty(IndexSettings indexSettings, final IndexReader indexReader,\n            IndexOrdinalsFieldData indexFieldData) throws IOException {\n        assert indexReader.leaves().size() > 1;\n\n        final LeafOrdinalsFieldData[] atomicFD = new LeafOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = new AbstractLeafOrdinalsFieldData(AbstractLeafOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION) {\n                @Override\n                public SortedSetDocValues getOrdinalsValues() {\n                    return DocValues.emptySortedSet();\n                }\n\n                @Override\n                public long ramBytesUsed() {\n                    return 0;\n                }\n\n                @Override\n                public Collection<Accountable> getChildResources() {\n                    return Collections.emptyList();\n                }\n\n                @Override\n                public void close() {\n                }\n            };\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(),\n                atomicFD, ordinalMap, 0, AbstractLeafOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION\n        );\n    }\n","date":"2020-03-17 20:25:51","endLine":115,"groupId":"45153","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"buildEmpty","params":"(IndexSettingsindexSettings@finalIndexReaderindexReader@IndexOrdinalsFieldDataindexFieldData)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/d5/fd31cfd5be92ca2e742243e0b47403e0eaaeb4.src","preCode":"    public static IndexOrdinalsFieldData buildEmpty(IndexSettings indexSettings, final IndexReader indexReader,\n            IndexOrdinalsFieldData indexFieldData) throws IOException {\n        assert indexReader.leaves().size() > 1;\n\n        final AtomicOrdinalsFieldData[] atomicFD = new AtomicOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = new AbstractAtomicOrdinalsFieldData(AbstractAtomicOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION) {\n                @Override\n                public SortedSetDocValues getOrdinalsValues() {\n                    return DocValues.emptySortedSet();\n                }\n\n                @Override\n                public long ramBytesUsed() {\n                    return 0;\n                }\n\n                @Override\n                public Collection<Accountable> getChildResources() {\n                    return Collections.emptyList();\n                }\n\n                @Override\n                public void close() {\n                }\n            };\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(),\n                atomicFD, ordinalMap, 0, AbstractAtomicOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION\n        );\n    }\n","realPath":"server/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":82,"status":"M"}],"commitId":"3e607d9e93c6319fcd606714aabca4af91f133d3","commitMessage":"@@@Rename AtomicFieldData to LeafFieldData (#53554)\n\nThis conforms with lucene's LeafReader naming convention.  and\nmatches other per-segment structures in elasticsearch.","date":"2020-03-17 20:25:51","modifiedFileCount":"59","status":"M","submitter":"Alan Woodward"},{"authorTime":"2020-06-02 21:54:53","codes":[{"authorDate":"2020-06-02 21:54:53","commitOrder":3,"curCode":"    public static IndexOrdinalsFieldData build(final IndexReader indexReader, IndexOrdinalsFieldData indexFieldData,\n            IndexSettings indexSettings, CircuitBreakerService breakerService, Logger logger,\n            Function<SortedSetDocValues, ScriptDocValues<?>> scriptFunction) throws IOException {\n        assert indexReader.leaves().size() > 1;\n        long startTimeNS = System.nanoTime();\n\n        final LeafOrdinalsFieldData[] atomicFD = new LeafOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = indexFieldData.load(indexReader.leaves().get(i));\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        final long memorySizeInBytes = ordinalMap.ramBytesUsed();\n        breakerService.getBreaker(CircuitBreaker.FIELDDATA).addWithoutBreaking(memorySizeInBytes);\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"global-ordinals [{}][{}] took [{}]\",\n                    indexFieldData.getFieldName(),\n                    ordinalMap.getValueCount(),\n                    new TimeValue(System.nanoTime() - startTimeNS, TimeUnit.NANOSECONDS)\n            );\n        }\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(), indexFieldData.getValuesSourceType(),\n                atomicFD, ordinalMap, memorySizeInBytes, scriptFunction\n        );\n    }\n","date":"2020-06-02 21:54:53","endLine":80,"groupId":"53005","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"build","params":"(finalIndexReaderindexReader@IndexOrdinalsFieldDataindexFieldData@IndexSettingsindexSettings@CircuitBreakerServicebreakerService@Loggerlogger@Function<SortedSetDocValues@ScriptDocValues<?>>scriptFunction)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/93/31dd659a3e0c6702873bfa440d29a708957e7c.src","preCode":"    public static IndexOrdinalsFieldData build(final IndexReader indexReader, IndexOrdinalsFieldData indexFieldData,\n            IndexSettings indexSettings, CircuitBreakerService breakerService, Logger logger,\n            Function<SortedSetDocValues, ScriptDocValues<?>> scriptFunction) throws IOException {\n        assert indexReader.leaves().size() > 1;\n        long startTimeNS = System.nanoTime();\n\n        final LeafOrdinalsFieldData[] atomicFD = new LeafOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = indexFieldData.load(indexReader.leaves().get(i));\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        final long memorySizeInBytes = ordinalMap.ramBytesUsed();\n        breakerService.getBreaker(CircuitBreaker.FIELDDATA).addWithoutBreaking(memorySizeInBytes);\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"global-ordinals [{}][{}] took [{}]\",\n                    indexFieldData.getFieldName(),\n                    ordinalMap.getValueCount(),\n                    new TimeValue(System.nanoTime() - startTimeNS, TimeUnit.NANOSECONDS)\n            );\n        }\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(),\n                atomicFD, ordinalMap, memorySizeInBytes, scriptFunction\n        );\n    }\n","realPath":"server/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":53,"status":"M"},{"authorDate":"2020-06-02 21:54:53","commitOrder":3,"curCode":"    public static IndexOrdinalsFieldData buildEmpty(IndexSettings indexSettings, final IndexReader indexReader,\n            IndexOrdinalsFieldData indexFieldData) throws IOException {\n        assert indexReader.leaves().size() > 1;\n\n        final LeafOrdinalsFieldData[] atomicFD = new LeafOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = new AbstractLeafOrdinalsFieldData(AbstractLeafOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION) {\n                @Override\n                public SortedSetDocValues getOrdinalsValues() {\n                    return DocValues.emptySortedSet();\n                }\n\n                @Override\n                public long ramBytesUsed() {\n                    return 0;\n                }\n\n                @Override\n                public Collection<Accountable> getChildResources() {\n                    return Collections.emptyList();\n                }\n\n                @Override\n                public void close() {\n                }\n            };\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(), indexFieldData.getValuesSourceType(),\n                atomicFD, ordinalMap, 0, AbstractLeafOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION\n        );\n    }\n","date":"2020-06-02 21:54:53","endLine":115,"groupId":"45153","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"buildEmpty","params":"(IndexSettingsindexSettings@finalIndexReaderindexReader@IndexOrdinalsFieldDataindexFieldData)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/93/31dd659a3e0c6702873bfa440d29a708957e7c.src","preCode":"    public static IndexOrdinalsFieldData buildEmpty(IndexSettings indexSettings, final IndexReader indexReader,\n            IndexOrdinalsFieldData indexFieldData) throws IOException {\n        assert indexReader.leaves().size() > 1;\n\n        final LeafOrdinalsFieldData[] atomicFD = new LeafOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = new AbstractLeafOrdinalsFieldData(AbstractLeafOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION) {\n                @Override\n                public SortedSetDocValues getOrdinalsValues() {\n                    return DocValues.emptySortedSet();\n                }\n\n                @Override\n                public long ramBytesUsed() {\n                    return 0;\n                }\n\n                @Override\n                public Collection<Accountable> getChildResources() {\n                    return Collections.emptyList();\n                }\n\n                @Override\n                public void close() {\n                }\n            };\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(),\n                atomicFD, ordinalMap, 0, AbstractLeafOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION\n        );\n    }\n","realPath":"server/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":82,"status":"M"}],"commitId":"0a23487e73eb3c0c3a84704e6bd7a5ed077ed5e6","commitMessage":"@@@IndexFieldData should hold the ValuesSourceType (#57373)\n\n","date":"2020-06-02 21:54:53","modifiedFileCount":"82","status":"M","submitter":"Mark Tozzi"},{"authorTime":"2020-07-20 22:44:31","codes":[{"authorDate":"2020-07-20 22:44:31","commitOrder":4,"curCode":"    public static IndexOrdinalsFieldData build(final IndexReader indexReader, IndexOrdinalsFieldData indexFieldData,\n            CircuitBreakerService breakerService, Logger logger,\n            Function<SortedSetDocValues, ScriptDocValues<?>> scriptFunction) throws IOException {\n        assert indexReader.leaves().size() > 1;\n        long startTimeNS = System.nanoTime();\n\n        final LeafOrdinalsFieldData[] atomicFD = new LeafOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = indexFieldData.load(indexReader.leaves().get(i));\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        final long memorySizeInBytes = ordinalMap.ramBytesUsed();\n        breakerService.getBreaker(CircuitBreaker.FIELDDATA).addWithoutBreaking(memorySizeInBytes);\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"global-ordinals [{}][{}] took [{}]\",\n                    indexFieldData.getFieldName(),\n                    ordinalMap.getValueCount(),\n                    new TimeValue(System.nanoTime() - startTimeNS, TimeUnit.NANOSECONDS)\n            );\n        }\n        return new GlobalOrdinalsIndexFieldData(indexFieldData.getFieldName(), indexFieldData.getValuesSourceType(),\n                atomicFD, ordinalMap, memorySizeInBytes, scriptFunction\n        );\n    }\n","date":"2020-07-20 22:44:31","endLine":79,"groupId":"107977","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"build","params":"(finalIndexReaderindexReader@IndexOrdinalsFieldDataindexFieldData@CircuitBreakerServicebreakerService@Loggerlogger@Function<SortedSetDocValues@ScriptDocValues<?>>scriptFunction)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/d4/0f702c2d5607f19d871e894d49c7cad8f1f765.src","preCode":"    public static IndexOrdinalsFieldData build(final IndexReader indexReader, IndexOrdinalsFieldData indexFieldData,\n            IndexSettings indexSettings, CircuitBreakerService breakerService, Logger logger,\n            Function<SortedSetDocValues, ScriptDocValues<?>> scriptFunction) throws IOException {\n        assert indexReader.leaves().size() > 1;\n        long startTimeNS = System.nanoTime();\n\n        final LeafOrdinalsFieldData[] atomicFD = new LeafOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = indexFieldData.load(indexReader.leaves().get(i));\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        final long memorySizeInBytes = ordinalMap.ramBytesUsed();\n        breakerService.getBreaker(CircuitBreaker.FIELDDATA).addWithoutBreaking(memorySizeInBytes);\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"global-ordinals [{}][{}] took [{}]\",\n                    indexFieldData.getFieldName(),\n                    ordinalMap.getValueCount(),\n                    new TimeValue(System.nanoTime() - startTimeNS, TimeUnit.NANOSECONDS)\n            );\n        }\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(), indexFieldData.getValuesSourceType(),\n                atomicFD, ordinalMap, memorySizeInBytes, scriptFunction\n        );\n    }\n","realPath":"server/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":52,"status":"M"},{"authorDate":"2020-07-20 22:44:31","commitOrder":4,"curCode":"    public static IndexOrdinalsFieldData buildEmpty(IndexReader indexReader, IndexOrdinalsFieldData indexFieldData) throws IOException {\n        assert indexReader.leaves().size() > 1;\n\n        final LeafOrdinalsFieldData[] atomicFD = new LeafOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = new AbstractLeafOrdinalsFieldData(AbstractLeafOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION) {\n                @Override\n                public SortedSetDocValues getOrdinalsValues() {\n                    return DocValues.emptySortedSet();\n                }\n\n                @Override\n                public long ramBytesUsed() {\n                    return 0;\n                }\n\n                @Override\n                public Collection<Accountable> getChildResources() {\n                    return Collections.emptyList();\n                }\n\n                @Override\n                public void close() {\n                }\n            };\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        return new GlobalOrdinalsIndexFieldData(indexFieldData.getFieldName(), indexFieldData.getValuesSourceType(),\n                atomicFD, ordinalMap, 0, AbstractLeafOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION\n        );\n    }\n","date":"2020-07-20 22:44:31","endLine":113,"groupId":"107977","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"buildEmpty","params":"(IndexReaderindexReader@IndexOrdinalsFieldDataindexFieldData)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/d4/0f702c2d5607f19d871e894d49c7cad8f1f765.src","preCode":"    public static IndexOrdinalsFieldData buildEmpty(IndexSettings indexSettings, final IndexReader indexReader,\n            IndexOrdinalsFieldData indexFieldData) throws IOException {\n        assert indexReader.leaves().size() > 1;\n\n        final LeafOrdinalsFieldData[] atomicFD = new LeafOrdinalsFieldData[indexReader.leaves().size()];\n        final SortedSetDocValues[] subs = new SortedSetDocValues[indexReader.leaves().size()];\n        for (int i = 0; i < indexReader.leaves().size(); ++i) {\n            atomicFD[i] = new AbstractLeafOrdinalsFieldData(AbstractLeafOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION) {\n                @Override\n                public SortedSetDocValues getOrdinalsValues() {\n                    return DocValues.emptySortedSet();\n                }\n\n                @Override\n                public long ramBytesUsed() {\n                    return 0;\n                }\n\n                @Override\n                public Collection<Accountable> getChildResources() {\n                    return Collections.emptyList();\n                }\n\n                @Override\n                public void close() {\n                }\n            };\n            subs[i] = atomicFD[i].getOrdinalsValues();\n        }\n        final OrdinalMap ordinalMap = OrdinalMap.build(null, subs, PackedInts.DEFAULT);\n        return new GlobalOrdinalsIndexFieldData(indexSettings, indexFieldData.getFieldName(), indexFieldData.getValuesSourceType(),\n                atomicFD, ordinalMap, 0, AbstractLeafOrdinalsFieldData.DEFAULT_SCRIPT_FUNCTION\n        );\n    }\n","realPath":"server/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":81,"status":"M"}],"commitId":"2c5c478875ee5e7534a13fe8c88368602a7ff437","commitMessage":"@@@Merge branch 'master' into feature/runtime_fields\n","date":"2020-07-20 22:44:31","modifiedFileCount":"143","status":"M","submitter":"Luca Cavanna"}]
