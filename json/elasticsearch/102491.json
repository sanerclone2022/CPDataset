[{"authorTime":"2018-04-26 03:22:53","codes":[{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    public void testSimpleOperations() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(false));\n        getResult.release();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        getResult = engine.get(newGet(false, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(false));\n        getResult.release();\n\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        getResult = engine.get(newGet(false, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_2), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_2, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(false));\n        getResult.release();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","date":"2018-04-26 03:22:53","endLine":970,"groupId":"13920","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testSimpleOperations","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ea/4b53f16c0031978564b8ac55007607824634ea.src","preCode":"    public void testSimpleOperations() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(false));\n        getResult.release();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        getResult = engine.get(newGet(false, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(false));\n        getResult.release();\n\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        getResult = engine.get(newGet(false, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_2), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_2, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(false));\n        getResult.release();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":812,"status":"B"},{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    public void testSearchResultRelease() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","date":"2018-04-26 03:22:53","endLine":1007,"groupId":"14878","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testSearchResultRelease","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ea/4b53f16c0031978564b8ac55007607824634ea.src","preCode":"    public void testSearchResultRelease() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":972,"status":"B"}],"commitId":"d74fb9eb4559077e2d20b19a9ed62d9ff825027a","commitMessage":"@@@Opened x-pack ILM code\n","date":"2018-04-26 03:22:53","modifiedFileCount":"0","status":"B","submitter":"Tal Levy"},{"authorTime":"2018-04-26 03:22:53","codes":[{"authorDate":"2018-05-29 16:47:43","commitOrder":2,"curCode":"    public void testSimpleOperations() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_2), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_2, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","date":"2018-05-29 16:47:43","endLine":971,"groupId":"13920","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testSimpleOperations","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/26/da424460ef2a3edb6acbd57aecaf08535475a3.src","preCode":"    public void testSimpleOperations() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(false));\n        getResult.release();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        getResult = engine.get(newGet(false, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(false));\n        getResult.release();\n\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        getResult = engine.get(newGet(false, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_2), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_2, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(false));\n        getResult.release();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        getResult = engine.get(newGet(true, doc), searcherFactory);\n        assertThat(getResult.exists(), equalTo(true));\n        assertThat(getResult.docIdAndVersion(), notNullValue());\n        getResult.release();\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":814,"status":"M"},{"authorDate":"2018-04-26 03:22:53","commitOrder":2,"curCode":"    public void testSearchResultRelease() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","date":"2018-04-26 03:22:53","endLine":1007,"groupId":"14878","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testSearchResultRelease","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ea/4b53f16c0031978564b8ac55007607824634ea.src","preCode":"    public void testSearchResultRelease() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":972,"status":"N"}],"commitId":"2ccb4df00512e19734f3e5ef003302f336752624","commitMessage":"@@@Merge branch 'master' into index-lifecycle\n","date":"2018-05-29 16:47:43","modifiedFileCount":"42","status":"M","submitter":"Colin Goodheart-Smithe"},{"authorTime":"2018-04-26 03:22:53","codes":[{"authorDate":"2019-07-05 04:48:48","commitOrder":3,"curCode":"    public void testSimpleOperations() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Engine.Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_2), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_2, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","date":"2019-07-05 04:48:48","endLine":1089,"groupId":"13920","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testSimpleOperations","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/52/59829de89f7053da6255fa2fd6e049ade7e042.src","preCode":"    public void testSimpleOperations() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_2), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_2, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":914,"status":"M"},{"authorDate":"2018-04-26 03:22:53","commitOrder":3,"curCode":"    public void testSearchResultRelease() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","date":"2018-04-26 03:22:53","endLine":1007,"groupId":"14878","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testSearchResultRelease","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ea/4b53f16c0031978564b8ac55007607824634ea.src","preCode":"    public void testSearchResultRelease() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":972,"status":"N"}],"commitId":"399d53e5c03ae4157d9ba107d01fbecfed758972","commitMessage":"@@@Refactor index engines to manage readers instead of searchers (#43860)\n\nThis commit changes the way we manage refreshes in the index engines.\nInstead of relying on a SearcherManager.  this change uses a ReaderManager that\ncreates ElasticsearchDirectoryReader when needed. Searchers are now created on-demand\n(when acquireSearcher is called) from the current ElasticsearchDirectoryReader.\nIt also slightly changes the Engine.Searcher to extend IndexSearcher in order\nto simplify the usage in the consumer.\n","date":"2019-07-05 04:48:48","modifiedFileCount":"33","status":"M","submitter":"Jim Ferenczi"},{"authorTime":"2019-10-15 16:05:29","codes":[{"authorDate":"2019-10-15 16:05:29","commitOrder":4,"curCode":"    public void testSimpleOperations() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Engine.Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_2), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_2, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","date":"2019-10-15 16:05:29","endLine":1098,"groupId":"13920","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"testSimpleOperations","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/95/bfa4a03c6989ccf471184a5a4d19ca304b6c11.src","preCode":"    public void testSimpleOperations() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Engine.Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_2), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_2, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":923,"status":"M"},{"authorDate":"2019-10-15 16:05:29","commitOrder":4,"curCode":"    public void testSearchResultRelease() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","date":"2019-10-15 16:05:29","endLine":1138,"groupId":"5736","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testSearchResultRelease","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/95/bfa4a03c6989ccf471184a5a4d19ca304b6c11.src","preCode":"    public void testSearchResultRelease() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"test\", \"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":1100,"status":"M"}],"commitId":"6531369f11d159896957b75a7eae0b7da214d01a","commitMessage":"@@@Don't persist type information to translog (#47229)\n\nWe no longer need to store type information in the translog.  given that an index\ncan only have a single type.\n\nRelates to #41059","date":"2019-10-15 16:05:29","modifiedFileCount":"100","status":"M","submitter":"Alan Woodward"},{"authorTime":"2019-10-31 02:08:35","codes":[{"authorDate":"2019-10-31 02:08:35","commitOrder":5,"curCode":"    public void testSimpleOperations() throws Exception {\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Engine.Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_2), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_2, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","date":"2019-10-31 02:08:35","endLine":1102,"groupId":"13920","id":9,"instanceNumber":1,"isCurCommit":0,"methodName":"testSimpleOperations","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/2b/eced43a012cc79ce30b04f88b74c5a95b443ff.src","preCode":"    public void testSimpleOperations() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Engine.Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_2), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_2, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":926,"status":"M"},{"authorDate":"2019-10-31 02:08:35","commitOrder":5,"curCode":"    public void testSearchResultRelease() throws Exception {\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","date":"2019-10-31 02:08:35","endLine":1143,"groupId":"5736","id":10,"instanceNumber":2,"isCurCommit":0,"methodName":"testSearchResultRelease","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/2b/eced43a012cc79ce30b04f88b74c5a95b443ff.src","preCode":"    public void testSearchResultRelease() throws Exception {\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":1104,"status":"M"}],"commitId":"927cc34eca97c1ee760efd195e72cafa90544a97","commitMessage":"@@@Do not warm up searcher in engine constructor (#48605)\n\nWith this change.  we won't warm up searchers until we externally refresh \nan engine. We explicitly refresh before allowing reading from a shard\n(i.e..  move to post_recovery state) and during resetting. These\nguarantees that we have warmed up the engine before exposing the\nexternal searcher.\n\nAnother prerequisite for #47186.","date":"2019-10-31 02:08:35","modifiedFileCount":"4","status":"M","submitter":"Nhat Nguyen"},{"authorTime":"2019-10-31 02:08:35","codes":[{"authorDate":"2020-11-10 08:38:47","commitOrder":6,"curCode":"    public void testSimpleOperations() throws Exception {\n        final DocumentMapper mapper = docMapper();\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Engine.Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(SOURCE), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, SOURCE, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","date":"2020-11-10 08:38:47","endLine":907,"groupId":"13920","id":11,"instanceNumber":1,"isCurCommit":0,"methodName":"testSimpleOperations","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/12/9bde0b45d76d9ba1290fd579c1e216cc3d149e.src","preCode":"    public void testSimpleOperations() throws Exception {\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Engine.Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_2), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_2, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), searcherFactory)) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":730,"status":"M"},{"authorDate":"2019-10-31 02:08:35","commitOrder":6,"curCode":"    public void testSearchResultRelease() throws Exception {\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","date":"2019-10-31 02:08:35","endLine":1143,"groupId":"5736","id":12,"instanceNumber":2,"isCurCommit":0,"methodName":"testSearchResultRelease","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/2b/eced43a012cc79ce30b04f88b74c5a95b443ff.src","preCode":"    public void testSearchResultRelease() throws Exception {\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":1104,"status":"N"}],"commitId":"33b408ffc931399255b822126746edbd80d14ae7","commitMessage":"@@@Realtime get from in-memory segment when possible (#64504)\n\nIf the reader wrapper is specified.  then we can't perform a realtime get \nusing operations from translog. With this change.  we will create an\nin-memory Lucene segment from that indexing operation and perform a\nrealtime get from that segment to avoid refresh storms.","date":"2020-11-10 08:38:47","modifiedFileCount":"11","status":"M","submitter":"Nhat Nguyen"},{"authorTime":"2019-10-31 02:08:35","codes":[{"authorDate":"2021-05-12 20:50:26","commitOrder":7,"curCode":"    public void testSimpleOperations() throws Exception {\n        MapperService mapperService = createMapperService();\n        final MappingLookup mappingLookup = mapperService.mappingLookup();\n        DocumentParser documentParser = mapperService.documentParser();\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(SOURCE), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, SOURCE, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","date":"2021-05-12 20:50:26","endLine":911,"groupId":"13920","id":13,"instanceNumber":1,"isCurCommit":0,"methodName":"testSimpleOperations","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/e8/8cf005d8c67f5fd36931d438980183ad1a3d90.src","preCode":"    public void testSimpleOperations() throws Exception {\n        final DocumentMapper mapper = docMapper();\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        final BiFunction<String, Engine.SearcherScope, Engine.Searcher> searcherFactory = engine::acquireSearcher;\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(SOURCE), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, SOURCE, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mapper, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":734,"status":"M"},{"authorDate":"2019-10-31 02:08:35","commitOrder":7,"curCode":"    public void testSearchResultRelease() throws Exception {\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","date":"2019-10-31 02:08:35","endLine":1143,"groupId":"5736","id":14,"instanceNumber":2,"isCurCommit":0,"methodName":"testSearchResultRelease","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/2b/eced43a012cc79ce30b04f88b74c5a95b443ff.src","preCode":"    public void testSearchResultRelease() throws Exception {\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":1104,"status":"N"}],"commitId":"4528e780c48ada91fd452b9c51dc1a37772c5f07","commitMessage":"@@@Merge branch 'master' into feature/vector-tiles\n\n# Conflicts:\n#\tx-pack/plugin/spatial/build.gradle\n#\tx-pack/plugin/spatial/src/main/java/org/elasticsearch/xpack/spatial/SpatialPlugin.java\n","date":"2021-05-12 20:50:26","modifiedFileCount":"564","status":"M","submitter":"iverase"},{"authorTime":"2019-10-31 02:08:35","codes":[{"authorDate":"2021-06-24 16:56:30","commitOrder":8,"curCode":"    public void testSimpleOperations() throws Exception {\n        MapperService mapperService = createMapperService();\n        final MappingLookup mappingLookup = mapperService.mappingLookup();\n        DocumentParser documentParser = mapperService.documentParser();\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        LuceneDocument document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(SOURCE), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, SOURCE, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","date":"2021-06-24 16:56:30","endLine":911,"groupId":"102491","id":15,"instanceNumber":1,"isCurCommit":0,"methodName":"testSimpleOperations","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/eb/05b967b24aefcf14dab2426a087c83cc3266a1.src","preCode":"    public void testSimpleOperations() throws Exception {\n        MapperService mapperService = createMapperService();\n        final MappingLookup mappingLookup = mapperService.mappingLookup();\n        DocumentParser documentParser = mapperService.documentParser();\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        Document document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        ParsedDocument doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(false, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(SOURCE), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, SOURCE, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(false));\n        }\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        document = testDocumentWithTextField();\n        document.add(new Field(SourceFieldMapper.NAME, BytesReference.toBytes(B_1), SourceFieldMapper.Defaults.FIELD_TYPE));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(new Engine.Index(newUid(doc), primaryTerm.get(), doc, Versions.MATCH_DELETED));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.flush();\n\n        \r\n        try (Engine.GetResult getResult = engine.get(newGet(true, doc), mappingLookup, documentParser, randomSearcherWrapper())) {\n            assertThat(getResult.exists(), equalTo(true));\n            assertThat(getResult.docIdAndVersion(), notNullValue());\n        }\n\n        \r\n        \r\n        document = testDocument();\n        document.add(new TextField(\"value\", \"test1\", Field.Store.YES));\n        doc = testParsedDocument(\"1\", null, document, B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test1\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":734,"status":"M"},{"authorDate":"2019-10-31 02:08:35","commitOrder":8,"curCode":"    public void testSearchResultRelease() throws Exception {\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","date":"2019-10-31 02:08:35","endLine":1143,"groupId":"102491","id":16,"instanceNumber":2,"isCurCommit":0,"methodName":"testSearchResultRelease","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/2b/eced43a012cc79ce30b04f88b74c5a95b443ff.src","preCode":"    public void testSearchResultRelease() throws Exception {\n        engine.refresh(\"warm_up\");\n        Engine.Searcher searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        searchResult.close();\n\n        \r\n        ParsedDocument doc = testParsedDocument(\"1\", null, testDocumentWithTextField(), B_1, null);\n        engine.index(indexForDoc(doc));\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 0));\n        searchResult.close();\n\n        \r\n        engine.refresh(\"test\");\n\n        \r\n        searchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        \r\n\n        \r\n        engine.delete(new Engine.Delete(\"1\", newUid(doc), primaryTerm.get()));\n        engine.refresh(\"test\");\n        Engine.Searcher updateSearchResult = engine.acquireSearcher(\"test\");\n        MatcherAssert.assertThat(updateSearchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(0));\n        updateSearchResult.close();\n\n        \r\n        MatcherAssert.assertThat(searchResult, EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(1));\n        MatcherAssert.assertThat(searchResult,\n            EngineSearcherTotalHitsMatcher.engineSearcherTotalHits(new TermQuery(new Term(\"value\", \"test\")), 1));\n        searchResult.close();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":1104,"status":"N"}],"commitId":"7cedc3ec3a109f02f54b9e12a7ca8a3470b67e80","commitMessage":"@@@Make Document a top-level class (#74472)\n\nThere is no reason for Document to be an inner class of ParseContext.  especially as it is public and accessed directly from many different places.\n\nThis commit takes it out to its own top-level class file.  which has the advantage of simplifying ParseContext which could use some love too.\n","date":"2021-06-24 16:56:30","modifiedFileCount":"46","status":"M","submitter":"Luca Cavanna"}]
