[{"authorTime":"2018-04-26 03:22:53","codes":[{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        GeoDistanceSortBuilder sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0).setNestedPath(\"path\");\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(TypeFieldMapper.NAME, \"__path\")), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0).setNestedPath(\"path\")\n                .setNestedFilter(QueryBuilders.matchAllQuery());\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        \r\n        \r\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0).setNestedFilter(QueryBuilders.termQuery(\"fieldName\", \"value\"));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField, instanceOf(SortField.class));\n    }\n","date":"2018-04-26 03:22:53","endLine":540,"groupId":"40098","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testBuildNested","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/11/09bdfc1f1a108634f94e2f03ba5006b1d36445.src","preCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        GeoDistanceSortBuilder sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0).setNestedPath(\"path\");\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(TypeFieldMapper.NAME, \"__path\")), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0).setNestedPath(\"path\")\n                .setNestedFilter(QueryBuilders.matchAllQuery());\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        \r\n        \r\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0).setNestedFilter(QueryBuilders.termQuery(\"fieldName\", \"value\"));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField, instanceOf(SortField.class));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":506,"status":"B"},{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        ScriptSortBuilder sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER).setNestedPath(\"path\");\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(TypeFieldMapper.NAME, \"__path\")), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER).setNestedPath(\"path\")\n                .setNestedFilter(QueryBuilders.matchAllQuery());\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        \r\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n                .setNestedFilter(QueryBuilders.matchAllQuery());\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        assertNull(comparatorSource.nested());\n    }\n","date":"2018-04-26 03:22:53","endLine":347,"groupId":"40098","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testBuildNested","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ed/83011c26609e5fddf0acad50cfff4aead3c2e8.src","preCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        ScriptSortBuilder sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER).setNestedPath(\"path\");\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(TypeFieldMapper.NAME, \"__path\")), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER).setNestedPath(\"path\")\n                .setNestedFilter(QueryBuilders.matchAllQuery());\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        \r\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n                .setNestedFilter(QueryBuilders.matchAllQuery());\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        assertNull(comparatorSource.nested());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":311,"status":"B"}],"commitId":"d74fb9eb4559077e2d20b19a9ed62d9ff825027a","commitMessage":"@@@Opened x-pack ILM code\n","date":"2018-04-26 03:22:53","modifiedFileCount":"0","status":"B","submitter":"Tal Levy"},{"authorTime":"2019-06-27 23:30:02","codes":[{"authorDate":"2019-06-27 23:30:02","commitOrder":2,"curCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        GeoDistanceSortBuilder sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n            .setNestedSort(new NestedSortBuilder(\"path\"));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(TypeFieldMapper.NAME, \"__path\")), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n            .setNestedSort(new NestedSortBuilder(\"path\")\n                .setFilter(QueryBuilders.matchAllQuery())\n            );\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n    }\n","date":"2019-06-27 23:30:02","endLine":510,"groupId":"40098","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testBuildNested","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/73/be5837faa90654cf82aa008206950f5e7bbb95.src","preCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        GeoDistanceSortBuilder sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0).setNestedPath(\"path\");\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(TypeFieldMapper.NAME, \"__path\")), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0).setNestedPath(\"path\")\n                .setNestedFilter(QueryBuilders.matchAllQuery());\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        \r\n        \r\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0).setNestedFilter(QueryBuilders.termQuery(\"fieldName\", \"value\"));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField, instanceOf(SortField.class));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":479,"status":"M"},{"authorDate":"2019-06-27 23:30:02","commitOrder":2,"curCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        ScriptSortBuilder sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n            .setNestedSort(new NestedSortBuilder(\"path\"));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(TypeFieldMapper.NAME, \"__path\")), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n            .setNestedSort(new NestedSortBuilder(\"path\")\n                .setFilter(QueryBuilders.matchAllQuery()));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n    }\n","date":"2019-06-27 23:30:02","endLine":345,"groupId":"40098","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testBuildNested","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/1d/3b71bbf40dbd2c4c6775099ade86b61fe7b73d.src","preCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        ScriptSortBuilder sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER).setNestedPath(\"path\");\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(TypeFieldMapper.NAME, \"__path\")), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER).setNestedPath(\"path\")\n                .setNestedFilter(QueryBuilders.matchAllQuery());\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        \r\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n                .setNestedFilter(QueryBuilders.matchAllQuery());\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        assertNull(comparatorSource.nested());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":315,"status":"M"}],"commitId":"a6144158384876d259e59986af7c2fd14b67f6cc","commitMessage":"@@@Remove deprecated sort options: nested_path and nested_filter (#42809)\n\nThis commit removes the nested_path and nested_filter options deprecated in 6x.\nThis change also checks that the sort field has a [nested] option if it is under a nested\nobject and throws an exception if it's not the case.\n\nCloses #27098","date":"2019-06-27 23:30:02","modifiedFileCount":"13","status":"M","submitter":"Jim Ferenczi"},{"authorTime":"2020-01-23 00:31:34","codes":[{"authorDate":"2020-01-23 00:31:34","commitOrder":3,"curCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        GeoDistanceSortBuilder sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n            .setNestedSort(new NestedSortBuilder(\"path\"));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(NestedPathFieldMapper.NAME, \"path\")), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n            .setNestedSort(new NestedSortBuilder(\"path\")\n                .setFilter(QueryBuilders.matchAllQuery())\n            );\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n    }\n","date":"2020-01-23 00:31:34","endLine":510,"groupId":"40098","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testBuildNested","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ff/5444766f6e4167e1783500feaee1a281fed9ce.src","preCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        GeoDistanceSortBuilder sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n            .setNestedSort(new NestedSortBuilder(\"path\"));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(TypeFieldMapper.NAME, \"__path\")), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n            .setNestedSort(new NestedSortBuilder(\"path\")\n                .setFilter(QueryBuilders.matchAllQuery())\n            );\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":479,"status":"M"},{"authorDate":"2020-01-23 00:31:34","commitOrder":3,"curCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        ScriptSortBuilder sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n            .setNestedSort(new NestedSortBuilder(\"path\"));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(NestedPathFieldMapper.NAME, \"path\")), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n            .setNestedSort(new NestedSortBuilder(\"path\")\n                .setFilter(QueryBuilders.matchAllQuery()));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n    }\n","date":"2020-01-23 00:31:34","endLine":346,"groupId":"40098","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testBuildNested","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/10/99d442a3fde574e558664a62936cfa8a31c444.src","preCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        ScriptSortBuilder sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n            .setNestedSort(new NestedSortBuilder(\"path\"));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(TypeFieldMapper.NAME, \"__path\")), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n            .setNestedSort(new NestedSortBuilder(\"path\")\n                .setFilter(QueryBuilders.matchAllQuery()));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":316,"status":"M"}],"commitId":"1dc9dd42235e876fde8c3b31934f1bc88d668896","commitMessage":"@@@Add NestedPathFieldMapper to store nested path information (#51100)\n\nCurrently nested documents repurpose the _type field to store their nested paths.\nThis commit adds a dedicated _nested_path field instead.  which decouples this\ninformation from types and will allow the removal of the _type field entirely further\ndown the line. To preserve backwards compatibility.  references to this field are\nmediated via methods that take an index settings object.  and indexes created before\n8x still use the _type field.\n\nRelates to #41059\nCloses #24362","date":"2020-01-23 00:31:34","modifiedFileCount":"21","status":"M","submitter":"Alan Woodward"},{"authorTime":"2021-01-15 01:11:59","codes":[{"authorDate":"2021-01-15 01:11:59","commitOrder":4,"curCode":"    public void testBuildNested() throws IOException {\n        SearchExecutionContext searchExecutionContext = createMockSearchExecutionContext();\n\n        GeoDistanceSortBuilder sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(searchExecutionContext).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n            .setNestedSort(new NestedSortBuilder(\"path\"));\n        sortField = sortBuilder.build(searchExecutionContext).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(NestedPathFieldMapper.NAME, \"path\")), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n            .setNestedSort(new NestedSortBuilder(\"path\")\n                .setFilter(QueryBuilders.matchAllQuery())\n            );\n        sortField = sortBuilder.build(searchExecutionContext).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n    }\n","date":"2021-01-15 01:11:59","endLine":508,"groupId":"104522","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"testBuildNested","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/c0/335e5dcef5ae2edb57461f44a5156cb4eff554.src","preCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        GeoDistanceSortBuilder sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n            .setNestedSort(new NestedSortBuilder(\"path\"));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(NestedPathFieldMapper.NAME, \"path\")), nested.getInnerQuery());\n\n        sortBuilder = new GeoDistanceSortBuilder(\"fieldName\", 1.0, 1.0)\n            .setNestedSort(new NestedSortBuilder(\"path\")\n                .setFilter(QueryBuilders.matchAllQuery())\n            );\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":477,"status":"M"},{"authorDate":"2021-01-15 01:11:59","commitOrder":4,"curCode":"    public void testBuildNested() throws IOException {\n        SearchExecutionContext searchExecutionContext = createMockSearchExecutionContext();\n\n        ScriptSortBuilder sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(searchExecutionContext).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n            .setNestedSort(new NestedSortBuilder(\"path\"));\n        sortField = sortBuilder.build(searchExecutionContext).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(NestedPathFieldMapper.NAME, \"path\")), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n            .setNestedSort(new NestedSortBuilder(\"path\")\n                .setFilter(QueryBuilders.matchAllQuery()));\n        sortField = sortBuilder.build(searchExecutionContext).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n    }\n","date":"2021-01-15 01:11:59","endLine":346,"groupId":"104522","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testBuildNested","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/b8/fb8ba6a42b69c77bc4e299deb6359eebf411a5.src","preCode":"    public void testBuildNested() throws IOException {\n        QueryShardContext shardContextMock = createMockShardContext();\n\n        ScriptSortBuilder sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n                .setNestedSort(new NestedSortBuilder(\"path\").setFilter(QueryBuilders.matchAllQuery()));\n        SortField sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        XFieldComparatorSource comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        Nested nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n            .setNestedSort(new NestedSortBuilder(\"path\"));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new TermQuery(new Term(NestedPathFieldMapper.NAME, \"path\")), nested.getInnerQuery());\n\n        sortBuilder = new ScriptSortBuilder(mockScript(MOCK_SCRIPT_NAME), ScriptSortType.NUMBER)\n            .setNestedSort(new NestedSortBuilder(\"path\")\n                .setFilter(QueryBuilders.matchAllQuery()));\n        sortField = sortBuilder.build(shardContextMock).field;\n        assertThat(sortField.getComparatorSource(), instanceOf(XFieldComparatorSource.class));\n        comparatorSource = (XFieldComparatorSource) sortField.getComparatorSource();\n        nested = comparatorSource.nested();\n        assertNotNull(nested);\n        assertEquals(new MatchAllDocsQuery(), nested.getInnerQuery());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":316,"status":"M"}],"commitId":"5852fbedf52c77b0a76c2c731fdd4982fb65cd87","commitMessage":"@@@Rename QueryShardContext -> SearchExecutionContext. (#67490)\n\nWe decided to rename `QueryShardContext` to clarify that it supports all parts\nof search request execution. Before there was confusion over whether it should\nonly be used for building queries.  or maybe only used in the query phase. This\nPR also updates the javadocs.\n\nCloses #64740.","date":"2021-01-15 01:11:59","modifiedFileCount":"357","status":"M","submitter":"Julie Tibshirani"}]
