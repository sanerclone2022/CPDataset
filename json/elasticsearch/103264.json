[{"authorTime":"2020-07-29 01:14:40","codes":[{"authorDate":"2020-07-29 01:14:40","commitOrder":1,"curCode":"    public void testCoordinatingPrimaryRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1024 * 3);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1024 * 3, false)) {\n            if (randomBoolean()) {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markCoordinatingOperationStarted(1024 * 2));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getCoordinatingRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            } else {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markPrimaryOperationStarted(1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getPrimaryRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            }\n            long preForceRejections = indexingPressure.stats().getPrimaryRejections();\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1024 * 2, true);\n            assertEquals(preForceRejections, indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 8, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            forced.close();\n\n            \r\n            IndexingPressureStats preLocalStats = indexingPressure.stats();\n            Releasable local = indexingPressure.markPrimaryOperationLocalToCoordinatingNodeStarted(1024 * 2);\n            assertEquals(preLocalStats.getPrimaryRejections(), indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 6, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            assertEquals(preLocalStats.getCurrentPrimaryBytes() + 1024 * 2, indexingPressure.stats().getCurrentPrimaryBytes());\n            local.close();\n        }\n\n        assertEquals(1024 * 8, indexingPressure.stats().getTotalCombinedCoordinatingAndPrimaryBytes());\n    }\n","date":"2020-07-29 01:42:59","endLine":108,"groupId":"70739","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testCoordinatingPrimaryRejections","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ad/4c78ad730cb3a5190077100467c9a893c1db82.src","preCode":"    public void testCoordinatingPrimaryRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1024 * 3);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1024 * 3, false)) {\n            if (randomBoolean()) {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markCoordinatingOperationStarted(1024 * 2));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getCoordinatingRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            } else {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markPrimaryOperationStarted(1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getPrimaryRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            }\n            long preForceRejections = indexingPressure.stats().getPrimaryRejections();\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1024 * 2, true);\n            assertEquals(preForceRejections, indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 8, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            forced.close();\n\n            \r\n            IndexingPressureStats preLocalStats = indexingPressure.stats();\n            Releasable local = indexingPressure.markPrimaryOperationLocalToCoordinatingNodeStarted(1024 * 2);\n            assertEquals(preLocalStats.getPrimaryRejections(), indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 6, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            assertEquals(preLocalStats.getCurrentPrimaryBytes() + 1024 * 2, indexingPressure.stats().getCurrentPrimaryBytes());\n            local.close();\n        }\n\n        assertEquals(1024 * 8, indexingPressure.stats().getTotalCombinedCoordinatingAndPrimaryBytes());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/IndexingPressureTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":75,"status":"B"},{"authorDate":"2020-07-29 01:14:40","commitOrder":1,"curCode":"    public void testReplicaRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1024 * 3);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1024 * 3, false)) {\n            \r\n            Releasable replica2 = indexingPressure.markReplicaOperationStarted(1024 * 11, false);\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            \r\n            expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markReplicaOperationStarted(1024 * 2, false));\n            IndexingPressureStats stats = indexingPressure.stats();\n            assertEquals(1, stats.getReplicaRejections());\n            assertEquals(1024 * 14, stats.getCurrentReplicaBytes());\n\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1024 * 2, true);\n            assertEquals(1, indexingPressure.stats().getReplicaRejections());\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            forced.close();\n\n            replica2.close();\n            forced.close();\n        }\n\n        assertEquals(1024 * 14, indexingPressure.stats().getTotalReplicaBytes());\n    }\n","date":"2020-07-29 01:42:59","endLine":135,"groupId":"16903","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testReplicaRejections","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/ad/4c78ad730cb3a5190077100467c9a893c1db82.src","preCode":"    public void testReplicaRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1024 * 3);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1024 * 3, false)) {\n            \r\n            Releasable replica2 = indexingPressure.markReplicaOperationStarted(1024 * 11, false);\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            \r\n            expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markReplicaOperationStarted(1024 * 2, false));\n            IndexingPressureStats stats = indexingPressure.stats();\n            assertEquals(1, stats.getReplicaRejections());\n            assertEquals(1024 * 14, stats.getCurrentReplicaBytes());\n\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1024 * 2, true);\n            assertEquals(1, indexingPressure.stats().getReplicaRejections());\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            forced.close();\n\n            replica2.close();\n            forced.close();\n        }\n\n        assertEquals(1024 * 14, indexingPressure.stats().getTotalReplicaBytes());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/IndexingPressureTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":110,"status":"B"}],"commitId":"e3bbb3bed4ed9430ab43eb4a3e8276ae503c13ab","commitMessage":"@@@Merge branch 'master' into feature/runtime_fields\n","date":"2020-07-29 01:42:59","modifiedFileCount":"261","status":"B","submitter":"Nik Everett"},{"authorTime":"2020-09-23 02:14:45","codes":[{"authorDate":"2020-09-23 02:14:45","commitOrder":2,"curCode":"    public void testCoordinatingPrimaryRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1024 * 3, false);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1024 * 3, false)) {\n            if (randomBoolean()) {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markCoordinatingOperationStarted(1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getCoordinatingRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            } else {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markPrimaryOperationStarted(1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getPrimaryRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            }\n            long preForceRejections = indexingPressure.stats().getPrimaryRejections();\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1024 * 2, true);\n            assertEquals(preForceRejections, indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 8, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            forced.close();\n\n            \r\n            IndexingPressureStats preLocalStats = indexingPressure.stats();\n            Releasable local = indexingPressure.markPrimaryOperationLocalToCoordinatingNodeStarted(1024 * 2);\n            assertEquals(preLocalStats.getPrimaryRejections(), indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 6, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            assertEquals(preLocalStats.getCurrentPrimaryBytes() + 1024 * 2, indexingPressure.stats().getCurrentPrimaryBytes());\n            local.close();\n        }\n\n        assertEquals(1024 * 8, indexingPressure.stats().getTotalCombinedCoordinatingAndPrimaryBytes());\n    }\n","date":"2020-09-23 02:14:45","endLine":108,"groupId":"70739","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testCoordinatingPrimaryRejections","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/6c/fcc4f329c961d29e22fb73cb5b05972be90a07.src","preCode":"    public void testCoordinatingPrimaryRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1024 * 3);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1024 * 3, false)) {\n            if (randomBoolean()) {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markCoordinatingOperationStarted(1024 * 2));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getCoordinatingRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            } else {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markPrimaryOperationStarted(1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getPrimaryRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            }\n            long preForceRejections = indexingPressure.stats().getPrimaryRejections();\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1024 * 2, true);\n            assertEquals(preForceRejections, indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 8, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            forced.close();\n\n            \r\n            IndexingPressureStats preLocalStats = indexingPressure.stats();\n            Releasable local = indexingPressure.markPrimaryOperationLocalToCoordinatingNodeStarted(1024 * 2);\n            assertEquals(preLocalStats.getPrimaryRejections(), indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 6, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            assertEquals(preLocalStats.getCurrentPrimaryBytes() + 1024 * 2, indexingPressure.stats().getCurrentPrimaryBytes());\n            local.close();\n        }\n\n        assertEquals(1024 * 8, indexingPressure.stats().getTotalCombinedCoordinatingAndPrimaryBytes());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/IndexingPressureTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":75,"status":"M"},{"authorDate":"2020-09-23 02:14:45","commitOrder":2,"curCode":"    public void testReplicaRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1024 * 3, false);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1024 * 3, false)) {\n            \r\n            Releasable replica2 = indexingPressure.markReplicaOperationStarted(1024 * 11, false);\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            \r\n            expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markReplicaOperationStarted(1024 * 2, false));\n            IndexingPressureStats stats = indexingPressure.stats();\n            assertEquals(1, stats.getReplicaRejections());\n            assertEquals(1024 * 14, stats.getCurrentReplicaBytes());\n\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1024 * 2, true);\n            assertEquals(1, indexingPressure.stats().getReplicaRejections());\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            forced.close();\n\n            replica2.close();\n            forced.close();\n        }\n\n        assertEquals(1024 * 14, indexingPressure.stats().getTotalReplicaBytes());\n    }\n","date":"2020-09-23 02:14:45","endLine":135,"groupId":"16903","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testReplicaRejections","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/6c/fcc4f329c961d29e22fb73cb5b05972be90a07.src","preCode":"    public void testReplicaRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1024 * 3);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1024 * 3, false)) {\n            \r\n            Releasable replica2 = indexingPressure.markReplicaOperationStarted(1024 * 11, false);\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            \r\n            expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markReplicaOperationStarted(1024 * 2, false));\n            IndexingPressureStats stats = indexingPressure.stats();\n            assertEquals(1, stats.getReplicaRejections());\n            assertEquals(1024 * 14, stats.getCurrentReplicaBytes());\n\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1024 * 2, true);\n            assertEquals(1, indexingPressure.stats().getReplicaRejections());\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            forced.close();\n\n            replica2.close();\n            forced.close();\n        }\n\n        assertEquals(1024 * 14, indexingPressure.stats().getTotalReplicaBytes());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/IndexingPressureTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":110,"status":"M"}],"commitId":"242083a36e02496aae9214dc41b89372022e7076","commitMessage":"@@@Dedicated threadpool for system index writes (#61655)\n\nThis commit adds a dedicated threadpool for system index write\noperations. The dedicated resources for system index writes serves as\na means to ensure that user activity does not block important system\noperations from occurring such as the management of users and roles.","date":"2020-09-23 02:14:45","modifiedFileCount":"29","status":"M","submitter":"Jay Modi"},{"authorTime":"2020-12-09 03:49:56","codes":[{"authorDate":"2020-12-09 03:49:56","commitOrder":3,"curCode":"    public void testCoordinatingPrimaryRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1, 1024 * 3, false);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1, 1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1, 1024 * 3, false)) {\n            if (randomBoolean()) {\n                expectThrows(EsRejectedExecutionException.class,\n                    () -> indexingPressure.markCoordinatingOperationStarted(1, 1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getCoordinatingRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            } else {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markPrimaryOperationStarted(1, 1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getPrimaryRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            }\n            long preForceRejections = indexingPressure.stats().getPrimaryRejections();\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1, 1024 * 2, true);\n            assertEquals(preForceRejections, indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 8, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            forced.close();\n\n            \r\n            IndexingPressureStats preLocalStats = indexingPressure.stats();\n            Releasable local = indexingPressure.markPrimaryOperationLocalToCoordinatingNodeStarted(1, 1024 * 2);\n            assertEquals(preLocalStats.getPrimaryRejections(), indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 6, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            assertEquals(preLocalStats.getCurrentPrimaryBytes() + 1024 * 2, indexingPressure.stats().getCurrentPrimaryBytes());\n            local.close();\n        }\n\n        assertEquals(1024 * 8, indexingPressure.stats().getTotalCombinedCoordinatingAndPrimaryBytes());\n    }\n","date":"2020-12-09 03:49:56","endLine":122,"groupId":"70739","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testCoordinatingPrimaryRejections","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/b3/119736f508e97eecc3f7ad1cde02834ae9e1d1.src","preCode":"    public void testCoordinatingPrimaryRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1024 * 3, false);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1024 * 3, false)) {\n            if (randomBoolean()) {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markCoordinatingOperationStarted(1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getCoordinatingRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            } else {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markPrimaryOperationStarted(1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getPrimaryRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            }\n            long preForceRejections = indexingPressure.stats().getPrimaryRejections();\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1024 * 2, true);\n            assertEquals(preForceRejections, indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 8, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            forced.close();\n\n            \r\n            IndexingPressureStats preLocalStats = indexingPressure.stats();\n            Releasable local = indexingPressure.markPrimaryOperationLocalToCoordinatingNodeStarted(1024 * 2);\n            assertEquals(preLocalStats.getPrimaryRejections(), indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 6, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            assertEquals(preLocalStats.getCurrentPrimaryBytes() + 1024 * 2, indexingPressure.stats().getCurrentPrimaryBytes());\n            local.close();\n        }\n\n        assertEquals(1024 * 8, indexingPressure.stats().getTotalCombinedCoordinatingAndPrimaryBytes());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/IndexingPressureTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":88,"status":"M"},{"authorDate":"2020-12-09 03:49:56","commitOrder":3,"curCode":"    public void testReplicaRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1, 1024 * 3, false);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1, 1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1, 1024 * 3, false)) {\n            \r\n            Releasable replica2 = indexingPressure.markReplicaOperationStarted(1, 1024 * 11, false);\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            \r\n            expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markReplicaOperationStarted(1, 1024 * 2, false));\n            IndexingPressureStats stats = indexingPressure.stats();\n            assertEquals(1, stats.getReplicaRejections());\n            assertEquals(1024 * 14, stats.getCurrentReplicaBytes());\n\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1, 1024 * 2, true);\n            assertEquals(1, indexingPressure.stats().getReplicaRejections());\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            forced.close();\n\n            replica2.close();\n            forced.close();\n        }\n\n        assertEquals(1024 * 14, indexingPressure.stats().getTotalReplicaBytes());\n    }\n","date":"2020-12-09 03:49:56","endLine":149,"groupId":"16903","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testReplicaRejections","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/b3/119736f508e97eecc3f7ad1cde02834ae9e1d1.src","preCode":"    public void testReplicaRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1024 * 3, false);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1024 * 3, false)) {\n            \r\n            Releasable replica2 = indexingPressure.markReplicaOperationStarted(1024 * 11, false);\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            \r\n            expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markReplicaOperationStarted(1024 * 2, false));\n            IndexingPressureStats stats = indexingPressure.stats();\n            assertEquals(1, stats.getReplicaRejections());\n            assertEquals(1024 * 14, stats.getCurrentReplicaBytes());\n\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1024 * 2, true);\n            assertEquals(1, indexingPressure.stats().getReplicaRejections());\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            forced.close();\n\n            replica2.close();\n            forced.close();\n        }\n\n        assertEquals(1024 * 14, indexingPressure.stats().getTotalReplicaBytes());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/IndexingPressureTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":124,"status":"M"}],"commitId":"c76058d0b3ca1e14ce4126ff6eb2a68b741b90f0","commitMessage":"@@@Track in-progress indexing operations (#65996)\n\nCurrently.  our indexing pressure metrics only track the number of \"bytes\"\nrelated to in-progress indexing requests. This commit introduces tracking of\nthe number of operations. Building out this metrics will add more information\nfor future monitoring and back-pressure.","date":"2020-12-09 03:49:56","modifiedFileCount":"11","status":"M","submitter":"Tim Brooks"},{"authorTime":"2021-01-20 01:48:37","codes":[{"authorDate":"2020-12-09 03:49:56","commitOrder":4,"curCode":"    public void testCoordinatingPrimaryRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1, 1024 * 3, false);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1, 1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1, 1024 * 3, false)) {\n            if (randomBoolean()) {\n                expectThrows(EsRejectedExecutionException.class,\n                    () -> indexingPressure.markCoordinatingOperationStarted(1, 1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getCoordinatingRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            } else {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markPrimaryOperationStarted(1, 1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getPrimaryRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            }\n            long preForceRejections = indexingPressure.stats().getPrimaryRejections();\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1, 1024 * 2, true);\n            assertEquals(preForceRejections, indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 8, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            forced.close();\n\n            \r\n            IndexingPressureStats preLocalStats = indexingPressure.stats();\n            Releasable local = indexingPressure.markPrimaryOperationLocalToCoordinatingNodeStarted(1, 1024 * 2);\n            assertEquals(preLocalStats.getPrimaryRejections(), indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 6, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            assertEquals(preLocalStats.getCurrentPrimaryBytes() + 1024 * 2, indexingPressure.stats().getCurrentPrimaryBytes());\n            local.close();\n        }\n\n        assertEquals(1024 * 8, indexingPressure.stats().getTotalCombinedCoordinatingAndPrimaryBytes());\n    }\n","date":"2020-12-09 03:49:56","endLine":122,"groupId":"103264","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"testCoordinatingPrimaryRejections","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/b3/119736f508e97eecc3f7ad1cde02834ae9e1d1.src","preCode":"    public void testCoordinatingPrimaryRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1, 1024 * 3, false);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1, 1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1, 1024 * 3, false)) {\n            if (randomBoolean()) {\n                expectThrows(EsRejectedExecutionException.class,\n                    () -> indexingPressure.markCoordinatingOperationStarted(1, 1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getCoordinatingRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            } else {\n                expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markPrimaryOperationStarted(1, 1024 * 2, false));\n                IndexingPressureStats stats = indexingPressure.stats();\n                assertEquals(1, stats.getPrimaryRejections());\n                assertEquals(1024 * 6, stats.getCurrentCombinedCoordinatingAndPrimaryBytes());\n            }\n            long preForceRejections = indexingPressure.stats().getPrimaryRejections();\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1, 1024 * 2, true);\n            assertEquals(preForceRejections, indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 8, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            forced.close();\n\n            \r\n            IndexingPressureStats preLocalStats = indexingPressure.stats();\n            Releasable local = indexingPressure.markPrimaryOperationLocalToCoordinatingNodeStarted(1, 1024 * 2);\n            assertEquals(preLocalStats.getPrimaryRejections(), indexingPressure.stats().getPrimaryRejections());\n            assertEquals(1024 * 6, indexingPressure.stats().getCurrentCombinedCoordinatingAndPrimaryBytes());\n            assertEquals(preLocalStats.getCurrentPrimaryBytes() + 1024 * 2, indexingPressure.stats().getCurrentPrimaryBytes());\n            local.close();\n        }\n\n        assertEquals(1024 * 8, indexingPressure.stats().getTotalCombinedCoordinatingAndPrimaryBytes());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/IndexingPressureTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":88,"status":"N"},{"authorDate":"2021-01-20 01:48:37","commitOrder":4,"curCode":"    public void testReplicaRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1, 1024 * 3, false);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1, 1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1, 1024 * 3, false)) {\n            \r\n            Releasable replica2 = indexingPressure.markReplicaOperationStarted(1, 1024 * 11, false);\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            \r\n            expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markReplicaOperationStarted(1, 1024 * 2, false));\n            IndexingPressureStats stats = indexingPressure.stats();\n            assertEquals(1, stats.getReplicaRejections());\n            assertEquals(1024 * 14, stats.getCurrentReplicaBytes());\n\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1, 1024 * 2, true);\n            assertEquals(1, indexingPressure.stats().getReplicaRejections());\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            forced.close();\n            replica2.close();\n        }\n\n        assertEquals(1024 * 14, indexingPressure.stats().getTotalReplicaBytes());\n    }\n","date":"2021-01-20 01:48:37","endLine":147,"groupId":"103264","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testReplicaRejections","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/c1/54b64462402b4360202c7ec8f3e78ec78eb641.src","preCode":"    public void testReplicaRejections() {\n        IndexingPressure indexingPressure = new IndexingPressure(settings);\n        try (Releasable coordinating = indexingPressure.markCoordinatingOperationStarted(1, 1024 * 3, false);\n             Releasable primary = indexingPressure.markPrimaryOperationStarted(1, 1024 * 3, false);\n             Releasable replica = indexingPressure.markReplicaOperationStarted(1, 1024 * 3, false)) {\n            \r\n            Releasable replica2 = indexingPressure.markReplicaOperationStarted(1, 1024 * 11, false);\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            \r\n            expectThrows(EsRejectedExecutionException.class, () -> indexingPressure.markReplicaOperationStarted(1, 1024 * 2, false));\n            IndexingPressureStats stats = indexingPressure.stats();\n            assertEquals(1, stats.getReplicaRejections());\n            assertEquals(1024 * 14, stats.getCurrentReplicaBytes());\n\n            \r\n            Releasable forced = indexingPressure.markPrimaryOperationStarted(1, 1024 * 2, true);\n            assertEquals(1, indexingPressure.stats().getReplicaRejections());\n            assertEquals(1024 * 14, indexingPressure.stats().getCurrentReplicaBytes());\n            forced.close();\n\n            replica2.close();\n            forced.close();\n        }\n\n        assertEquals(1024 * 14, indexingPressure.stats().getTotalReplicaBytes());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/IndexingPressureTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":124,"status":"M"}],"commitId":"f5dfa7b4328710776e1814ee5272d1d55a4984ff","commitMessage":"@@@Ensure IndexingPressure memory is re-adjusted once (#67673)\n\nWe have seen a case where the memory of IndexingPressure was \nre-adjusted twice. With this commit.  we will log that error with a \nstack trace so that we can figure out the source of the issue.","date":"2021-01-20 01:48:37","modifiedFileCount":"2","status":"M","submitter":"Nhat Nguyen"}]
