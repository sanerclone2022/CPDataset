[{"authorTime":"2019-01-23 20:10:11","codes":[{"authorDate":"2019-01-23 20:10:11","commitOrder":2,"curCode":"    public void testCannotSetInitialConfigurationWithoutQuorum() {\n        final Cluster cluster = new Cluster(randomIntBetween(1, 5));\n        final Coordinator coordinator = cluster.getAnyNode().coordinator;\n        final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(\n            Sets.newHashSet(coordinator.getLocalNode().getId(), \"unknown-node\"));\n        final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n            () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n        assertThat(exceptionMessage,\n            startsWith(\"not enough nodes discovered to form a quorum in the initial configuration [knownNodes=[\"));\n        assertThat(exceptionMessage, containsString(\"unknown-node\"));\n        assertThat(exceptionMessage, containsString(coordinator.getLocalNode().toString()));\n\n        \r\n        assertTrue(coordinator.setInitialConfiguration(new VotingConfiguration(Collections.singleton(coordinator.getLocalNode().getId()))));\n        cluster.stabilise();\n    }\n","date":"2019-01-23 20:10:11","endLine":789,"groupId":"39548","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testCannotSetInitialConfigurationWithoutQuorum","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/7d/b63ab120e9170bd6380cd335d02295aeccb8f3.src","preCode":"    public void testCannotSetInitialConfigurationWithoutQuorum() {\n        final Cluster cluster = new Cluster(randomIntBetween(1, 5));\n        final Coordinator coordinator = cluster.getAnyNode().coordinator;\n        final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(\n            Sets.newHashSet(coordinator.getLocalNode().getId(), \"unknown-node\"));\n        final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n            () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n        assertThat(exceptionMessage,\n            startsWith(\"not enough nodes discovered to form a quorum in the initial configuration [knownNodes=[\"));\n        assertThat(exceptionMessage, containsString(\"unknown-node\"));\n        assertThat(exceptionMessage, containsString(coordinator.getLocalNode().toString()));\n\n        \r\n        assertTrue(coordinator.setInitialConfiguration(new VotingConfiguration(Collections.singleton(coordinator.getLocalNode().getId()))));\n        cluster.stabilise();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":774,"status":"MB"},{"authorDate":"2019-01-23 20:10:11","commitOrder":2,"curCode":"    public void testCannotSetInitialConfigurationWithoutLocalNode() {\n        final Cluster cluster = new Cluster(randomIntBetween(1, 5));\n        final Coordinator coordinator = cluster.getAnyNode().coordinator;\n        final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(Sets.newHashSet(\"unknown-node\"));\n        final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n            () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n        assertThat(exceptionMessage,\n            equalTo(\"local node is not part of initial configuration\"));\n    }\n","date":"2019-01-23 20:10:11","endLine":799,"groupId":"53784","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testCannotSetInitialConfigurationWithoutLocalNode","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/7d/b63ab120e9170bd6380cd335d02295aeccb8f3.src","preCode":"    public void testCannotSetInitialConfigurationWithoutLocalNode() {\n        final Cluster cluster = new Cluster(randomIntBetween(1, 5));\n        final Coordinator coordinator = cluster.getAnyNode().coordinator;\n        final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(Sets.newHashSet(\"unknown-node\"));\n        final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n            () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n        assertThat(exceptionMessage,\n            equalTo(\"local node is not part of initial configuration\"));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":791,"status":"B"}],"commitId":"d5139e0590ed044c0950cfede5bac537a3fba2b3","commitMessage":"@@@Only bootstrap and elect node in current voting configuration (#37712)\n\nAdapts bootstrapping and leader election to only trigger on nodes that are actually part of the voting\nconfiguration.","date":"2019-01-23 20:10:11","modifiedFileCount":"4","status":"M","submitter":"Yannick Welsch"},{"authorTime":"2019-07-30 18:46:14","codes":[{"authorDate":"2019-07-30 18:46:14","commitOrder":3,"curCode":"    public void testCannotSetInitialConfigurationWithoutQuorum() {\n        try (Cluster cluster = new Cluster(randomIntBetween(1, 5))) {\n            final Coordinator coordinator = cluster.getAnyNode().coordinator;\n            final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(\n                Sets.newHashSet(coordinator.getLocalNode().getId(), \"unknown-node\"));\n            final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n                () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n            assertThat(exceptionMessage,\n                startsWith(\"not enough nodes discovered to form a quorum in the initial configuration [knownNodes=[\"));\n            assertThat(exceptionMessage, containsString(\"unknown-node\"));\n            assertThat(exceptionMessage, containsString(coordinator.getLocalNode().toString()));\n\n            \r\n            assertTrue(coordinator.setInitialConfiguration(\n                new VotingConfiguration(Collections.singleton(coordinator.getLocalNode().getId()))));\n            cluster.stabilise();\n        }\n    }\n","date":"2019-07-30 18:46:14","endLine":776,"groupId":"39548","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testCannotSetInitialConfigurationWithoutQuorum","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/11/6ad97e34ef1566539592fecbf5ffa3e5e7c072.src","preCode":"    public void testCannotSetInitialConfigurationWithoutQuorum() {\n        final Cluster cluster = new Cluster(randomIntBetween(1, 5));\n        final Coordinator coordinator = cluster.getAnyNode().coordinator;\n        final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(\n            Sets.newHashSet(coordinator.getLocalNode().getId(), \"unknown-node\"));\n        final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n            () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n        assertThat(exceptionMessage,\n            startsWith(\"not enough nodes discovered to form a quorum in the initial configuration [knownNodes=[\"));\n        assertThat(exceptionMessage, containsString(\"unknown-node\"));\n        assertThat(exceptionMessage, containsString(coordinator.getLocalNode().toString()));\n\n        \r\n        assertTrue(coordinator.setInitialConfiguration(new VotingConfiguration(Collections.singleton(coordinator.getLocalNode().getId()))));\n        cluster.stabilise();\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":759,"status":"M"},{"authorDate":"2019-07-30 18:46:14","commitOrder":3,"curCode":"    public void testCannotSetInitialConfigurationWithoutLocalNode() {\n        try (Cluster cluster = new Cluster(randomIntBetween(1, 5))) {\n            final Coordinator coordinator = cluster.getAnyNode().coordinator;\n            final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(Sets.newHashSet(\"unknown-node\"));\n            final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n                () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n            assertThat(exceptionMessage,\n                equalTo(\"local node is not part of initial configuration\"));\n        }\n    }\n","date":"2019-07-30 18:46:14","endLine":787,"groupId":"53784","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testCannotSetInitialConfigurationWithoutLocalNode","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/11/6ad97e34ef1566539592fecbf5ffa3e5e7c072.src","preCode":"    public void testCannotSetInitialConfigurationWithoutLocalNode() {\n        final Cluster cluster = new Cluster(randomIntBetween(1, 5));\n        final Coordinator coordinator = cluster.getAnyNode().coordinator;\n        final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(Sets.newHashSet(\"unknown-node\"));\n        final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n            () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n        assertThat(exceptionMessage,\n            equalTo(\"local node is not part of initial configuration\"));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":778,"status":"M"}],"commitId":"3e8ccf9ba422e5621702519046637a9d7184f7c7","commitMessage":"@@@Close nodes properly in Coordinator tests (#44967)\n\nToday closing a `ClusterNode` in an `AbstractCoordinatorTestCase` uses\n`onNode()` so has no effect if the node is not in the current list of nodes.\nIt also discards the `Runnable` it creates without having run it.  so has no\neffect anyway.\n\nThis commit makes these tests much stricter about properly closing the nodes\nstarted during `Coordinator` tests.  by tracking the persisted states that are\nopened.  and adds an assertion to catch the trappy requirement that the closing\nnode still belongs to the cluster.","date":"2019-07-30 18:46:14","modifiedFileCount":"5","status":"M","submitter":"David Turner"},{"authorTime":"2019-07-30 18:46:14","codes":[{"authorDate":"2020-04-01 02:05:47","commitOrder":4,"curCode":"    public void testCannotSetInitialConfigurationWithoutQuorum() {\n        try (Cluster cluster = new Cluster(randomIntBetween(1, 5))) {\n            final Coordinator coordinator = cluster.getAnyNode().coordinator;\n            final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(\n                Sets.newHashSet(coordinator.getLocalNode().getId(), \"unknown-node\"));\n            final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n                () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n            assertThat(exceptionMessage,\n                startsWith(\"not enough nodes discovered to form a quorum in the initial configuration [knownNodes=[\"));\n            assertThat(exceptionMessage, containsString(\"unknown-node\"));\n            assertThat(exceptionMessage, containsString(coordinator.getLocalNode().toString()));\n\n            \r\n            assertTrue(coordinator.setInitialConfiguration(VotingConfiguration.of(coordinator.getLocalNode())));\n            cluster.stabilise();\n        }\n    }\n","date":"2020-04-01 02:05:47","endLine":779,"groupId":"102306","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testCannotSetInitialConfigurationWithoutQuorum","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/65/af20e1c32ab8cb0683f1548062f8d98547e8bb.src","preCode":"    public void testCannotSetInitialConfigurationWithoutQuorum() {\n        try (Cluster cluster = new Cluster(randomIntBetween(1, 5))) {\n            final Coordinator coordinator = cluster.getAnyNode().coordinator;\n            final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(\n                Sets.newHashSet(coordinator.getLocalNode().getId(), \"unknown-node\"));\n            final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n                () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n            assertThat(exceptionMessage,\n                startsWith(\"not enough nodes discovered to form a quorum in the initial configuration [knownNodes=[\"));\n            assertThat(exceptionMessage, containsString(\"unknown-node\"));\n            assertThat(exceptionMessage, containsString(coordinator.getLocalNode().toString()));\n\n            \r\n            assertTrue(coordinator.setInitialConfiguration(\n                new VotingConfiguration(Collections.singleton(coordinator.getLocalNode().getId()))));\n            cluster.stabilise();\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":763,"status":"M"},{"authorDate":"2019-07-30 18:46:14","commitOrder":4,"curCode":"    public void testCannotSetInitialConfigurationWithoutLocalNode() {\n        try (Cluster cluster = new Cluster(randomIntBetween(1, 5))) {\n            final Coordinator coordinator = cluster.getAnyNode().coordinator;\n            final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(Sets.newHashSet(\"unknown-node\"));\n            final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n                () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n            assertThat(exceptionMessage,\n                equalTo(\"local node is not part of initial configuration\"));\n        }\n    }\n","date":"2019-07-30 18:46:14","endLine":787,"groupId":"102306","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testCannotSetInitialConfigurationWithoutLocalNode","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/11/6ad97e34ef1566539592fecbf5ffa3e5e7c072.src","preCode":"    public void testCannotSetInitialConfigurationWithoutLocalNode() {\n        try (Cluster cluster = new Cluster(randomIntBetween(1, 5))) {\n            final Coordinator coordinator = cluster.getAnyNode().coordinator;\n            final VotingConfiguration unknownNodeConfiguration = new VotingConfiguration(Sets.newHashSet(\"unknown-node\"));\n            final String exceptionMessage = expectThrows(CoordinationStateRejectedException.class,\n                () -> coordinator.setInitialConfiguration(unknownNodeConfiguration)).getMessage();\n            assertThat(exceptionMessage,\n                equalTo(\"local node is not part of initial configuration\"));\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/cluster/coordination/CoordinatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":778,"status":"N"}],"commitId":"2073d8c4b9003a6d8f3d7fac7cec22d0e5d47aa2","commitMessage":"@@@Use VotingConfiguration#of where possible (#54507)\n\nThis resolves a longstanding TODO in the cluster coordination subsystem.\n\nRelates #32006","date":"2020-04-01 02:05:47","modifiedFileCount":"6","status":"M","submitter":"David Turner"}]
