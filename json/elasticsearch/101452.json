[{"authorTime":"2018-04-26 03:22:53","codes":[{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query, SearchContext searchContext) throws IOException {\n        assertThat(query, instanceOf(HasChildQueryBuilder.LateParsingQuery.class));\n        HasChildQueryBuilder.LateParsingQuery lpq = (HasChildQueryBuilder.LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(searchContext.getQueryShardContext());\n\n            assertNotNull(searchContext);\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            for (InnerHitContextBuilder builder : innerHitBuilders.values()) {\n                builder.build(searchContext, searchContext.innerHits());\n            }\n            assertNotNull(searchContext.innerHits());\n            assertEquals(1, searchContext.innerHits().getInnerHits().size());\n            assertTrue(searchContext.innerHits().getInnerHits().containsKey(queryBuilder.innerHit().getName()));\n            InnerHitsContext.InnerHitSubContext innerHits = searchContext.innerHits()\n                    .getInnerHits().get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.size(), queryBuilder.innerHit().getSize());\n            assertEquals(innerHits.sort().sort.getSort().length, 1);\n            assertEquals(innerHits.sort().sort.getSort()[0].getField(), STRING_FIELD_NAME_2);\n        }\n    }\n","date":"2018-04-26 03:22:53","endLine":166,"groupId":"20687","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(HasParentQueryBuilderqueryBuilder@Queryquery@SearchContextsearchContext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/e2/d45d22ab25d6d6b4a26f1c8e6ba80248ce8162.src","preCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query, SearchContext searchContext) throws IOException {\n        assertThat(query, instanceOf(HasChildQueryBuilder.LateParsingQuery.class));\n        HasChildQueryBuilder.LateParsingQuery lpq = (HasChildQueryBuilder.LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(searchContext.getQueryShardContext());\n\n            assertNotNull(searchContext);\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            for (InnerHitContextBuilder builder : innerHitBuilders.values()) {\n                builder.build(searchContext, searchContext.innerHits());\n            }\n            assertNotNull(searchContext.innerHits());\n            assertEquals(1, searchContext.innerHits().getInnerHits().size());\n            assertTrue(searchContext.innerHits().getInnerHits().containsKey(queryBuilder.innerHit().getName()));\n            InnerHitsContext.InnerHitSubContext innerHits = searchContext.innerHits()\n                    .getInnerHits().get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.size(), queryBuilder.innerHit().getSize());\n            assertEquals(innerHits.sort().sort.getSort().length, 1);\n            assertEquals(innerHits.sort().sort.getSort()[0].getField(), STRING_FIELD_NAME_2);\n        }\n    }\n","realPath":"modules/parent-join/src/test/java/org/elasticsearch/join/query/HasParentQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":141,"status":"B"},{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, SearchContext searchContext) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(searchContext.getQueryShardContext());\n\n            assertNotNull(searchContext);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            for (InnerHitContextBuilder builder : innerHitInternals.values()) {\n                builder.build(searchContext, searchContext.innerHits());\n            }\n            assertNotNull(searchContext.innerHits());\n            assertEquals(1, searchContext.innerHits().getInnerHits().size());\n            assertTrue(searchContext.innerHits().getInnerHits().containsKey(queryBuilder.innerHit().getName()));\n            InnerHitsContext.InnerHitSubContext innerHits = searchContext.innerHits().getInnerHits().get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.size(), queryBuilder.innerHit().getSize());\n            assertEquals(innerHits.sort().sort.getSort().length, 1);\n            assertEquals(innerHits.sort().sort.getSort()[0].getField(), INT_FIELD_NAME);\n        }\n    }\n","date":"2018-04-26 03:22:53","endLine":119,"groupId":"12350","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(NestedQueryBuilderqueryBuilder@Queryquery@SearchContextsearchContext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/a2/e6018d0ef6b194f8a2de82e8e8591dbcbd43e7.src","preCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, SearchContext searchContext) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(searchContext.getQueryShardContext());\n\n            assertNotNull(searchContext);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            for (InnerHitContextBuilder builder : innerHitInternals.values()) {\n                builder.build(searchContext, searchContext.innerHits());\n            }\n            assertNotNull(searchContext.innerHits());\n            assertEquals(1, searchContext.innerHits().getInnerHits().size());\n            assertTrue(searchContext.innerHits().getInnerHits().containsKey(queryBuilder.innerHit().getName()));\n            InnerHitsContext.InnerHitSubContext innerHits = searchContext.innerHits().getInnerHits().get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.size(), queryBuilder.innerHit().getSize());\n            assertEquals(innerHits.sort().sort.getSort().length, 1);\n            assertEquals(innerHits.sort().sort.getSort()[0].getField(), INT_FIELD_NAME);\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":97,"status":"B"}],"commitId":"d74fb9eb4559077e2d20b19a9ed62d9ff825027a","commitMessage":"@@@Opened x-pack ILM code\n","date":"2018-04-26 03:22:53","modifiedFileCount":"0","status":"B","submitter":"Tal Levy"},{"authorTime":"2019-09-12 19:46:23","codes":[{"authorDate":"2019-09-12 19:46:23","commitOrder":2,"curCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query, SearchContext searchContext) throws IOException {\n        assertThat(query, instanceOf(HasChildQueryBuilder.LateParsingQuery.class));\n        HasChildQueryBuilder.LateParsingQuery lpq = (HasChildQueryBuilder.LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(searchContext.getQueryShardContext());\n\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            final InnerHitsContext innerHitsContext = new InnerHitsContext();\n            for (InnerHitContextBuilder builder : innerHitBuilders.values()) {\n                builder.build(searchContext, innerHitsContext);\n            }\n            assertEquals(1, innerHitsContext.getInnerHits().size());\n            assertTrue(innerHitsContext.getInnerHits().containsKey(queryBuilder.innerHit().getName()));\n            InnerHitsContext.InnerHitSubContext innerHits = innerHitsContext.getInnerHits().get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.size(), queryBuilder.innerHit().getSize());\n            assertEquals(innerHits.sort().sort.getSort().length, 1);\n            assertEquals(innerHits.sort().sort.getSort()[0].getField(), STRING_FIELD_NAME_2);\n        }\n    }\n","date":"2019-09-12 19:46:23","endLine":164,"groupId":"20687","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(HasParentQueryBuilderqueryBuilder@Queryquery@SearchContextsearchContext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/01/33b233b4782017444e900ce7917f6c9b0c0524.src","preCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query, SearchContext searchContext) throws IOException {\n        assertThat(query, instanceOf(HasChildQueryBuilder.LateParsingQuery.class));\n        HasChildQueryBuilder.LateParsingQuery lpq = (HasChildQueryBuilder.LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(searchContext.getQueryShardContext());\n\n            assertNotNull(searchContext);\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            for (InnerHitContextBuilder builder : innerHitBuilders.values()) {\n                builder.build(searchContext, searchContext.innerHits());\n            }\n            assertNotNull(searchContext.innerHits());\n            assertEquals(1, searchContext.innerHits().getInnerHits().size());\n            assertTrue(searchContext.innerHits().getInnerHits().containsKey(queryBuilder.innerHit().getName()));\n            InnerHitsContext.InnerHitSubContext innerHits = searchContext.innerHits()\n                    .getInnerHits().get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.size(), queryBuilder.innerHit().getSize());\n            assertEquals(innerHits.sort().sort.getSort().length, 1);\n            assertEquals(innerHits.sort().sort.getSort()[0].getField(), STRING_FIELD_NAME_2);\n        }\n    }\n","realPath":"modules/parent-join/src/test/java/org/elasticsearch/join/query/HasParentQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":141,"status":"M"},{"authorDate":"2019-09-12 19:46:23","commitOrder":2,"curCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, SearchContext searchContext) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(searchContext.getQueryShardContext());\n\n            assertNotNull(searchContext);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            InnerHitsContext innerHitsContext = new InnerHitsContext();\n            for (InnerHitContextBuilder builder : innerHitInternals.values()) {\n                builder.build(searchContext, innerHitsContext);\n            }\n            assertEquals(1, innerHitsContext.getInnerHits().size());\n            assertTrue(innerHitsContext.getInnerHits().containsKey(queryBuilder.innerHit().getName()));\n            InnerHitsContext.InnerHitSubContext innerHits = innerHitsContext.getInnerHits().get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.size(), queryBuilder.innerHit().getSize());\n            assertEquals(innerHits.sort().sort.getSort().length, 1);\n            assertEquals(innerHits.sort().sort.getSort()[0].getField(), INT_FIELD_NAME);\n        }\n    }\n","date":"2019-09-12 19:46:23","endLine":120,"groupId":"12350","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(NestedQueryBuilderqueryBuilder@Queryquery@SearchContextsearchContext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/e5/61db869f2b8ed44e15d5ac850a834dca389f1a.src","preCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, SearchContext searchContext) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(searchContext.getQueryShardContext());\n\n            assertNotNull(searchContext);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            for (InnerHitContextBuilder builder : innerHitInternals.values()) {\n                builder.build(searchContext, searchContext.innerHits());\n            }\n            assertNotNull(searchContext.innerHits());\n            assertEquals(1, searchContext.innerHits().getInnerHits().size());\n            assertTrue(searchContext.innerHits().getInnerHits().containsKey(queryBuilder.innerHit().getName()));\n            InnerHitsContext.InnerHitSubContext innerHits = searchContext.innerHits().getInnerHits().get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.size(), queryBuilder.innerHit().getSize());\n            assertEquals(innerHits.sort().sort.getSort().length, 1);\n            assertEquals(innerHits.sort().sort.getSort()[0].getField(), INT_FIELD_NAME);\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":98,"status":"M"}],"commitId":"328fe4472fadeb00cbc01aea256167deb7ee88bd","commitMessage":"@@@Delay the creation of SubSearchContext to the FetchSubPhase (#46598)\n\nThis change delays the creation of the SubSearchContext for nested and parent/child inner_hits\nto the fetch sub phase in order to ensure that a SearchContext can built entirely from a\nQueryShardContext. This commit also adds a validation step to the inner hits builder that ensures that we fail the request early if the inner hits path is invalid.\n\nRelates #46523","date":"2019-09-12 19:46:23","modifiedFileCount":"14","status":"M","submitter":"Jim Ferenczi"},{"authorTime":"2019-09-24 01:37:15","codes":[{"authorDate":"2019-09-24 01:37:15","commitOrder":3,"curCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(HasChildQueryBuilder.LateParsingQuery.class));\n        HasChildQueryBuilder.LateParsingQuery lpq = (HasChildQueryBuilder.LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(context);\n\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            assertTrue(innerHitBuilders.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitBuilders.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","date":"2019-09-24 01:37:15","endLine":155,"groupId":"25879","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(HasParentQueryBuilderqueryBuilder@Queryquery@QueryShardContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/b0/b07b28ca38f625f8c76dfbe578c71893906a65.src","preCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query, SearchContext searchContext) throws IOException {\n        assertThat(query, instanceOf(HasChildQueryBuilder.LateParsingQuery.class));\n        HasChildQueryBuilder.LateParsingQuery lpq = (HasChildQueryBuilder.LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(searchContext.getQueryShardContext());\n\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            final InnerHitsContext innerHitsContext = new InnerHitsContext();\n            for (InnerHitContextBuilder builder : innerHitBuilders.values()) {\n                builder.build(searchContext, innerHitsContext);\n            }\n            assertEquals(1, innerHitsContext.getInnerHits().size());\n            assertTrue(innerHitsContext.getInnerHits().containsKey(queryBuilder.innerHit().getName()));\n            InnerHitsContext.InnerHitSubContext innerHits = innerHitsContext.getInnerHits().get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.size(), queryBuilder.innerHit().getSize());\n            assertEquals(innerHits.sort().sort.getSort().length, 1);\n            assertEquals(innerHits.sort().sort.getSort()[0].getField(), STRING_FIELD_NAME_2);\n        }\n    }\n","realPath":"modules/parent-join/src/test/java/org/elasticsearch/join/query/HasParentQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":139,"status":"M"},{"authorDate":"2019-09-24 01:37:15","commitOrder":3,"curCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            assertTrue(innerHitInternals.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitInternals.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","date":"2019-09-24 01:37:15","endLine":113,"groupId":"2044","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(NestedQueryBuilderqueryBuilder@Queryquery@QueryShardContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/6e/13e861ccfb1aa9141ee66b71236434dc67b872.src","preCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, SearchContext searchContext) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(searchContext.getQueryShardContext());\n\n            assertNotNull(searchContext);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            InnerHitsContext innerHitsContext = new InnerHitsContext();\n            for (InnerHitContextBuilder builder : innerHitInternals.values()) {\n                builder.build(searchContext, innerHitsContext);\n            }\n            assertEquals(1, innerHitsContext.getInnerHits().size());\n            assertTrue(innerHitsContext.getInnerHits().containsKey(queryBuilder.innerHit().getName()));\n            InnerHitsContext.InnerHitSubContext innerHits = innerHitsContext.getInnerHits().get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.size(), queryBuilder.innerHit().getSize());\n            assertEquals(innerHits.sort().sort.getSort().length, 1);\n            assertEquals(innerHits.sort().sort.getSort()[0].getField(), INT_FIELD_NAME);\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":98,"status":"M"}],"commitId":"4414fccb2765dd24895216636e68aabea2d156ca","commitMessage":"@@@Replace SearchContext with QueryShardContext in query builder tests (#46978)\n\nThis commit replaces the SearchContext used in AbstractQueryTestCase with\na QueryShardContext in order to reduce the visibility of search contexts.\n\nRelates #46523","date":"2019-09-24 01:37:15","modifiedFileCount":"57","status":"M","submitter":"Jim Ferenczi"},{"authorTime":"2019-09-24 01:37:15","codes":[{"authorDate":"2019-10-15 16:44:15","commitOrder":4,"curCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(HasChildQueryBuilder.LateParsingQuery.class));\n        HasChildQueryBuilder.LateParsingQuery lpq = (HasChildQueryBuilder.LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            assertTrue(innerHitBuilders.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitBuilders.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","date":"2019-10-15 16:44:15","endLine":156,"groupId":"56328","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(HasParentQueryBuilderqueryBuilder@Queryquery@QueryShardContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/1a/f3a056d2fb8f9a47c6121353015df37d7bf2e1.src","preCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(HasChildQueryBuilder.LateParsingQuery.class));\n        HasChildQueryBuilder.LateParsingQuery lpq = (HasChildQueryBuilder.LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(context);\n\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            assertTrue(innerHitBuilders.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitBuilders.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","realPath":"modules/parent-join/src/test/java/org/elasticsearch/join/query/HasParentQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":139,"status":"M"},{"authorDate":"2019-09-24 01:37:15","commitOrder":4,"curCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            assertTrue(innerHitInternals.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitInternals.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","date":"2019-09-24 01:37:15","endLine":113,"groupId":"2044","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(NestedQueryBuilderqueryBuilder@Queryquery@QueryShardContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/6e/13e861ccfb1aa9141ee66b71236434dc67b872.src","preCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            assertTrue(innerHitInternals.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitInternals.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":98,"status":"N"}],"commitId":"30d039a7606a2a1140d6e147498684793a111c01","commitMessage":"@@@Revert \"Delay the creation of SubSearchContext to the FetchSubPhase (#46598)\"\n\nThis reverts commit 328fe4472fadeb00cbc01aea256167deb7ee88bd.\n","date":"2019-10-15 16:44:15","modifiedFileCount":"13","status":"M","submitter":"jimczi"},{"authorTime":"2019-09-24 01:37:15","codes":[{"authorDate":"2020-10-19 19:17:48","commitOrder":5,"curCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(LateParsingQuery.class));\n        LateParsingQuery lpq = (LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            assertTrue(innerHitBuilders.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitBuilders.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","date":"2020-10-19 19:17:48","endLine":162,"groupId":"56328","id":9,"instanceNumber":1,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(HasParentQueryBuilderqueryBuilder@Queryquery@QueryShardContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/6f/35f537ff46df9b5d2f0eedc2061a9507fbfc49.src","preCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(HasChildQueryBuilder.LateParsingQuery.class));\n        HasChildQueryBuilder.LateParsingQuery lpq = (HasChildQueryBuilder.LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            assertTrue(innerHitBuilders.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitBuilders.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","realPath":"modules/parent-join/src/test/java/org/elasticsearch/join/query/HasParentQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":145,"status":"M"},{"authorDate":"2019-09-24 01:37:15","commitOrder":5,"curCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            assertTrue(innerHitInternals.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitInternals.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","date":"2019-09-24 01:37:15","endLine":113,"groupId":"2044","id":10,"instanceNumber":2,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(NestedQueryBuilderqueryBuilder@Queryquery@QueryShardContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/6e/13e861ccfb1aa9141ee66b71236434dc67b872.src","preCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            assertTrue(innerHitInternals.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitInternals.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":98,"status":"N"}],"commitId":"70d88ef62d7ea287907c98b3f3263e3b08e60f3f","commitMessage":"@@@Rework parent-join to not require access to DocumentMapper (#63738)\n\nParent joins work using a cluster of field mappers: the join field itself;\na set of subfields that allow multiple relationships between parents and\nchildren to be defined; and a metadata field that acts to only allow a\nsingle join field per index to be defined. The various queries and\naggregations that use this infrastructure retrieve the join field mapper\nvia a static method and then build themselves by pulling individual\nrelationship mappers from this main mapper.\n\nUsing mappers rather than MappedFieldTypes means that we need to\nexpose DocumentMapper at search time.  which is something we are\ntrying to avoid. This commit refactors things so that the join relations\nare encapsulated in a Joiner object.  which lives instead on the\nMappedFieldType associated with the metadata join field. Rather than\nusing the ParentJoinFieldMapper and connected ParentIdFieldMappers. \nwe can now build queries and aggregations using this Joiner object. \nretrieved via the QueryShardContext or AggregationContext using\na static helper method on Joiner itself.","date":"2020-10-19 19:17:48","modifiedFileCount":"16","status":"M","submitter":"Alan Woodward"},{"authorTime":"2021-01-15 01:11:59","codes":[{"authorDate":"2021-01-15 01:11:59","commitOrder":6,"curCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query,\n                                       SearchExecutionContext context) throws IOException {\n        assertThat(query, instanceOf(LateParsingQuery.class));\n        LateParsingQuery lpq = (LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            assertTrue(innerHitBuilders.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitBuilders.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","date":"2021-01-15 01:11:59","endLine":153,"groupId":"101452","id":11,"instanceNumber":1,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(HasParentQueryBuilderqueryBuilder@Queryquery@SearchExecutionContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/2c/cf15e753e59d0ce7457299ade6f9b4c811c8c0.src","preCode":"    protected void doAssertLuceneQuery(HasParentQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(LateParsingQuery.class));\n        LateParsingQuery lpq = (LateParsingQuery) query;\n        assertEquals(queryBuilder.score() ? ScoreMode.Max : ScoreMode.None, lpq.getScoreMode());\n\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (HasParentQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitBuilders = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitBuilders);\n            assertTrue(innerHitBuilders.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitBuilders.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","realPath":"modules/parent-join/src/test/java/org/elasticsearch/join/query/HasParentQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":135,"status":"M"},{"authorDate":"2021-01-15 01:11:59","commitOrder":6,"curCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, SearchExecutionContext context) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            assertTrue(innerHitInternals.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitInternals.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","date":"2021-01-15 01:11:59","endLine":108,"groupId":"101452","id":12,"instanceNumber":2,"isCurCommit":0,"methodName":"doAssertLuceneQuery","params":"(NestedQueryBuilderqueryBuilder@Queryquery@SearchExecutionContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/25/ce9c5920b330a515953ba12e856f6d48d35210.src","preCode":"    protected void doAssertLuceneQuery(NestedQueryBuilder queryBuilder, Query query, QueryShardContext context) throws IOException {\n        assertThat(query, instanceOf(ESToParentBlockJoinQuery.class));\n        \r\n        if (queryBuilder.innerHit() != null) {\n            \r\n            \r\n            queryBuilder = (NestedQueryBuilder) queryBuilder.rewrite(context);\n\n            assertNotNull(context);\n            Map<String, InnerHitContextBuilder> innerHitInternals = new HashMap<>();\n            InnerHitContextBuilder.extractInnerHits(queryBuilder, innerHitInternals);\n            assertTrue(innerHitInternals.containsKey(queryBuilder.innerHit().getName()));\n            InnerHitContextBuilder innerHits = innerHitInternals.get(queryBuilder.innerHit().getName());\n            assertEquals(innerHits.innerHitBuilder(), queryBuilder.innerHit());\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":93,"status":"M"}],"commitId":"5852fbedf52c77b0a76c2c731fdd4982fb65cd87","commitMessage":"@@@Rename QueryShardContext -> SearchExecutionContext. (#67490)\n\nWe decided to rename `QueryShardContext` to clarify that it supports all parts\nof search request execution. Before there was confusion over whether it should\nonly be used for building queries.  or maybe only used in the query phase. This\nPR also updates the javadocs.\n\nCloses #64740.","date":"2021-01-15 01:11:59","modifiedFileCount":"357","status":"M","submitter":"Julie Tibshirani"}]
