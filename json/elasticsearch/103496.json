[{"authorTime":"2018-04-26 03:22:53","codes":[{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    public void testExactOnUnsupportedField() throws Exception {\n        assumeTrue(\"test runs only when at least a type is registered\", getCurrentTypes().length > 0);\n        MatchQueryBuilder query = new MatchQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geo fields do not support exact searching, use dedicated geo queries instead: [mapped_geo_point]\", e.getMessage());\n        query.lenient(true);\n        query.toQuery(context); \r\n    }\n","date":"2018-04-26 03:22:53","endLine":299,"groupId":"69027","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testExactOnUnsupportedField","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/05/a4b99f19d1a7c3b886c31c92293620178d966b.src","preCode":"    public void testExactOnUnsupportedField() throws Exception {\n        assumeTrue(\"test runs only when at least a type is registered\", getCurrentTypes().length > 0);\n        MatchQueryBuilder query = new MatchQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geo fields do not support exact searching, use dedicated geo queries instead: [mapped_geo_point]\", e.getMessage());\n        query.lenient(true);\n        query.toQuery(context); \r\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":291,"status":"B"},{"authorDate":"2018-04-26 03:22:53","commitOrder":1,"curCode":"    public void testGeo() throws Exception {\n        assumeTrue(\"test runs only when at least a type is registered\", getCurrentTypes().length > 0);\n        TermQueryBuilder query = new TermQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geo fields do not support exact searching, use dedicated geo queries instead: [mapped_geo_point]\",\n                e.getMessage());\n    }\n","date":"2018-04-26 03:22:53","endLine":144,"groupId":"69027","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testGeo","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/45/cbd43864f907c1ff8e50028de473f1e789d7d8.src","preCode":"    public void testGeo() throws Exception {\n        assumeTrue(\"test runs only when at least a type is registered\", getCurrentTypes().length > 0);\n        TermQueryBuilder query = new TermQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geo fields do not support exact searching, use dedicated geo queries instead: [mapped_geo_point]\",\n                e.getMessage());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/TermQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":137,"status":"B"}],"commitId":"d74fb9eb4559077e2d20b19a9ed62d9ff825027a","commitMessage":"@@@Opened x-pack ILM code\n","date":"2018-04-26 03:22:53","modifiedFileCount":"0","status":"B","submitter":"Tal Levy"},{"authorTime":"2018-07-27 17:51:09","codes":[{"authorDate":"2018-07-27 17:51:09","commitOrder":2,"curCode":"    public void testExactOnUnsupportedField() throws Exception {\n        MatchQueryBuilder query = new MatchQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geo fields do not support exact searching, use dedicated geo queries instead: [mapped_geo_point]\", e.getMessage());\n        query.lenient(true);\n        query.toQuery(context); \r\n    }\n","date":"2018-07-27 17:51:09","endLine":305,"groupId":"69027","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testExactOnUnsupportedField","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/0d/e9cac885502f8903e07e295b658b65d7596654.src","preCode":"    public void testExactOnUnsupportedField() throws Exception {\n        assumeTrue(\"test runs only when at least a type is registered\", getCurrentTypes().length > 0);\n        MatchQueryBuilder query = new MatchQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geo fields do not support exact searching, use dedicated geo queries instead: [mapped_geo_point]\", e.getMessage());\n        query.lenient(true);\n        query.toQuery(context); \r\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":298,"status":"M"},{"authorDate":"2018-07-27 17:51:09","commitOrder":2,"curCode":"    public void testGeo() throws Exception {\n        TermQueryBuilder query = new TermQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geo fields do not support exact searching, use dedicated geo queries instead: [mapped_geo_point]\",\n                e.getMessage());\n    }\n","date":"2018-07-27 17:51:09","endLine":146,"groupId":"69027","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testGeo","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/68/76d021a0ae93fa8e3d4c9cda0246a69d698a9a.src","preCode":"    public void testGeo() throws Exception {\n        assumeTrue(\"test runs only when at least a type is registered\", getCurrentTypes().length > 0);\n        TermQueryBuilder query = new TermQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geo fields do not support exact searching, use dedicated geo queries instead: [mapped_geo_point]\",\n                e.getMessage());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/TermQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":140,"status":"M"}],"commitId":"dfb277cfb7969ad543a31dea234579d0e886a73a","commitMessage":"@@@Merge branch 'master' into index-lifecycle\n","date":"2018-07-27 17:51:09","modifiedFileCount":"105","status":"M","submitter":"Colin Goodheart-Smithe"},{"authorTime":"2020-04-24 00:40:04","codes":[{"authorDate":"2020-04-24 00:40:04","commitOrder":3,"curCode":"    public void testExactOnUnsupportedField() throws Exception {\n        MatchQueryBuilder query = new MatchQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geometry fields do not support exact searching, use dedicated geometry queries instead: \" +\n            \"[mapped_geo_point]\", e.getMessage());\n        query.lenient(true);\n        query.toQuery(context); \r\n    }\n","date":"2020-04-24 00:40:04","endLine":298,"groupId":"52788","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testExactOnUnsupportedField","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/24/8e9fb03ee5f2d0a6f37ebd66f7b6fc455de4a7.src","preCode":"    public void testExactOnUnsupportedField() throws Exception {\n        MatchQueryBuilder query = new MatchQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geo fields do not support exact searching, use dedicated geo queries instead: [mapped_geo_point]\", e.getMessage());\n        query.lenient(true);\n        query.toQuery(context); \r\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":290,"status":"M"},{"authorDate":"2020-04-24 00:40:04","commitOrder":3,"curCode":"    public void testGeo() throws Exception {\n        TermQueryBuilder query = new TermQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geometry fields do not support exact searching, \"\n                + \"use dedicated geometry queries instead: [mapped_geo_point]\", e.getMessage());\n    }\n","date":"2020-04-24 00:40:04","endLine":143,"groupId":"52788","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testGeo","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/d8/5442b0b40fc864271332ad2ea2efd78cbf40e8.src","preCode":"    public void testGeo() throws Exception {\n        TermQueryBuilder query = new TermQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geo fields do not support exact searching, use dedicated geo queries instead: [mapped_geo_point]\",\n                e.getMessage());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/TermQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":137,"status":"M"}],"commitId":"eb0b2c8f6996ff90becc8875f20ac34b925f5795","commitMessage":"@@@Refactor Spatial Field Mappers (#55621)\n\nThis commit refactors all spatial Field Mappers to a common \nAbstractGeometryFieldMapper that implements shared parameter functionality \n(e.g..  ignore_malformed.  ignore_z_value) and provides a common framework for \noverriding type parsing.  and building in xpack. Common shape functionality is \nimplemented in a new AbstractShapeGeometryFieldMapper that is reused and \noverridden in GeoShapeFieldMapper.  GeoShapeFieldMapperWithDocValues.  \nLegacyGeoShapeFieldMapper.  and ShapeFieldMapper. This abstraction provides a \nreusable foundation for adding new xpack features; such as coordinate reference \nsystem support.","date":"2020-04-24 00:40:04","modifiedFileCount":"30","status":"M","submitter":"Nick Knize"},{"authorTime":"2020-10-13 17:05:43","codes":[{"authorDate":"2020-10-13 17:05:43","commitOrder":4,"curCode":"    public void testExactOnUnsupportedField() throws Exception {\n        MatchQueryBuilder query = new MatchQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        IllegalArgumentException e = expectThrows(IllegalArgumentException.class, () -> query.toQuery(context));\n        assertEquals(\"Field [mapped_geo_point] of type [geo_point] does not support match queries\", e.getMessage());\n        query.lenient(true);\n        assertThat(query.toQuery(context), Matchers.instanceOf(MatchNoDocsQuery.class));\n    }\n","date":"2020-10-13 17:05:43","endLine":298,"groupId":"69027","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"testExactOnUnsupportedField","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/5f/16c0379d90b2591dbff92dd360a786596ff512.src","preCode":"    public void testExactOnUnsupportedField() throws Exception {\n        MatchQueryBuilder query = new MatchQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geometry fields do not support exact searching, use dedicated geometry queries instead: \" +\n            \"[mapped_geo_point]\", e.getMessage());\n        query.lenient(true);\n        query.toQuery(context); \r\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":291,"status":"M"},{"authorDate":"2020-10-13 17:05:43","commitOrder":4,"curCode":"    public void testGeo() throws Exception {\n        TermQueryBuilder query = new TermQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        IllegalArgumentException e = expectThrows(IllegalArgumentException.class, () -> query.toQuery(context));\n        assertEquals(\"Geometry fields do not support exact searching, \"\n                + \"use dedicated geometry queries instead: [mapped_geo_point]\", e.getMessage());\n    }\n","date":"2020-10-13 17:05:43","endLine":155,"groupId":"52788","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testGeo","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/0d/8b145564fec48d49fb215790767e52c8c3ba92.src","preCode":"    public void testGeo() throws Exception {\n        TermQueryBuilder query = new TermQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        QueryShardException e = expectThrows(QueryShardException.class, () -> query.toQuery(context));\n        assertEquals(\"Geometry fields do not support exact searching, \"\n                + \"use dedicated geometry queries instead: [mapped_geo_point]\", e.getMessage());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/TermQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":149,"status":"M"}],"commitId":"f491422e1edf79ea08d5657b5035f4a5ee444442","commitMessage":"@@@Ensure field types consistency on supporting text queries (#63487)\n\nSome supported field types don't support term queries.  and throw exception in their termQuery method. That exception is either an IllegalArgumentException or a QueryShardException. There is logic in MatchQuery that skips the field or not depending on the exception that is thrown.\n\nAlso.  such field types should hold a TextSearchInfo.NONE while that is not always the case.\n\nWith this commit we make the following changes:\n\n- streamline using TextSearchInfo.NONE in all field types that don't support text queries\n- standardize the exception being thrown when a field type does not support term queries to be IllegalArgumentException. Note that this is not a breaking change as both exceptions previously returned translated to 400 status code.\n- Adapt the MatchQuery logic to skip fields that don't support term queries. There is no need to call termQuery passing an empty string and catch exceptions potentially thrown. We can rather check the TextSearchInfo which tells already whether the field supports text queries or not.\n- add a test method to MapperTestCase that verifies the consistency of a field type by verifying that it is not searchable whenever it uses TextSearchInfo.NONE.  while it is otherwise. This is what triggered all of the above changes.","date":"2020-10-13 17:05:43","modifiedFileCount":"41","status":"M","submitter":"Luca Cavanna"},{"authorTime":"2021-01-15 01:11:59","codes":[{"authorDate":"2021-01-15 01:11:59","commitOrder":5,"curCode":"    public void testExactOnUnsupportedField() throws Exception {\n        MatchQueryBuilder query = new MatchQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        SearchExecutionContext context = createSearchExecutionContext();\n        IllegalArgumentException e = expectThrows(IllegalArgumentException.class, () -> query.toQuery(context));\n        assertEquals(\"Field [mapped_geo_point] of type [geo_point] does not support match queries\", e.getMessage());\n        query.lenient(true);\n        assertThat(query.toQuery(context), Matchers.instanceOf(MatchNoDocsQuery.class));\n    }\n","date":"2021-01-15 01:11:59","endLine":298,"groupId":"103496","id":9,"instanceNumber":1,"isCurCommit":0,"methodName":"testExactOnUnsupportedField","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/fe/bef003dadd4ecf44f88693de56c7329680117c.src","preCode":"    public void testExactOnUnsupportedField() throws Exception {\n        MatchQueryBuilder query = new MatchQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        IllegalArgumentException e = expectThrows(IllegalArgumentException.class, () -> query.toQuery(context));\n        assertEquals(\"Field [mapped_geo_point] of type [geo_point] does not support match queries\", e.getMessage());\n        query.lenient(true);\n        assertThat(query.toQuery(context), Matchers.instanceOf(MatchNoDocsQuery.class));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":291,"status":"M"},{"authorDate":"2021-01-15 01:11:59","commitOrder":5,"curCode":"    public void testGeo() throws Exception {\n        TermQueryBuilder query = new TermQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        SearchExecutionContext context = createSearchExecutionContext();\n        IllegalArgumentException e = expectThrows(IllegalArgumentException.class, () -> query.toQuery(context));\n        assertEquals(\"Geometry fields do not support exact searching, \"\n                + \"use dedicated geometry queries instead: [mapped_geo_point]\", e.getMessage());\n    }\n","date":"2021-01-15 01:11:59","endLine":155,"groupId":"103496","id":10,"instanceNumber":2,"isCurCommit":0,"methodName":"testGeo","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/90/098c3d8c73f6233be3aa0529c9ffe4458dd59c.src","preCode":"    public void testGeo() throws Exception {\n        TermQueryBuilder query = new TermQueryBuilder(GEO_POINT_FIELD_NAME, \"2,3\");\n        QueryShardContext context = createShardContext();\n        IllegalArgumentException e = expectThrows(IllegalArgumentException.class, () -> query.toQuery(context));\n        assertEquals(\"Geometry fields do not support exact searching, \"\n                + \"use dedicated geometry queries instead: [mapped_geo_point]\", e.getMessage());\n    }\n","realPath":"server/src/test/java/org/elasticsearch/index/query/TermQueryBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":149,"status":"M"}],"commitId":"5852fbedf52c77b0a76c2c731fdd4982fb65cd87","commitMessage":"@@@Rename QueryShardContext -> SearchExecutionContext. (#67490)\n\nWe decided to rename `QueryShardContext` to clarify that it supports all parts\nof search request execution. Before there was confusion over whether it should\nonly be used for building queries.  or maybe only used in the query phase. This\nPR also updates the javadocs.\n\nCloses #64740.","date":"2021-01-15 01:11:59","modifiedFileCount":"357","status":"M","submitter":"Julie Tibshirani"}]
