[{"authorTime":"2021-09-13 22:00:36","codes":[{"authorDate":"2021-09-13 22:00:36","commitOrder":1,"curCode":"    public void testQueryWithoutAnyFetch() {\n        Map<SearchShardTarget, SearchProfileQueryPhaseResult> searchPhase = randomSearchPhaseResults();\n        FetchSearchResult fetchPhase = fetchResult(searchPhase.keySet().iterator().next(), null);\n        SearchProfileResults result = builder(searchPhase).build(List.of(fetchPhase));\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getQueryPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n        assertThat(result.getShardResults().values().stream().filter(r -> r.getFetchPhase() != null).count(), equalTo(0L));\n    }\n","date":"2021-09-13 22:00:36","endLine":51,"groupId":"28327","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testQueryWithoutAnyFetch","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/45/095245934d59ce2f6d8f49775b9e5895c1e7a4.src","preCode":"    public void testQueryWithoutAnyFetch() {\n        Map<SearchShardTarget, SearchProfileQueryPhaseResult> searchPhase = randomSearchPhaseResults();\n        FetchSearchResult fetchPhase = fetchResult(searchPhase.keySet().iterator().next(), null);\n        SearchProfileResults result = builder(searchPhase).build(List.of(fetchPhase));\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getQueryPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n        assertThat(result.getShardResults().values().stream().filter(r -> r.getFetchPhase() != null).count(), equalTo(0L));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/profile/SearchProfileResultsBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":42,"status":"B"},{"authorDate":"2021-09-13 22:00:36","commitOrder":1,"curCode":"    public void testQueryAndFetch() {\n        Map<SearchShardTarget, SearchProfileQueryPhaseResult> searchPhase = randomSearchPhaseResults();\n        List<FetchSearchResult> fetchPhase = searchPhase.entrySet()\n            .stream()\n            .map(e -> fetchResult(e.getKey(), new ProfileResult(\"fetch\", \"\", Map.of(), Map.of(), 1, List.of())))\n            .collect(toList());\n        SearchProfileResults result = builder(searchPhase).build(fetchPhase);\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getQueryPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getFetchPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n    }\n","date":"2021-09-13 22:00:36","endLine":68,"groupId":"28327","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testQueryAndFetch","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/45/095245934d59ce2f6d8f49775b9e5895c1e7a4.src","preCode":"    public void testQueryAndFetch() {\n        Map<SearchShardTarget, SearchProfileQueryPhaseResult> searchPhase = randomSearchPhaseResults();\n        List<FetchSearchResult> fetchPhase = searchPhase.entrySet()\n            .stream()\n            .map(e -> fetchResult(e.getKey(), new ProfileResult(\"fetch\", \"\", Map.of(), Map.of(), 1, List.of())))\n            .collect(toList());\n        SearchProfileResults result = builder(searchPhase).build(fetchPhase);\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getQueryPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getFetchPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/profile/SearchProfileResultsBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":53,"status":"B"}],"commitId":"c2c0165fd2811eb88e10eaa0089fbdbdeaab020c","commitMessage":"@@@Profile the fetch phase (#77064)\n\nThis adds profiling to the fetch phase so we can tell when fetching is\nslower than we'd like and we can tell which portion of the fetch is\nslow. The output includes which stored fields were loaded.  how long it\ntook to load stored fields.  which fetch sub-phases were run.  and how\nlong those fetch sub-phases took.\n\nCloses #75892\n\n* Skip bwc\n\n* Don't compare fetch profiles\n\n* Use passed one\n\n* no npe\n\n* Do last rename\n\n* Move method down\n\n* serialization tests\n\n* Fix sneaky serialization\n\n* Test for sneaky bug\n\n* license header\n\n* Document\n\n* Fix test\n\n* newline\n\n* Restore assertion\n\n* unit test merging\n\n* Handle inner hits\n\n* Fixup\n\n* Revert unneeded\n\n* Revert inner hits profiling\n\n* Fix names\n\n* Fixup names\n\n* Move results building\n\n* Drop loaded_nested\n\n* Checkstyle\n\n* Fixup more\n\n* Finish writeable cleanup\n\nAdd unit tests for merge\n\n* Remove null checking builder\n\n* Fix wire mistake\n\nHow did this pass before?!\n\n* Rename\n\n* Remove funny builder\n\n* Remove name munging","date":"2021-09-13 22:00:36","modifiedFileCount":"42","status":"B","submitter":"Nik Everett"},{"authorTime":"2021-09-14 00:16:32","codes":[{"authorDate":"2021-09-14 00:16:32","commitOrder":2,"curCode":"    public void testQueryWithoutAnyFetch() {\n        Map<SearchShardTarget, SearchProfileQueryPhaseResult> searchPhase = randomSearchPhaseResults(between(1, 2));\n        FetchSearchResult fetchPhase = fetchResult(searchPhase.keySet().iterator().next(), null);\n        SearchProfileResults result = builder(searchPhase).build(List.of(fetchPhase));\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getQueryPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n        assertThat(result.getShardResults().values().stream().filter(r -> r.getFetchPhase() != null).count(), equalTo(0L));\n    }\n","date":"2021-09-14 00:16:32","endLine":51,"groupId":"104659","id":3,"instanceNumber":1,"isCurCommit":1,"methodName":"testQueryWithoutAnyFetch","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/6b/ce43afaa57354e1d71a9198f4e4c886b684532.src","preCode":"    public void testQueryWithoutAnyFetch() {\n        Map<SearchShardTarget, SearchProfileQueryPhaseResult> searchPhase = randomSearchPhaseResults();\n        FetchSearchResult fetchPhase = fetchResult(searchPhase.keySet().iterator().next(), null);\n        SearchProfileResults result = builder(searchPhase).build(List.of(fetchPhase));\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getQueryPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n        assertThat(result.getShardResults().values().stream().filter(r -> r.getFetchPhase() != null).count(), equalTo(0L));\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/profile/SearchProfileResultsBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":42,"status":"M"},{"authorDate":"2021-09-14 00:16:32","commitOrder":2,"curCode":"    public void testQueryAndFetch() {\n        Map<SearchShardTarget, SearchProfileQueryPhaseResult> searchPhase = randomSearchPhaseResults(between(1, 2));\n        List<FetchSearchResult> fetchPhase = searchPhase.entrySet()\n            .stream()\n            .map(e -> fetchResult(e.getKey(), new ProfileResult(\"fetch\", \"\", Map.of(), Map.of(), 1, List.of())))\n            .collect(toList());\n        SearchProfileResults result = builder(searchPhase).build(fetchPhase);\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getQueryPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getFetchPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n    }\n","date":"2021-09-14 00:16:32","endLine":68,"groupId":"104659","id":4,"instanceNumber":2,"isCurCommit":1,"methodName":"testQueryAndFetch","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/6b/ce43afaa57354e1d71a9198f4e4c886b684532.src","preCode":"    public void testQueryAndFetch() {\n        Map<SearchShardTarget, SearchProfileQueryPhaseResult> searchPhase = randomSearchPhaseResults();\n        List<FetchSearchResult> fetchPhase = searchPhase.entrySet()\n            .stream()\n            .map(e -> fetchResult(e.getKey(), new ProfileResult(\"fetch\", \"\", Map.of(), Map.of(), 1, List.of())))\n            .collect(toList());\n        SearchProfileResults result = builder(searchPhase).build(fetchPhase);\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getQueryPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n        assertThat(\n            result.getShardResults().values().stream().filter(r -> r.getFetchPhase() != null).count(),\n            equalTo((long) searchPhase.size())\n        );\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/profile/SearchProfileResultsBuilderTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":53,"status":"M"}],"commitId":"e5228904361f85ebaeb5da1331a7c763a927f773","commitMessage":"@@@Fix profile test (#77643)\n\nIn #77064 I added some more tests for profiling. It fails when a\n`rarely()` block hits - roughly 2% of the time. This should fix it.","date":"2021-09-14 00:16:32","modifiedFileCount":"1","status":"M","submitter":"Nik Everett"}]
