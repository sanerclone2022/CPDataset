[{"authorTime":"2019-08-27 02:21:42","codes":[{"authorDate":"2019-08-27 02:21:42","commitOrder":1,"curCode":"    public void testMultipleRangesLotsOfOverlap() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            Document doc = new Document();\n            BytesRef encodedRange = rangeType.encodeRanges(Set.of(\n                new RangeFieldMapper.Range(rangeType, 1L, 2L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 4L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 13L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 5L, true, true) \r\n            ));\n            doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n            w.addDocument(doc);\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5);\n            MappedFieldType fieldType = new RangeFieldMapper.Builder(\"field\", rangeType).fieldType();\n            fieldType.setName(\"field\");\n\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram = search(searcher, new MatchAllDocsQuery(), aggBuilder, fieldType);\n                assertEquals(3, histogram.getBuckets().size());\n\n                assertEquals(0d, histogram.getBuckets().get(0).getKey());\n                assertEquals(1, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(5d, histogram.getBuckets().get(1).getKey());\n                assertEquals(1, histogram.getBuckets().get(1).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(2).getKey());\n                assertEquals(1, histogram.getBuckets().get(2).getDocCount());\n            }\n        }\n\n    }\n","date":"2019-08-27 02:21:42","endLine":225,"groupId":"45500","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testMultipleRangesLotsOfOverlap","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/73/dd41e640dda8ff037012de949c8a98428e291d.src","preCode":"    public void testMultipleRangesLotsOfOverlap() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            Document doc = new Document();\n            BytesRef encodedRange = rangeType.encodeRanges(Set.of(\n                new RangeFieldMapper.Range(rangeType, 1L, 2L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 4L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 13L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 5L, true, true) \r\n            ));\n            doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n            w.addDocument(doc);\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5);\n            MappedFieldType fieldType = new RangeFieldMapper.Builder(\"field\", rangeType).fieldType();\n            fieldType.setName(\"field\");\n\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram = search(searcher, new MatchAllDocsQuery(), aggBuilder, fieldType);\n                assertEquals(3, histogram.getBuckets().size());\n\n                assertEquals(0d, histogram.getBuckets().get(0).getKey());\n                assertEquals(1, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(5d, histogram.getBuckets().get(1).getKey());\n                assertEquals(1, histogram.getBuckets().get(1).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(2).getKey());\n                assertEquals(1, histogram.getBuckets().get(2).getDocCount());\n            }\n        }\n\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/RangeHistogramAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":189,"status":"B"},{"authorDate":"2019-08-27 02:21:42","commitOrder":1,"curCode":"    public void testMinDocCount() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            for (RangeFieldMapper.Range range : new RangeFieldMapper.Range[] {\n                new RangeFieldMapper.Range(rangeType, -14L, -11L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 0L, 9L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 6L, 12L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 13L, 14L, true, true), \r\n            }) {\n                Document doc = new Document();\n                BytesRef encodedRange = rangeType.encodeRanges(Collections.singleton(range));\n                doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n                w.addDocument(doc);\n            }\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5)\n                .minDocCount(2);\n            MappedFieldType fieldType = new RangeFieldMapper.Builder(\"field\", rangeType).fieldType();\n            fieldType.setName(\"field\");\n\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram = searchAndReduce(searcher, new MatchAllDocsQuery(), aggBuilder, fieldType);\n                assertEquals(2, histogram.getBuckets().size());\n\n                assertEquals(5d, histogram.getBuckets().get(0).getKey());\n                assertEquals(2, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(1).getKey());\n                assertEquals(2, histogram.getBuckets().get(1).getDocCount());\n            }\n        }\n    }\n","date":"2019-08-27 02:21:42","endLine":309,"groupId":"43652","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testMinDocCount","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/73/dd41e640dda8ff037012de949c8a98428e291d.src","preCode":"    public void testMinDocCount() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            for (RangeFieldMapper.Range range : new RangeFieldMapper.Range[] {\n                new RangeFieldMapper.Range(rangeType, -14L, -11L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 0L, 9L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 6L, 12L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 13L, 14L, true, true), \r\n            }) {\n                Document doc = new Document();\n                BytesRef encodedRange = rangeType.encodeRanges(Collections.singleton(range));\n                doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n                w.addDocument(doc);\n            }\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5)\n                .minDocCount(2);\n            MappedFieldType fieldType = new RangeFieldMapper.Builder(\"field\", rangeType).fieldType();\n            fieldType.setName(\"field\");\n\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram = searchAndReduce(searcher, new MatchAllDocsQuery(), aggBuilder, fieldType);\n                assertEquals(2, histogram.getBuckets().size());\n\n                assertEquals(5d, histogram.getBuckets().get(0).getKey());\n                assertEquals(2, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(1).getKey());\n                assertEquals(2, histogram.getBuckets().get(1).getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/RangeHistogramAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":274,"status":"B"}],"commitId":"1a0dddf4ad24b3f2c751a1fe0e024fdbf8754f94","commitMessage":"@@@Range Field support for Histogram and Date Histogram aggregations(#45395)\n\n * Add support for a Range field ValuesSource.  including decode logic for range doc values and exposing RangeType as a first class enum\n * Provide hooks in ValuesSourceConfig for aggregations to control ValuesSource class selection on missing & script values\n * Branch aggregator creation in Histogram and DateHistogram based on ValuesSource class.  to enable specialization based on type.  This is similar to how Terms aggregator works.\n * Prioritize field type when available for selecting the ValuesSource class type to use for an aggregation\n\n","date":"2019-08-27 02:21:42","modifiedFileCount":"44","status":"B","submitter":"Mark Tozzi"},{"authorTime":"2020-05-29 21:54:47","codes":[{"authorDate":"2020-05-29 21:54:47","commitOrder":2,"curCode":"    public void testMultipleRangesLotsOfOverlap() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            Document doc = new Document();\n            BytesRef encodedRange = rangeType.encodeRanges(Set.of(\n                new RangeFieldMapper.Range(rangeType, 1L, 2L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 4L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 13L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 5L, true, true) \r\n            ));\n            doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n            w.addDocument(doc);\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5);\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram = search(searcher, new MatchAllDocsQuery(), aggBuilder, rangeField(\"field\", rangeType));\n                assertEquals(3, histogram.getBuckets().size());\n\n                assertEquals(0d, histogram.getBuckets().get(0).getKey());\n                assertEquals(1, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(5d, histogram.getBuckets().get(1).getKey());\n                assertEquals(1, histogram.getBuckets().get(1).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(2).getKey());\n                assertEquals(1, histogram.getBuckets().get(2).getDocCount());\n            }\n        }\n\n    }\n","date":"2020-05-29 21:54:47","endLine":219,"groupId":"45500","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testMultipleRangesLotsOfOverlap","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/9c/c63f3352fa175a004e611b860399619c9ca0a2.src","preCode":"    public void testMultipleRangesLotsOfOverlap() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            Document doc = new Document();\n            BytesRef encodedRange = rangeType.encodeRanges(Set.of(\n                new RangeFieldMapper.Range(rangeType, 1L, 2L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 4L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 13L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 5L, true, true) \r\n            ));\n            doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n            w.addDocument(doc);\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5);\n            MappedFieldType fieldType = new RangeFieldMapper.Builder(\"field\", rangeType).fieldType();\n            fieldType.setName(\"field\");\n\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram = search(searcher, new MatchAllDocsQuery(), aggBuilder, fieldType);\n                assertEquals(3, histogram.getBuckets().size());\n\n                assertEquals(0d, histogram.getBuckets().get(0).getKey());\n                assertEquals(1, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(5d, histogram.getBuckets().get(1).getKey());\n                assertEquals(1, histogram.getBuckets().get(1).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(2).getKey());\n                assertEquals(1, histogram.getBuckets().get(2).getDocCount());\n            }\n        }\n\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/RangeHistogramAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":186,"status":"M"},{"authorDate":"2020-05-29 21:54:47","commitOrder":2,"curCode":"    public void testMinDocCount() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            for (RangeFieldMapper.Range range : new RangeFieldMapper.Range[] {\n                new RangeFieldMapper.Range(rangeType, -14L, -11L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 0L, 9L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 6L, 12L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 13L, 14L, true, true), \r\n            }) {\n                Document doc = new Document();\n                BytesRef encodedRange = rangeType.encodeRanges(Collections.singleton(range));\n                doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n                w.addDocument(doc);\n            }\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5)\n                .minDocCount(2);\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram = searchAndReduce(\n                    searcher,\n                    new MatchAllDocsQuery(),\n                    aggBuilder,\n                    rangeField(\"field\", rangeType)\n                );\n                assertEquals(2, histogram.getBuckets().size());\n\n                assertEquals(5d, histogram.getBuckets().get(0).getKey());\n                assertEquals(2, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(1).getKey());\n                assertEquals(2, histogram.getBuckets().get(1).getDocCount());\n            }\n        }\n    }\n","date":"2020-05-29 21:54:47","endLine":302,"groupId":"43652","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testMinDocCount","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/9c/c63f3352fa175a004e611b860399619c9ca0a2.src","preCode":"    public void testMinDocCount() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            for (RangeFieldMapper.Range range : new RangeFieldMapper.Range[] {\n                new RangeFieldMapper.Range(rangeType, -14L, -11L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 0L, 9L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 6L, 12L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 13L, 14L, true, true), \r\n            }) {\n                Document doc = new Document();\n                BytesRef encodedRange = rangeType.encodeRanges(Collections.singleton(range));\n                doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n                w.addDocument(doc);\n            }\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5)\n                .minDocCount(2);\n            MappedFieldType fieldType = new RangeFieldMapper.Builder(\"field\", rangeType).fieldType();\n            fieldType.setName(\"field\");\n\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram = searchAndReduce(searcher, new MatchAllDocsQuery(), aggBuilder, fieldType);\n                assertEquals(2, histogram.getBuckets().size());\n\n                assertEquals(5d, histogram.getBuckets().get(0).getKey());\n                assertEquals(2, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(1).getKey());\n                assertEquals(2, histogram.getBuckets().get(1).getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/RangeHistogramAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":265,"status":"M"}],"commitId":"460b204f8e61ac77c6550f1df3b7b0d4413fb0d4","commitMessage":"@@@Save memory when histogram agg is not on top (#57277)\n\nThis saves some memory when the `histogram` aggregation is not a top\nlevel aggregation by dropping `asMultiBucketAggregator` in favor of\nnatively implementing multi-bucket storage in the aggregator. For the\nmost part this just uses the `LongKeyedBucketOrds` that we built the\nfirst time we did this.\n","date":"2020-05-29 21:54:47","modifiedFileCount":"9","status":"M","submitter":"Nik Everett"},{"authorTime":"2020-05-29 21:54:47","codes":[{"authorDate":"2020-08-07 05:14:20","commitOrder":3,"curCode":"    public void testMultipleRangesLotsOfOverlap() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            Document doc = new Document();\n            BytesRef encodedRange = rangeType.encodeRanges(Set.of(\n                new RangeFieldMapper.Range(rangeType, 1L, 2L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 4L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 13L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 5L, true, true) \r\n            ));\n            doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n            w.addDocument(doc);\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5);\n\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram =\n                    searchAndReduce(searcher, new MatchAllDocsQuery(), aggBuilder, rangeField(\"field\", rangeType));\n                assertEquals(3, histogram.getBuckets().size());\n\n                assertEquals(0d, histogram.getBuckets().get(0).getKey());\n                assertEquals(1, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(5d, histogram.getBuckets().get(1).getKey());\n                assertEquals(1, histogram.getBuckets().get(1).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(2).getKey());\n                assertEquals(1, histogram.getBuckets().get(2).getDocCount());\n            }\n        }\n\n    }\n","date":"2020-08-07 05:14:20","endLine":236,"groupId":"105044","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testMultipleRangesLotsOfOverlap","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/31/2ca43c7286e2af1f9ce4ff4272756b7b9cddb3.src","preCode":"    public void testMultipleRangesLotsOfOverlap() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            Document doc = new Document();\n            BytesRef encodedRange = rangeType.encodeRanges(Set.of(\n                new RangeFieldMapper.Range(rangeType, 1L, 2L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 4L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 13L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 1L, 5L, true, true) \r\n            ));\n            doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n            w.addDocument(doc);\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5);\n\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram = search(searcher, new MatchAllDocsQuery(), aggBuilder, rangeField(\"field\", rangeType));\n                assertEquals(3, histogram.getBuckets().size());\n\n                assertEquals(0d, histogram.getBuckets().get(0).getKey());\n                assertEquals(1, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(5d, histogram.getBuckets().get(1).getKey());\n                assertEquals(1, histogram.getBuckets().get(1).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(2).getKey());\n                assertEquals(1, histogram.getBuckets().get(2).getDocCount());\n            }\n        }\n\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/RangeHistogramAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":201,"status":"M"},{"authorDate":"2020-05-29 21:54:47","commitOrder":3,"curCode":"    public void testMinDocCount() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            for (RangeFieldMapper.Range range : new RangeFieldMapper.Range[] {\n                new RangeFieldMapper.Range(rangeType, -14L, -11L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 0L, 9L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 6L, 12L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 13L, 14L, true, true), \r\n            }) {\n                Document doc = new Document();\n                BytesRef encodedRange = rangeType.encodeRanges(Collections.singleton(range));\n                doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n                w.addDocument(doc);\n            }\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5)\n                .minDocCount(2);\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram = searchAndReduce(\n                    searcher,\n                    new MatchAllDocsQuery(),\n                    aggBuilder,\n                    rangeField(\"field\", rangeType)\n                );\n                assertEquals(2, histogram.getBuckets().size());\n\n                assertEquals(5d, histogram.getBuckets().get(0).getKey());\n                assertEquals(2, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(1).getKey());\n                assertEquals(2, histogram.getBuckets().get(1).getDocCount());\n            }\n        }\n    }\n","date":"2020-05-29 21:54:47","endLine":302,"groupId":"105044","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testMinDocCount","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-elasticsearch-10-0.7/blobInfo/CC_OUT/blobs/9c/c63f3352fa175a004e611b860399619c9ca0a2.src","preCode":"    public void testMinDocCount() throws Exception {\n        RangeType rangeType = RangeType.LONG;\n        try (Directory dir = newDirectory();\n             RandomIndexWriter w = new RandomIndexWriter(random(), dir)) {\n            for (RangeFieldMapper.Range range : new RangeFieldMapper.Range[] {\n                new RangeFieldMapper.Range(rangeType, -14L, -11L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 0L, 9L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 6L, 12L, true, true), \r\n                new RangeFieldMapper.Range(rangeType, 13L, 14L, true, true), \r\n            }) {\n                Document doc = new Document();\n                BytesRef encodedRange = rangeType.encodeRanges(Collections.singleton(range));\n                doc.add(new BinaryDocValuesField(\"field\", encodedRange));\n                w.addDocument(doc);\n            }\n\n            HistogramAggregationBuilder aggBuilder = new HistogramAggregationBuilder(\"my_agg\")\n                .field(\"field\")\n                .interval(5)\n                .minDocCount(2);\n            try (IndexReader reader = w.getReader()) {\n                IndexSearcher searcher = new IndexSearcher(reader);\n                InternalHistogram histogram = searchAndReduce(\n                    searcher,\n                    new MatchAllDocsQuery(),\n                    aggBuilder,\n                    rangeField(\"field\", rangeType)\n                );\n                assertEquals(2, histogram.getBuckets().size());\n\n                assertEquals(5d, histogram.getBuckets().get(0).getKey());\n                assertEquals(2, histogram.getBuckets().get(0).getDocCount());\n\n                assertEquals(10d, histogram.getBuckets().get(1).getKey());\n                assertEquals(2, histogram.getBuckets().get(1).getDocCount());\n            }\n        }\n    }\n","realPath":"server/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/RangeHistogramAggregatorTests.java","repoName":"elasticsearch","snippetEndLine":0,"snippetStartLine":0,"startLine":265,"status":"N"}],"commitId":"5e3ea6eb11c68bdcc9adda51715a6e1fea9186d6","commitMessage":"@@@Merge branch 'master' into feature/runtime_fields\n","date":"2020-08-07 05:14:20","modifiedFileCount":"73","status":"M","submitter":"Nik Everett"}]
