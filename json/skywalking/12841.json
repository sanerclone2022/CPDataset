[{"authorTime":"2021-05-19 14:14:48","codes":[{"authorDate":"2021-05-19 14:14:48","commitOrder":1,"curCode":"    private void buildMustQueryListByCondition(final EventQueryCondition condition, final List<QueryBuilder> mustQueryList) {\n        if (!isNullOrEmpty(condition.getUuid())) {\n            mustQueryList.add(QueryBuilders.termQuery(Event.UUID, condition.getUuid()));\n        }\n\n        final Source source = condition.getSource();\n        if (source != null) {\n            if (!isNullOrEmpty(source.getService())) {\n                mustQueryList.add(QueryBuilders.termQuery(Event.SERVICE, source.getService()));\n            }\n            if (!isNullOrEmpty(source.getServiceInstance())) {\n                mustQueryList.add(QueryBuilders.termQuery(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n            }\n            if (!isNullOrEmpty(source.getEndpoint())) {\n                mustQueryList.add(QueryBuilders.matchPhraseQuery(\n                        MatchCNameBuilder.INSTANCE.build(Event.ENDPOINT),\n                        source.getEndpoint()\n                ));\n            }\n        }\n\n        if (!isNullOrEmpty(condition.getName())) {\n            mustQueryList.add(QueryBuilders.termQuery(Event.NAME, condition.getName()));\n        }\n\n        if (condition.getType() != null) {\n            mustQueryList.add(QueryBuilders.termQuery(Event.TYPE, condition.getType().name()));\n        }\n\n        final Duration startTime = condition.getTime();\n        if (startTime != null) {\n            if (startTime.getStartTimestamp() > 0) {\n                mustQueryList.add(QueryBuilders.rangeQuery(Event.START_TIME)\n                        .gt(startTime.getStartTimestamp()));\n            }\n            if (startTime.getEndTimestamp() > 0) {\n                mustQueryList.add(QueryBuilders.rangeQuery(Event.END_TIME)\n                        .lt(startTime.getEndTimestamp()));\n            }\n        }\n    }\n","date":"2021-05-19 14:14:48","endLine":117,"groupId":"4561","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"buildMustQueryListByCondition","params":"(finalEventQueryConditioncondition@finalList<QueryBuilder>mustQueryList)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-skywalking-10-0.7/blobInfo/CC_OUT/blobs/74/9037b477ceebeedef46c8894a39c9e7cef6839.src","preCode":"    private void buildMustQueryListByCondition(final EventQueryCondition condition, final List<QueryBuilder> mustQueryList) {\n        if (!isNullOrEmpty(condition.getUuid())) {\n            mustQueryList.add(QueryBuilders.termQuery(Event.UUID, condition.getUuid()));\n        }\n\n        final Source source = condition.getSource();\n        if (source != null) {\n            if (!isNullOrEmpty(source.getService())) {\n                mustQueryList.add(QueryBuilders.termQuery(Event.SERVICE, source.getService()));\n            }\n            if (!isNullOrEmpty(source.getServiceInstance())) {\n                mustQueryList.add(QueryBuilders.termQuery(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n            }\n            if (!isNullOrEmpty(source.getEndpoint())) {\n                mustQueryList.add(QueryBuilders.matchPhraseQuery(\n                        MatchCNameBuilder.INSTANCE.build(Event.ENDPOINT),\n                        source.getEndpoint()\n                ));\n            }\n        }\n\n        if (!isNullOrEmpty(condition.getName())) {\n            mustQueryList.add(QueryBuilders.termQuery(Event.NAME, condition.getName()));\n        }\n\n        if (condition.getType() != null) {\n            mustQueryList.add(QueryBuilders.termQuery(Event.TYPE, condition.getType().name()));\n        }\n\n        final Duration startTime = condition.getTime();\n        if (startTime != null) {\n            if (startTime.getStartTimestamp() > 0) {\n                mustQueryList.add(QueryBuilders.rangeQuery(Event.START_TIME)\n                        .gt(startTime.getStartTimestamp()));\n            }\n            if (startTime.getEndTimestamp() > 0) {\n                mustQueryList.add(QueryBuilders.rangeQuery(Event.END_TIME)\n                        .lt(startTime.getEndTimestamp()));\n            }\n        }\n    }\n","realPath":"oap-server/server-storage-plugin/storage-elasticsearch-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/elasticsearch/query/ESEventQueryDAO.java","repoName":"skywalking","snippetEndLine":0,"snippetStartLine":0,"startLine":77,"status":"B"},{"authorDate":"2021-05-19 14:14:48","commitOrder":1,"curCode":"    protected void buildQueryByCondition(List<WhereQueryImpl<SelectQueryImpl>> queries, EventQueryCondition condition) {\n        WhereQueryImpl<SelectQueryImpl> countWhereQuery = queries.get(0);\n        WhereQueryImpl<SelectQueryImpl> recallWhereQuery = queries.get(1);\n        if (!isNullOrEmpty(condition.getUuid())) {\n            recallWhereQuery.and(eq(Event.UUID, condition.getUuid()));\n            countWhereQuery.and(eq(Event.UUID, condition.getUuid()));\n        }\n\n        final Source source = condition.getSource();\n        if (source != null) {\n            if (!isNullOrEmpty(source.getService())) {\n                recallWhereQuery.and(eq(Event.SERVICE, source.getService()));\n                countWhereQuery.and(eq(Event.SERVICE, source.getService()));\n            }\n            if (!isNullOrEmpty(source.getServiceInstance())) {\n                recallWhereQuery.and(eq(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n                countWhereQuery.and(eq(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n            }\n            if (!isNullOrEmpty(source.getEndpoint())) {\n                recallWhereQuery.and(contains(Event.ENDPOINT, source.getEndpoint().replaceAll(\"/\", \"\\\\\\\\/\")));\n                countWhereQuery.and(contains(Event.ENDPOINT, source.getEndpoint().replaceAll(\"/\", \"\\\\\\\\/\")));\n            }\n        }\n\n        if (!isNullOrEmpty(condition.getName())) {\n            recallWhereQuery.and(eq(InfluxConstants.NAME, condition.getName()));\n            countWhereQuery.and(eq(InfluxConstants.NAME, condition.getName()));\n        }\n\n        if (condition.getType() != null) {\n            recallWhereQuery.and(eq(Event.TYPE, condition.getType().name()));\n            countWhereQuery.and(eq(Event.TYPE, condition.getType().name()));\n        }\n\n        final Duration startTime = condition.getTime();\n        if (startTime != null) {\n            if (startTime.getStartTimestamp() > 0) {\n                recallWhereQuery.and(gt(Event.START_TIME, startTime.getStartTimestamp()));\n                countWhereQuery.and(gt(Event.START_TIME, startTime.getStartTimestamp()));\n            }\n            if (startTime.getEndTimestamp() > 0) {\n                recallWhereQuery.and(lt(Event.END_TIME, startTime.getEndTimestamp()));\n                countWhereQuery.and(lt(Event.END_TIME, startTime.getEndTimestamp()));\n            }\n        }\n    }\n","date":"2021-05-19 14:14:48","endLine":171,"groupId":"4925","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"buildQueryByCondition","params":"(List<WhereQueryImpl<SelectQueryImpl>>queries@EventQueryConditioncondition)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-skywalking-10-0.7/blobInfo/CC_OUT/blobs/ab/36ca28e6ce4d1b5b34c2b30d9689c92b919fa5.src","preCode":"    protected void buildQueryByCondition(List<WhereQueryImpl<SelectQueryImpl>> queries, EventQueryCondition condition) {\n        WhereQueryImpl<SelectQueryImpl> countWhereQuery = queries.get(0);\n        WhereQueryImpl<SelectQueryImpl> recallWhereQuery = queries.get(1);\n        if (!isNullOrEmpty(condition.getUuid())) {\n            recallWhereQuery.and(eq(Event.UUID, condition.getUuid()));\n            countWhereQuery.and(eq(Event.UUID, condition.getUuid()));\n        }\n\n        final Source source = condition.getSource();\n        if (source != null) {\n            if (!isNullOrEmpty(source.getService())) {\n                recallWhereQuery.and(eq(Event.SERVICE, source.getService()));\n                countWhereQuery.and(eq(Event.SERVICE, source.getService()));\n            }\n            if (!isNullOrEmpty(source.getServiceInstance())) {\n                recallWhereQuery.and(eq(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n                countWhereQuery.and(eq(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n            }\n            if (!isNullOrEmpty(source.getEndpoint())) {\n                recallWhereQuery.and(contains(Event.ENDPOINT, source.getEndpoint().replaceAll(\"/\", \"\\\\\\\\/\")));\n                countWhereQuery.and(contains(Event.ENDPOINT, source.getEndpoint().replaceAll(\"/\", \"\\\\\\\\/\")));\n            }\n        }\n\n        if (!isNullOrEmpty(condition.getName())) {\n            recallWhereQuery.and(eq(InfluxConstants.NAME, condition.getName()));\n            countWhereQuery.and(eq(InfluxConstants.NAME, condition.getName()));\n        }\n\n        if (condition.getType() != null) {\n            recallWhereQuery.and(eq(Event.TYPE, condition.getType().name()));\n            countWhereQuery.and(eq(Event.TYPE, condition.getType().name()));\n        }\n\n        final Duration startTime = condition.getTime();\n        if (startTime != null) {\n            if (startTime.getStartTimestamp() > 0) {\n                recallWhereQuery.and(gt(Event.START_TIME, startTime.getStartTimestamp()));\n                countWhereQuery.and(gt(Event.START_TIME, startTime.getStartTimestamp()));\n            }\n            if (startTime.getEndTimestamp() > 0) {\n                recallWhereQuery.and(lt(Event.END_TIME, startTime.getEndTimestamp()));\n                countWhereQuery.and(lt(Event.END_TIME, startTime.getEndTimestamp()));\n            }\n        }\n    }\n","realPath":"oap-server/server-storage-plugin/storage-influxdb-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/influxdb/query/EventQueryDAO.java","repoName":"skywalking","snippetEndLine":0,"snippetStartLine":0,"startLine":126,"status":"B"}],"commitId":"bb590daba99e25e78c98a9601fae46e63fc5efa6","commitMessage":"@@@Include event(s) to alarms. (#6888)\n\nCo-authored-by: kezhenxu94 <kezhenxu94@apache.org>\nCo-authored-by: ?? Wu Sheng <wu.sheng@foxmail.com>","date":"2021-05-19 14:14:48","modifiedFileCount":"19","status":"B","submitter":"chen~"},{"authorTime":"2021-05-19 14:14:48","codes":[{"authorDate":"2021-09-06 15:21:35","commitOrder":2,"curCode":"    private void buildMustQueryListByCondition(final EventQueryCondition condition,\n                                               final BoolQueryBuilder query) {\n        if (!isNullOrEmpty(condition.getUuid())) {\n            query.must(Query.term(Event.UUID, condition.getUuid()));\n        }\n\n        final Source source = condition.getSource();\n        if (source != null) {\n            if (!isNullOrEmpty(source.getService())) {\n                query.must(Query.term(Event.SERVICE, source.getService()));\n            }\n            if (!isNullOrEmpty(source.getServiceInstance())) {\n                query.must(Query.term(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n            }\n            if (!isNullOrEmpty(source.getEndpoint())) {\n                query.must(Query.matchPhrase(\n                    MatchCNameBuilder.INSTANCE.build(Event.ENDPOINT),\n                    source.getEndpoint()\n                ));\n            }\n        }\n\n        if (!isNullOrEmpty(condition.getName())) {\n            query.must(Query.term(Event.NAME, condition.getName()));\n        }\n\n        if (condition.getType() != null) {\n            query.must(Query.term(Event.TYPE, condition.getType().name()));\n        }\n\n        final Duration startTime = condition.getTime();\n        if (startTime != null) {\n            if (startTime.getStartTimestamp() > 0) {\n                query.must(Query.range(Event.START_TIME).gt(startTime.getStartTimestamp()));\n            }\n            if (startTime.getEndTimestamp() > 0) {\n                query.must(Query.range(Event.END_TIME).lt(startTime.getEndTimestamp()));\n            }\n        }\n    }\n","date":"2021-09-06 15:21:35","endLine":118,"groupId":"12841","id":3,"instanceNumber":1,"isCurCommit":1,"methodName":"buildMustQueryListByCondition","params":"(finalEventQueryConditioncondition@finalBoolQueryBuilderquery)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-skywalking-10-0.7/blobInfo/CC_OUT/blobs/07/0181529129390fb99fa5d143d6329c03cd9c43.src","preCode":"    private void buildMustQueryListByCondition(final EventQueryCondition condition, final List<QueryBuilder> mustQueryList) {\n        if (!isNullOrEmpty(condition.getUuid())) {\n            mustQueryList.add(QueryBuilders.termQuery(Event.UUID, condition.getUuid()));\n        }\n\n        final Source source = condition.getSource();\n        if (source != null) {\n            if (!isNullOrEmpty(source.getService())) {\n                mustQueryList.add(QueryBuilders.termQuery(Event.SERVICE, source.getService()));\n            }\n            if (!isNullOrEmpty(source.getServiceInstance())) {\n                mustQueryList.add(QueryBuilders.termQuery(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n            }\n            if (!isNullOrEmpty(source.getEndpoint())) {\n                mustQueryList.add(QueryBuilders.matchPhraseQuery(\n                        MatchCNameBuilder.INSTANCE.build(Event.ENDPOINT),\n                        source.getEndpoint()\n                ));\n            }\n        }\n\n        if (!isNullOrEmpty(condition.getName())) {\n            mustQueryList.add(QueryBuilders.termQuery(Event.NAME, condition.getName()));\n        }\n\n        if (condition.getType() != null) {\n            mustQueryList.add(QueryBuilders.termQuery(Event.TYPE, condition.getType().name()));\n        }\n\n        final Duration startTime = condition.getTime();\n        if (startTime != null) {\n            if (startTime.getStartTimestamp() > 0) {\n                mustQueryList.add(QueryBuilders.rangeQuery(Event.START_TIME)\n                        .gt(startTime.getStartTimestamp()));\n            }\n            if (startTime.getEndTimestamp() > 0) {\n                mustQueryList.add(QueryBuilders.rangeQuery(Event.END_TIME)\n                        .lt(startTime.getEndTimestamp()));\n            }\n        }\n    }\n","realPath":"oap-server/server-storage-plugin/storage-elasticsearch-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/elasticsearch/query/ESEventQueryDAO.java","repoName":"skywalking","snippetEndLine":0,"snippetStartLine":0,"startLine":79,"status":"M"},{"authorDate":"2021-05-19 14:14:48","commitOrder":2,"curCode":"    protected void buildQueryByCondition(List<WhereQueryImpl<SelectQueryImpl>> queries, EventQueryCondition condition) {\n        WhereQueryImpl<SelectQueryImpl> countWhereQuery = queries.get(0);\n        WhereQueryImpl<SelectQueryImpl> recallWhereQuery = queries.get(1);\n        if (!isNullOrEmpty(condition.getUuid())) {\n            recallWhereQuery.and(eq(Event.UUID, condition.getUuid()));\n            countWhereQuery.and(eq(Event.UUID, condition.getUuid()));\n        }\n\n        final Source source = condition.getSource();\n        if (source != null) {\n            if (!isNullOrEmpty(source.getService())) {\n                recallWhereQuery.and(eq(Event.SERVICE, source.getService()));\n                countWhereQuery.and(eq(Event.SERVICE, source.getService()));\n            }\n            if (!isNullOrEmpty(source.getServiceInstance())) {\n                recallWhereQuery.and(eq(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n                countWhereQuery.and(eq(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n            }\n            if (!isNullOrEmpty(source.getEndpoint())) {\n                recallWhereQuery.and(contains(Event.ENDPOINT, source.getEndpoint().replaceAll(\"/\", \"\\\\\\\\/\")));\n                countWhereQuery.and(contains(Event.ENDPOINT, source.getEndpoint().replaceAll(\"/\", \"\\\\\\\\/\")));\n            }\n        }\n\n        if (!isNullOrEmpty(condition.getName())) {\n            recallWhereQuery.and(eq(InfluxConstants.NAME, condition.getName()));\n            countWhereQuery.and(eq(InfluxConstants.NAME, condition.getName()));\n        }\n\n        if (condition.getType() != null) {\n            recallWhereQuery.and(eq(Event.TYPE, condition.getType().name()));\n            countWhereQuery.and(eq(Event.TYPE, condition.getType().name()));\n        }\n\n        final Duration startTime = condition.getTime();\n        if (startTime != null) {\n            if (startTime.getStartTimestamp() > 0) {\n                recallWhereQuery.and(gt(Event.START_TIME, startTime.getStartTimestamp()));\n                countWhereQuery.and(gt(Event.START_TIME, startTime.getStartTimestamp()));\n            }\n            if (startTime.getEndTimestamp() > 0) {\n                recallWhereQuery.and(lt(Event.END_TIME, startTime.getEndTimestamp()));\n                countWhereQuery.and(lt(Event.END_TIME, startTime.getEndTimestamp()));\n            }\n        }\n    }\n","date":"2021-05-19 14:14:48","endLine":171,"groupId":"12841","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"buildQueryByCondition","params":"(List<WhereQueryImpl<SelectQueryImpl>>queries@EventQueryConditioncondition)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-skywalking-10-0.7/blobInfo/CC_OUT/blobs/ab/36ca28e6ce4d1b5b34c2b30d9689c92b919fa5.src","preCode":"    protected void buildQueryByCondition(List<WhereQueryImpl<SelectQueryImpl>> queries, EventQueryCondition condition) {\n        WhereQueryImpl<SelectQueryImpl> countWhereQuery = queries.get(0);\n        WhereQueryImpl<SelectQueryImpl> recallWhereQuery = queries.get(1);\n        if (!isNullOrEmpty(condition.getUuid())) {\n            recallWhereQuery.and(eq(Event.UUID, condition.getUuid()));\n            countWhereQuery.and(eq(Event.UUID, condition.getUuid()));\n        }\n\n        final Source source = condition.getSource();\n        if (source != null) {\n            if (!isNullOrEmpty(source.getService())) {\n                recallWhereQuery.and(eq(Event.SERVICE, source.getService()));\n                countWhereQuery.and(eq(Event.SERVICE, source.getService()));\n            }\n            if (!isNullOrEmpty(source.getServiceInstance())) {\n                recallWhereQuery.and(eq(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n                countWhereQuery.and(eq(Event.SERVICE_INSTANCE, source.getServiceInstance()));\n            }\n            if (!isNullOrEmpty(source.getEndpoint())) {\n                recallWhereQuery.and(contains(Event.ENDPOINT, source.getEndpoint().replaceAll(\"/\", \"\\\\\\\\/\")));\n                countWhereQuery.and(contains(Event.ENDPOINT, source.getEndpoint().replaceAll(\"/\", \"\\\\\\\\/\")));\n            }\n        }\n\n        if (!isNullOrEmpty(condition.getName())) {\n            recallWhereQuery.and(eq(InfluxConstants.NAME, condition.getName()));\n            countWhereQuery.and(eq(InfluxConstants.NAME, condition.getName()));\n        }\n\n        if (condition.getType() != null) {\n            recallWhereQuery.and(eq(Event.TYPE, condition.getType().name()));\n            countWhereQuery.and(eq(Event.TYPE, condition.getType().name()));\n        }\n\n        final Duration startTime = condition.getTime();\n        if (startTime != null) {\n            if (startTime.getStartTimestamp() > 0) {\n                recallWhereQuery.and(gt(Event.START_TIME, startTime.getStartTimestamp()));\n                countWhereQuery.and(gt(Event.START_TIME, startTime.getStartTimestamp()));\n            }\n            if (startTime.getEndTimestamp() > 0) {\n                recallWhereQuery.and(lt(Event.END_TIME, startTime.getEndTimestamp()));\n                countWhereQuery.and(lt(Event.END_TIME, startTime.getEndTimestamp()));\n            }\n        }\n    }\n","realPath":"oap-server/server-storage-plugin/storage-influxdb-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/influxdb/query/EventQueryDAO.java","repoName":"skywalking","snippetEndLine":0,"snippetStartLine":0,"startLine":126,"status":"N"}],"commitId":"26b81a2e5991ecdd2bde0f7071264cb80bb235cf","commitMessage":"@@@Rebuilt ElasticSearch client on top of their REST API (#7634)\n\n","date":"2021-09-06 15:21:35","modifiedFileCount":"60","status":"M","submitter":"kezhenxu94"}]
