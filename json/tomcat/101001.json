[{"authorTime":"2006-03-30 08:55:22","codes":[{"authorDate":"2006-03-30 08:55:22","commitOrder":1,"curCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isDebugEnabled()) {\n            log.debug(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(appBase().getAbsolutePath())) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File expandedDocBase = new File(name);\n            File warDocBase = new File(name + \".war\");\n            if (!expandedDocBase.isAbsolute()) {\n                expandedDocBase = new File(appBase(), name);\n                warDocBase = new File(appBase(), name + \".war\");\n            }\n            \r\n            \r\n            if (isWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (warDocBase.exists()) {\n                    deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                            new Long(warDocBase.lastModified()));\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","date":"2006-03-30 08:55:22","endLine":663,"groupId":"13506","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(StringcontextPath@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fa/e22247552e2603b2129120da6fe348e2ddf837.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isDebugEnabled()) {\n            log.debug(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(appBase().getAbsolutePath())) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File expandedDocBase = new File(name);\n            File warDocBase = new File(name + \".war\");\n            if (!expandedDocBase.isAbsolute()) {\n                expandedDocBase = new File(appBase(), name);\n                warDocBase = new File(appBase(), name + \".war\");\n            }\n            \r\n            \r\n            if (isWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (warDocBase.exists()) {\n                    deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                            new Long(warDocBase.lastModified()));\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":549,"status":"B"},{"authorDate":"2006-03-30 08:55:22","commitOrder":1,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","date":"2006-03-30 08:55:22","endLine":1260,"groupId":"11253","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fa/e22247552e2603b2129120da6fe348e2ddf837.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1212,"status":"B"}],"commitId":"550f6379d2e184ba218895d6d8c6760c61805214","commitMessage":"@@@- Reduce the number of JARs.\n- Is it me.  or are the JARs magically smaller ? There must be something related to JDK 1.5.\n- bootstrap.jar is really needed.\n- Import modeler. I think there are some serious possibilities to enhance XML processing.  \n  as everything (or almost everything.  as I don't think the modeler does at the moment) \n  goes through digester.\n- I suppose the webapps could be added now.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@389946 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2006-03-30 08:55:22","modifiedFileCount":"45","status":"B","submitter":"Remy Maucherat"},{"authorTime":"2006-03-30 08:55:22","codes":[{"authorDate":"2008-01-20 22:01:52","commitOrder":2,"curCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isDebugEnabled()) {\n            log.debug(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(appBase().getAbsolutePath())) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                if (warDocBase.exists()) {\n                    deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                            new Long(warDocBase.lastModified()));\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","date":"2008-01-20 22:01:52","endLine":686,"groupId":"11247","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(StringcontextPath@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/29/e9f0527c47ccedbdca0356b0135fe7e6cf58ac.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isDebugEnabled()) {\n            log.debug(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(appBase().getAbsolutePath())) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File expandedDocBase = new File(name);\n            File warDocBase = new File(name + \".war\");\n            if (!expandedDocBase.isAbsolute()) {\n                expandedDocBase = new File(appBase(), name);\n                warDocBase = new File(appBase(), name + \".war\");\n            }\n            \r\n            \r\n            if (isWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (warDocBase.exists()) {\n                    deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                            new Long(warDocBase.lastModified()));\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":567,"status":"M"},{"authorDate":"2006-03-30 08:55:22","commitOrder":2,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","date":"2006-03-30 08:55:22","endLine":1260,"groupId":"11253","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fa/e22247552e2603b2129120da6fe348e2ddf837.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1212,"status":"N"}],"commitId":"ecd5324965c3309f10fb6973d5f269884d2e7649","commitMessage":"@@@FIX: WatchedResource does not work if app is outside \"webapps\"\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@613558 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2008-01-20 22:01:52","modifiedFileCount":"1","status":"M","submitter":"Peter Rossbach"},{"authorTime":"2006-03-30 08:55:22","codes":[{"authorDate":"2008-05-06 00:08:07","commitOrder":3,"curCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isDebugEnabled()) {\n            log.debug(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class<?> clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(appBase().getAbsolutePath())) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                if (warDocBase.exists()) {\n                    deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                            new Long(warDocBase.lastModified()));\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","date":"2008-05-06 00:08:07","endLine":687,"groupId":"11247","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(StringcontextPath@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/d3/bd38be9eeec2a7b059afc4194a2cfd5ce095c5.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isDebugEnabled()) {\n            log.debug(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(appBase().getAbsolutePath())) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                if (warDocBase.exists()) {\n                    deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                            new Long(warDocBase.lastModified()));\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":568,"status":"M"},{"authorDate":"2006-03-30 08:55:22","commitOrder":3,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","date":"2006-03-30 08:55:22","endLine":1260,"groupId":"11253","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fa/e22247552e2603b2129120da6fe348e2ddf837.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1212,"status":"N"}],"commitId":"8e245b21f13b3edfa279b91afcb2bcdc10d25219","commitMessage":"@@@Fix various Eclipse warnings. Generics.  unused code.  etc\nNo functional change.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@653519 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2008-05-06 00:08:07","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2006-03-30 08:55:22","codes":[{"authorDate":"2008-07-11 01:01:23","commitOrder":4,"curCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isDebugEnabled()) {\n            log.debug(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class<?> clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                if (warDocBase.exists()) {\n                    deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                            new Long(warDocBase.lastModified()));\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","date":"2008-07-11 01:01:23","endLine":688,"groupId":"11247","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(StringcontextPath@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/f5/4debc7ac8761cf5eaf885562d9e8611ad1bc1d.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isDebugEnabled()) {\n            log.debug(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class<?> clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(appBase().getAbsolutePath())) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                if (warDocBase.exists()) {\n                    deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                            new Long(warDocBase.lastModified()));\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":568,"status":"M"},{"authorDate":"2006-03-30 08:55:22","commitOrder":4,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","date":"2006-03-30 08:55:22","endLine":1260,"groupId":"11253","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fa/e22247552e2603b2129120da6fe348e2ddf837.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1212,"status":"N"}],"commitId":"252fca1ada750ab414fe053d91c88fba4f9ce284","commitMessage":"@@@Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42678\nOnly ignore docBase it it really is a subdir of appBase\nPatch provided by juergen\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@675650 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2008-07-11 01:01:23","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2006-03-30 08:55:22","codes":[{"authorDate":"2008-11-09 09:45:26","commitOrder":5,"curCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isDebugEnabled()) {\n            log.debug(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class<?> clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","date":"2008-11-09 09:45:26","endLine":693,"groupId":"11247","id":9,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(StringcontextPath@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/6a/b0d7ef7740f179fe743988a28daf119cea384a.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isDebugEnabled()) {\n            log.debug(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class<?> clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                if (warDocBase.exists()) {\n                    deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                            new Long(warDocBase.lastModified()));\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":571,"status":"M"},{"authorDate":"2006-03-30 08:55:22","commitOrder":5,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","date":"2006-03-30 08:55:22","endLine":1260,"groupId":"11253","id":10,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fa/e22247552e2603b2129120da6fe348e2ddf837.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1212,"status":"N"}],"commitId":"400f344bd4ee72bd713dc6a45ba93db81b58b044","commitMessage":"@@@Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42747\nI've tested this with all the combinations I could think of and ensured that the order of the redploy resources is consistent. The summary of changes is:\n- context.xml takes effect on first deploy rather than next restart\n- context.xml from DIR is now copied to conf/<eng>/<host> in the same manner as context.xml from WAR\nI also fixed a couple of edge cases I spotted and changed a few local variables to make the code easier to understand.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@712464 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2008-11-09 09:45:26","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2006-03-30 08:55:22","codes":[{"authorDate":"2009-06-11 21:13:09","commitOrder":6,"curCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class<?> clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","date":"2009-06-11 21:13:09","endLine":699,"groupId":"11247","id":11,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(StringcontextPath@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/66/cd96332abaa74a67aac0e8d9f1e4cbba06ec70.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isDebugEnabled()) {\n            log.debug(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class<?> clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":577,"status":"M"},{"authorDate":"2006-03-30 08:55:22","commitOrder":6,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","date":"2006-03-30 08:55:22","endLine":1260,"groupId":"11253","id":12,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fa/e22247552e2603b2129120da6fe348e2ddf837.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1212,"status":"N"}],"commitId":"7fdfc130a76be46c5d143c779a37292e14769c18","commitMessage":"@@@Log context deployment consistently at info level.  regardless of war/dir/xml\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@783756 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2009-06-11 21:13:09","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2006-03-30 08:55:22","codes":[{"authorDate":"2010-02-17 17:20:59","commitOrder":7,"curCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","date":"2010-02-17 17:20:59","endLine":707,"groupId":"11247","id":13,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(StringcontextPath@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/11/5ec8c597ea0dd798e4e28db9cadae8596e1d56.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n            if (context instanceof Lifecycle) {\n                Class<?> clazz = Class.forName(host.getConfigClass());\n                LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n                ((Lifecycle) context).addLifecycleListener(listener);\n            }\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":585,"status":"M"},{"authorDate":"2006-03-30 08:55:22","commitOrder":7,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","date":"2006-03-30 08:55:22","endLine":1260,"groupId":"11253","id":14,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fa/e22247552e2603b2129120da6fe348e2ddf837.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1212,"status":"N"}],"commitId":"dcf5b025d9cb3f90b7303858a28daae5c515d5f2","commitMessage":"@@@Add Lifecycle to Container.  Server and Service\nRemove casts instanceof tests and any other code this makes unnecessary\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@910877 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2010-02-17 17:20:59","modifiedFileCount":"18","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2006-03-30 08:55:22","codes":[{"authorDate":"2010-03-26 21:47:18","commitOrder":8,"curCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","date":"2010-03-26 21:47:18","endLine":705,"groupId":"11247","id":15,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(StringcontextPath@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/da/aef5b597f4f74e2fd05988cf8f60d11e7f1c19.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":582,"status":"M"},{"authorDate":"2006-03-30 08:55:22","commitOrder":8,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","date":"2006-03-30 08:55:22","endLine":1260,"groupId":"11253","id":16,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fa/e22247552e2603b2129120da6fe348e2ddf837.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1212,"status":"N"}],"commitId":"4081f43576512bf902fcb62d121e8f36af218593","commitMessage":"@@@Improve log message when deploying from configBase to make it clearer where xml file is read from.\nJavadoc tweak\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@927850 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2010-03-26 21:47:18","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2006-03-30 08:55:22","codes":[{"authorDate":"2010-03-28 19:57:46","commitOrder":9,"curCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","date":"2010-03-28 19:57:46","endLine":736,"groupId":"11247","id":17,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(StringcontextPath@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/55/35dbe6814d34018467fd5e278315533f6a8402.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.getAbsolutePath());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":613,"status":"M"},{"authorDate":"2006-03-30 08:55:22","commitOrder":9,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","date":"2006-03-30 08:55:22","endLine":1260,"groupId":"11253","id":18,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fa/e22247552e2603b2129120da6fe348e2ddf837.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1212,"status":"N"}],"commitId":"83226d99cc91396cee328ae6b2478d749b4932b7","commitMessage":"@@@Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48662\nMake extraction of context.xml files configurable and disable it by default for Tomcat 7\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@928380 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2010-03-28 19:57:46","modifiedFileCount":"6","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2010-05-12 04:05:15","codes":[{"authorDate":"2010-05-12 04:05:15","commitOrder":10,"curCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","date":"2010-05-12 04:05:15","endLine":738,"groupId":"10616","id":19,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(StringcontextPath@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/65/d3ef41dd7871aafb88cff9a64e3d075dda8ecd.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":615,"status":"M"},{"authorDate":"2010-05-12 04:05:15","commitOrder":10,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","date":"2010-05-12 04:05:15","endLine":1530,"groupId":"16718","id":20,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/65/d3ef41dd7871aafb88cff9a64e3d075dda8ecd.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase().endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1482,"status":"M"}],"commitId":"5ad9ecdfc65736b88613e42bcc849008d2cacd71","commitMessage":"@@@Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49226\nEnsure case conversion behaves as expected\nPatch provided by sebb\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@943260 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2010-05-12 04:05:15","modifiedFileCount":"29","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2010-05-12 04:05:15","codes":[{"authorDate":"2010-09-28 06:01:45","commitOrder":11,"curCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","date":"2010-09-28 06:01:45","endLine":689,"groupId":"10616","id":21,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(StringcontextPath@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/b3/0d71031bfe2afb7d4f601b09be6573773db728.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":565,"status":"M"},{"authorDate":"2010-05-12 04:05:15","commitOrder":11,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","date":"2010-05-12 04:05:15","endLine":1530,"groupId":"16718","id":22,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/65/d3ef41dd7871aafb88cff9a64e3d075dda8ecd.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1482,"status":"N"}],"commitId":"92f81b19e6255baf01dcef2a7e4ec69d05dc8282","commitMessage":"@@@Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644\nSome Throwables must always be re-thrown\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1001923 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2010-09-28 06:01:45","modifiedFileCount":"22","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2010-11-01 10:04:53","codes":[{"authorDate":"2010-11-01 10:04:53","commitOrder":12,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml, String file) {\n        if (deploymentExists(cn.getName())) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n\n            \r\n            File expandedDocBase = new File(appBase(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2010-11-01 10:04:53","endLine":647,"groupId":"641","id":23,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/40/a4a49b8c2f8472492164ee0d924f25e6080c6d.src","preCode":"    protected void deployDescriptor(String contextPath, File contextXml, String file) {\n        if (deploymentExists(contextPath)) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setPath(contextPath);\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            \r\n            File expandedDocBase = new File(appBase(), name);\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(contextPath, deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":531,"status":"M"},{"authorDate":"2010-11-01 10:04:53","commitOrder":12,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(appBase(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2010-11-01 10:04:53","endLine":1378,"groupId":"14674","id":24,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/40/a4a49b8c2f8472492164ee0d924f25e6080c6d.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextPath = context.getPath();\n        \n        if (deployed.containsKey(contextPath))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextPath);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            String name = null;\n            String path = context.getPath();\n            if (path.equals(\"\")) {\n                name = \"ROOT\";\n            } else {\n                if (path.startsWith(\"/\")) {\n                    name = path.substring(1);\n                } else {\n                    name = path;\n                }\n            }\n            File docBase = new File(name);\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), name);\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextPath, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1344,"status":"M"}],"commitId":"40f87363ea4f5353c0e00e29015363af6a27cb37","commitMessage":"@@@Parallel deployment\n- More work separating Context.name & Context.path\n- Review use of Context.getName() and Context.getPath() and use the correct one\n- Start to add webappVersion property to Context (many components not version aware - e.g. Manager app)\n- Set version when deploying apps if version is specified\n- Include version in Context.name if version is specified\n- New ContextName util class to handle all path/name/version etc translations\n\nIn most cases the behaviour is unchanged if the version is not specified. The one exception is JMX ObjectNames that used to contain a key value pair \"path=...\". Since context path is no longer unique when using versions.  this has been changed to \"context=...\" and the context name used which is unique.\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1029527 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2010-11-01 10:04:53","modifiedFileCount":"22","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2010-12-15 22:34:32","codes":[{"authorDate":"2010-12-15 22:34:32","commitOrder":13,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml, String file) {\n        if (deploymentExists(cn.getName())) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n\n            \r\n            File expandedDocBase = new File(appBase(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2010-12-15 22:34:32","endLine":649,"groupId":"641","id":25,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/66/596dd6073270375b52385008a34d552336a9c5.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml, String file) {\n        if (deploymentExists(cn.getName())) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n\n            \r\n            File expandedDocBase = new File(appBase(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        new Long(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put\n                    (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                new Long(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            new Long(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put\n                        (contextXml.getAbsolutePath(), new Long(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":531,"status":"M"},{"authorDate":"2010-12-15 22:34:32","commitOrder":13,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(appBase(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2010-12-15 22:34:32","endLine":1361,"groupId":"14674","id":26,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/66/596dd6073270375b52385008a34d552336a9c5.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                                          new Long(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(appBase(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        new Long(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1327,"status":"M"}],"commitId":"4b41600fa6dca93ac5011655e15f71a20e53cfd6","commitMessage":"@@@Fix various warnings (FindBugs.  Eclipse etc.)\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1049563 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2010-12-15 22:34:32","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2011-08-16 02:50:25","codes":[{"authorDate":"2011-08-16 02:50:25","commitOrder":14,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml, String file) {\n        if (deploymentExists(cn.getName())) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n\n            \r\n            File expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2011-08-16 02:50:25","endLine":665,"groupId":"641","id":27,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml@Stringfile)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2c/efbb9856417e8a426c7dca164fde6335b506b4.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml, String file) {\n        if (deploymentExists(cn.getName())) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(appBase(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        appBase().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n\n            \r\n            File expandedDocBase = new File(appBase(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(appBase(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":547,"status":"M"},{"authorDate":"2011-08-16 02:50:25","commitOrder":14,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2011-08-16 02:50:25","endLine":1403,"groupId":"3011","id":28,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2c/efbb9856417e8a426c7dca164fde6335b506b4.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(appBase(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(appBase(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1369,"status":"M"}],"commitId":"f82aea1d7c8e36b79d8dda00482790774774401b","commitMessage":"@@@Clean-up I do not intend to back-port (non-critical and changes the Host API)\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1157943 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2011-08-16 02:50:25","modifiedFileCount":"10","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2011-08-16 02:50:25","codes":[{"authorDate":"2011-10-11 20:15:44","commitOrder":15,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n        if (deploymentExists(cn.getName())) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\n                                \"hostConfig.deployDescriptor.error\",\n                                contextXml.getAbsolutePath()));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n\n            \r\n            File expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2011-10-11 20:15:44","endLine":662,"groupId":"641","id":29,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/14/ce01b90c5738218c1156d455f73064fd8dd793.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml, String file) {\n        if (deploymentExists(cn.getName())) {\n            return;\n        }\n        \n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\", file,\n                    configBase.getPath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                file));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n\n            \r\n            File expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, \n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   file), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":543,"status":"M"},{"authorDate":"2011-08-16 02:50:25","commitOrder":15,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2011-08-16 02:50:25","endLine":1403,"groupId":"3011","id":30,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2c/efbb9856417e8a426c7dca164fde6335b506b4.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1369,"status":"N"}],"commitId":"d00cf7970750a94ee45fc8e53e70fdcd9167c267","commitMessage":"@@@Simplify deployment code\nUse full paths in log messages to remove ambiguity\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1181743 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2011-10-11 20:15:44","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2011-08-16 02:50:25","codes":[{"authorDate":"2011-10-28 15:37:34","commitOrder":16,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\n                                \"hostConfig.deployDescriptor.error\",\n                                contextXml.getAbsolutePath()));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n\n            \r\n            File expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2011-10-28 15:37:34","endLine":677,"groupId":"641","id":31,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/3a/e6be73789714c335fe3799bcaceb3039bc8111.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n        if (deploymentExists(cn.getName())) {\n            return;\n        }\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\n                                \"hostConfig.deployDescriptor.error\",\n                                contextXml.getAbsolutePath()));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n\n            \r\n            File expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":561,"status":"M"},{"authorDate":"2011-08-16 02:50:25","commitOrder":16,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2011-08-16 02:50:25","endLine":1403,"groupId":"3011","id":32,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2c/efbb9856417e8a426c7dca164fde6335b506b4.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1369,"status":"N"}],"commitId":"d6f68b124d917154508706eb5ace8cdd16bf3fe5","commitMessage":"@@@Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46264\nImplement threaded start/stop for containers\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1190185 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2011-10-28 15:37:34","modifiedFileCount":"8","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2011-08-16 02:50:25","codes":[{"authorDate":"2011-11-15 05:51:23","commitOrder":17,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()));\n                    context = new FailedContext();\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context != null && context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2011-11-15 05:51:23","endLine":686,"groupId":"3544","id":33,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/12/088c77bd9b2fcbfed60cd68c56bf237aab6ab4.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                    if (context == null) {\n                        log.error(sm.getString(\n                                \"hostConfig.deployDescriptor.error\",\n                                contextXml.getAbsolutePath()));\n                        return;\n                    }\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            boolean isExternalWar = false;\n            boolean isExternal = false;\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n            host.addChild(context);\n            \r\n\n            \r\n            File expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":564,"status":"M"},{"authorDate":"2011-08-16 02:50:25","commitOrder":17,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2011-08-16 02:50:25","endLine":1403,"groupId":"3011","id":34,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2c/efbb9856417e8a426c7dca164fde6335b506b4.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1369,"status":"N"}],"commitId":"53ee263bec8ecac46a0ef0d59b943b17d372a8d2","commitMessage":"@@@Improve handling of failed deployments\n- Allow failed configurations to be fixed via JMX\n- Ensure once a deployment fails.  the context is not deployed\n- Ensure changes to any context.xml file trigger redeployment rather than reloading\n- Tweak base lifecycle implementation to allow failed components to be restarted once they have been fixed\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1201921 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2011-11-15 05:51:23","modifiedFileCount":"4","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2011-08-16 02:50:25","codes":[{"authorDate":"2012-07-22 03:10:39","commitOrder":18,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()));\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2012-07-22 03:10:39","endLine":652,"groupId":"9516","id":35,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/6e/f867d7855004ba5fe9a4a38bac4dbf03e30726.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()));\n                    context = new FailedContext();\n                } finally {\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context != null && context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (context != null && host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":528,"status":"M"},{"authorDate":"2011-08-16 02:50:25","commitOrder":18,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2011-08-16 02:50:25","endLine":1403,"groupId":"3011","id":36,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2c/efbb9856417e8a426c7dca164fde6335b506b4.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1369,"status":"N"}],"commitId":"3f84e8d907b015fa96b0cc1f60e63c923c6bae93","commitMessage":"@@@FindBugs - Possible NPE\nUse consistent approach to exception handling and the creation of the FailedContext instance\ncontext cannot be null\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1364154 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2012-07-22 03:10:39","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2011-08-16 02:50:25","codes":[{"authorDate":"2012-11-12 09:15:52","commitOrder":19,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()));\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2012-11-12 09:15:52","endLine":659,"groupId":"9516","id":37,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/ee/1f113b68833668fca4735059c50bf4f6e52bd0.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n        try {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(contextXml);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()));\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":534,"status":"M"},{"authorDate":"2011-08-16 02:50:25","commitOrder":19,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2011-08-16 02:50:25","endLine":1403,"groupId":"3011","id":38,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2c/efbb9856417e8a426c7dca164fde6335b506b4.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1369,"status":"N"}],"commitId":"37acfc95edb717df14317aa3ee8864f561541df5","commitMessage":"@@@Fix memory leak that prevents context.xml files associated with failed deployments from being deleted.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1408163 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2012-11-12 09:15:52","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2011-08-16 02:50:25","codes":[{"authorDate":"2013-01-30 04:16:30","commitOrder":20,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2013-01-30 04:16:30","endLine":659,"groupId":"9516","id":39,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/7f/c7fdebef89520906831de634fb49a8d8c2d642.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()));\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":534,"status":"M"},{"authorDate":"2011-08-16 02:50:25","commitOrder":20,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2011-08-16 02:50:25","endLine":1403,"groupId":"3011","id":40,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2c/efbb9856417e8a426c7dca164fde6335b506b4.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1369,"status":"N"}],"commitId":"28447d647774475acbec9563191dbe96f25b9d35","commitMessage":"@@@Include the exception in the error message\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1440095 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2013-01-30 04:16:30","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2011-08-16 02:50:25","codes":[{"authorDate":"2013-05-15 21:47:29","commitOrder":21,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n\n        \r\n        deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                Long.valueOf(contextXml.lastModified()));\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                    \r\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (!isExternalWar) {\n                        addWatchedResources(deployedApp,\n                                docBase.getAbsolutePath(), context);\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n            File expandedDocBase = null;\n            if (context.getDocBase() == null) {\n                \r\n                expandedDocBase =\n                        new File(host.getAppBaseFile(), cn.getBaseName());\n            } else {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n            File warDocBase =\n                    new File(expandedDocBase.getAbsolutePath() + \".war\");\n\n            if (isExternalWar && warDocBase.exists()) {\n               \r\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWARs) {\n                    deployedApp.redeployResources.put(\n                            expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                }\n            } else if (!isExternal) {\n                \r\n                if (warDocBase.exists()) {\n                    deployedApp.redeployResources.put(\n                            warDocBase.getAbsolutePath(),\n                            Long.valueOf(warDocBase.lastModified()));\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(\n                            expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2013-05-15 21:47:29","endLine":667,"groupId":"0","id":41,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/87/8ff02d8349c720c2be7c5c8171e6e3eab066c1.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":533,"status":"M"},{"authorDate":"2011-08-16 02:50:25","commitOrder":21,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2011-08-16 02:50:25","endLine":1403,"groupId":"3011","id":42,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2c/efbb9856417e8a426c7dca164fde6335b506b4.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1369,"status":"N"}],"commitId":"8a052207d4fa3aa13132ca7ea602f1e472b44958","commitMessage":"@@@Change auto-deployment behaviour on deletion. Redeploy order is now always (not all entries will be present)\n- XML\n- WAR (appBase or external)\n- DIR (appBase or external)\n- global resources\n\nWhen a resource is deleted.  all resources below it in the above list are also deleted except external and global resources\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1482834 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2013-05-15 21:47:29","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2011-08-16 02:50:25","codes":[{"authorDate":"2013-05-16 21:40:31","commitOrder":22,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2013-05-16 21:40:31","endLine":658,"groupId":"9516","id":43,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/9c/358b0d1236a4eec96db0d160ce0629e031d6f8.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n\n        \r\n        deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                Long.valueOf(contextXml.lastModified()));\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                    (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                    \r\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (!isExternalWar) {\n                        addWatchedResources(deployedApp,\n                                docBase.getAbsolutePath(), context);\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n            File expandedDocBase = null;\n            if (context.getDocBase() == null) {\n                \r\n                expandedDocBase =\n                        new File(host.getAppBaseFile(), cn.getBaseName());\n            } else {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n            File warDocBase =\n                    new File(expandedDocBase.getAbsolutePath() + \".war\");\n\n            if (isExternalWar && warDocBase.exists()) {\n               \r\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWARs) {\n                    deployedApp.redeployResources.put(\n                            expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                }\n            } else if (!isExternal) {\n                \r\n                if (warDocBase.exists()) {\n                    deployedApp.redeployResources.put(\n                            warDocBase.getAbsolutePath(),\n                            Long.valueOf(warDocBase.lastModified()));\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(\n                            expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":533,"status":"M"},{"authorDate":"2011-08-16 02:50:25","commitOrder":22,"curCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2011-08-16 02:50:25","endLine":1403,"groupId":"3011","id":44,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2c/efbb9856417e8a426c7dca164fde6335b506b4.src","preCode":"    public void manageApp(Context context)  {    \n\n        String contextName = context.getName();\n        \n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n        \n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1369,"status":"N"}],"commitId":"78d121dee6b37ad5195d949c28244a520efabf53","commitMessage":"@@@Revert r1482834\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1483359 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2013-05-16 21:40:31","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2013-05-17 04:39:46","codes":[{"authorDate":"2013-05-17 04:39:46","commitOrder":23,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2013-05-17 04:39:46","endLine":659,"groupId":"9516","id":45,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/3e/ed0b4cf730f4f430c858e2abae658952c5bea4.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp = new DeployedApplication(cn.getName());\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":533,"status":"M"},{"authorDate":"2013-05-17 04:39:46","commitOrder":23,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2013-05-17 04:39:46","endLine":1554,"groupId":"3011","id":46,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/3e/ed0b4cf730f4f430c858e2abae658952c5bea4.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp = new DeployedApplication(contextName);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1519,"status":"M"}],"commitId":"68ac99f6fc8cb62624111ec91be638f4d3d5f85f","commitMessage":"@@@Refactor to enabling reloading rather than redploying of a context when a WAR file changes and there is an XML file present in the Host's configBase. In this scenario.  the context object doesn't need to be re-created because it's config won't change - it is defined by the unchanged XML file in the HOst's configBase.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1483552 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2013-05-17 04:39:46","modifiedFileCount":"2","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2013-05-17 04:39:46","codes":[{"authorDate":"2013-05-17 22:15:29","commitOrder":24,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.reloadResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2013-05-17 22:15:29","endLine":670,"groupId":"9516","id":47,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/06/27a486e1febc8c8fa12154c96c7269c8f5689a.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":533,"status":"M"},{"authorDate":"2013-05-17 04:39:46","commitOrder":24,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2013-05-17 04:39:46","endLine":1554,"groupId":"3011","id":48,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/3e/ed0b4cf730f4f430c858e2abae658952c5bea4.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1519,"status":"N"}],"commitId":"13adb2f9aca3bafa7d594f6f08e365f9dcedf43f","commitMessage":"@@@Add dummy reload resources to trigger a reload if a WAR or DIR is added to an XML\nAdd dummy redploy resources to trigger a redeploy if an XML is added to a WAR\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1483816 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2013-05-17 22:15:29","modifiedFileCount":"1","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2013-05-17 04:39:46","codes":[{"authorDate":"2013-07-25 17:35:44","commitOrder":25,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2013-07-25 17:35:44","endLine":671,"groupId":"9516","id":49,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/0b/db7e5219e857a92ed2884591ba7b7dd7befb4a.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.reloadResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":534,"status":"M"},{"authorDate":"2013-05-17 04:39:46","commitOrder":25,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2013-05-17 04:39:46","endLine":1554,"groupId":"3011","id":50,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/3e/ed0b4cf730f4f430c858e2abae658952c5bea4.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1519,"status":"N"}],"commitId":"ae300fd19340405922e52fac9f4c772e015809b6","commitMessage":"@@@In order to unpack a WAR.  remove the directory before reload a WAR.\nIn a deployment by context descriptor.  WAR that registered to redeploy resources always trigger a reload. \n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1506863 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2013-07-25 17:35:44","modifiedFileCount":"1","status":"M","submitter":"Keiichi Fujino"},{"authorTime":"2013-05-17 04:39:46","codes":[{"authorDate":"2013-11-26 05:52:57","commitOrder":26,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","date":"2013-11-26 05:52:57","endLine":650,"groupId":"9516","id":51,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2f/37cfac3b6c669ea1596761e491babe1c59ad6d.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digester) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":513,"status":"M"},{"authorDate":"2013-05-17 04:39:46","commitOrder":26,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2013-05-17 04:39:46","endLine":1554,"groupId":"3011","id":52,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/3e/ed0b4cf730f4f430c858e2abae658952c5bea4.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1519,"status":"N"}],"commitId":"64235af288da000fc167c56e1ed187e04e0b52cf","commitMessage":"@@@Ensure that the Host's contextClassName attribute is used when parsing descriptors that do not define one.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1545416 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2013-11-26 05:52:57","modifiedFileCount":"2","status":"M","submitter":"Mark Emlyn David Thomas"},{"authorTime":"2013-05-17 04:39:46","codes":[{"authorDate":"2014-04-24 20:50:39","commitOrder":27,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2014-04-24 20:50:39","endLine":656,"groupId":"9516","id":53,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/a9/6f714149c67c3eb81bae9ab22e2335dceb8473.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        \r\n        if(log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":512,"status":"M"},{"authorDate":"2013-05-17 04:39:46","commitOrder":27,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2013-05-17 04:39:46","endLine":1554,"groupId":"3011","id":54,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/3e/ed0b4cf730f4f430c858e2abae658952c5bea4.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1519,"status":"N"}],"commitId":"6388d56b348b8970ea105d1d49f943a543229555","commitMessage":"@@@Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56382\nAdd information about finished deployment and its execution time to the logs. Patch provided by Danila Galimov.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1589698 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2014-04-24 20:50:39","modifiedFileCount":"1","status":"M","submitter":"Violeta Georgieva Georgieva"},{"authorTime":"2013-05-17 04:39:46","codes":[{"authorDate":"2014-10-16 15:55:02","commitOrder":28,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2014-10-16 15:55:02","endLine":654,"groupId":"9516","id":55,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/59/e2f072fc411749015c142b78b1d2e2c22fbaa5.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                deployedApp.redeployResources.put(contextXml.getAbsolutePath(),\n                        Long.valueOf(contextXml.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":512,"status":"M"},{"authorDate":"2013-05-17 04:39:46","commitOrder":28,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2013-05-17 04:39:46","endLine":1554,"groupId":"3011","id":56,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/3e/ed0b4cf730f4f430c858e2abae658952c5bea4.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1519,"status":"N"}],"commitId":"1fdd301b3334ba4617b77196ba3b1fb117fca699","commitMessage":"@@@Remove the unnecessary registration of context.xml as a redeploy resource. \nThe context.xml having an external docBase has already been registered as a redeploy resource at first.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1632228 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2014-10-16 15:55:02","modifiedFileCount":"1","status":"M","submitter":"Keiichi Fujino"},{"authorTime":"2013-05-17 04:39:46","codes":[{"authorDate":"2015-02-23 10:34:50","commitOrder":29,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWARs) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2015-02-23 10:34:50","endLine":659,"groupId":"1744","id":57,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/43/5c142c022e8522c1d60d7e5ce3d197f15c748d.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar && unpackWARs) {\n                deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                        Long.valueOf(expandedDocBase.lastModified()));\n                addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":512,"status":"M"},{"authorDate":"2013-05-17 04:39:46","commitOrder":29,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2013-05-17 04:39:46","endLine":1554,"groupId":"3011","id":58,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/3e/ed0b4cf730f4f430c858e2abae658952c5bea4.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1519,"status":"N"}],"commitId":"a936cc0e5c437a6b6055a022ac336955ebddce3d","commitMessage":"@@@When docBase refers internal war and unpackWARs is set to false.  avoid registration of the invalid redeploy resource that has been added \".war\" extension in duplicate.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1661594 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2015-02-23 10:34:50","modifiedFileCount":"1","status":"M","submitter":"Keiichi Fujino"},{"authorTime":"2013-05-17 04:39:46","codes":[{"authorDate":"2015-02-23 10:37:11","commitOrder":30,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWARs) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2015-02-23 10:37:11","endLine":653,"groupId":"1744","id":59,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/e8/f616f9fbb87c993979b18f5ce22094832494d3.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWARs) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    if (!isExternal && !unpackWARs) {\n                        \r\n                        deployedApp.reloadResources.put(\n                                expandedDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":512,"status":"M"},{"authorDate":"2013-05-17 04:39:46","commitOrder":30,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2013-05-17 04:39:46","endLine":1554,"groupId":"3011","id":60,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/3e/ed0b4cf730f4f430c858e2abae658952c5bea4.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1519,"status":"N"}],"commitId":"87ba48adf7d79581af9529da2b8a9bf42a17992e","commitMessage":"@@@If WAR exists.  it is not necessary to trigger a reload when adding a Directory.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1661595 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2015-02-23 10:37:11","modifiedFileCount":"1","status":"M","submitter":"Keiichi Fujino"},{"authorTime":"2015-03-03 12:17:24","codes":[{"authorDate":"2015-03-03 12:17:24","commitOrder":31,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                boolean unpackWAR = unpackWARs;\n                if (unpackWAR && context instanceof StandardContext) {\n                    unpackWAR = ((StandardContext) context).getUnpackWAR();\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2015-03-03 12:17:24","endLine":657,"groupId":"1744","id":61,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2a/f6380ff60e3dbae9c4ab0118532f276f52fc2f.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWARs) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":512,"status":"M"},{"authorDate":"2015-03-03 12:17:24","commitOrder":31,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2015-03-03 12:17:24","endLine":1616,"groupId":"6703","id":62,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2a/f6380ff60e3dbae9c4ab0118532f276f52fc2f.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        if (isWar && unpackWARs) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1577,"status":"M"}],"commitId":"750aa79a262d6d167e386d0d5f5ffe57190108f8","commitMessage":"@@@Make sure that unpackWAR attribute of Context is handled correctly in HostConfig.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1663522 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2015-03-03 12:17:24","modifiedFileCount":"1","status":"M","submitter":"Keiichi Fujino"},{"authorTime":"2015-03-03 12:17:24","codes":[{"authorDate":"2015-03-05 06:35:11","commitOrder":32,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2015-03-05 06:35:11","endLine":659,"groupId":"7662","id":63,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/6a/a11716c3c971a64ee647366ecddf391e2fb96f.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                boolean unpackWAR = unpackWARs;\n                if (unpackWAR && context instanceof StandardContext) {\n                    unpackWAR = ((StandardContext) context).getUnpackWAR();\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":512,"status":"M"},{"authorDate":"2015-03-03 12:17:24","commitOrder":32,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2015-03-03 12:17:24","endLine":1616,"groupId":"6703","id":64,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2a/f6380ff60e3dbae9c4ab0118532f276f52fc2f.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1577,"status":"N"}],"commitId":"0067fc171fe50d187ae8db3e90a914cc22dae6da","commitMessage":"@@@Follow-up to r1663995.\nkkolino review\nAdd another link. Fix a typo.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1664172 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2015-03-05 06:35:11","modifiedFileCount":"1","status":"M","submitter":"Mark Thomas"},{"authorTime":"2015-03-03 12:17:24","codes":[{"authorDate":"2015-03-05 06:36:50","commitOrder":33,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                boolean unpackWAR = unpackWARs;\n                if (unpackWAR && context instanceof StandardContext) {\n                    unpackWAR = ((StandardContext) context).getUnpackWAR();\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2015-03-05 06:36:50","endLine":657,"groupId":"1744","id":65,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/7b/b2880919cbbe4e0aa07b946bce29010c41f698.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":512,"status":"M"},{"authorDate":"2015-03-03 12:17:24","commitOrder":33,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2015-03-03 12:17:24","endLine":1616,"groupId":"6703","id":66,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2a/f6380ff60e3dbae9c4ab0118532f276f52fc2f.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1577,"status":"N"}],"commitId":"0e1993d54ed36c9cb23f396e3c1afb5a5c24c913","commitMessage":"@@@Revert r1664172 as it included unintended changes\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1664173 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2015-03-05 06:36:50","modifiedFileCount":"1","status":"M","submitter":"Mark Thomas"},{"authorTime":"2015-03-03 12:17:24","codes":[{"authorDate":"2015-03-05 18:48:25","commitOrder":34,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2015-03-05 18:48:25","endLine":659,"groupId":"7662","id":67,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/15/a8d5ba37a86e1340c99b9c4e2a1f2e5a7156ba.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                boolean unpackWAR = unpackWARs;\n                if (unpackWAR && context instanceof StandardContext) {\n                    unpackWAR = ((StandardContext) context).getUnpackWAR();\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (expandedDocBase.exists()) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                \r\n                if (!isExternal) {\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":512,"status":"M"},{"authorDate":"2015-03-03 12:17:24","commitOrder":34,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2015-03-03 12:17:24","endLine":1616,"groupId":"6703","id":68,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2a/f6380ff60e3dbae9c4ab0118532f276f52fc2f.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1577,"status":"N"}],"commitId":"ce5369d7e950eb97acf21f2e8c57e2fa47be9f78","commitMessage":"@@@Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=56608\nWhen deploying an external WAR.  add watched resources in the expanded directory based on whether the expanded directory is expected to exist rather than if it does exist.\nWhen triggering a reload due to a modified watched resource.  ensure that multiple changed watched resources only trigger one reload rather than a series of reloads.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1664301 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2015-03-05 18:48:25","modifiedFileCount":"1","status":"M","submitter":"Mark Thomas"},{"authorTime":"2015-03-03 12:17:24","codes":[{"authorDate":"2016-01-18 07:41:04","commitOrder":35,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2016-01-18 07:41:04","endLine":672,"groupId":"7662","id":69,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/c1/284343baa4599209f92a7682a4f33954db275f.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                    digester.reset();\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":525,"status":"M"},{"authorDate":"2015-03-03 12:17:24","commitOrder":35,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2015-03-03 12:17:24","endLine":1616,"groupId":"6703","id":70,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2a/f6380ff60e3dbae9c4ab0118532f276f52fc2f.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1577,"status":"N"}],"commitId":"46174460eb26616182eb4d49c78bf3a7f5f1fc1a","commitMessage":"@@@Small code improvements in HostConfig class:\n\n1) In deployWAR() call digester.reset() first before doing non-trivial work such as \"new URL(...)\". \nbecause digester is a shared instance. Though a failure in the \"new URL()\" call there is very unlikely.\n\n2) Reduce scope of \"JarEntry entry\" variable.  getting rid of \"finally{entry=null;}\" blocks.\nAnyway a JarEntry is available only while the original JarFile is open.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1725150 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2016-01-18 07:41:04","modifiedFileCount":"1","status":"M","submitter":"Konstantin Kolinko"},{"authorTime":"2015-03-03 12:17:24","codes":[{"authorDate":"2017-10-05 20:44:21","commitOrder":36,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.getDeclaredConstructor().newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2017-10-05 20:44:21","endLine":698,"groupId":"7662","id":71,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/83/46d9667a3c893c069a7ff44ef325420ba30812.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":551,"status":"M"},{"authorDate":"2015-03-03 12:17:24","commitOrder":36,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2015-03-03 12:17:24","endLine":1616,"groupId":"6703","id":72,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2a/f6380ff60e3dbae9c4ab0118532f276f52fc2f.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1577,"status":"N"}],"commitId":"d6de67e099df7007dac7dfe266518ebb178ec440","commitMessage":"@@@Fix some more deprecation warnings when building with Java 9.\nUse of Class.newInstance() in o.a.catalina\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1811198 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2017-10-05 20:44:21","modifiedFileCount":"26","status":"M","submitter":"Mark Thomas"},{"authorTime":"2015-03-03 12:17:24","codes":[{"authorDate":"2017-10-06 02:19:57","commitOrder":37,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener = (LifecycleListener) clazz.getConstructor().newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2017-10-06 02:19:57","endLine":697,"groupId":"7662","id":73,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/ab/9d63cbf1698a30216ddb652cde3f9cbc41bffa.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener =\n                (LifecycleListener) clazz.getDeclaredConstructor().newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":551,"status":"M"},{"authorDate":"2015-03-03 12:17:24","commitOrder":37,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2015-03-03 12:17:24","endLine":1616,"groupId":"6703","id":74,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2a/f6380ff60e3dbae9c4ab0118532f276f52fc2f.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1577,"status":"N"}],"commitId":"a707e35540bacabd943548469d88148d26c8d521","commitMessage":"@@@getDeclaredConstructor() -> getConstructor()\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1811220 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2017-10-06 02:19:57","modifiedFileCount":"65","status":"M","submitter":"Mark Thomas"},{"authorTime":"2015-03-03 12:17:24","codes":[{"authorDate":"2018-02-27 22:08:58","commitOrder":38,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            if (context.getPath() != null) {\n                log.warn(sm.getString(\"hostConfig.deployDescriptor.path\", context.getPath(),\n                        contextXml.getAbsolutePath()));\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener = (LifecycleListener) clazz.getConstructor().newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2018-02-27 22:08:58","endLine":702,"groupId":"7662","id":75,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/d3/5cd3b79205fb5242285500cb5a960488378f30.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener = (LifecycleListener) clazz.getConstructor().newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":551,"status":"M"},{"authorDate":"2015-03-03 12:17:24","commitOrder":38,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2015-03-03 12:17:24","endLine":1616,"groupId":"6703","id":76,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2a/f6380ff60e3dbae9c4ab0118532f276f52fc2f.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1577,"status":"N"}],"commitId":"5f0245408001466ab2bccd9b1749a3aeac393d90","commitMessage":"@@@\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1825454 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2018-02-27 22:08:58","modifiedFileCount":"1","status":"M","submitter":"Mark Thomas"},{"authorTime":"2015-03-03 12:17:24","codes":[{"authorDate":"2018-02-28 05:50:27","commitOrder":39,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            if (context.getPath() != null) {\n                log.warn(sm.getString(\"hostConfig.deployDescriptor.path\", context.getPath(),\n                        contextXml.getAbsolutePath()));\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener = (LifecycleListener) clazz.getConstructor().newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                    \r\n                    File war = new File(host.getAppBaseFile(), cn.getBaseName() + \".war\");\n                    if (war.exists()) {\n                        log.warn(sm.getString(\"hostConfig.deployDescriptor.hiddenWar\",\n                                contextXml.getAbsolutePath(), war.getAbsolutePath()));\n                    }\n                    File dir = new File(host.getAppBaseFile(), cn.getBaseName());\n                    if (dir.exists()) {\n                        log.warn(sm.getString(\"hostConfig.deployDescriptor.hiddenDir\",\n                                contextXml.getAbsolutePath(), dir.getAbsolutePath()));\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2018-02-28 05:50:27","endLine":708,"groupId":"9435","id":77,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/e7/89ec2309aacc58451892b8097883d263bba67d.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            if (context.getPath() != null) {\n                log.warn(sm.getString(\"hostConfig.deployDescriptor.path\", context.getPath(),\n                        contextXml.getAbsolutePath()));\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener = (LifecycleListener) clazz.getConstructor().newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":546,"status":"M"},{"authorDate":"2015-03-03 12:17:24","commitOrder":39,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2015-03-03 12:17:24","endLine":1616,"groupId":"6703","id":78,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2a/f6380ff60e3dbae9c4ab0118532f276f52fc2f.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1577,"status":"N"}],"commitId":"aa0a4c88872df4b9fa263e6a38c2bdef9d1e98ca","commitMessage":"@@@When a deployment descriptor is deployed that references an external docBase and.  as a result.  a docBase under the appBase will be ignored.  log a warning.\n\ngit-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1825508 13f79535-47bb-0310-9956-ffa450edef68\n","date":"2018-02-28 05:50:27","modifiedFileCount":"1","status":"M","submitter":"Mark Thomas"},{"authorTime":"2015-03-03 12:17:24","codes":[{"authorDate":"2021-01-20 21:28:57","commitOrder":40,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            if (context.getPath() != null) {\n                log.warn(sm.getString(\"hostConfig.deployDescriptor.path\", context.getPath(),\n                        contextXml.getAbsolutePath()));\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener = (LifecycleListener) clazz.getConstructor().newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalFile().toPath().startsWith(host.getAppBaseFile().toPath())) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                    \r\n                    File war = new File(host.getAppBaseFile(), cn.getBaseName() + \".war\");\n                    if (war.exists()) {\n                        log.warn(sm.getString(\"hostConfig.deployDescriptor.hiddenWar\",\n                                contextXml.getAbsolutePath(), war.getAbsolutePath()));\n                    }\n                    File dir = new File(host.getAppBaseFile(), cn.getBaseName());\n                    if (dir.exists()) {\n                        log.warn(sm.getString(\"hostConfig.deployDescriptor.hiddenDir\",\n                                contextXml.getAbsolutePath(), dir.getAbsolutePath()));\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2021-01-20 21:28:57","endLine":708,"groupId":"899","id":79,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fd/81ad2a4137fad82f26d7d32dd124051498d9ff.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            if (context.getPath() != null) {\n                log.warn(sm.getString(\"hostConfig.deployDescriptor.path\", context.getPath(),\n                        contextXml.getAbsolutePath()));\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener = (LifecycleListener) clazz.getConstructor().newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalPath().startsWith(\n                        host.getAppBaseFile().getAbsolutePath() + File.separator)) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                    \r\n                    File war = new File(host.getAppBaseFile(), cn.getBaseName() + \".war\");\n                    if (war.exists()) {\n                        log.warn(sm.getString(\"hostConfig.deployDescriptor.hiddenWar\",\n                                contextXml.getAbsolutePath(), war.getAbsolutePath()));\n                    }\n                    File dir = new File(host.getAppBaseFile(), cn.getBaseName());\n                    if (dir.exists()) {\n                        log.warn(sm.getString(\"hostConfig.deployDescriptor.hiddenDir\",\n                                contextXml.getAbsolutePath(), dir.getAbsolutePath()));\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":547,"status":"M"},{"authorDate":"2015-03-03 12:17:24","commitOrder":40,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2015-03-03 12:17:24","endLine":1616,"groupId":"6703","id":80,"instanceNumber":2,"isCurCommit":0,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/2a/f6380ff60e3dbae9c4ab0118532f276f52fc2f.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1577,"status":"N"}],"commitId":"6d66e99ef85da93e4d2c2a536ca51aa3418bfaf4","commitMessage":"@@@Use java.nio.file.Path for consistent sub-directory checking","date":"2021-01-20 21:28:57","modifiedFileCount":"5","status":"M","submitter":"Mark Thomas"},{"authorTime":"2021-05-26 18:09:29","codes":[{"authorDate":"2021-01-20 21:28:57","commitOrder":41,"curCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            if (context.getPath() != null) {\n                log.warn(sm.getString(\"hostConfig.deployDescriptor.path\", context.getPath(),\n                        contextXml.getAbsolutePath()));\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener = (LifecycleListener) clazz.getConstructor().newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalFile().toPath().startsWith(host.getAppBaseFile().toPath())) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                    \r\n                    File war = new File(host.getAppBaseFile(), cn.getBaseName() + \".war\");\n                    if (war.exists()) {\n                        log.warn(sm.getString(\"hostConfig.deployDescriptor.hiddenWar\",\n                                contextXml.getAbsolutePath(), war.getAbsolutePath()));\n                    }\n                    File dir = new File(host.getAppBaseFile(), cn.getBaseName());\n                    if (dir.exists()) {\n                        log.warn(sm.getString(\"hostConfig.deployDescriptor.hiddenDir\",\n                                contextXml.getAbsolutePath(), dir.getAbsolutePath()));\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","date":"2021-01-20 21:28:57","endLine":708,"groupId":"101001","id":81,"instanceNumber":1,"isCurCommit":0,"methodName":"deployDescriptor","params":"(ContextNamecn@FilecontextXml)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/fd/81ad2a4137fad82f26d7d32dd124051498d9ff.src","preCode":"    protected void deployDescriptor(ContextName cn, File contextXml) {\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(cn.getName(), true);\n\n        long startTime = 0;\n        \r\n        if(log.isInfoEnabled()) {\n           startTime = System.currentTimeMillis();\n           log.info(sm.getString(\"hostConfig.deployDescriptor\",\n                    contextXml.getAbsolutePath()));\n        }\n\n        Context context = null;\n        boolean isExternalWar = false;\n        boolean isExternal = false;\n        File expandedDocBase = null;\n\n        try (FileInputStream fis = new FileInputStream(contextXml)) {\n            synchronized (digesterLock) {\n                try {\n                    context = (Context) digester.parse(fis);\n                } catch (Exception e) {\n                    log.error(sm.getString(\n                            \"hostConfig.deployDescriptor.error\",\n                            contextXml.getAbsolutePath()), e);\n                } finally {\n                    digester.reset();\n                    if (context == null) {\n                        context = new FailedContext();\n                    }\n                }\n            }\n\n            if (context.getPath() != null) {\n                log.warn(sm.getString(\"hostConfig.deployDescriptor.path\", context.getPath(),\n                        contextXml.getAbsolutePath()));\n            }\n\n            Class<?> clazz = Class.forName(host.getConfigClass());\n            LifecycleListener listener = (LifecycleListener) clazz.getConstructor().newInstance();\n            context.addLifecycleListener(listener);\n\n            context.setConfigFile(contextXml.toURI().toURL());\n            context.setName(cn.getName());\n            context.setPath(cn.getPath());\n            context.setWebappVersion(cn.getVersion());\n            \r\n            if (context.getDocBase() != null) {\n                File docBase = new File(context.getDocBase());\n                if (!docBase.isAbsolute()) {\n                    docBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n                \r\n                if (!docBase.getCanonicalFile().toPath().startsWith(host.getAppBaseFile().toPath())) {\n                    isExternal = true;\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                    deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                            Long.valueOf(docBase.lastModified()));\n                    if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                        isExternalWar = true;\n                    }\n                    \r\n                    File war = new File(host.getAppBaseFile(), cn.getBaseName() + \".war\");\n                    if (war.exists()) {\n                        log.warn(sm.getString(\"hostConfig.deployDescriptor.hiddenWar\",\n                                contextXml.getAbsolutePath(), war.getAbsolutePath()));\n                    }\n                    File dir = new File(host.getAppBaseFile(), cn.getBaseName());\n                    if (dir.exists()) {\n                        log.warn(sm.getString(\"hostConfig.deployDescriptor.hiddenDir\",\n                                contextXml.getAbsolutePath(), dir.getAbsolutePath()));\n                    }\n                } else {\n                    log.warn(sm.getString(\"hostConfig.deployDescriptor.localDocBaseSpecified\",\n                             docBase));\n                    \r\n                    context.setDocBase(null);\n                }\n            }\n\n            host.addChild(context);\n        } catch (Throwable t) {\n            ExceptionUtils.handleThrowable(t);\n            log.error(sm.getString(\"hostConfig.deployDescriptor.error\",\n                                   contextXml.getAbsolutePath()), t);\n        } finally {\n            \r\n\n            \r\n            expandedDocBase = new File(host.getAppBaseFile(), cn.getBaseName());\n            if (context.getDocBase() != null\n                    && !context.getDocBase().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                \r\n                expandedDocBase = new File(context.getDocBase());\n                if (!expandedDocBase.isAbsolute()) {\n                    \r\n                    expandedDocBase = new File(host.getAppBaseFile(), context.getDocBase());\n                }\n            }\n\n            boolean unpackWAR = unpackWARs;\n            if (unpackWAR && context instanceof StandardContext) {\n                unpackWAR = ((StandardContext) context).getUnpackWAR();\n            }\n\n            \r\n            \r\n            if (isExternalWar) {\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp, expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n            } else {\n                \r\n                if (!isExternal) {\n                    File warDocBase = new File(expandedDocBase.getAbsolutePath() + \".war\");\n                    if (warDocBase.exists()) {\n                        deployedApp.redeployResources.put(warDocBase.getAbsolutePath(),\n                                Long.valueOf(warDocBase.lastModified()));\n                    } else {\n                        \r\n                        deployedApp.redeployResources.put(\n                                warDocBase.getAbsolutePath(),\n                                Long.valueOf(0));\n                    }\n                }\n                if (unpackWAR) {\n                    deployedApp.redeployResources.put(expandedDocBase.getAbsolutePath(),\n                            Long.valueOf(expandedDocBase.lastModified()));\n                    addWatchedResources(deployedApp,\n                            expandedDocBase.getAbsolutePath(), context);\n                } else {\n                    addWatchedResources(deployedApp, null, context);\n                }\n                if (!isExternal) {\n                    \r\n                    \r\n                    deployedApp.redeployResources.put(\n                            contextXml.getAbsolutePath(),\n                            Long.valueOf(contextXml.lastModified()));\n                }\n            }\n            \r\n            \r\n            addGlobalRedeployResources(deployedApp);\n        }\n\n        if (host.findChild(context.getName()) != null) {\n            deployed.put(context.getName(), deployedApp);\n        }\n\n        if (log.isInfoEnabled()) {\n            log.info(sm.getString(\"hostConfig.deployDescriptor.finished\",\n                contextXml.getAbsolutePath(), Long.valueOf(System.currentTimeMillis() - startTime)));\n        }\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":547,"status":"N"},{"authorDate":"2021-05-26 18:09:29","commitOrder":41,"curCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName)) {\n            return;\n        }\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","date":"2021-05-26 18:09:29","endLine":1838,"groupId":"101001","id":82,"instanceNumber":2,"isCurCommit":1,"methodName":"manageApp","params":"(Contextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-tomcat-10-0.7/blobInfo/CC_OUT/blobs/26/735fbcbf5e4c10b913f22b042b070d7ebe31ae.src","preCode":"    public void manageApp(Context context)  {\n\n        String contextName = context.getName();\n\n        if (deployed.containsKey(contextName))\n            return;\n\n        DeployedApplication deployedApp =\n                new DeployedApplication(contextName, false);\n\n        \r\n        boolean isWar = false;\n        if (context.getDocBase() != null) {\n            File docBase = new File(context.getDocBase());\n            if (!docBase.isAbsolute()) {\n                docBase = new File(host.getAppBaseFile(), context.getDocBase());\n            }\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                    Long.valueOf(docBase.lastModified()));\n            if (docBase.getAbsolutePath().toLowerCase(Locale.ENGLISH).endsWith(\".war\")) {\n                isWar = true;\n            }\n        }\n        host.addChild(context);\n        \r\n        \r\n        boolean unpackWAR = unpackWARs;\n        if (unpackWAR && context instanceof StandardContext) {\n            unpackWAR = ((StandardContext) context).getUnpackWAR();\n        }\n        if (isWar && unpackWAR) {\n            File docBase = new File(host.getAppBaseFile(), context.getBaseName());\n            deployedApp.redeployResources.put(docBase.getAbsolutePath(),\n                        Long.valueOf(docBase.lastModified()));\n            addWatchedResources(deployedApp, docBase.getAbsolutePath(), context);\n        } else {\n            addWatchedResources(deployedApp, null, context);\n        }\n        deployed.put(contextName, deployedApp);\n    }\n","realPath":"java/org/apache/catalina/startup/HostConfig.java","repoName":"tomcat","snippetEndLine":0,"snippetStartLine":0,"startLine":1798,"status":"M"}],"commitId":"6a667943c5da6b5d61ac6bec1d7c9de061e3217c","commitMessage":"@@@Code clean-up. Add braces for clarity.\n\nClean-up commit primarily to trigger CI build to test buildbot renaming","date":"2021-05-26 18:09:29","modifiedFileCount":"44","status":"M","submitter":"Mark Thomas"}]
