[{"authorTime":"2018-07-24 02:11:59","codes":[{"authorDate":"2018-09-29 22:44:06","commitOrder":3,"curCode":"    public void deleteBranch(@PathVariable String appId,\n                             @PathVariable String env,\n                             @PathVariable String clusterName,\n                             @PathVariable String namespaceName,\n                             @PathVariable String branchName,\n                             @RequestParam(\"operator\") String operator,\n                             HttpServletRequest request) {\n        boolean canDelete = consumerPermissionValidator.hasReleaseNamespacePermission(request, appId, namespaceName, env) ||\n            (consumerPermissionValidator.hasModifyNamespacePermission(request, appId, namespaceName, env) &&\n                releaseService.loadLatestRelease(appId, Env.valueOf(env), branchName, namespaceName) == null);\n\n        if (!canDelete) {\n            throw new AccessDeniedException(\"Forbidden operation. \"\n                + \"Caused by: 1.you don't have release permission \"\n                + \"or 2. you don't have modification permission \"\n                + \"or 3. you have modification permission but branch has been released\");\n        }\n        namespaceBranchService.deleteBranch(appId, Env.valueOf(env.toUpperCase()), clusterName, namespaceName, branchName, operator);\n\n    }\n","date":"2018-09-29 22:44:06","endLine":85,"groupId":"1717","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"deleteBranch","params":"(@PathVariableStringappId@@PathVariableStringenv@@PathVariableStringclusterName@@PathVariableStringnamespaceName@@PathVariableStringbranchName@@RequestParam(\"operator\")Stringoperator@HttpServletRequestrequest)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-apollo-10-0.7/blobInfo/CC_OUT/blobs/21/85ebb385e3a04268f589133b772b3a9d8eefee.src","preCode":"    public void deleteBranch(@PathVariable String appId,\n                             @PathVariable String env,\n                             @PathVariable String clusterName,\n                             @PathVariable String namespaceName,\n                             @PathVariable String branchName,\n                             @RequestParam(\"operator\") String operator,\n                             HttpServletRequest request) {\n        boolean canDelete = consumerPermissionValidator.hasReleaseNamespacePermission(request, appId, namespaceName, env) ||\n            (consumerPermissionValidator.hasModifyNamespacePermission(request, appId, namespaceName, env) &&\n                releaseService.loadLatestRelease(appId, Env.valueOf(env), branchName, namespaceName) == null);\n\n        if (!canDelete) {\n            throw new AccessDeniedException(\"Forbidden operation. \"\n                + \"Caused by: 1.you don't have release permission \"\n                + \"or 2. you don't have modification permission \"\n                + \"or 3. you have modification permission but branch has been released\");\n        }\n        namespaceBranchService.deleteBranch(appId, Env.valueOf(env.toUpperCase()), clusterName, namespaceName, branchName, operator);\n\n    }\n","realPath":"apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceBranchController.java","repoName":"apollo","snippetEndLine":0,"snippetStartLine":0,"startLine":66,"status":"B"},{"authorDate":"2018-07-24 02:11:59","commitOrder":3,"curCode":"  public void deleteBranch(@PathVariable String appId,\n                           @PathVariable String env,\n                           @PathVariable String clusterName,\n                           @PathVariable String namespaceName,\n                           @PathVariable String branchName) {\n\n    boolean canDelete = permissionValidator.hasReleaseNamespacePermission(appId, namespaceName, env) ||\n            (permissionValidator.hasModifyNamespacePermission(appId, namespaceName, env) &&\n                      releaseService.loadLatestRelease(appId, Env.valueOf(env), branchName, namespaceName) == null);\n\n\n    if (!canDelete) {\n      throw new AccessDeniedException(\"Forbidden operation. \"\n                                      + \"Caused by: 1.you don't have release permission \"\n                                      + \"or 2. you don't have modification permission \"\n                                      + \"or 3. you have modification permission but branch has been released\");\n    }\n\n    namespaceBranchService.deleteBranch(appId, Env.valueOf(env), clusterName, namespaceName, branchName);\n\n  }\n","date":"2018-07-24 02:11:59","endLine":80,"groupId":"1634","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"deleteBranch","params":"(@PathVariableStringappId@@PathVariableStringenv@@PathVariableStringclusterName@@PathVariableStringnamespaceName@@PathVariableStringbranchName)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-apollo-10-0.7/blobInfo/CC_OUT/blobs/45/4255e847c52bb10a17d96fd9f6b2cfe56c6107.src","preCode":"  public void deleteBranch(@PathVariable String appId,\n                           @PathVariable String env,\n                           @PathVariable String clusterName,\n                           @PathVariable String namespaceName,\n                           @PathVariable String branchName) {\n\n    boolean canDelete = permissionValidator.hasReleaseNamespacePermission(appId, namespaceName, env) ||\n            (permissionValidator.hasModifyNamespacePermission(appId, namespaceName, env) &&\n                      releaseService.loadLatestRelease(appId, Env.valueOf(env), branchName, namespaceName) == null);\n\n\n    if (!canDelete) {\n      throw new AccessDeniedException(\"Forbidden operation. \"\n                                      + \"Caused by: 1.you don't have release permission \"\n                                      + \"or 2. you don't have modification permission \"\n                                      + \"or 3. you have modification permission but branch has been released\");\n    }\n\n    namespaceBranchService.deleteBranch(appId, Env.valueOf(env), clusterName, namespaceName, branchName);\n\n  }\n","realPath":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceBranchController.java","repoName":"apollo","snippetEndLine":0,"snippetStartLine":0,"startLine":60,"status":"NB"}],"commitId":"7c435bd5e0308d05097a9e69614e73ee33f099ca","commitMessage":"@@@Merge pull request #1518 from jieqian/gray_release_4_openapi\n\nfeature: add gray operation on Open API","date":"2018-09-29 22:44:06","modifiedFileCount":"7","status":"M","submitter":"Jason Song"},{"authorTime":"2018-07-24 02:11:59","codes":[{"authorDate":"2018-10-05 16:54:17","commitOrder":4,"curCode":"    public void deleteBranch(@PathVariable String appId,\n                             @PathVariable String env,\n                             @PathVariable String clusterName,\n                             @PathVariable String namespaceName,\n                             @PathVariable String branchName,\n                             @RequestParam(\"operator\") String operator,\n                             HttpServletRequest request) {\n        RequestPrecondition.checkArguments(!StringUtils.isContainEmpty(operator),\"operator can not be empty\");\n\n        if (userService.findByUserId(operator) == null) {\n            throw new BadRequestException(\"operator \" + operator + \" not exists\");\n        }\n\n        boolean canDelete = consumerPermissionValidator.hasReleaseNamespacePermission(request, appId, namespaceName, env) ||\n            (consumerPermissionValidator.hasModifyNamespacePermission(request, appId, namespaceName, env) &&\n                releaseService.loadLatestRelease(appId, Env.valueOf(env), branchName, namespaceName) == null);\n\n        if (!canDelete) {\n            throw new AccessDeniedException(\"Forbidden operation. \"\n                + \"Caused by: 1.you don't have release permission \"\n                + \"or 2. you don't have modification permission \"\n                + \"or 3. you have modification permission but branch has been released\");\n        }\n        namespaceBranchService.deleteBranch(appId, Env.valueOf(env.toUpperCase()), clusterName, namespaceName, branchName, operator);\n\n    }\n","date":"2018-10-05 16:54:17","endLine":103,"groupId":"10141","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"deleteBranch","params":"(@PathVariableStringappId@@PathVariableStringenv@@PathVariableStringclusterName@@PathVariableStringnamespaceName@@PathVariableStringbranchName@@RequestParam(\"operator\")Stringoperator@HttpServletRequestrequest)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-apollo-10-0.7/blobInfo/CC_OUT/blobs/e8/625cde2136857f7618123a53d69367b6596d6b.src","preCode":"    public void deleteBranch(@PathVariable String appId,\n                             @PathVariable String env,\n                             @PathVariable String clusterName,\n                             @PathVariable String namespaceName,\n                             @PathVariable String branchName,\n                             @RequestParam(\"operator\") String operator,\n                             HttpServletRequest request) {\n        boolean canDelete = consumerPermissionValidator.hasReleaseNamespacePermission(request, appId, namespaceName, env) ||\n            (consumerPermissionValidator.hasModifyNamespacePermission(request, appId, namespaceName, env) &&\n                releaseService.loadLatestRelease(appId, Env.valueOf(env), branchName, namespaceName) == null);\n\n        if (!canDelete) {\n            throw new AccessDeniedException(\"Forbidden operation. \"\n                + \"Caused by: 1.you don't have release permission \"\n                + \"or 2. you don't have modification permission \"\n                + \"or 3. you have modification permission but branch has been released\");\n        }\n        namespaceBranchService.deleteBranch(appId, Env.valueOf(env.toUpperCase()), clusterName, namespaceName, branchName, operator);\n\n    }\n","realPath":"apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceBranchController.java","repoName":"apollo","snippetEndLine":0,"snippetStartLine":0,"startLine":78,"status":"M"},{"authorDate":"2018-07-24 02:11:59","commitOrder":4,"curCode":"  public void deleteBranch(@PathVariable String appId,\n                           @PathVariable String env,\n                           @PathVariable String clusterName,\n                           @PathVariable String namespaceName,\n                           @PathVariable String branchName) {\n\n    boolean canDelete = permissionValidator.hasReleaseNamespacePermission(appId, namespaceName, env) ||\n            (permissionValidator.hasModifyNamespacePermission(appId, namespaceName, env) &&\n                      releaseService.loadLatestRelease(appId, Env.valueOf(env), branchName, namespaceName) == null);\n\n\n    if (!canDelete) {\n      throw new AccessDeniedException(\"Forbidden operation. \"\n                                      + \"Caused by: 1.you don't have release permission \"\n                                      + \"or 2. you don't have modification permission \"\n                                      + \"or 3. you have modification permission but branch has been released\");\n    }\n\n    namespaceBranchService.deleteBranch(appId, Env.valueOf(env), clusterName, namespaceName, branchName);\n\n  }\n","date":"2018-07-24 02:11:59","endLine":80,"groupId":"10141","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"deleteBranch","params":"(@PathVariableStringappId@@PathVariableStringenv@@PathVariableStringclusterName@@PathVariableStringnamespaceName@@PathVariableStringbranchName)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-apollo-10-0.7/blobInfo/CC_OUT/blobs/45/4255e847c52bb10a17d96fd9f6b2cfe56c6107.src","preCode":"  public void deleteBranch(@PathVariable String appId,\n                           @PathVariable String env,\n                           @PathVariable String clusterName,\n                           @PathVariable String namespaceName,\n                           @PathVariable String branchName) {\n\n    boolean canDelete = permissionValidator.hasReleaseNamespacePermission(appId, namespaceName, env) ||\n            (permissionValidator.hasModifyNamespacePermission(appId, namespaceName, env) &&\n                      releaseService.loadLatestRelease(appId, Env.valueOf(env), branchName, namespaceName) == null);\n\n\n    if (!canDelete) {\n      throw new AccessDeniedException(\"Forbidden operation. \"\n                                      + \"Caused by: 1.you don't have release permission \"\n                                      + \"or 2. you don't have modification permission \"\n                                      + \"or 3. you have modification permission but branch has been released\");\n    }\n\n    namespaceBranchService.deleteBranch(appId, Env.valueOf(env), clusterName, namespaceName, branchName);\n\n  }\n","realPath":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceBranchController.java","repoName":"apollo","snippetEndLine":0,"snippetStartLine":0,"startLine":60,"status":"N"}],"commitId":"39ef9ca67fca9ca390af96ffb727a5109b75a7b0","commitMessage":"@@@Merge pull request #1533 from nobodyiam/open-api-gray-release-refactor\n\nrefactor gray release open api a little bit","date":"2018-10-05 16:54:17","modifiedFileCount":"2","status":"M","submitter":"Jason Song"}]
