[{"authorTime":"2016-11-22 15:47:36","codes":[{"authorDate":"2016-11-22 15:47:36","commitOrder":1,"curCode":"  public void testPublishMasterNamespaceAndBranchHasNotItems() {\n    long parentNamespaceId = 101;\n    String parentClusterName = \"default1\";\n    long childNamespaceId = 102;\n    String childClusterName = \"child-cluster1\";\n    Namespace parentNamespace = instanceNamespace(parentNamespaceId, parentClusterName);\n\n    releaseService.publish(parentNamespace, \"\", \"\", operator);\n\n    Release latestParentNamespaceRelease = releaseService.findLatestActiveRelease(parentNamespace);\n\n    \r\n    Assert.assertNotNull(latestParentNamespaceRelease);\n\n    Map<String, String> parentNamespaceConfiguration = parseConfiguration(latestParentNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, parentNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", parentNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", parentNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", parentNamespaceConfiguration.get(\"k3\"));\n\n    \r\n    Namespace childNamespace = instanceNamespace(childNamespaceId, childClusterName);\n    Release latestChildNamespaceRelease = releaseService.findLatestActiveRelease(childNamespace);\n\n    \r\n    Assert.assertNotNull(latestChildNamespaceRelease);\n\n    Map<String, String> childNamespaceConfiguration = parseConfiguration(latestChildNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, childNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", childNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", childNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", childNamespaceConfiguration.get(\"k3\"));\n\n    GrayReleaseRule rule= namespaceBranchService.findBranchGrayRules(testApp, parentClusterName,\n                                                                     testNamespace, childClusterName);\n    Assert.assertNotNull(rule);\n    Assert.assertEquals(1, rule.getBranchStatus());\n    Assert.assertEquals(Long.valueOf(latestChildNamespaceRelease.getId()), rule.getReleaseId());\n\n    \r\n    Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace\n        (testApp, parentClusterName, testNamespace, pageable);\n\n    ReleaseHistory masterReleaseHistory = releaseHistories.getContent().get(1);\n    ReleaseHistory branchReleaseHistory = releaseHistories.getContent().get(0);\n\n    Assert.assertEquals(2, releaseHistories.getTotalElements());\n    Assert.assertEquals(ReleaseOperation.NORMAL_RELEASE, masterReleaseHistory.getOperation());\n    Assert.assertEquals(latestParentNamespaceRelease.getId(), masterReleaseHistory.getReleaseId());\n    Assert.assertEquals(0, masterReleaseHistory.getPreviousReleaseId());\n    Assert.assertEquals(ReleaseOperation.MASTER_NORMAL_RELEASE_MERGE_TO_GRAY,\n        branchReleaseHistory.getOperation());\n    Assert.assertEquals(latestChildNamespaceRelease.getId(), branchReleaseHistory.getReleaseId());\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(String.format\n        (\"\\\"baseReleaseId\\\":%d\", latestParentNamespaceRelease.getId())));\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(rule.getRules()));\n\n  }\n","date":"2016-11-22 15:47:36","endLine":146,"groupId":"1386","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testPublishMasterNamespaceAndBranchHasNotItems","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-apollo-10-0.7/blobInfo/CC_OUT/blobs/18/0f973bcb036d0c95ae48f48238a48dcbec88b1.src","preCode":"  public void testPublishMasterNamespaceAndBranchHasNotItems() {\n    long parentNamespaceId = 101;\n    String parentClusterName = \"default1\";\n    long childNamespaceId = 102;\n    String childClusterName = \"child-cluster1\";\n    Namespace parentNamespace = instanceNamespace(parentNamespaceId, parentClusterName);\n\n    releaseService.publish(parentNamespace, \"\", \"\", operator);\n\n    Release latestParentNamespaceRelease = releaseService.findLatestActiveRelease(parentNamespace);\n\n    \r\n    Assert.assertNotNull(latestParentNamespaceRelease);\n\n    Map<String, String> parentNamespaceConfiguration = parseConfiguration(latestParentNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, parentNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", parentNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", parentNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", parentNamespaceConfiguration.get(\"k3\"));\n\n    \r\n    Namespace childNamespace = instanceNamespace(childNamespaceId, childClusterName);\n    Release latestChildNamespaceRelease = releaseService.findLatestActiveRelease(childNamespace);\n\n    \r\n    Assert.assertNotNull(latestChildNamespaceRelease);\n\n    Map<String, String> childNamespaceConfiguration = parseConfiguration(latestChildNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, childNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", childNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", childNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", childNamespaceConfiguration.get(\"k3\"));\n\n    GrayReleaseRule rule= namespaceBranchService.findBranchGrayRules(testApp, parentClusterName,\n                                                                     testNamespace, childClusterName);\n    Assert.assertNotNull(rule);\n    Assert.assertEquals(1, rule.getBranchStatus());\n    Assert.assertEquals(Long.valueOf(latestChildNamespaceRelease.getId()), rule.getReleaseId());\n\n    \r\n    Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace\n        (testApp, parentClusterName, testNamespace, pageable);\n\n    ReleaseHistory masterReleaseHistory = releaseHistories.getContent().get(1);\n    ReleaseHistory branchReleaseHistory = releaseHistories.getContent().get(0);\n\n    Assert.assertEquals(2, releaseHistories.getTotalElements());\n    Assert.assertEquals(ReleaseOperation.NORMAL_RELEASE, masterReleaseHistory.getOperation());\n    Assert.assertEquals(latestParentNamespaceRelease.getId(), masterReleaseHistory.getReleaseId());\n    Assert.assertEquals(0, masterReleaseHistory.getPreviousReleaseId());\n    Assert.assertEquals(ReleaseOperation.MASTER_NORMAL_RELEASE_MERGE_TO_GRAY,\n        branchReleaseHistory.getOperation());\n    Assert.assertEquals(latestChildNamespaceRelease.getId(), branchReleaseHistory.getReleaseId());\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(String.format\n        (\"\\\"baseReleaseId\\\":%d\", latestParentNamespaceRelease.getId())));\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(rule.getRules()));\n\n  }\n","realPath":"apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/ReleaseCreationTest.java","repoName":"apollo","snippetEndLine":0,"snippetStartLine":0,"startLine":89,"status":"B"},{"authorDate":"2016-11-22 15:47:36","commitOrder":1,"curCode":"  public void testPublishMasterNamespaceAndBranchHasItems() {\n    long parentNamespaceId = 103;\n    String parentClusterName = \"default2\";\n    long childNamespaceId = 104;\n    String childClusterName = \"child-cluster2\";\n    Namespace parentNamespace = instanceNamespace(parentNamespaceId, parentClusterName);\n\n    releaseService.publish(parentNamespace, \"\", \"\", operator);\n\n    Release latestParentNamespaceRelease = releaseService.findLatestActiveRelease(parentNamespace);\n\n    \r\n    Assert.assertNotNull(latestParentNamespaceRelease);\n\n    Map<String, String> parentNamespaceConfiguration = parseConfiguration(latestParentNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, parentNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", parentNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", parentNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", parentNamespaceConfiguration.get(\"k3\"));\n\n    \r\n    Namespace childNamespace = instanceNamespace(childNamespaceId, childClusterName);\n    Release latestChildNamespaceRelease = releaseService.findLatestActiveRelease(childNamespace);\n\n    Assert.assertNotNull(latestChildNamespaceRelease);\n\n    Map<String, String> childNamespaceConfiguration = parseConfiguration(latestChildNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, childNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", childNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", childNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", childNamespaceConfiguration.get(\"k3\"));\n\n    GrayReleaseRule rule= namespaceBranchService.findBranchGrayRules(testApp, parentClusterName,\n                                                                     testNamespace, childClusterName);\n    Assert.assertNotNull(rule);\n    Assert.assertEquals(1, rule.getBranchStatus());\n    Assert.assertEquals(Long.valueOf(latestChildNamespaceRelease.getId()), rule.getReleaseId());\n\n    \r\n    Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace\n        (testApp, parentClusterName, testNamespace, pageable);\n\n    ReleaseHistory masterReleaseHistory = releaseHistories.getContent().get(1);\n    ReleaseHistory branchReleaseHistory = releaseHistories.getContent().get(0);\n\n    Assert.assertEquals(2, releaseHistories.getTotalElements());\n    Assert.assertEquals(ReleaseOperation.NORMAL_RELEASE, masterReleaseHistory.getOperation());\n    Assert.assertEquals(latestParentNamespaceRelease.getId(), masterReleaseHistory.getReleaseId());\n    Assert.assertEquals(0, masterReleaseHistory.getPreviousReleaseId());\n    Assert.assertEquals(ReleaseOperation.MASTER_NORMAL_RELEASE_MERGE_TO_GRAY,\n        branchReleaseHistory.getOperation());\n    Assert.assertEquals(latestChildNamespaceRelease.getId(), branchReleaseHistory.getReleaseId());\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(String.format\n        (\"\\\"baseReleaseId\\\":%d\", latestParentNamespaceRelease.getId())));\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(rule.getRules()));\n  }\n","date":"2016-11-22 15:47:36","endLine":218,"groupId":"1386","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testPublishMasterNamespaceAndBranchHasItems","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-apollo-10-0.7/blobInfo/CC_OUT/blobs/18/0f973bcb036d0c95ae48f48238a48dcbec88b1.src","preCode":"  public void testPublishMasterNamespaceAndBranchHasItems() {\n    long parentNamespaceId = 103;\n    String parentClusterName = \"default2\";\n    long childNamespaceId = 104;\n    String childClusterName = \"child-cluster2\";\n    Namespace parentNamespace = instanceNamespace(parentNamespaceId, parentClusterName);\n\n    releaseService.publish(parentNamespace, \"\", \"\", operator);\n\n    Release latestParentNamespaceRelease = releaseService.findLatestActiveRelease(parentNamespace);\n\n    \r\n    Assert.assertNotNull(latestParentNamespaceRelease);\n\n    Map<String, String> parentNamespaceConfiguration = parseConfiguration(latestParentNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, parentNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", parentNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", parentNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", parentNamespaceConfiguration.get(\"k3\"));\n\n    \r\n    Namespace childNamespace = instanceNamespace(childNamespaceId, childClusterName);\n    Release latestChildNamespaceRelease = releaseService.findLatestActiveRelease(childNamespace);\n\n    Assert.assertNotNull(latestChildNamespaceRelease);\n\n    Map<String, String> childNamespaceConfiguration = parseConfiguration(latestChildNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, childNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", childNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", childNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", childNamespaceConfiguration.get(\"k3\"));\n\n    GrayReleaseRule rule= namespaceBranchService.findBranchGrayRules(testApp, parentClusterName,\n                                                                     testNamespace, childClusterName);\n    Assert.assertNotNull(rule);\n    Assert.assertEquals(1, rule.getBranchStatus());\n    Assert.assertEquals(Long.valueOf(latestChildNamespaceRelease.getId()), rule.getReleaseId());\n\n    \r\n    Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace\n        (testApp, parentClusterName, testNamespace, pageable);\n\n    ReleaseHistory masterReleaseHistory = releaseHistories.getContent().get(1);\n    ReleaseHistory branchReleaseHistory = releaseHistories.getContent().get(0);\n\n    Assert.assertEquals(2, releaseHistories.getTotalElements());\n    Assert.assertEquals(ReleaseOperation.NORMAL_RELEASE, masterReleaseHistory.getOperation());\n    Assert.assertEquals(latestParentNamespaceRelease.getId(), masterReleaseHistory.getReleaseId());\n    Assert.assertEquals(0, masterReleaseHistory.getPreviousReleaseId());\n    Assert.assertEquals(ReleaseOperation.MASTER_NORMAL_RELEASE_MERGE_TO_GRAY,\n        branchReleaseHistory.getOperation());\n    Assert.assertEquals(latestChildNamespaceRelease.getId(), branchReleaseHistory.getReleaseId());\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(String.format\n        (\"\\\"baseReleaseId\\\":%d\", latestParentNamespaceRelease.getId())));\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(rule.getRules()));\n  }\n","realPath":"apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/ReleaseCreationTest.java","repoName":"apollo","snippetEndLine":0,"snippetStartLine":0,"startLine":163,"status":"B"}],"commitId":"6d7ebbe8491f5a920f20f84867e9114c3fbd17ae","commitMessage":"@@@Merge branch 'master' into 'release'\n\nMaster2Release\n\n\n\nSee merge request !32","date":"2016-11-22 15:47:36","modifiedFileCount":"58","status":"B","submitter":"zl??(IT)"},{"authorTime":"2017-01-19 16:28:42","codes":[{"authorDate":"2017-01-19 16:28:42","commitOrder":2,"curCode":"  public void testPublishMasterNamespaceAndBranchHasNotItems() {\n    long parentNamespaceId = 101;\n    String parentClusterName = \"default1\";\n    long childNamespaceId = 102;\n    String childClusterName = \"child-cluster1\";\n    Namespace parentNamespace = instanceNamespace(parentNamespaceId, parentClusterName);\n\n    releaseService.publish(parentNamespace, \"\", \"\", operator, false);\n\n    Release latestParentNamespaceRelease = releaseService.findLatestActiveRelease(parentNamespace);\n\n    \r\n    Assert.assertNotNull(latestParentNamespaceRelease);\n\n    Map<String, String> parentNamespaceConfiguration = parseConfiguration(latestParentNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, parentNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", parentNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", parentNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", parentNamespaceConfiguration.get(\"k3\"));\n\n    \r\n    Namespace childNamespace = instanceNamespace(childNamespaceId, childClusterName);\n    Release latestChildNamespaceRelease = releaseService.findLatestActiveRelease(childNamespace);\n\n    \r\n    Assert.assertNotNull(latestChildNamespaceRelease);\n\n    Map<String, String> childNamespaceConfiguration = parseConfiguration(latestChildNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, childNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", childNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", childNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", childNamespaceConfiguration.get(\"k3\"));\n\n    GrayReleaseRule rule= namespaceBranchService.findBranchGrayRules(testApp, parentClusterName,\n                                                                     testNamespace, childClusterName);\n    Assert.assertNotNull(rule);\n    Assert.assertEquals(1, rule.getBranchStatus());\n    Assert.assertEquals(Long.valueOf(latestChildNamespaceRelease.getId()), rule.getReleaseId());\n\n    \r\n    Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace\n        (testApp, parentClusterName, testNamespace, pageable);\n\n    ReleaseHistory masterReleaseHistory = releaseHistories.getContent().get(1);\n    ReleaseHistory branchReleaseHistory = releaseHistories.getContent().get(0);\n\n    Assert.assertEquals(2, releaseHistories.getTotalElements());\n    Assert.assertEquals(ReleaseOperation.NORMAL_RELEASE, masterReleaseHistory.getOperation());\n    Assert.assertEquals(latestParentNamespaceRelease.getId(), masterReleaseHistory.getReleaseId());\n    Assert.assertEquals(0, masterReleaseHistory.getPreviousReleaseId());\n    Assert.assertEquals(ReleaseOperation.MASTER_NORMAL_RELEASE_MERGE_TO_GRAY,\n        branchReleaseHistory.getOperation());\n    Assert.assertEquals(latestChildNamespaceRelease.getId(), branchReleaseHistory.getReleaseId());\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(String.format\n        (\"\\\"baseReleaseId\\\":%d\", latestParentNamespaceRelease.getId())));\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(rule.getRules()));\n\n  }\n","date":"2017-01-19 16:28:42","endLine":144,"groupId":"10616","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testPublishMasterNamespaceAndBranchHasNotItems","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-apollo-10-0.7/blobInfo/CC_OUT/blobs/3d/4a5f545d4d21a9b0d390d1c463be35ad4b26b2.src","preCode":"  public void testPublishMasterNamespaceAndBranchHasNotItems() {\n    long parentNamespaceId = 101;\n    String parentClusterName = \"default1\";\n    long childNamespaceId = 102;\n    String childClusterName = \"child-cluster1\";\n    Namespace parentNamespace = instanceNamespace(parentNamespaceId, parentClusterName);\n\n    releaseService.publish(parentNamespace, \"\", \"\", operator);\n\n    Release latestParentNamespaceRelease = releaseService.findLatestActiveRelease(parentNamespace);\n\n    \r\n    Assert.assertNotNull(latestParentNamespaceRelease);\n\n    Map<String, String> parentNamespaceConfiguration = parseConfiguration(latestParentNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, parentNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", parentNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", parentNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", parentNamespaceConfiguration.get(\"k3\"));\n\n    \r\n    Namespace childNamespace = instanceNamespace(childNamespaceId, childClusterName);\n    Release latestChildNamespaceRelease = releaseService.findLatestActiveRelease(childNamespace);\n\n    \r\n    Assert.assertNotNull(latestChildNamespaceRelease);\n\n    Map<String, String> childNamespaceConfiguration = parseConfiguration(latestChildNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, childNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", childNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", childNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", childNamespaceConfiguration.get(\"k3\"));\n\n    GrayReleaseRule rule= namespaceBranchService.findBranchGrayRules(testApp, parentClusterName,\n                                                                     testNamespace, childClusterName);\n    Assert.assertNotNull(rule);\n    Assert.assertEquals(1, rule.getBranchStatus());\n    Assert.assertEquals(Long.valueOf(latestChildNamespaceRelease.getId()), rule.getReleaseId());\n\n    \r\n    Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace\n        (testApp, parentClusterName, testNamespace, pageable);\n\n    ReleaseHistory masterReleaseHistory = releaseHistories.getContent().get(1);\n    ReleaseHistory branchReleaseHistory = releaseHistories.getContent().get(0);\n\n    Assert.assertEquals(2, releaseHistories.getTotalElements());\n    Assert.assertEquals(ReleaseOperation.NORMAL_RELEASE, masterReleaseHistory.getOperation());\n    Assert.assertEquals(latestParentNamespaceRelease.getId(), masterReleaseHistory.getReleaseId());\n    Assert.assertEquals(0, masterReleaseHistory.getPreviousReleaseId());\n    Assert.assertEquals(ReleaseOperation.MASTER_NORMAL_RELEASE_MERGE_TO_GRAY,\n        branchReleaseHistory.getOperation());\n    Assert.assertEquals(latestChildNamespaceRelease.getId(), branchReleaseHistory.getReleaseId());\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(String.format\n        (\"\\\"baseReleaseId\\\":%d\", latestParentNamespaceRelease.getId())));\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(rule.getRules()));\n\n  }\n","realPath":"apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/ReleaseCreationTest.java","repoName":"apollo","snippetEndLine":0,"snippetStartLine":0,"startLine":87,"status":"M"},{"authorDate":"2017-01-19 16:28:42","commitOrder":2,"curCode":"  public void testPublishMasterNamespaceAndBranchHasItems() {\n    long parentNamespaceId = 103;\n    String parentClusterName = \"default2\";\n    long childNamespaceId = 104;\n    String childClusterName = \"child-cluster2\";\n    Namespace parentNamespace = instanceNamespace(parentNamespaceId, parentClusterName);\n\n    releaseService.publish(parentNamespace, \"\", \"\", operator, false);\n\n    Release latestParentNamespaceRelease = releaseService.findLatestActiveRelease(parentNamespace);\n\n    \r\n    Assert.assertNotNull(latestParentNamespaceRelease);\n\n    Map<String, String> parentNamespaceConfiguration = parseConfiguration(latestParentNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, parentNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", parentNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", parentNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", parentNamespaceConfiguration.get(\"k3\"));\n\n    \r\n    Namespace childNamespace = instanceNamespace(childNamespaceId, childClusterName);\n    Release latestChildNamespaceRelease = releaseService.findLatestActiveRelease(childNamespace);\n\n    Assert.assertNotNull(latestChildNamespaceRelease);\n\n    Map<String, String> childNamespaceConfiguration = parseConfiguration(latestChildNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, childNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", childNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", childNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", childNamespaceConfiguration.get(\"k3\"));\n\n    GrayReleaseRule rule= namespaceBranchService.findBranchGrayRules(testApp, parentClusterName,\n                                                                     testNamespace, childClusterName);\n    Assert.assertNotNull(rule);\n    Assert.assertEquals(1, rule.getBranchStatus());\n    Assert.assertEquals(Long.valueOf(latestChildNamespaceRelease.getId()), rule.getReleaseId());\n\n    \r\n    Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace\n        (testApp, parentClusterName, testNamespace, pageable);\n\n    ReleaseHistory masterReleaseHistory = releaseHistories.getContent().get(1);\n    ReleaseHistory branchReleaseHistory = releaseHistories.getContent().get(0);\n\n    Assert.assertEquals(2, releaseHistories.getTotalElements());\n    Assert.assertEquals(ReleaseOperation.NORMAL_RELEASE, masterReleaseHistory.getOperation());\n    Assert.assertEquals(latestParentNamespaceRelease.getId(), masterReleaseHistory.getReleaseId());\n    Assert.assertEquals(0, masterReleaseHistory.getPreviousReleaseId());\n    Assert.assertEquals(ReleaseOperation.MASTER_NORMAL_RELEASE_MERGE_TO_GRAY,\n        branchReleaseHistory.getOperation());\n    Assert.assertEquals(latestChildNamespaceRelease.getId(), branchReleaseHistory.getReleaseId());\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(String.format\n        (\"\\\"baseReleaseId\\\":%d\", latestParentNamespaceRelease.getId())));\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(rule.getRules()));\n  }\n","date":"2017-01-19 16:28:42","endLine":216,"groupId":"10616","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testPublishMasterNamespaceAndBranchHasItems","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-apollo-10-0.7/blobInfo/CC_OUT/blobs/3d/4a5f545d4d21a9b0d390d1c463be35ad4b26b2.src","preCode":"  public void testPublishMasterNamespaceAndBranchHasItems() {\n    long parentNamespaceId = 103;\n    String parentClusterName = \"default2\";\n    long childNamespaceId = 104;\n    String childClusterName = \"child-cluster2\";\n    Namespace parentNamespace = instanceNamespace(parentNamespaceId, parentClusterName);\n\n    releaseService.publish(parentNamespace, \"\", \"\", operator);\n\n    Release latestParentNamespaceRelease = releaseService.findLatestActiveRelease(parentNamespace);\n\n    \r\n    Assert.assertNotNull(latestParentNamespaceRelease);\n\n    Map<String, String> parentNamespaceConfiguration = parseConfiguration(latestParentNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, parentNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", parentNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", parentNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", parentNamespaceConfiguration.get(\"k3\"));\n\n    \r\n    Namespace childNamespace = instanceNamespace(childNamespaceId, childClusterName);\n    Release latestChildNamespaceRelease = releaseService.findLatestActiveRelease(childNamespace);\n\n    Assert.assertNotNull(latestChildNamespaceRelease);\n\n    Map<String, String> childNamespaceConfiguration = parseConfiguration(latestChildNamespaceRelease.getConfigurations());\n    Assert.assertEquals(3, childNamespaceConfiguration.size());\n    Assert.assertEquals(\"v1\", childNamespaceConfiguration.get(\"k1\"));\n    Assert.assertEquals(\"v2\", childNamespaceConfiguration.get(\"k2\"));\n    Assert.assertEquals(\"v3\", childNamespaceConfiguration.get(\"k3\"));\n\n    GrayReleaseRule rule= namespaceBranchService.findBranchGrayRules(testApp, parentClusterName,\n                                                                     testNamespace, childClusterName);\n    Assert.assertNotNull(rule);\n    Assert.assertEquals(1, rule.getBranchStatus());\n    Assert.assertEquals(Long.valueOf(latestChildNamespaceRelease.getId()), rule.getReleaseId());\n\n    \r\n    Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace\n        (testApp, parentClusterName, testNamespace, pageable);\n\n    ReleaseHistory masterReleaseHistory = releaseHistories.getContent().get(1);\n    ReleaseHistory branchReleaseHistory = releaseHistories.getContent().get(0);\n\n    Assert.assertEquals(2, releaseHistories.getTotalElements());\n    Assert.assertEquals(ReleaseOperation.NORMAL_RELEASE, masterReleaseHistory.getOperation());\n    Assert.assertEquals(latestParentNamespaceRelease.getId(), masterReleaseHistory.getReleaseId());\n    Assert.assertEquals(0, masterReleaseHistory.getPreviousReleaseId());\n    Assert.assertEquals(ReleaseOperation.MASTER_NORMAL_RELEASE_MERGE_TO_GRAY,\n        branchReleaseHistory.getOperation());\n    Assert.assertEquals(latestChildNamespaceRelease.getId(), branchReleaseHistory.getReleaseId());\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(String.format\n        (\"\\\"baseReleaseId\\\":%d\", latestParentNamespaceRelease.getId())));\n    Assert.assertTrue(branchReleaseHistory.getOperationContext().contains(rule.getRules()));\n  }\n","realPath":"apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/ReleaseCreationTest.java","repoName":"apollo","snippetEndLine":0,"snippetStartLine":0,"startLine":161,"status":"M"}],"commitId":"4f3dd644a2dde5e77186ec8aac124e27b45c14b3","commitMessage":"@@@Merge pull request #520 from lepdou/emergency_publish\n\nemergency publish","date":"2017-01-19 16:28:42","modifiedFileCount":"15","status":"M","submitter":"Jason Song"}]
