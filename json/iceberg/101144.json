[{"authorTime":"2020-11-14 07:55:36","codes":[{"authorDate":"2020-11-14 07:55:36","commitOrder":1,"curCode":"  public void testCherrypickSnapshotUsingPositionalArgs() {\n    sql(\"CREATE TABLE %s (id bigint NOT NULL, data string) USING iceberg\", tableName);\n    sql(\"ALTER TABLE %s SET TBLPROPERTIES ('%s' 'true')\", tableName, WRITE_AUDIT_PUBLISH_ENABLED);\n\n    spark.conf().set(\"spark.wap.id\", \"1\");\n\n    sql(\"INSERT INTO TABLE %s VALUES (1, 'a')\", tableName);\n\n    assertEquals(\"Should not see rows from staged snapshot\",\n        ImmutableList.of(),\n        sql(\"SELECT * FROM %s\", tableName));\n\n    Table table = validationCatalog.loadTable(tableIdent);\n    Snapshot wapSnapshot = Iterables.getOnlyElement(table.snapshots());\n\n    List<Object[]> output = sql(\n        \"CALL %s.system.cherrypick_snapshot('%s', '%s', %dL)\",\n        catalogName, tableIdent.namespace(), tableIdent.name(), wapSnapshot.snapshotId());\n\n    table.refresh();\n\n    Snapshot currentSnapshot = table.currentSnapshot();\n\n    assertEquals(\"Procedure output must match\",\n        ImmutableList.of(row(wapSnapshot.snapshotId(), currentSnapshot.snapshotId())),\n        output);\n\n    assertEquals(\"Cherrypick must be successful\",\n        ImmutableList.of(row(1L, \"a\")),\n        sql(\"SELECT * FROM %s\", tableName));\n  }\n","date":"2020-11-14 07:55:36","endLine":82,"groupId":"1672","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testCherrypickSnapshotUsingPositionalArgs","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/9d/f5639073e8cb81a1f5411385aaf3e3263a0187.src","preCode":"  public void testCherrypickSnapshotUsingPositionalArgs() {\n    sql(\"CREATE TABLE %s (id bigint NOT NULL, data string) USING iceberg\", tableName);\n    sql(\"ALTER TABLE %s SET TBLPROPERTIES ('%s' 'true')\", tableName, WRITE_AUDIT_PUBLISH_ENABLED);\n\n    spark.conf().set(\"spark.wap.id\", \"1\");\n\n    sql(\"INSERT INTO TABLE %s VALUES (1, 'a')\", tableName);\n\n    assertEquals(\"Should not see rows from staged snapshot\",\n        ImmutableList.of(),\n        sql(\"SELECT * FROM %s\", tableName));\n\n    Table table = validationCatalog.loadTable(tableIdent);\n    Snapshot wapSnapshot = Iterables.getOnlyElement(table.snapshots());\n\n    List<Object[]> output = sql(\n        \"CALL %s.system.cherrypick_snapshot('%s', '%s', %dL)\",\n        catalogName, tableIdent.namespace(), tableIdent.name(), wapSnapshot.snapshotId());\n\n    table.refresh();\n\n    Snapshot currentSnapshot = table.currentSnapshot();\n\n    assertEquals(\"Procedure output must match\",\n        ImmutableList.of(row(wapSnapshot.snapshotId(), currentSnapshot.snapshotId())),\n        output);\n\n    assertEquals(\"Cherrypick must be successful\",\n        ImmutableList.of(row(1L, \"a\")),\n        sql(\"SELECT * FROM %s\", tableName));\n  }\n","realPath":"spark3-extensions/src/test/java/org/apache/iceberg/spark/extensions/TestCherrypickSnapshotProcedure.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":52,"status":"B"},{"authorDate":"2020-11-14 07:55:36","commitOrder":1,"curCode":"  public void testCherrypickSnapshotUsingNamedArgs() {\n    sql(\"CREATE TABLE %s (id bigint NOT NULL, data string) USING iceberg\", tableName);\n    sql(\"ALTER TABLE %s SET TBLPROPERTIES ('%s' 'true')\", tableName, WRITE_AUDIT_PUBLISH_ENABLED);\n\n    spark.conf().set(\"spark.wap.id\", \"1\");\n\n    sql(\"INSERT INTO TABLE %s VALUES (1, 'a')\", tableName);\n\n    assertEquals(\"Should not see rows from staged snapshot\",\n        ImmutableList.of(),\n        sql(\"SELECT * FROM %s\", tableName));\n\n    Table table = validationCatalog.loadTable(tableIdent);\n    Snapshot wapSnapshot = Iterables.getOnlyElement(table.snapshots());\n\n    List<Object[]> output = sql(\n        \"CALL %s.system.cherrypick_snapshot(snapshot_id => %dL, table => '%s', namespace => '%s')\",\n        catalogName, wapSnapshot.snapshotId(), tableIdent.name(), tableIdent.namespace());\n\n    table.refresh();\n\n    Snapshot currentSnapshot = table.currentSnapshot();\n\n    assertEquals(\"Procedure output must match\",\n        ImmutableList.of(row(wapSnapshot.snapshotId(), currentSnapshot.snapshotId())),\n        output);\n\n    assertEquals(\"Cherrypick must be successful\",\n        ImmutableList.of(row(1L, \"a\")),\n        sql(\"SELECT * FROM %s\", tableName));\n  }\n","date":"2020-11-14 07:55:36","endLine":115,"groupId":"3309","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testCherrypickSnapshotUsingNamedArgs","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/9d/f5639073e8cb81a1f5411385aaf3e3263a0187.src","preCode":"  public void testCherrypickSnapshotUsingNamedArgs() {\n    sql(\"CREATE TABLE %s (id bigint NOT NULL, data string) USING iceberg\", tableName);\n    sql(\"ALTER TABLE %s SET TBLPROPERTIES ('%s' 'true')\", tableName, WRITE_AUDIT_PUBLISH_ENABLED);\n\n    spark.conf().set(\"spark.wap.id\", \"1\");\n\n    sql(\"INSERT INTO TABLE %s VALUES (1, 'a')\", tableName);\n\n    assertEquals(\"Should not see rows from staged snapshot\",\n        ImmutableList.of(),\n        sql(\"SELECT * FROM %s\", tableName));\n\n    Table table = validationCatalog.loadTable(tableIdent);\n    Snapshot wapSnapshot = Iterables.getOnlyElement(table.snapshots());\n\n    List<Object[]> output = sql(\n        \"CALL %s.system.cherrypick_snapshot(snapshot_id => %dL, table => '%s', namespace => '%s')\",\n        catalogName, wapSnapshot.snapshotId(), tableIdent.name(), tableIdent.namespace());\n\n    table.refresh();\n\n    Snapshot currentSnapshot = table.currentSnapshot();\n\n    assertEquals(\"Procedure output must match\",\n        ImmutableList.of(row(wapSnapshot.snapshotId(), currentSnapshot.snapshotId())),\n        output);\n\n    assertEquals(\"Cherrypick must be successful\",\n        ImmutableList.of(row(1L, \"a\")),\n        sql(\"SELECT * FROM %s\", tableName));\n  }\n","realPath":"spark3-extensions/src/test/java/org/apache/iceberg/spark/extensions/TestCherrypickSnapshotProcedure.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":85,"status":"B"}],"commitId":"165a278086f4b9b75f65e947ed4064fe5d633e83","commitMessage":"@@@Spark: Add CherrypickSnapshotProcedure (#1771)\n\n","date":"2020-11-14 07:55:36","modifiedFileCount":"1","status":"B","submitter":"Anton Okolnychyi"},{"authorTime":"2020-12-09 23:37:55","codes":[{"authorDate":"2020-12-09 23:37:55","commitOrder":2,"curCode":"  public void testCherrypickSnapshotUsingPositionalArgs() {\n    sql(\"CREATE TABLE %s (id bigint NOT NULL, data string) USING iceberg\", tableName);\n    sql(\"ALTER TABLE %s SET TBLPROPERTIES ('%s' 'true')\", tableName, WRITE_AUDIT_PUBLISH_ENABLED);\n\n    spark.conf().set(\"spark.wap.id\", \"1\");\n\n    sql(\"INSERT INTO TABLE %s VALUES (1, 'a')\", tableName);\n\n    assertEquals(\"Should not see rows from staged snapshot\",\n        ImmutableList.of(),\n        sql(\"SELECT * FROM %s\", tableName));\n\n    Table table = validationCatalog.loadTable(tableIdent);\n    Snapshot wapSnapshot = Iterables.getOnlyElement(table.snapshots());\n\n    List<Object[]> output = sql(\n        \"CALL %s.system.cherrypick_snapshot('%s', %dL)\",\n        catalogName, tableIdent, wapSnapshot.snapshotId());\n\n    table.refresh();\n\n    Snapshot currentSnapshot = table.currentSnapshot();\n\n    assertEquals(\"Procedure output must match\",\n        ImmutableList.of(row(wapSnapshot.snapshotId(), currentSnapshot.snapshotId())),\n        output);\n\n    assertEquals(\"Cherrypick must be successful\",\n        ImmutableList.of(row(1L, \"a\")),\n        sql(\"SELECT * FROM %s\", tableName));\n  }\n","date":"2020-12-09 23:37:55","endLine":81,"groupId":"101144","id":3,"instanceNumber":1,"isCurCommit":1,"methodName":"testCherrypickSnapshotUsingPositionalArgs","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/ba/1c5db167477d4526c560b5f6a422f692c5cd46.src","preCode":"  public void testCherrypickSnapshotUsingPositionalArgs() {\n    sql(\"CREATE TABLE %s (id bigint NOT NULL, data string) USING iceberg\", tableName);\n    sql(\"ALTER TABLE %s SET TBLPROPERTIES ('%s' 'true')\", tableName, WRITE_AUDIT_PUBLISH_ENABLED);\n\n    spark.conf().set(\"spark.wap.id\", \"1\");\n\n    sql(\"INSERT INTO TABLE %s VALUES (1, 'a')\", tableName);\n\n    assertEquals(\"Should not see rows from staged snapshot\",\n        ImmutableList.of(),\n        sql(\"SELECT * FROM %s\", tableName));\n\n    Table table = validationCatalog.loadTable(tableIdent);\n    Snapshot wapSnapshot = Iterables.getOnlyElement(table.snapshots());\n\n    List<Object[]> output = sql(\n        \"CALL %s.system.cherrypick_snapshot('%s', '%s', %dL)\",\n        catalogName, tableIdent.namespace(), tableIdent.name(), wapSnapshot.snapshotId());\n\n    table.refresh();\n\n    Snapshot currentSnapshot = table.currentSnapshot();\n\n    assertEquals(\"Procedure output must match\",\n        ImmutableList.of(row(wapSnapshot.snapshotId(), currentSnapshot.snapshotId())),\n        output);\n\n    assertEquals(\"Cherrypick must be successful\",\n        ImmutableList.of(row(1L, \"a\")),\n        sql(\"SELECT * FROM %s\", tableName));\n  }\n","realPath":"spark3-extensions/src/test/java/org/apache/iceberg/spark/extensions/TestCherrypickSnapshotProcedure.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":51,"status":"M"},{"authorDate":"2020-12-09 23:37:55","commitOrder":2,"curCode":"  public void testCherrypickSnapshotUsingNamedArgs() {\n    sql(\"CREATE TABLE %s (id bigint NOT NULL, data string) USING iceberg\", tableName);\n    sql(\"ALTER TABLE %s SET TBLPROPERTIES ('%s' 'true')\", tableName, WRITE_AUDIT_PUBLISH_ENABLED);\n\n    spark.conf().set(\"spark.wap.id\", \"1\");\n\n    sql(\"INSERT INTO TABLE %s VALUES (1, 'a')\", tableName);\n\n    assertEquals(\"Should not see rows from staged snapshot\",\n        ImmutableList.of(),\n        sql(\"SELECT * FROM %s\", tableName));\n\n    Table table = validationCatalog.loadTable(tableIdent);\n    Snapshot wapSnapshot = Iterables.getOnlyElement(table.snapshots());\n\n    List<Object[]> output = sql(\n        \"CALL %s.system.cherrypick_snapshot(snapshot_id => %dL, table => '%s')\",\n        catalogName, wapSnapshot.snapshotId(), tableIdent);\n\n    table.refresh();\n\n    Snapshot currentSnapshot = table.currentSnapshot();\n\n    assertEquals(\"Procedure output must match\",\n        ImmutableList.of(row(wapSnapshot.snapshotId(), currentSnapshot.snapshotId())),\n        output);\n\n    assertEquals(\"Cherrypick must be successful\",\n        ImmutableList.of(row(1L, \"a\")),\n        sql(\"SELECT * FROM %s\", tableName));\n  }\n","date":"2020-12-09 23:37:55","endLine":114,"groupId":"101144","id":4,"instanceNumber":2,"isCurCommit":1,"methodName":"testCherrypickSnapshotUsingNamedArgs","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/ba/1c5db167477d4526c560b5f6a422f692c5cd46.src","preCode":"  public void testCherrypickSnapshotUsingNamedArgs() {\n    sql(\"CREATE TABLE %s (id bigint NOT NULL, data string) USING iceberg\", tableName);\n    sql(\"ALTER TABLE %s SET TBLPROPERTIES ('%s' 'true')\", tableName, WRITE_AUDIT_PUBLISH_ENABLED);\n\n    spark.conf().set(\"spark.wap.id\", \"1\");\n\n    sql(\"INSERT INTO TABLE %s VALUES (1, 'a')\", tableName);\n\n    assertEquals(\"Should not see rows from staged snapshot\",\n        ImmutableList.of(),\n        sql(\"SELECT * FROM %s\", tableName));\n\n    Table table = validationCatalog.loadTable(tableIdent);\n    Snapshot wapSnapshot = Iterables.getOnlyElement(table.snapshots());\n\n    List<Object[]> output = sql(\n        \"CALL %s.system.cherrypick_snapshot(snapshot_id => %dL, table => '%s', namespace => '%s')\",\n        catalogName, wapSnapshot.snapshotId(), tableIdent.name(), tableIdent.namespace());\n\n    table.refresh();\n\n    Snapshot currentSnapshot = table.currentSnapshot();\n\n    assertEquals(\"Procedure output must match\",\n        ImmutableList.of(row(wapSnapshot.snapshotId(), currentSnapshot.snapshotId())),\n        output);\n\n    assertEquals(\"Cherrypick must be successful\",\n        ImmutableList.of(row(1L, \"a\")),\n        sql(\"SELECT * FROM %s\", tableName));\n  }\n","realPath":"spark3-extensions/src/test/java/org/apache/iceberg/spark/extensions/TestCherrypickSnapshotProcedure.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":84,"status":"M"}],"commitId":"e39584ed89356cacf006610bffd475a3ad3a1ac4","commitMessage":"@@@Spark: Migrate to identifiers in procedures (#1890)\n\n","date":"2020-12-09 23:37:55","modifiedFileCount":"16","status":"M","submitter":"Russell Spitzer"}]
