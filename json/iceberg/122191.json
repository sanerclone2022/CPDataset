[{"authorTime":"2020-12-16 09:52:18","codes":[{"authorDate":"2020-12-16 09:52:18","commitOrder":1,"curCode":"  public BaseUpdatePartitionSpec addField(String name, Term term) {\n    PartitionField alreadyAdded = nameToAddedField.get(name);\n    Preconditions.checkArgument(alreadyAdded == null, \"Cannot add duplicate partition field: %s\", alreadyAdded);\n\n    Pair<Integer, Transform<?, ?>> sourceTransform = resolve(term);\n    Pair<Integer, String> validationKey = Pair.of(sourceTransform.first(), sourceTransform.second().toString());\n\n    PartitionField existing = transformToField.get(validationKey);\n    Preconditions.checkArgument(existing == null,\n        \"Cannot add duplicate partition field %s=%s, conflicts with %s\", name, term, existing);\n\n    PartitionField added = transformToAddedField.get(validationKey);\n    Preconditions.checkArgument(added == null,\n        \"Cannot add duplicate partition field %s=%s, already added: %s\", name, term, added);\n\n    PartitionField newField = new PartitionField(\n        sourceTransform.first(), assignFieldId(), name, sourceTransform.second());\n    checkForRedundantAddedPartitions(newField);\n\n    transformToAddedField.put(validationKey, newField);\n    if (name != null) {\n      nameToAddedField.put(name, newField);\n    }\n\n    adds.add(newField);\n\n    return this;\n  }\n","date":"2020-12-16 09:52:18","endLine":149,"groupId":"4119","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"addField","params":"(Stringname@Termterm)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/ef/cf0894abb37e612cffa6718f42cdb357e989e2.src","preCode":"  public BaseUpdatePartitionSpec addField(String name, Term term) {\n    PartitionField alreadyAdded = nameToAddedField.get(name);\n    Preconditions.checkArgument(alreadyAdded == null, \"Cannot add duplicate partition field: %s\", alreadyAdded);\n\n    Pair<Integer, Transform<?, ?>> sourceTransform = resolve(term);\n    Pair<Integer, String> validationKey = Pair.of(sourceTransform.first(), sourceTransform.second().toString());\n\n    PartitionField existing = transformToField.get(validationKey);\n    Preconditions.checkArgument(existing == null,\n        \"Cannot add duplicate partition field %s=%s, conflicts with %s\", name, term, existing);\n\n    PartitionField added = transformToAddedField.get(validationKey);\n    Preconditions.checkArgument(added == null,\n        \"Cannot add duplicate partition field %s=%s, already added: %s\", name, term, added);\n\n    PartitionField newField = new PartitionField(\n        sourceTransform.first(), assignFieldId(), name, sourceTransform.second());\n    checkForRedundantAddedPartitions(newField);\n\n    transformToAddedField.put(validationKey, newField);\n    if (name != null) {\n      nameToAddedField.put(name, newField);\n    }\n\n    adds.add(newField);\n\n    return this;\n  }\n","realPath":"core/src/main/java/org/apache/iceberg/BaseUpdatePartitionSpec.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":122,"status":"B"},{"authorDate":"2020-12-16 09:52:18","commitOrder":1,"curCode":"  public BaseUpdatePartitionSpec removeField(Term term) {\n    Pair<Integer, Transform<?, ?>> sourceTransform = resolve(term);\n    Pair<Integer, String> key = Pair.of(sourceTransform.first(), sourceTransform.second().toString());\n\n    PartitionField added = transformToAddedField.get(key);\n    Preconditions.checkArgument(added == null, \"Cannot delete newly added field: %s\", added);\n\n    PartitionField field = transformToField.get(key);\n    Preconditions.checkArgument(field != null,\n        \"Cannot find partition field to remove: %s\", term);\n    Preconditions.checkArgument(renames.get(field.name()) == null,\n        \"Cannot rename and delete partition field: %s\", field.name());\n\n    deletes.add(field.fieldId());\n\n    return this;\n  }\n","date":"2020-12-16 09:52:18","endLine":185,"groupId":"4119","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"removeField","params":"(Termterm)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/ef/cf0894abb37e612cffa6718f42cdb357e989e2.src","preCode":"  public BaseUpdatePartitionSpec removeField(Term term) {\n    Pair<Integer, Transform<?, ?>> sourceTransform = resolve(term);\n    Pair<Integer, String> key = Pair.of(sourceTransform.first(), sourceTransform.second().toString());\n\n    PartitionField added = transformToAddedField.get(key);\n    Preconditions.checkArgument(added == null, \"Cannot delete newly added field: %s\", added);\n\n    PartitionField field = transformToField.get(key);\n    Preconditions.checkArgument(field != null,\n        \"Cannot find partition field to remove: %s\", term);\n    Preconditions.checkArgument(renames.get(field.name()) == null,\n        \"Cannot rename and delete partition field: %s\", field.name());\n\n    deletes.add(field.fieldId());\n\n    return this;\n  }\n","realPath":"core/src/main/java/org/apache/iceberg/BaseUpdatePartitionSpec.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":169,"status":"B"}],"commitId":"ab6a5e9ebf2f580fb7be21fb00f1f543726f43eb","commitMessage":"@@@Core: Add UpdatePartitionSpec implementation (#1919)\n\n","date":"2020-12-16 09:52:18","modifiedFileCount":"2","status":"B","submitter":"Ryan Blue"},{"authorTime":"2020-12-16 09:52:18","codes":[{"authorDate":"2021-06-21 19:28:25","commitOrder":2,"curCode":"  public BaseUpdatePartitionSpec addField(String name, Term term) {\n    PartitionField alreadyAdded = nameToAddedField.get(name);\n    Preconditions.checkArgument(alreadyAdded == null, \"Cannot add duplicate partition field: %s\", alreadyAdded);\n\n    Pair<Integer, Transform<?, ?>> sourceTransform = resolve(term);\n    Pair<Integer, String> validationKey = Pair.of(sourceTransform.first(), sourceTransform.second().toString());\n\n    PartitionField existing = transformToField.get(validationKey);\n    Preconditions.checkArgument(existing == null,\n        \"Cannot add duplicate partition field %s=%s, conflicts with %s\", name, term, existing);\n\n    PartitionField added = transformToAddedField.get(validationKey);\n    Preconditions.checkArgument(added == null,\n        \"Cannot add duplicate partition field %s=%s, already added: %s\", name, term, added);\n\n    PartitionField newField = new PartitionField(\n        sourceTransform.first(), assignFieldId(), name, sourceTransform.second());\n    if (newField.name() == null) {\n      String partitionName = PartitionSpecVisitor.visit(schema, newField, PartitionNameGenerator.INSTANCE);\n      newField = new PartitionField(newField.sourceId(), newField.fieldId(), partitionName, newField.transform());\n    }\n\n    checkForRedundantAddedPartitions(newField);\n    transformToAddedField.put(validationKey, newField);\n\n    PartitionField existingField = nameToField.get(newField.name());\n    if (existingField != null) {\n      if (isVoidTransform(existingField)) {\n        \r\n        renameField(existingField.name(), existingField.name() + \"_\" + existingField.fieldId());\n      } else {\n        throw new IllegalArgumentException(String.format(\"Cannot add duplicate partition field name: %s\", name));\n      }\n    }\n\n    nameToAddedField.put(newField.name(), newField);\n\n    adds.add(newField);\n\n    return this;\n  }\n","date":"2021-06-21 19:28:25","endLine":168,"groupId":"122191","id":3,"instanceNumber":1,"isCurCommit":1,"methodName":"addField","params":"(Stringname@Termterm)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/80/f8188002d587c76acf01a5784aea3d30f35ff9.src","preCode":"  public BaseUpdatePartitionSpec addField(String name, Term term) {\n    PartitionField alreadyAdded = nameToAddedField.get(name);\n    Preconditions.checkArgument(alreadyAdded == null, \"Cannot add duplicate partition field: %s\", alreadyAdded);\n\n    Pair<Integer, Transform<?, ?>> sourceTransform = resolve(term);\n    Pair<Integer, String> validationKey = Pair.of(sourceTransform.first(), sourceTransform.second().toString());\n\n    PartitionField existing = transformToField.get(validationKey);\n    Preconditions.checkArgument(existing == null,\n        \"Cannot add duplicate partition field %s=%s, conflicts with %s\", name, term, existing);\n\n    PartitionField added = transformToAddedField.get(validationKey);\n    Preconditions.checkArgument(added == null,\n        \"Cannot add duplicate partition field %s=%s, already added: %s\", name, term, added);\n\n    PartitionField newField = new PartitionField(\n        sourceTransform.first(), assignFieldId(), name, sourceTransform.second());\n    checkForRedundantAddedPartitions(newField);\n\n    transformToAddedField.put(validationKey, newField);\n    if (name != null) {\n      nameToAddedField.put(name, newField);\n    }\n\n    adds.add(newField);\n\n    return this;\n  }\n","realPath":"core/src/main/java/org/apache/iceberg/BaseUpdatePartitionSpec.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":128,"status":"M"},{"authorDate":"2020-12-16 09:52:18","commitOrder":2,"curCode":"  public BaseUpdatePartitionSpec removeField(Term term) {\n    Pair<Integer, Transform<?, ?>> sourceTransform = resolve(term);\n    Pair<Integer, String> key = Pair.of(sourceTransform.first(), sourceTransform.second().toString());\n\n    PartitionField added = transformToAddedField.get(key);\n    Preconditions.checkArgument(added == null, \"Cannot delete newly added field: %s\", added);\n\n    PartitionField field = transformToField.get(key);\n    Preconditions.checkArgument(field != null,\n        \"Cannot find partition field to remove: %s\", term);\n    Preconditions.checkArgument(renames.get(field.name()) == null,\n        \"Cannot rename and delete partition field: %s\", field.name());\n\n    deletes.add(field.fieldId());\n\n    return this;\n  }\n","date":"2020-12-16 09:52:18","endLine":185,"groupId":"122191","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"removeField","params":"(Termterm)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/ef/cf0894abb37e612cffa6718f42cdb357e989e2.src","preCode":"  public BaseUpdatePartitionSpec removeField(Term term) {\n    Pair<Integer, Transform<?, ?>> sourceTransform = resolve(term);\n    Pair<Integer, String> key = Pair.of(sourceTransform.first(), sourceTransform.second().toString());\n\n    PartitionField added = transformToAddedField.get(key);\n    Preconditions.checkArgument(added == null, \"Cannot delete newly added field: %s\", added);\n\n    PartitionField field = transformToField.get(key);\n    Preconditions.checkArgument(field != null,\n        \"Cannot find partition field to remove: %s\", term);\n    Preconditions.checkArgument(renames.get(field.name()) == null,\n        \"Cannot rename and delete partition field: %s\", field.name());\n\n    deletes.add(field.fieldId());\n\n    return this;\n  }\n","realPath":"core/src/main/java/org/apache/iceberg/BaseUpdatePartitionSpec.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":169,"status":"N"}],"commitId":"619603c443a200f687284c01d13e5961a920c036","commitMessage":"@@@fix: add and remove partition transform on same column failed when use v1 metadata (#2691)\n\n","date":"2021-06-21 19:28:25","modifiedFileCount":"2","status":"M","submitter":"vinson0526"}]
