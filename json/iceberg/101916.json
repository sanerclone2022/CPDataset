[{"authorTime":"2020-08-06 04:22:25","codes":[{"authorDate":"2020-08-06 04:22:25","commitOrder":1,"curCode":"  public void testPartitionedTableWithPartitionEqDeletes() {\n    table.newAppend()\n        .appendFile(FILE_A)\n        .commit();\n\n    table.newRowDelta()\n        .addDeletes(FILE_A_EQ_1)\n        .commit();\n\n    List<FileScanTask> tasks = Lists.newArrayList(table.newScan().planFiles().iterator());\n    Assert.assertEquals(\"Should have one task\", 1, tasks.size());\n\n    FileScanTask task = tasks.get(0);\n    Assert.assertEquals(\"Should have the correct data file path\",\n        FILE_A.path(), task.file().path());\n    Assert.assertEquals(\"Should have one associated delete file\",\n        1, task.deletes().size());\n    Assert.assertEquals(\"Should have only pos delete file\",\n        FILE_A_EQ_1.path(), task.deletes().get(0).path());\n  }\n","date":"2020-08-06 04:22:25","endLine":220,"groupId":"3363","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testPartitionedTableWithPartitionEqDeletes","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/40/d8363cc3202da93979634f4a473092758c95b2.src","preCode":"  public void testPartitionedTableWithPartitionEqDeletes() {\n    table.newAppend()\n        .appendFile(FILE_A)\n        .commit();\n\n    table.newRowDelta()\n        .addDeletes(FILE_A_EQ_1)\n        .commit();\n\n    List<FileScanTask> tasks = Lists.newArrayList(table.newScan().planFiles().iterator());\n    Assert.assertEquals(\"Should have one task\", 1, tasks.size());\n\n    FileScanTask task = tasks.get(0);\n    Assert.assertEquals(\"Should have the correct data file path\",\n        FILE_A.path(), task.file().path());\n    Assert.assertEquals(\"Should have one associated delete file\",\n        1, task.deletes().size());\n    Assert.assertEquals(\"Should have only pos delete file\",\n        FILE_A_EQ_1.path(), task.deletes().get(0).path());\n  }\n","realPath":"core/src/test/java/org/apache/iceberg/TestDeleteFileIndex.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":201,"status":"B"},{"authorDate":"2020-08-06 04:22:25","commitOrder":1,"curCode":"  public void testPartitionedTableScanWithGlobalDeletes() {\n    table.newAppend()\n        .appendFile(FILE_A)\n        .commit();\n\n    TableMetadata base = table.ops().current();\n    table.ops().commit(base, base.updatePartitionSpec(PartitionSpec.unpartitioned()));\n\n    \r\n    table.newRowDelta()\n        .addDeletes(UNPARTITIONED_POS_DELETES)\n        .addDeletes(UNPARTITIONED_EQ_DELETES)\n        .commit();\n\n    List<FileScanTask> tasks = Lists.newArrayList(table.newScan().planFiles().iterator());\n    Assert.assertEquals(\"Should have one task\", 1, tasks.size());\n\n    FileScanTask task = tasks.get(0);\n    Assert.assertEquals(\"Should have the correct data file path\",\n        FILE_A.path(), task.file().path());\n    Assert.assertEquals(\"Should have one associated delete file\",\n        1, task.deletes().size());\n    Assert.assertEquals(\"Should have expected delete file\",\n        UNPARTITIONED_EQ_DELETES.path(), task.deletes().get(0).path());\n  }\n","date":"2020-08-06 04:22:25","endLine":289,"groupId":"3363","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testPartitionedTableScanWithGlobalDeletes","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/40/d8363cc3202da93979634f4a473092758c95b2.src","preCode":"  public void testPartitionedTableScanWithGlobalDeletes() {\n    table.newAppend()\n        .appendFile(FILE_A)\n        .commit();\n\n    TableMetadata base = table.ops().current();\n    table.ops().commit(base, base.updatePartitionSpec(PartitionSpec.unpartitioned()));\n\n    \r\n    table.newRowDelta()\n        .addDeletes(UNPARTITIONED_POS_DELETES)\n        .addDeletes(UNPARTITIONED_EQ_DELETES)\n        .commit();\n\n    List<FileScanTask> tasks = Lists.newArrayList(table.newScan().planFiles().iterator());\n    Assert.assertEquals(\"Should have one task\", 1, tasks.size());\n\n    FileScanTask task = tasks.get(0);\n    Assert.assertEquals(\"Should have the correct data file path\",\n        FILE_A.path(), task.file().path());\n    Assert.assertEquals(\"Should have one associated delete file\",\n        1, task.deletes().size());\n    Assert.assertEquals(\"Should have expected delete file\",\n        UNPARTITIONED_EQ_DELETES.path(), task.deletes().get(0).path());\n  }\n","realPath":"core/src/test/java/org/apache/iceberg/TestDeleteFileIndex.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":265,"status":"B"}],"commitId":"0cd284978c3800a30d44aa2454dd5730b9bebfa7","commitMessage":"@@@Update scan planning with DeleteFiles in each task (#1288)\n\nThis adds `DeleteFileIndex` to scan delete manifests and index delete files.  updates `ManifestGroup` to use the index when planning tasks.  and adds delete files to `FileScanTask`.\n\nThe `DeleteFileIndex` uses a map keyed by partition spec ID and partition tuple. Values of the map are sorted list of sequence numbers and corresponding `DeleteFile` instances. When looking up a `DataFile`.  the potentially matching delete files are fetched using its partition tuple.  then the sequence numbers are binary searched to find the matching set of delete files with sequence numbers higher than the data file.\n\nThe index also supports global equality delete files. If an equality delete file is added to the table with an unpartitioned spec.  it will be returned for all data files with a lower sequence number.  regardless of partition.","date":"2020-08-06 04:22:25","modifiedFileCount":"11","status":"B","submitter":"Ryan Blue"},{"authorTime":"2021-03-30 08:24:02","codes":[{"authorDate":"2020-08-06 04:22:25","commitOrder":2,"curCode":"  public void testPartitionedTableWithPartitionEqDeletes() {\n    table.newAppend()\n        .appendFile(FILE_A)\n        .commit();\n\n    table.newRowDelta()\n        .addDeletes(FILE_A_EQ_1)\n        .commit();\n\n    List<FileScanTask> tasks = Lists.newArrayList(table.newScan().planFiles().iterator());\n    Assert.assertEquals(\"Should have one task\", 1, tasks.size());\n\n    FileScanTask task = tasks.get(0);\n    Assert.assertEquals(\"Should have the correct data file path\",\n        FILE_A.path(), task.file().path());\n    Assert.assertEquals(\"Should have one associated delete file\",\n        1, task.deletes().size());\n    Assert.assertEquals(\"Should have only pos delete file\",\n        FILE_A_EQ_1.path(), task.deletes().get(0).path());\n  }\n","date":"2020-08-06 04:22:25","endLine":220,"groupId":"101916","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testPartitionedTableWithPartitionEqDeletes","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/40/d8363cc3202da93979634f4a473092758c95b2.src","preCode":"  public void testPartitionedTableWithPartitionEqDeletes() {\n    table.newAppend()\n        .appendFile(FILE_A)\n        .commit();\n\n    table.newRowDelta()\n        .addDeletes(FILE_A_EQ_1)\n        .commit();\n\n    List<FileScanTask> tasks = Lists.newArrayList(table.newScan().planFiles().iterator());\n    Assert.assertEquals(\"Should have one task\", 1, tasks.size());\n\n    FileScanTask task = tasks.get(0);\n    Assert.assertEquals(\"Should have the correct data file path\",\n        FILE_A.path(), task.file().path());\n    Assert.assertEquals(\"Should have one associated delete file\",\n        1, task.deletes().size());\n    Assert.assertEquals(\"Should have only pos delete file\",\n        FILE_A_EQ_1.path(), task.deletes().get(0).path());\n  }\n","realPath":"core/src/test/java/org/apache/iceberg/TestDeleteFileIndex.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":201,"status":"N"},{"authorDate":"2021-03-30 08:24:02","commitOrder":2,"curCode":"  public void testPartitionedTableScanWithGlobalDeletes() {\n    table.newAppend()\n        .appendFile(FILE_A)\n        .commit();\n\n    TableMetadata base = table.ops().current();\n    table.ops().commit(base, base.updatePartitionSpec(PartitionSpec.unpartitioned()));\n\n    \r\n    DeleteFile unpartitionedEqDeletes = unpartitionedEqDeletes(table.spec());\n    table.newRowDelta()\n        .addDeletes(unpartitionedPosDeletes(table.spec()))\n        .addDeletes(unpartitionedEqDeletes)\n        .commit();\n\n    List<FileScanTask> tasks = Lists.newArrayList(table.newScan().planFiles().iterator());\n    Assert.assertEquals(\"Should have one task\", 1, tasks.size());\n\n    FileScanTask task = tasks.get(0);\n    Assert.assertEquals(\"Should have the correct data file path\",\n        FILE_A.path(), task.file().path());\n    Assert.assertEquals(\"Should have one associated delete file\",\n        1, task.deletes().size());\n    Assert.assertEquals(\"Should have expected delete file\",\n        unpartitionedEqDeletes.path(), task.deletes().get(0).path());\n  }\n","date":"2021-03-30 08:24:02","endLine":314,"groupId":"101916","id":4,"instanceNumber":2,"isCurCommit":1,"methodName":"testPartitionedTableScanWithGlobalDeletes","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-iceberg-10-0.7/blobInfo/CC_OUT/blobs/17/91eaaf67d2732357c6cfd6d591c2099814cd30.src","preCode":"  public void testPartitionedTableScanWithGlobalDeletes() {\n    table.newAppend()\n        .appendFile(FILE_A)\n        .commit();\n\n    TableMetadata base = table.ops().current();\n    table.ops().commit(base, base.updatePartitionSpec(PartitionSpec.unpartitioned()));\n\n    \r\n    table.newRowDelta()\n        .addDeletes(UNPARTITIONED_POS_DELETES)\n        .addDeletes(UNPARTITIONED_EQ_DELETES)\n        .commit();\n\n    List<FileScanTask> tasks = Lists.newArrayList(table.newScan().planFiles().iterator());\n    Assert.assertEquals(\"Should have one task\", 1, tasks.size());\n\n    FileScanTask task = tasks.get(0);\n    Assert.assertEquals(\"Should have the correct data file path\",\n        FILE_A.path(), task.file().path());\n    Assert.assertEquals(\"Should have one associated delete file\",\n        1, task.deletes().size());\n    Assert.assertEquals(\"Should have expected delete file\",\n        UNPARTITIONED_EQ_DELETES.path(), task.deletes().get(0).path());\n  }\n","realPath":"core/src/test/java/org/apache/iceberg/TestDeleteFileIndex.java","repoName":"iceberg","snippetEndLine":0,"snippetStartLine":0,"startLine":289,"status":"M"}],"commitId":"aba898b1a2ea15fd091228626b6887a5a72800c0","commitMessage":"@@@Spark: Fix RewriteDataFilesAction with custom outputSpecId (#2293)\n\n","date":"2021-03-30 08:24:02","modifiedFileCount":"7","status":"M","submitter":"Edgar Rodriguez"}]
