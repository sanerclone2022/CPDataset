[{"authorTime":"2020-12-12 23:20:10","codes":[{"authorDate":"2021-05-01 18:10:08","commitOrder":2,"curCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(dataSourceMap, \"discovery_db\", Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","date":"2021-05-01 18:10:08","endLine":119,"groupId":"652","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"updatePrimaryDataSource","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/d3/0fcb124ecc5a5c85afcd655a0c7fb03776a8ea.src","preCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(dataSourceMap, \"discovery_db\", Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","realPath":"shardingsphere-features/shardingsphere-db-discovery/shardingsphere-db-discovery-provider/shardingsphere-db-discovery-mgr/src/test/java/org/apache/shardingsphere/dbdiscovery/mgr/MGRDatabaseDiscoveryTypeTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":83,"status":"B"},{"authorDate":"2020-12-12 23:20:10","commitOrder":2,"curCode":"    private Map<String, DatabaseType> getDatabaseTypes() {\n        Map<String, DatabaseType> result = new HashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            result.put(String.format(SCHEMA_PATTERN, i), new MySQLDatabaseType());\n        }\n        return result;\n    }\n","date":"2020-12-12 23:20:10","endLine":109,"groupId":"11785","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"getDatabaseTypes","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/1c/141e80ce669dbbcdc7b561457ca64ea6ad3fa7.src","preCode":"    private Map<String, DatabaseType> getDatabaseTypes() {\n        Map<String, DatabaseType> result = new HashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            result.put(String.format(SCHEMA_PATTERN, i), new MySQLDatabaseType());\n        }\n        return result;\n    }\n","realPath":"shardingsphere-proxy/shardingsphere-proxy-backend/src/test/java/org/apache/shardingsphere/proxy/backend/text/data/impl/BroadcastDatabaseBackendHandlerTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":103,"status":"NB"}],"commitId":"0c1a59f202af796493b279157538e3e460b4f823","commitMessage":"@@@Rename package name from db.discovery to dbdiscovery (#10232)\n\n","date":"2021-05-01 18:10:08","modifiedFileCount":"4","status":"M","submitter":"Liang Zhang"},{"authorTime":"2020-12-12 23:20:10","codes":[{"authorDate":"2021-09-06 06:30:59","commitOrder":3,"curCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(\"discovery_db\", dataSourceMap, Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","date":"2021-09-06 06:30:59","endLine":119,"groupId":"10893","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"updatePrimaryDataSource","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/3b/fb40cc0ebe20bd3588ed733b6428f7930f4f1a.src","preCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(dataSourceMap, \"discovery_db\", Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","realPath":"shardingsphere-features/shardingsphere-db-discovery/shardingsphere-db-discovery-provider/shardingsphere-db-discovery-mgr/src/test/java/org/apache/shardingsphere/dbdiscovery/mgr/MGRDatabaseDiscoveryTypeTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":83,"status":"M"},{"authorDate":"2020-12-12 23:20:10","commitOrder":3,"curCode":"    private Map<String, DatabaseType> getDatabaseTypes() {\n        Map<String, DatabaseType> result = new HashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            result.put(String.format(SCHEMA_PATTERN, i), new MySQLDatabaseType());\n        }\n        return result;\n    }\n","date":"2020-12-12 23:20:10","endLine":109,"groupId":"10893","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"getDatabaseTypes","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/1c/141e80ce669dbbcdc7b561457ca64ea6ad3fa7.src","preCode":"    private Map<String, DatabaseType> getDatabaseTypes() {\n        Map<String, DatabaseType> result = new HashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            result.put(String.format(SCHEMA_PATTERN, i), new MySQLDatabaseType());\n        }\n        return result;\n    }\n","realPath":"shardingsphere-proxy/shardingsphere-proxy-backend/src/test/java/org/apache/shardingsphere/proxy/backend/text/data/impl/BroadcastDatabaseBackendHandlerTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":103,"status":"N"}],"commitId":"89f9871ff79d769d22964caf1e6ba2aa91e9c3ec","commitMessage":"@@@Remove databaseType ref of DatabaseDiscoveryRule (#12231)\n\n* Remove databaseType ref of DatabaseDiscoveryRule\n\n* Refactor DatabaseDiscoveryType","date":"2021-09-06 06:30:59","modifiedFileCount":"11","status":"M","submitter":"Liang Zhang"}]
