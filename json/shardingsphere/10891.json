[{"authorTime":"2020-12-21 19:41:50","codes":[{"authorDate":"2021-05-01 18:10:08","commitOrder":3,"curCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(dataSourceMap, \"discovery_db\", Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","date":"2021-05-01 18:10:08","endLine":119,"groupId":"652","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"updatePrimaryDataSource","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/d3/0fcb124ecc5a5c85afcd655a0c7fb03776a8ea.src","preCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(dataSourceMap, \"discovery_db\", Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","realPath":"shardingsphere-features/shardingsphere-db-discovery/shardingsphere-db-discovery-provider/shardingsphere-db-discovery-mgr/src/test/java/org/apache/shardingsphere/dbdiscovery/mgr/MGRDatabaseDiscoveryTypeTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":83,"status":"B"},{"authorDate":"2020-12-21 19:41:50","commitOrder":3,"curCode":"    private Map<String, ShardingSphereMetaData> createMetaDataMap() {\n        Map<String, ShardingSphereMetaData> result = new LinkedHashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            ShardingSphereMetaData metaData = mock(ShardingSphereMetaData.class);\n            when(metaData.getResource()).thenReturn(new ShardingSphereResource(Collections.emptyMap(), null, null, new MySQLDatabaseType()));\n            when(metaData.getRuleMetaData()).thenReturn(new ShardingSphereRuleMetaData(Collections.emptyList(), Collections.emptyList()));\n            result.put(String.format(SCHEMA_PATTERN, i), metaData);\n        }\n        return result;\n    }\n","date":"2020-12-21 19:41:50","endLine":141,"groupId":"2329","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"createMetaDataMap","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/0e/9fdd03d32a25e1d9714d09ca99d31b12d5c191.src","preCode":"    private Map<String, ShardingSphereMetaData> createMetaDataMap() {\n        Map<String, ShardingSphereMetaData> result = new LinkedHashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            ShardingSphereMetaData metaData = mock(ShardingSphereMetaData.class);\n            when(metaData.getResource()).thenReturn(new ShardingSphereResource(Collections.emptyMap(), null, null, new MySQLDatabaseType()));\n            when(metaData.getRuleMetaData()).thenReturn(new ShardingSphereRuleMetaData(Collections.emptyList(), Collections.emptyList()));\n            result.put(String.format(SCHEMA_PATTERN, i), metaData);\n        }\n        return result;\n    }\n","realPath":"shardingsphere-proxy/shardingsphere-proxy-backend/src/test/java/org/apache/shardingsphere/proxy/backend/context/ProxyContextTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":132,"status":"NB"}],"commitId":"0c1a59f202af796493b279157538e3e460b4f823","commitMessage":"@@@Rename package name from db.discovery to dbdiscovery (#10232)\n\n","date":"2021-05-01 18:10:08","modifiedFileCount":"4","status":"M","submitter":"Liang Zhang"},{"authorTime":"2021-06-24 15:39:40","codes":[{"authorDate":"2021-05-01 18:10:08","commitOrder":4,"curCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(dataSourceMap, \"discovery_db\", Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","date":"2021-05-01 18:10:08","endLine":119,"groupId":"652","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"updatePrimaryDataSource","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/d3/0fcb124ecc5a5c85afcd655a0c7fb03776a8ea.src","preCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(dataSourceMap, \"discovery_db\", Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","realPath":"shardingsphere-features/shardingsphere-db-discovery/shardingsphere-db-discovery-provider/shardingsphere-db-discovery-mgr/src/test/java/org/apache/shardingsphere/dbdiscovery/mgr/MGRDatabaseDiscoveryTypeTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":83,"status":"N"},{"authorDate":"2021-06-24 15:39:40","commitOrder":4,"curCode":"    private Map<String, ShardingSphereMetaData> createMetaDataMap() {\n        Map<String, ShardingSphereMetaData> result = new LinkedHashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            ShardingSphereMetaData metaData = mock(ShardingSphereMetaData.class);\n            ShardingSphereSchema schema = mock(ShardingSphereSchema.class);\n            when(metaData.getResource()).thenReturn(new ShardingSphereResource(Collections.emptyMap(), null, null, new MySQLDatabaseType()));\n            when(metaData.getRuleMetaData()).thenReturn(new ShardingSphereRuleMetaData(Collections.emptyList(), Collections.emptyList()));\n            when(metaData.getSchema()).thenReturn(schema);\n            when(schema.getTables()).thenReturn(new HashMap<>());\n            result.put(String.format(SCHEMA_PATTERN, i), metaData);\n        }\n        return result;\n    }\n","date":"2021-06-24 15:39:40","endLine":130,"groupId":"12363","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"createMetaDataMap","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/c8/cc8e8e5ca81fa762a99df3ac6ba5aa78b0c9c2.src","preCode":"    private Map<String, ShardingSphereMetaData> createMetaDataMap() {\n        Map<String, ShardingSphereMetaData> result = new LinkedHashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            ShardingSphereMetaData metaData = mock(ShardingSphereMetaData.class);\n            when(metaData.getResource()).thenReturn(new ShardingSphereResource(Collections.emptyMap(), null, null, new MySQLDatabaseType()));\n            when(metaData.getRuleMetaData()).thenReturn(new ShardingSphereRuleMetaData(Collections.emptyList(), Collections.emptyList()));\n            result.put(String.format(SCHEMA_PATTERN, i), metaData);\n        }\n        return result;\n    }\n","realPath":"shardingsphere-proxy/shardingsphere-proxy-backend/src/test/java/org/apache/shardingsphere/proxy/backend/context/ProxyContextTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":118,"status":"M"}],"commitId":"b72ab3242674b4b64e61a3d4e1dd5c603c5bfcaa","commitMessage":"@@@Improve the initialization of OptimizeContextFactory for issue#10678 (#10840)\n\n* fixed 10678\n\n* fixed code\n\n* fixed 10678\n\n* test\n\n* fixed 10678\n\n* update test case\n\n* update test case\n\n* update test case\n\n* fix method error\n\n* checkstyle\n\n* fix ci and checkstyle\n\n* checkstyle\n\n* fix ci error\n\n* fix load table\n\n* Update StandardMetaDataContexts.java\n\n* Update dql-integration-test-cases.xml\n\n* Update FederateTableMetadata.java\n\n* Update OptimizeContextFactory.java\n\n* Update SchemaBuilder.java\n\n* Update FederateSchemaMetadatas.java","date":"2021-06-24 15:39:40","modifiedFileCount":"20","status":"M","submitter":"totalo"},{"authorTime":"2021-07-27 07:22:30","codes":[{"authorDate":"2021-05-01 18:10:08","commitOrder":5,"curCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(dataSourceMap, \"discovery_db\", Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","date":"2021-05-01 18:10:08","endLine":119,"groupId":"652","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"updatePrimaryDataSource","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/d3/0fcb124ecc5a5c85afcd655a0c7fb03776a8ea.src","preCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(dataSourceMap, \"discovery_db\", Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","realPath":"shardingsphere-features/shardingsphere-db-discovery/shardingsphere-db-discovery-provider/shardingsphere-db-discovery-mgr/src/test/java/org/apache/shardingsphere/dbdiscovery/mgr/MGRDatabaseDiscoveryTypeTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":83,"status":"N"},{"authorDate":"2021-07-27 07:22:30","commitOrder":5,"curCode":"    private Map<String, ShardingSphereMetaData> createMetaDataMap() {\n        Map<String, ShardingSphereMetaData> result = new LinkedHashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            result.put(String.format(SCHEMA_PATTERN, i), mock(ShardingSphereMetaData.class));\n        }\n        return result;\n    }\n","date":"2021-07-27 07:22:30","endLine":121,"groupId":"11785","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"createMetaDataMap","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/ee/7e9005b1e55a75d060de3aa4da7448f8d8c0f5.src","preCode":"    private Map<String, ShardingSphereMetaData> createMetaDataMap() {\n        Map<String, ShardingSphereMetaData> result = new LinkedHashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            ShardingSphereMetaData metaData = mock(ShardingSphereMetaData.class);\n            ShardingSphereSchema schema = mock(ShardingSphereSchema.class);\n            when(metaData.getResource()).thenReturn(new ShardingSphereResource(Collections.emptyMap(), null, null, new MySQLDatabaseType()));\n            when(metaData.getRuleMetaData()).thenReturn(new ShardingSphereRuleMetaData(Collections.emptyList(), Collections.emptyList()));\n            when(metaData.getSchema()).thenReturn(schema);\n            when(schema.getTables()).thenReturn(new HashMap<>());\n            result.put(String.format(SCHEMA_PATTERN, i), metaData);\n        }\n        return result;\n    }\n","realPath":"shardingsphere-proxy/shardingsphere-proxy-backend/src/test/java/org/apache/shardingsphere/proxy/backend/context/ProxyContextTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":115,"status":"M"}],"commitId":"6d7e3fe33533f8d8dd098e81d667ce57aabd625a","commitMessage":"@@@Use raw new HashMap to instead of guava (#11517)\n\n* Use raw new HashMap to instead of guava\n\n* Use raw new HashMap to instead of guava","date":"2021-07-27 07:22:30","modifiedFileCount":"69","status":"M","submitter":"Liang Zhang"},{"authorTime":"2021-07-27 07:22:30","codes":[{"authorDate":"2021-09-06 06:30:59","commitOrder":6,"curCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(\"discovery_db\", dataSourceMap, Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","date":"2021-09-06 06:30:59","endLine":119,"groupId":"10891","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"updatePrimaryDataSource","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/3b/fb40cc0ebe20bd3588ed733b6428f7930f4f1a.src","preCode":"    public void updatePrimaryDataSource() {\n        List<DataSource> dataSources = new LinkedList<>();\n        List<Connection> connections = new LinkedList<>();\n        List<Statement> statements = new LinkedList<>();\n        List<ResultSet> resultSets = new LinkedList<>();\n        List<DatabaseMetaData> databaseMetaData = new LinkedList<>();\n        for (int i = 0; i < 3; i++) {\n            dataSources.add(mock(DataSource.class));\n            connections.add(mock(Connection.class));\n            statements.add(mock(Statement.class));\n            resultSets.add(mock(ResultSet.class));\n            databaseMetaData.add(mock(DatabaseMetaData.class));\n        }\n        String sql = \"SELECT MEMBER_HOST, MEMBER_PORT FROM performance_schema.replication_group_members WHERE MEMBER_ID = \"\n                + \"(SELECT VARIABLE_VALUE FROM performance_schema.global_status WHERE VARIABLE_NAME = 'group_replication_primary_member')\";\n        try {\n            for (int i = 0; i < 3; i++) {\n                when(dataSources.get(i).getConnection()).thenReturn(connections.get(i));\n                when(connections.get(i).createStatement()).thenReturn(statements.get(i));\n                when(statements.get(i).executeQuery(sql)).thenReturn(resultSets.get(i));\n                when(resultSets.get(i).next()).thenReturn(true, false);\n                when(resultSets.get(i).getString(\"MEMBER_HOST\")).thenReturn(\"127.0.0.1\");\n                when(resultSets.get(i).getString(\"MEMBER_PORT\")).thenReturn(Integer.toString(3306 + i));\n                when(connections.get(i).getMetaData()).thenReturn(databaseMetaData.get(i));\n                when(databaseMetaData.get(i).getURL()).thenReturn(\"jdbc:mysql://127.0.0.1:\" + (3306 + i) + \"/ds_0?serverTimezone=UTC&useSSL=false\");\n            }\n        } catch (final SQLException ex) {\n            throw new ShardingSphereException(ex);\n        }\n        Map<String, DataSource> dataSourceMap = new HashMap<>(3, 1);\n        for (int i = 0; i < 3; i++) {\n            dataSourceMap.put(String.format(\"ds_%s\", i), dataSources.get(i));\n        }\n        mgrHaType.getProps().setProperty(\"groupName\", \"group_name\");\n        mgrHaType.updatePrimaryDataSource(dataSourceMap, \"discovery_db\", Collections.emptySet(), \"group_name\", null);\n        assertThat(mgrHaType.getPrimaryDataSource(), is(\"ds_2\"));\n    }\n","realPath":"shardingsphere-features/shardingsphere-db-discovery/shardingsphere-db-discovery-provider/shardingsphere-db-discovery-mgr/src/test/java/org/apache/shardingsphere/dbdiscovery/mgr/MGRDatabaseDiscoveryTypeTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":83,"status":"M"},{"authorDate":"2021-07-27 07:22:30","commitOrder":6,"curCode":"    private Map<String, ShardingSphereMetaData> createMetaDataMap() {\n        Map<String, ShardingSphereMetaData> result = new LinkedHashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            result.put(String.format(SCHEMA_PATTERN, i), mock(ShardingSphereMetaData.class));\n        }\n        return result;\n    }\n","date":"2021-07-27 07:22:30","endLine":121,"groupId":"10891","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"createMetaDataMap","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-shardingsphere-10-0.7/blobInfo/CC_OUT/blobs/ee/7e9005b1e55a75d060de3aa4da7448f8d8c0f5.src","preCode":"    private Map<String, ShardingSphereMetaData> createMetaDataMap() {\n        Map<String, ShardingSphereMetaData> result = new LinkedHashMap<>(10, 1);\n        for (int i = 0; i < 10; i++) {\n            result.put(String.format(SCHEMA_PATTERN, i), mock(ShardingSphereMetaData.class));\n        }\n        return result;\n    }\n","realPath":"shardingsphere-proxy/shardingsphere-proxy-backend/src/test/java/org/apache/shardingsphere/proxy/backend/context/ProxyContextTest.java","repoName":"shardingsphere","snippetEndLine":0,"snippetStartLine":0,"startLine":115,"status":"N"}],"commitId":"89f9871ff79d769d22964caf1e6ba2aa91e9c3ec","commitMessage":"@@@Remove databaseType ref of DatabaseDiscoveryRule (#12231)\n\n* Remove databaseType ref of DatabaseDiscoveryRule\n\n* Refactor DatabaseDiscoveryType","date":"2021-09-06 06:30:59","modifiedFileCount":"11","status":"M","submitter":"Liang Zhang"}]
