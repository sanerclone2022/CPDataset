[{"authorTime":"2018-10-19 20:39:50","codes":[{"authorDate":"2018-10-19 20:39:50","commitOrder":1,"curCode":"    public void testACLs() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n            try {\n                zk.create(\"/acltest\", new byte[0], Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\n                Assert.fail(\"Should have received an invalid acl error\");\n            } catch(InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \"\n                        + e.getMessage());\n            }\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, Ids.AUTH_IDS));\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id(\"ip\", \"127.0.0.1/8\")));\n                zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                Assert.fail(\"Should have received an invalid acl error\");\n            } catch(InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \"\n                        + e.getMessage());\n            }\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id()));\n                zk.create(\"/nullidtest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                Assert.fail(\"Should have received an invalid acl error\");\n            } catch(InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \"\n                        + e.getMessage());\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\",\"\")));\n            testACL.add(new ACL(Perms.WRITE, new Id(\"ip\", \"127.0.0.1\")));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    Assert.fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    Assert.fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    Assert.assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            Assert.assertEquals(1, acls.size());\n            Assert.assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            \r\n            acls = zk.getACL(\"/acltest\", null);\n            Assert.assertEquals(1, acls.size());\n            Assert.assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            zk.close();\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","date":"2018-10-19 20:39:50","endLine":198,"groupId":"2330","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testACLs","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/63/73bb36e3e58159c95655b0344608b7412f2244.src","preCode":"    public void testACLs() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n            try {\n                zk.create(\"/acltest\", new byte[0], Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\n                Assert.fail(\"Should have received an invalid acl error\");\n            } catch(InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \"\n                        + e.getMessage());\n            }\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, Ids.AUTH_IDS));\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id(\"ip\", \"127.0.0.1/8\")));\n                zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                Assert.fail(\"Should have received an invalid acl error\");\n            } catch(InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \"\n                        + e.getMessage());\n            }\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id()));\n                zk.create(\"/nullidtest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                Assert.fail(\"Should have received an invalid acl error\");\n            } catch(InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \"\n                        + e.getMessage());\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\",\"\")));\n            testACL.add(new ACL(Perms.WRITE, new Id(\"ip\", \"127.0.0.1\")));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    Assert.fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    Assert.fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    Assert.assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            Assert.assertEquals(1, acls.size());\n            Assert.assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            \r\n            acls = zk.getACL(\"/acltest\", null);\n            Assert.assertEquals(1, acls.size());\n            Assert.assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            zk.close();\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/ClientTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":125,"status":"B"},{"authorDate":"2018-10-19 20:39:50","commitOrder":1,"curCode":"    public void testNullAuthId() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\", null)));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    Assert.fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    Assert.fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    Assert.assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            Assert.assertEquals(1, acls.size());\n            Assert.assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","date":"2018-10-19 20:39:50","endLine":240,"groupId":"2330","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testNullAuthId","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/63/73bb36e3e58159c95655b0344608b7412f2244.src","preCode":"    public void testNullAuthId() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\", null)));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    Assert.fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    Assert.fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    Assert.assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            Assert.assertEquals(1, acls.size());\n            Assert.assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/ClientTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":201,"status":"B"}],"commitId":"cb9f303bda9137d1aebe8eff3eab85c8a59f3cdd","commitMessage":"@@@ZOOKEEPER-3032: MAVEN MIGRATION - zookeeper-server\n\nSeparating the java code is not feasible. Moving common and client back to server.\n\nAuthor: Norbert Kalmar <nkalmar@yahoo.com>\n\nReviewers: andor@apache.org\n\nCloses #672 from nkalmar/ZOOKEEPER-3032r\n","date":"2018-10-19 20:39:50","modifiedFileCount":"0","status":"B","submitter":"Norbert Kalmar"},{"authorTime":"2019-08-17 23:13:15","codes":[{"authorDate":"2019-08-17 23:13:15","commitOrder":2,"curCode":"    public void testACLs() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n            try {\n                zk.create(\"/acltest\", new byte[0], Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\n                fail(\"Should have received an invalid acl error\");\n            } catch (InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \" + e.getMessage());\n            }\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, Ids.AUTH_IDS));\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id(\"ip\", \"127.0.0.1/8\")));\n                zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                fail(\"Should have received an invalid acl error\");\n            } catch (InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \" + e.getMessage());\n            }\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id()));\n                zk.create(\"/nullidtest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                fail(\"Should have received an invalid acl error\");\n            } catch (InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \" + e.getMessage());\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\", \"\")));\n            testACL.add(new ACL(Perms.WRITE, new Id(\"ip\", \"127.0.0.1\")));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            assertEquals(1, acls.size());\n            assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            \r\n            acls = zk.getACL(\"/acltest\", null);\n            assertEquals(1, acls.size());\n            assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            zk.close();\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","date":"2019-08-17 23:13:15","endLine":196,"groupId":"1569","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testACLs","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/3f/e2f5d5ec8130ade35c43cc36cff0552fb71872.src","preCode":"    public void testACLs() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n            try {\n                zk.create(\"/acltest\", new byte[0], Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\n                Assert.fail(\"Should have received an invalid acl error\");\n            } catch(InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \"\n                        + e.getMessage());\n            }\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, Ids.AUTH_IDS));\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id(\"ip\", \"127.0.0.1/8\")));\n                zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                Assert.fail(\"Should have received an invalid acl error\");\n            } catch(InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \"\n                        + e.getMessage());\n            }\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id()));\n                zk.create(\"/nullidtest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                Assert.fail(\"Should have received an invalid acl error\");\n            } catch(InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \"\n                        + e.getMessage());\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\",\"\")));\n            testACL.add(new ACL(Perms.WRITE, new Id(\"ip\", \"127.0.0.1\")));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    Assert.fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    Assert.fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    Assert.assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            Assert.assertEquals(1, acls.size());\n            Assert.assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            \r\n            acls = zk.getACL(\"/acltest\", null);\n            Assert.assertEquals(1, acls.size());\n            Assert.assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            zk.close();\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/ClientTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":126,"status":"M"},{"authorDate":"2019-08-17 23:13:15","commitOrder":2,"curCode":"    public void testNullAuthId() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\", null)));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            assertEquals(1, acls.size());\n            assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","date":"2019-08-17 23:13:15","endLine":238,"groupId":"1569","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testNullAuthId","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/3f/e2f5d5ec8130ade35c43cc36cff0552fb71872.src","preCode":"    public void testNullAuthId() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\", null)));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    Assert.fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    Assert.fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    Assert.assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            Assert.assertEquals(1, acls.size());\n            Assert.assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/ClientTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":199,"status":"M"}],"commitId":"fe940cdd8fb23ba09684cefb73233d570f4a20fa","commitMessage":"@@@ZOOKEEPER-3475: Enable Checkstyle configuration on zookeeper-server\n\n- [x] org/apache/zookeeper\n- [x] org/apache/zookeeper/admin\n- [x] org/apache/zookeeper/cli\n- [x] org/apache/zookeeper/client\n- [x] org/apache/zookeeper/common\n- [x] org/apache/zookeeper/jmx\n- [x] org/apache/zookeeper/metrics\n- [x] org/apache/zookeeper/metrics/impl\n- [x] org/apache/zookeeper/server\n- [x] org/apache/zookeeper/server/admin\n- [x] org/apache/zookeeper/server/auth\n- [x] org/apache/zookeeper/server/command\n- [x] org/apache/zookeeper/server/metric\n- [x] org/apache/zookeeper/server/persistence\n- [x] org/apache/zookeeper/server/quorum\n- [x] org/apache/zookeeper/server/quorum/auth\n- [x] org/apache/zookeeper/server/quorum/flexible\n- [x] org/apache/zookeeper/server/util\n- [x] org/apache/zookeeper/server/watch\n- [x] org/apache/zookeeper/test\n- [x] org/apache/zookeeper/util\n- [x] org/apache/zookeeper/version/util\n\nAuthor: tison <wander4096@gmail.com>\n\nReviewers: Brian Nixon <nixon@fb.com>.  Enrico Olivelli <eolivelli@gmail.com>.  Michael Han <hanm@apache.org>\n\nCloses #1049 from TisonKun/ZOOKEEPER-3475\n","date":"2019-08-17 23:13:15","modifiedFileCount":"631","status":"M","submitter":"tison"},{"authorTime":"2019-08-17 23:13:15","codes":[{"authorDate":"2019-10-10 20:37:45","commitOrder":3,"curCode":"    public void testACLs() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n\n            try {\n                zk.create(\"/acltest\", new byte[0], Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\n                fail(\"Should have received an invalid acl error\");\n            } catch (InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : {}\", e.getMessage());\n            }\n\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, Ids.AUTH_IDS));\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id(\"ip\", \"127.0.0.1/8\")));\n                zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                fail(\"Should have received an invalid acl error\");\n            } catch (InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : {}\", e.getMessage());\n            }\n\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id()));\n                zk.create(\"/nullidtest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                fail(\"Should have received an invalid acl error\");\n            } catch (InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : {}\", e.getMessage());\n            }\n\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\", \"\")));\n            testACL.add(new ACL(Perms.WRITE, new Id(\"ip\", \"127.0.0.1\")));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            assertEquals(1, acls.size());\n            assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            \r\n            acls = zk.getACL(\"/acltest\", null);\n            assertEquals(1, acls.size());\n            assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            zk.close();\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","date":"2019-10-10 20:37:45","endLine":200,"groupId":"10609","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testACLs","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/43/cc5b00183eb76d7707697181d152ac66194868.src","preCode":"    public void testACLs() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n            try {\n                zk.create(\"/acltest\", new byte[0], Ids.CREATOR_ALL_ACL, CreateMode.PERSISTENT);\n                fail(\"Should have received an invalid acl error\");\n            } catch (InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \" + e.getMessage());\n            }\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, Ids.AUTH_IDS));\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id(\"ip\", \"127.0.0.1/8\")));\n                zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                fail(\"Should have received an invalid acl error\");\n            } catch (InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \" + e.getMessage());\n            }\n            try {\n                ArrayList<ACL> testACL = new ArrayList<ACL>();\n                testACL.add(new ACL(Perms.ALL | Perms.ADMIN, new Id()));\n                zk.create(\"/nullidtest\", new byte[0], testACL, CreateMode.PERSISTENT);\n                fail(\"Should have received an invalid acl error\");\n            } catch (InvalidACLException e) {\n                LOG.info(\"Test successful, invalid acl received : \" + e.getMessage());\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\", \"\")));\n            testACL.add(new ACL(Perms.WRITE, new Id(\"ip\", \"127.0.0.1\")));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            assertEquals(1, acls.size());\n            assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            \r\n            acls = zk.getACL(\"/acltest\", null);\n            assertEquals(1, acls.size());\n            assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n\n            zk.close();\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/ClientTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":126,"status":"M"},{"authorDate":"2019-08-17 23:13:15","commitOrder":3,"curCode":"    public void testNullAuthId() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\", null)));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            assertEquals(1, acls.size());\n            assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","date":"2019-08-17 23:13:15","endLine":238,"groupId":"10609","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testNullAuthId","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-zookeeper-10-0.7/blobInfo/CC_OUT/blobs/3f/e2f5d5ec8130ade35c43cc36cff0552fb71872.src","preCode":"    public void testNullAuthId() throws Exception {\n        ZooKeeper zk = null;\n        try {\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            ArrayList<ACL> testACL = new ArrayList<ACL>();\n            testACL.add(new ACL(Perms.ALL, new Id(\"auth\", null)));\n            zk.create(\"/acltest\", new byte[0], testACL, CreateMode.PERSISTENT);\n            zk.close();\n            zk = createClient();\n            zk.addAuthInfo(\"digest\", \"ben:passwd2\".getBytes());\n            if (skipACL) {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                } catch (KeeperException e) {\n                    fail(\"Badauth reads should succeed with skipACL.\");\n                }\n            } else {\n                try {\n                    zk.getData(\"/acltest\", false, null);\n                    fail(\"Should have received a permission error\");\n                } catch (KeeperException e) {\n                    assertEquals(Code.NOAUTH, e.code());\n                }\n            }\n            zk.addAuthInfo(\"digest\", \"ben:passwd\".getBytes());\n            zk.getData(\"/acltest\", false, null);\n            zk.setACL(\"/acltest\", Ids.OPEN_ACL_UNSAFE, -1);\n            zk.close();\n            zk = createClient();\n            zk.getData(\"/acltest\", false, null);\n            List<ACL> acls = zk.getACL(\"/acltest\", new Stat());\n            assertEquals(1, acls.size());\n            assertEquals(Ids.OPEN_ACL_UNSAFE, acls);\n        } finally {\n            if (zk != null) {\n                zk.close();\n            }\n        }\n    }\n","realPath":"zookeeper-server/src/test/java/org/apache/zookeeper/test/ClientTest.java","repoName":"zookeeper","snippetEndLine":0,"snippetStartLine":0,"startLine":199,"status":"N"}],"commitId":"11c07921c15e2fb7692375327b53f26a583b77ca","commitMessage":"@@@ZOOKEEPER-3509: Revisit log format\n\n1. Always wrap `.trace` with `isTraceEnabled`. It is because that some of trace calls are a bit complex.\n2. Never wrap other levels with `isXXXEnabled`. Logger already checks log level and we don't make side effect or expensive operation in log statement.\n3. Always use `{}` instead of string concatenation or `String.format`. Just for unification and it is what is recommended.\n4. Always log throwable in warn or error level or debug if omit\n5. Always log throwable as the last arg and never log `throwable.getMessage` since Logger already log stack trace.\n\nAuthor: tison <wander4096@gmail.com>\n\nReviewers: enixon@apache.org.  andor@apache.org\n\nCloses #1100 from TisonKun/ZOOKEEPER-3509 and squashes the following commits:\n\n0c3a4ded8 [tison] Address comment\ndcb68eb61 [tison] ZOOKEEPER-3509: Revisit log format\n","date":"2019-10-10 20:37:45","modifiedFileCount":"155","status":"M","submitter":"tison"}]
