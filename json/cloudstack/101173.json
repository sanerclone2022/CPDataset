[{"authorTime":"2018-05-17 03:59:17","codes":[{"authorDate":"2018-05-17 03:59:17","commitOrder":1,"curCode":"    public void expungeVolumesInPrimaryStorageIfNeededTestVolumeInPrimaryDataStore() throws InterruptedException, ExecutionException {\n        Mockito.doReturn(asyncCallFutureVolumeapiResultMock).when(volumeServiceMock).expungeVolumeAsync(volumeInfoMock);\n        Mockito.doReturn(volumeInfoMock).when(volumeDataFactoryMock).getVolume(volumeMockId, DataStoreRole.Primary);\n\n        volumeApiServiceImpl.expungeVolumesInPrimaryStorageIfNeeded(volumeVoMock);\n\n        Mockito.verify(volumeServiceMock, Mockito.times(1)).expungeVolumeAsync(volumeInfoMock);\n        Mockito.verify(asyncCallFutureVolumeapiResultMock, Mockito.times(1)).get();\n    }\n","date":"2018-05-17 03:59:17","endLine":763,"groupId":"4563","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"expungeVolumesInPrimaryStorageIfNeededTestVolumeInPrimaryDataStore","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/dd/cf4758eee3167233c8c68a7d4ff6c0f21b3214.src","preCode":"    public void expungeVolumesInPrimaryStorageIfNeededTestVolumeInPrimaryDataStore() throws InterruptedException, ExecutionException {\n        Mockito.doReturn(asyncCallFutureVolumeapiResultMock).when(volumeServiceMock).expungeVolumeAsync(volumeInfoMock);\n        Mockito.doReturn(volumeInfoMock).when(volumeDataFactoryMock).getVolume(volumeMockId, DataStoreRole.Primary);\n\n        volumeApiServiceImpl.expungeVolumesInPrimaryStorageIfNeeded(volumeVoMock);\n\n        Mockito.verify(volumeServiceMock, Mockito.times(1)).expungeVolumeAsync(volumeInfoMock);\n        Mockito.verify(asyncCallFutureVolumeapiResultMock, Mockito.times(1)).get();\n    }\n","realPath":"server/src/test/java/com/cloud/storage/VolumeApiServiceImplTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":755,"status":"B"},{"authorDate":"2018-05-17 03:59:17","commitOrder":1,"curCode":"    public void expungeVolumesInSecondaryStorageIfNeededTestVolumeNotFoundInSecondaryStorage() throws InterruptedException, ExecutionException {\n        Mockito.doReturn(asyncCallFutureVolumeapiResultMock).when(volumeServiceMock).expungeVolumeAsync(volumeInfoMock);\n        Mockito.doReturn(null).when(volumeDataFactoryMock).getVolume(volumeMockId, DataStoreRole.Image);\n        Mockito.doNothing().when(resourceLimitServiceMock).decrementResourceCount(accountMockId, ResourceType.secondary_storage, volumeSizeMock);\n        Mockito.doReturn(accountMockId).when(volumeInfoMock).getAccountId();\n        Mockito.doReturn(volumeSizeMock).when(volumeInfoMock).getSize();\n\n        volumeApiServiceImpl.expungeVolumesInSecondaryStorageIfNeeded(volumeVoMock);\n\n        Mockito.verify(volumeServiceMock, Mockito.times(0)).expungeVolumeAsync(volumeInfoMock);\n        Mockito.verify(asyncCallFutureVolumeapiResultMock, Mockito.times(0)).get();\n        Mockito.verify(resourceLimitServiceMock, Mockito.times(0)).decrementResourceCount(accountMockId, ResourceType.secondary_storage, volumeSizeMock);\n    }\n","date":"2018-05-17 03:59:17","endLine":796,"groupId":"1700","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"expungeVolumesInSecondaryStorageIfNeededTestVolumeNotFoundInSecondaryStorage","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/dd/cf4758eee3167233c8c68a7d4ff6c0f21b3214.src","preCode":"    public void expungeVolumesInSecondaryStorageIfNeededTestVolumeNotFoundInSecondaryStorage() throws InterruptedException, ExecutionException {\n        Mockito.doReturn(asyncCallFutureVolumeapiResultMock).when(volumeServiceMock).expungeVolumeAsync(volumeInfoMock);\n        Mockito.doReturn(null).when(volumeDataFactoryMock).getVolume(volumeMockId, DataStoreRole.Image);\n        Mockito.doNothing().when(resourceLimitServiceMock).decrementResourceCount(accountMockId, ResourceType.secondary_storage, volumeSizeMock);\n        Mockito.doReturn(accountMockId).when(volumeInfoMock).getAccountId();\n        Mockito.doReturn(volumeSizeMock).when(volumeInfoMock).getSize();\n\n        volumeApiServiceImpl.expungeVolumesInSecondaryStorageIfNeeded(volumeVoMock);\n\n        Mockito.verify(volumeServiceMock, Mockito.times(0)).expungeVolumeAsync(volumeInfoMock);\n        Mockito.verify(asyncCallFutureVolumeapiResultMock, Mockito.times(0)).get();\n        Mockito.verify(resourceLimitServiceMock, Mockito.times(0)).decrementResourceCount(accountMockId, ResourceType.secondary_storage, volumeSizeMock);\n    }\n","realPath":"server/src/test/java/com/cloud/storage/VolumeApiServiceImplTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":784,"status":"B"}],"commitId":"15eddf3dd664d6c3e722dccaa03fb5adeaf85d49","commitMessage":"@@@Merge forward branch '4.11' PR #2629\n\nFix primary storage count when deleting volumes (#2629)\n","date":"2018-05-17 03:59:17","modifiedFileCount":"7","status":"B","submitter":"Rafael Weing?rtner"},{"authorTime":"2020-02-12 15:28:25","codes":[{"authorDate":"2020-02-12 15:28:25","commitOrder":2,"curCode":"    public void expungeVolumesInPrimaryStorageIfNeededTestVolumeInPrimaryDataStore() throws InterruptedException, ExecutionException, NoTransitionException {\n        Mockito.doReturn(asyncCallFutureVolumeapiResultMock).when(volumeServiceMock).expungeVolumeAsync(volumeInfoMock);\n        Mockito.doReturn(volumeInfoMock).when(volumeDataFactoryMock).getVolume(volumeMockId, DataStoreRole.Primary);\n\n        volumeApiServiceImpl.expungeVolumesInPrimaryStorageIfNeeded(volumeVoMock);\n\n        Mockito.verify(volumeServiceMock, Mockito.times(1)).expungeVolumeAsync(volumeInfoMock);\n        Mockito.verify(asyncCallFutureVolumeapiResultMock, Mockito.times(1)).get();\n    }\n","date":"2020-02-12 15:28:25","endLine":779,"groupId":"101173","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"expungeVolumesInPrimaryStorageIfNeededTestVolumeInPrimaryDataStore","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/15/2cbb091516bf618cb440e45fb07a84ca95de75.src","preCode":"    public void expungeVolumesInPrimaryStorageIfNeededTestVolumeInPrimaryDataStore() throws InterruptedException, ExecutionException {\n        Mockito.doReturn(asyncCallFutureVolumeapiResultMock).when(volumeServiceMock).expungeVolumeAsync(volumeInfoMock);\n        Mockito.doReturn(volumeInfoMock).when(volumeDataFactoryMock).getVolume(volumeMockId, DataStoreRole.Primary);\n\n        volumeApiServiceImpl.expungeVolumesInPrimaryStorageIfNeeded(volumeVoMock);\n\n        Mockito.verify(volumeServiceMock, Mockito.times(1)).expungeVolumeAsync(volumeInfoMock);\n        Mockito.verify(asyncCallFutureVolumeapiResultMock, Mockito.times(1)).get();\n    }\n","realPath":"server/src/test/java/com/cloud/storage/VolumeApiServiceImplTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":771,"status":"M"},{"authorDate":"2020-02-12 15:28:25","commitOrder":2,"curCode":"    public void expungeVolumesInSecondaryStorageIfNeededTestVolumeNotFoundInSecondaryStorage() throws InterruptedException, ExecutionException {\n        Mockito.lenient().doReturn(asyncCallFutureVolumeapiResultMock).when(volumeServiceMock).expungeVolumeAsync(volumeInfoMock);\n        Mockito.doReturn(null).when(volumeDataFactoryMock).getVolume(volumeMockId, DataStoreRole.Image);\n        Mockito.lenient().doNothing().when(resourceLimitServiceMock).decrementResourceCount(accountMockId, ResourceType.secondary_storage, volumeSizeMock);\n        Mockito.lenient().doReturn(accountMockId).when(volumeInfoMock).getAccountId();\n        Mockito.lenient().doReturn(volumeSizeMock).when(volumeInfoMock).getSize();\n\n        volumeApiServiceImpl.expungeVolumesInSecondaryStorageIfNeeded(volumeVoMock);\n\n        Mockito.verify(volumeServiceMock, Mockito.times(0)).expungeVolumeAsync(volumeInfoMock);\n        Mockito.verify(asyncCallFutureVolumeapiResultMock, Mockito.times(0)).get();\n        Mockito.verify(resourceLimitServiceMock, Mockito.times(0)).decrementResourceCount(accountMockId, ResourceType.secondary_storage, volumeSizeMock);\n    }\n","date":"2020-02-12 15:28:25","endLine":812,"groupId":"101173","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"expungeVolumesInSecondaryStorageIfNeededTestVolumeNotFoundInSecondaryStorage","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/15/2cbb091516bf618cb440e45fb07a84ca95de75.src","preCode":"    public void expungeVolumesInSecondaryStorageIfNeededTestVolumeNotFoundInSecondaryStorage() throws InterruptedException, ExecutionException {\n        Mockito.doReturn(asyncCallFutureVolumeapiResultMock).when(volumeServiceMock).expungeVolumeAsync(volumeInfoMock);\n        Mockito.doReturn(null).when(volumeDataFactoryMock).getVolume(volumeMockId, DataStoreRole.Image);\n        Mockito.doNothing().when(resourceLimitServiceMock).decrementResourceCount(accountMockId, ResourceType.secondary_storage, volumeSizeMock);\n        Mockito.doReturn(accountMockId).when(volumeInfoMock).getAccountId();\n        Mockito.doReturn(volumeSizeMock).when(volumeInfoMock).getSize();\n\n        volumeApiServiceImpl.expungeVolumesInSecondaryStorageIfNeeded(volumeVoMock);\n\n        Mockito.verify(volumeServiceMock, Mockito.times(0)).expungeVolumeAsync(volumeInfoMock);\n        Mockito.verify(asyncCallFutureVolumeapiResultMock, Mockito.times(0)).get();\n        Mockito.verify(resourceLimitServiceMock, Mockito.times(0)).decrementResourceCount(accountMockId, ResourceType.secondary_storage, volumeSizeMock);\n    }\n","realPath":"server/src/test/java/com/cloud/storage/VolumeApiServiceImplTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":800,"status":"M"}],"commitId":"d90341ebf149d40a4dd03897960136dc29256677","commitMessage":"@@@cloudstack: add JDK11 support (#3601)\n\nThis adds support for JDK11 in CloudStack 4.14+:\n\n- Fixes code to build against JDK11\n- Bump to Debian 9 systemvmtemplate with openjdk-11\n- Fix Travis to run smoketests against openjdk-11\n- Use maven provided jdk11 compatible mysql-connector-java\n- Remove old agent init.d scripts\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>","date":"2020-02-12 15:28:25","modifiedFileCount":"118","status":"M","submitter":"Rohit Yadav"}]
