[{"authorTime":"2018-01-20 05:49:27","codes":[{"authorDate":"2018-01-20 05:49:27","commitOrder":1,"curCode":"    public void testFindUpgradePath470to481() {\n\n        final CloudStackVersion dbVersion = CloudStackVersion.parse(\"4.7.0\");\n        assertNotNull(dbVersion);\n\n        final CloudStackVersion currentVersion = CloudStackVersion.parse(\"4.8.1\");\n        assertNotNull(currentVersion);\n\n        final DatabaseUpgradeChecker checker = new DatabaseUpgradeChecker();\n        final DbUpgrade[] upgrades = checker.calculateUpgradePath(dbVersion, currentVersion);\n\n        assertNotNull(upgrades);\n\n        assertTrue(upgrades[0] instanceof Upgrade470to471);\n        assertTrue(upgrades[1] instanceof Upgrade471to480);\n        assertTrue(upgrades[2] instanceof Upgrade480to481);\n\n    }\n","date":"2018-01-20 05:49:27","endLine":95,"groupId":"20885","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testFindUpgradePath470to481","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/0b/210872ff52c105e330f6c1c6b4bef7f93e0da9.src","preCode":"    public void testFindUpgradePath470to481() {\n\n        final CloudStackVersion dbVersion = CloudStackVersion.parse(\"4.7.0\");\n        assertNotNull(dbVersion);\n\n        final CloudStackVersion currentVersion = CloudStackVersion.parse(\"4.8.1\");\n        assertNotNull(currentVersion);\n\n        final DatabaseUpgradeChecker checker = new DatabaseUpgradeChecker();\n        final DbUpgrade[] upgrades = checker.calculateUpgradePath(dbVersion, currentVersion);\n\n        assertNotNull(upgrades);\n\n        assertTrue(upgrades[0] instanceof Upgrade470to471);\n        assertTrue(upgrades[1] instanceof Upgrade471to480);\n        assertTrue(upgrades[2] instanceof Upgrade480to481);\n\n    }\n","realPath":"engine/schema/src/test/java/com/cloud/upgrade/DatabaseUpgradeCheckerTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":78,"status":"B"},{"authorDate":"2018-01-20 05:49:27","commitOrder":1,"curCode":"    public void testFindUpgradePath452to490() {\n\n        final CloudStackVersion dbVersion = CloudStackVersion.parse(\"4.5.2\");\n        assertNotNull(dbVersion);\n\n        final CloudStackVersion currentVersion = CloudStackVersion.parse(\"4.9.0\");\n        assertNotNull(currentVersion);\n\n        final DatabaseUpgradeChecker checker = new DatabaseUpgradeChecker();\n        final DbUpgrade[] upgrades = checker.calculateUpgradePath(dbVersion, currentVersion);\n\n        assertNotNull(upgrades);\n\n        assertTrue(upgrades[0] instanceof Upgrade452to460);\n        assertTrue(upgrades[1] instanceof Upgrade460to461);\n        assertTrue(upgrades[2] instanceof Upgrade461to470);\n        assertTrue(upgrades[3] instanceof Upgrade470to471);\n        assertTrue(upgrades[4] instanceof Upgrade471to480);\n        assertTrue(upgrades[5] instanceof Upgrade480to481);\n\n        assertTrue(Arrays.equals(new String[] { \"4.8.1\", currentVersion.toString()}, upgrades[6].getUpgradableVersionRange()));\n        assertEquals(currentVersion.toString(), upgrades[6].getUpgradedVersion());\n\n    }\n","date":"2018-01-20 05:49:27","endLine":121,"groupId":"3359","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testFindUpgradePath452to490","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/0b/210872ff52c105e330f6c1c6b4bef7f93e0da9.src","preCode":"    public void testFindUpgradePath452to490() {\n\n        final CloudStackVersion dbVersion = CloudStackVersion.parse(\"4.5.2\");\n        assertNotNull(dbVersion);\n\n        final CloudStackVersion currentVersion = CloudStackVersion.parse(\"4.9.0\");\n        assertNotNull(currentVersion);\n\n        final DatabaseUpgradeChecker checker = new DatabaseUpgradeChecker();\n        final DbUpgrade[] upgrades = checker.calculateUpgradePath(dbVersion, currentVersion);\n\n        assertNotNull(upgrades);\n\n        assertTrue(upgrades[0] instanceof Upgrade452to460);\n        assertTrue(upgrades[1] instanceof Upgrade460to461);\n        assertTrue(upgrades[2] instanceof Upgrade461to470);\n        assertTrue(upgrades[3] instanceof Upgrade470to471);\n        assertTrue(upgrades[4] instanceof Upgrade471to480);\n        assertTrue(upgrades[5] instanceof Upgrade480to481);\n\n        assertTrue(Arrays.equals(new String[] { \"4.8.1\", currentVersion.toString()}, upgrades[6].getUpgradableVersionRange()));\n        assertEquals(currentVersion.toString(), upgrades[6].getUpgradedVersion());\n\n    }\n","realPath":"engine/schema/src/test/java/com/cloud/upgrade/DatabaseUpgradeCheckerTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":98,"status":"B"}],"commitId":"893a88d225276e45f12f9490e6af2c94a81c2965","commitMessage":"@@@CLOUDSTACK-10105: Use maven standard project structure in all projects (#2283)\n\nRemove maven standard module (which only a few were using) and get ride of maven customization for the projects structure.\n\n- moved all directories to src/main/java.  src/main/resources.  src/main/scripts.  src/test/java.  src/test/resources\n- grep scan to search for src/com and src/org left over\n- grep for <project>/scripts to fix pom.xml configuration\n- remove custom <build> configuration in pom.xml\n\nSigned-off-by: Marc-Aur?le Brothier <m@brothier.org>","date":"2018-01-20 05:49:27","modifiedFileCount":"1","status":"B","submitter":"Marc-Aur?le Brothier"},{"authorTime":"2018-05-10 00:21:06","codes":[{"authorDate":"2018-01-20 05:49:27","commitOrder":2,"curCode":"    public void testFindUpgradePath470to481() {\n\n        final CloudStackVersion dbVersion = CloudStackVersion.parse(\"4.7.0\");\n        assertNotNull(dbVersion);\n\n        final CloudStackVersion currentVersion = CloudStackVersion.parse(\"4.8.1\");\n        assertNotNull(currentVersion);\n\n        final DatabaseUpgradeChecker checker = new DatabaseUpgradeChecker();\n        final DbUpgrade[] upgrades = checker.calculateUpgradePath(dbVersion, currentVersion);\n\n        assertNotNull(upgrades);\n\n        assertTrue(upgrades[0] instanceof Upgrade470to471);\n        assertTrue(upgrades[1] instanceof Upgrade471to480);\n        assertTrue(upgrades[2] instanceof Upgrade480to481);\n\n    }\n","date":"2018-01-20 05:49:27","endLine":95,"groupId":"1016","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testFindUpgradePath470to481","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/0b/210872ff52c105e330f6c1c6b4bef7f93e0da9.src","preCode":"    public void testFindUpgradePath470to481() {\n\n        final CloudStackVersion dbVersion = CloudStackVersion.parse(\"4.7.0\");\n        assertNotNull(dbVersion);\n\n        final CloudStackVersion currentVersion = CloudStackVersion.parse(\"4.8.1\");\n        assertNotNull(currentVersion);\n\n        final DatabaseUpgradeChecker checker = new DatabaseUpgradeChecker();\n        final DbUpgrade[] upgrades = checker.calculateUpgradePath(dbVersion, currentVersion);\n\n        assertNotNull(upgrades);\n\n        assertTrue(upgrades[0] instanceof Upgrade470to471);\n        assertTrue(upgrades[1] instanceof Upgrade471to480);\n        assertTrue(upgrades[2] instanceof Upgrade480to481);\n\n    }\n","realPath":"engine/schema/src/test/java/com/cloud/upgrade/DatabaseUpgradeCheckerTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":78,"status":"N"},{"authorDate":"2018-05-10 00:21:06","commitOrder":2,"curCode":"    public void testFindUpgradePath452to490() {\n\n        final CloudStackVersion dbVersion = CloudStackVersion.parse(\"4.5.2\");\n        assertNotNull(dbVersion);\n\n        final CloudStackVersion currentVersion = CloudStackVersion.parse(\"4.9.0\");\n        assertNotNull(currentVersion);\n\n        final DatabaseUpgradeChecker checker = new DatabaseUpgradeChecker();\n        final DbUpgrade[] upgrades = checker.calculateUpgradePath(dbVersion, currentVersion);\n\n        assertNotNull(upgrades);\n\n        assertTrue(upgrades[0] instanceof Upgrade452to453);\n        assertTrue(upgrades[1] instanceof Upgrade453to460);\n        assertTrue(upgrades[2] instanceof Upgrade460to461);\n        assertTrue(upgrades[3] instanceof Upgrade461to470);\n        assertTrue(upgrades[4] instanceof Upgrade470to471);\n        assertTrue(upgrades[5] instanceof Upgrade471to480);\n        assertTrue(upgrades[6] instanceof Upgrade480to481);\n\n        assertTrue(Arrays.equals(new String[] {\"4.8.1\", currentVersion.toString()}, upgrades[upgrades.length - 1].getUpgradableVersionRange()));\n        assertEquals(currentVersion.toString(), upgrades[upgrades.length - 1].getUpgradedVersion());\n    }\n","date":"2018-05-10 00:21:06","endLine":151,"groupId":"1016","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testFindUpgradePath452to490","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/3e/2995d7a6e160cae9356610e2fc806e9530daa6.src","preCode":"    public void testFindUpgradePath452to490() {\n\n        final CloudStackVersion dbVersion = CloudStackVersion.parse(\"4.5.2\");\n        assertNotNull(dbVersion);\n\n        final CloudStackVersion currentVersion = CloudStackVersion.parse(\"4.9.0\");\n        assertNotNull(currentVersion);\n\n        final DatabaseUpgradeChecker checker = new DatabaseUpgradeChecker();\n        final DbUpgrade[] upgrades = checker.calculateUpgradePath(dbVersion, currentVersion);\n\n        assertNotNull(upgrades);\n\n        assertTrue(upgrades[0] instanceof Upgrade452to460);\n        assertTrue(upgrades[1] instanceof Upgrade460to461);\n        assertTrue(upgrades[2] instanceof Upgrade461to470);\n        assertTrue(upgrades[3] instanceof Upgrade470to471);\n        assertTrue(upgrades[4] instanceof Upgrade471to480);\n        assertTrue(upgrades[5] instanceof Upgrade480to481);\n\n        assertTrue(Arrays.equals(new String[] { \"4.8.1\", currentVersion.toString()}, upgrades[6].getUpgradableVersionRange()));\n        assertEquals(currentVersion.toString(), upgrades[6].getUpgradedVersion());\n\n    }\n","realPath":"engine/schema/src/test/java/com/cloud/upgrade/DatabaseUpgradeCheckerTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":128,"status":"M"}],"commitId":"c60dbfd2c884593cc49d3c157ad14e900288dcac","commitMessage":"@@@engine/schema: enhance and cleanup DatabaseUpgradeChecker (#2584)\n\nUsing a hierarchy of database version rather than a flat\nlist of them. Adding a new schema upgrade path was really\ncumbersome and error-prone.  because we needed to maintain\na flat map of versions and their corresponding list of\nupgrade paths (`DbUpgrade`). Instead we're using a logical\nhierarchy structure of versions:\n\n```\nDatabaseVersionHierarchy.builder()\n    .next(\"4.0.0\"   .  new Upgrade40to41())\n    .next(\"4.0.1\"   .  new Upgrade40to41())\n    .next(\"4.0.2\"   .  new Upgrade40to41())\n    .next(\"4.1.0\"   .  new Upgrade410to420())\n    .next(\"4.1.1\"   .  new Upgrade410to420())\n    .next(\"4.2.0\"   .  new Upgrade420to421())\n    ...\n    .next(\"4.2.1\"   .  new Upgrade421to430())\n    .next(\"4.9.3.0\" .  new Upgrade4930to41000())\n    .next(\"4.10.0.0\".  new Upgrade41000to41100())\n    .next(\"4.11.0.0\".  new Upgrade41100to41110())\n    .build();\n```\n\nWith this change.  when we need to add a new version upgrade\npath.  we only need to add it in correct place in the hierarchy\nrather than add that in dozens of places in `_upgradeMap`.","date":"2018-05-10 00:21:06","modifiedFileCount":"2","status":"M","submitter":"Khosrow Moossavi"}]
