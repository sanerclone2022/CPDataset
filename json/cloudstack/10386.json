[{"authorTime":"2018-01-20 05:49:27","codes":[{"authorDate":"2018-01-20 05:49:27","commitOrder":1,"curCode":"    public long primaryStorageUsedForAccount(long accountId, List<Long> virtualRouters) {\n        SearchCriteria<SumCount> sc;\n        if (!virtualRouters.isEmpty()) {\n            sc = primaryStorageSearch2.create();\n            sc.setParameters(\"virtualRouterVmIds\", virtualRouters.toArray(new Object[virtualRouters.size()]));\n        } else {\n            sc = primaryStorageSearch.create();\n        }\n        sc.setParameters(\"accountId\", accountId);\n        sc.setParameters(\"states\", State.Allocated);\n        sc.setParameters(\"displayVolume\", 1);\n        List<SumCount> storageSpace = customSearch(sc, null);\n        if (storageSpace != null) {\n            return storageSpace.get(0).sum;\n        } else {\n            return 0;\n        }\n    }\n","date":"2018-01-20 05:49:27","endLine":452,"groupId":"7818","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"primaryStorageUsedForAccount","params":"(longaccountId@List<Long>virtualRouters)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/f6/91e30c743e5fd3705dcce5502d9f4f89eb79bc.src","preCode":"    public long primaryStorageUsedForAccount(long accountId, List<Long> virtualRouters) {\n        SearchCriteria<SumCount> sc;\n        if (!virtualRouters.isEmpty()) {\n            sc = primaryStorageSearch2.create();\n            sc.setParameters(\"virtualRouterVmIds\", virtualRouters.toArray(new Object[virtualRouters.size()]));\n        } else {\n            sc = primaryStorageSearch.create();\n        }\n        sc.setParameters(\"accountId\", accountId);\n        sc.setParameters(\"states\", State.Allocated);\n        sc.setParameters(\"displayVolume\", 1);\n        List<SumCount> storageSpace = customSearch(sc, null);\n        if (storageSpace != null) {\n            return storageSpace.get(0).sum;\n        } else {\n            return 0;\n        }\n    }\n","realPath":"engine/schema/src/main/java/com/cloud/storage/dao/VolumeDaoImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":435,"status":"B"},{"authorDate":"2018-01-20 05:49:27","commitOrder":1,"curCode":"    public long secondaryStorageUsedForAccount(long accountId) {\n        SearchCriteria<SumCount> sc = secondaryStorageSearch.create();\n        sc.setParameters(\"accountId\", accountId);\n        sc.setParameters(\"states\", State.Allocated);\n        List<SumCount> storageSpace = customSearch(sc, null);\n        if (storageSpace != null) {\n            return storageSpace.get(0).sum;\n        } else {\n            return 0;\n        }\n    }\n","date":"2018-01-20 05:49:27","endLine":465,"groupId":"14509","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"secondaryStorageUsedForAccount","params":"(longaccountId)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/f6/91e30c743e5fd3705dcce5502d9f4f89eb79bc.src","preCode":"    public long secondaryStorageUsedForAccount(long accountId) {\n        SearchCriteria<SumCount> sc = secondaryStorageSearch.create();\n        sc.setParameters(\"accountId\", accountId);\n        sc.setParameters(\"states\", State.Allocated);\n        List<SumCount> storageSpace = customSearch(sc, null);\n        if (storageSpace != null) {\n            return storageSpace.get(0).sum;\n        } else {\n            return 0;\n        }\n    }\n","realPath":"engine/schema/src/main/java/com/cloud/storage/dao/VolumeDaoImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":455,"status":"B"}],"commitId":"893a88d225276e45f12f9490e6af2c94a81c2965","commitMessage":"@@@CLOUDSTACK-10105: Use maven standard project structure in all projects (#2283)\n\nRemove maven standard module (which only a few were using) and get ride of maven customization for the projects structure.\n\n- moved all directories to src/main/java.  src/main/resources.  src/main/scripts.  src/test/java.  src/test/resources\n- grep scan to search for src/com and src/org left over\n- grep for <project>/scripts to fix pom.xml configuration\n- remove custom <build> configuration in pom.xml\n\nSigned-off-by: Marc-Aur?le Brothier <m@brothier.org>","date":"2018-01-20 05:49:27","modifiedFileCount":"1","status":"B","submitter":"Marc-Aur?le Brothier"},{"authorTime":"2018-01-20 05:49:27","codes":[{"authorDate":"2019-11-29 22:42:04","commitOrder":2,"curCode":"    public long primaryStorageUsedForAccount(long accountId, List<Long> virtualRouters) {\n        SearchCriteria<SumCount> sc;\n        if (!virtualRouters.isEmpty()) {\n            sc = primaryStorageSearch2.create();\n            sc.setParameters(\"virtualRouterVmIds\", virtualRouters.toArray(new Object[virtualRouters.size()]));\n        } else {\n            sc = primaryStorageSearch.create();\n        }\n        sc.setParameters(\"accountId\", accountId);\n        sc.setParameters(\"states\", State.Allocated);\n        sc.setParameters(\"NotCountStates\", State.Destroy, State.Expunged);\n        sc.setParameters(\"displayVolume\", 1);\n        List<SumCount> storageSpace = customSearch(sc, null);\n        if (storageSpace != null) {\n            return storageSpace.get(0).sum;\n        } else {\n            return 0;\n        }\n    }\n","date":"2019-11-29 22:42:04","endLine":477,"groupId":"10386","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"primaryStorageUsedForAccount","params":"(longaccountId@List<Long>virtualRouters)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/e8/ed3343831bd6f9ee623ef9d27d93622796e1e4.src","preCode":"    public long primaryStorageUsedForAccount(long accountId, List<Long> virtualRouters) {\n        SearchCriteria<SumCount> sc;\n        if (!virtualRouters.isEmpty()) {\n            sc = primaryStorageSearch2.create();\n            sc.setParameters(\"virtualRouterVmIds\", virtualRouters.toArray(new Object[virtualRouters.size()]));\n        } else {\n            sc = primaryStorageSearch.create();\n        }\n        sc.setParameters(\"accountId\", accountId);\n        sc.setParameters(\"states\", State.Allocated);\n        sc.setParameters(\"displayVolume\", 1);\n        List<SumCount> storageSpace = customSearch(sc, null);\n        if (storageSpace != null) {\n            return storageSpace.get(0).sum;\n        } else {\n            return 0;\n        }\n    }\n","realPath":"engine/schema/src/main/java/com/cloud/storage/dao/VolumeDaoImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":459,"status":"M"},{"authorDate":"2018-01-20 05:49:27","commitOrder":2,"curCode":"    public long secondaryStorageUsedForAccount(long accountId) {\n        SearchCriteria<SumCount> sc = secondaryStorageSearch.create();\n        sc.setParameters(\"accountId\", accountId);\n        sc.setParameters(\"states\", State.Allocated);\n        List<SumCount> storageSpace = customSearch(sc, null);\n        if (storageSpace != null) {\n            return storageSpace.get(0).sum;\n        } else {\n            return 0;\n        }\n    }\n","date":"2018-01-20 05:49:27","endLine":465,"groupId":"10386","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"secondaryStorageUsedForAccount","params":"(longaccountId)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/f6/91e30c743e5fd3705dcce5502d9f4f89eb79bc.src","preCode":"    public long secondaryStorageUsedForAccount(long accountId) {\n        SearchCriteria<SumCount> sc = secondaryStorageSearch.create();\n        sc.setParameters(\"accountId\", accountId);\n        sc.setParameters(\"states\", State.Allocated);\n        List<SumCount> storageSpace = customSearch(sc, null);\n        if (storageSpace != null) {\n            return storageSpace.get(0).sum;\n        } else {\n            return 0;\n        }\n    }\n","realPath":"engine/schema/src/main/java/com/cloud/storage/dao/VolumeDaoImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":455,"status":"N"}],"commitId":"f30b5ceba9001bb800ed2b6eabcf46ece73577aa","commitMessage":"@@@Fix resource count of expunged volume (#3669)\n\nIf the volume is in \"Expunged\" state then it should not be\nconsidered towards total resource count of \"primarystoragetotal\"\nfield.\nCurrently cloudstack takes into resource calculation even if the\nvolume is expunged. The volume itself doesnt exist in primage\nstorage and hence it should not be considered towrds resource\ncaculation.\n\nSteps to reproduce the issue:\n\n1 . Get the resource count of \"primarystoragetotal\" of a particular domain.\n2 . Create a VM with 5GB root disk size and stop it.\n3 . Now the value of \"primarystoragetotal\" should be intitial value plus 5.\n4 . Navigate to \"volumes\" of the VM and select \"Download Volume\" option.\n5 . Once the volume is downloaded.  expunge the VM.\n6 . Get the resource count of \"primarystoragetotal\". it will be same value as in step 3\n    But it should be same as initial value obtained in step 1.\n\nWith this fix.  the value obtained at step 6 will be same as in step 1.","date":"2019-11-29 22:42:04","modifiedFileCount":"1","status":"M","submitter":"Rakesh"}]
