[{"authorTime":"2015-03-17 18:14:40","codes":[{"authorDate":"2015-08-26 02:44:50","commitOrder":4,"curCode":"    public Network implement(final Network network, final NetworkOffering offering, final DeployDestination dest, final ReservationContext context)\n            throws InsufficientVirtualNetworkCapacityException {\n        assert network.getState() == State.Implementing : \"Why are we implementing \" + network;\n\n        final long dcId = dest.getDataCenter().getId();\n\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        final NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(),\n                State.Allocated, network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO) network).getUuid();\n        }\n        if (name.length() > MAX_NAME_LENGTH) {\n            name = name.substring(0, MAX_NAME_LENGTH - 1);\n        }\n\n        final List<NiciraNvpDeviceVO> devices = niciraNvpDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No NiciraNvp Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        final NiciraNvpDeviceVO niciraNvpDevice = devices.get(0);\n        final HostVO niciraNvpHost = hostDao.findById(niciraNvpDevice.getHostId());\n        hostDao.loadDetails(niciraNvpHost);\n        final String transportzoneuuid = niciraNvpHost.getDetail(\"transportzoneuuid\");\n        final String transportzoneisotype = niciraNvpHost.getDetail(\"transportzoneisotype\");\n\n        final CreateLogicalSwitchCommand cmd = new CreateLogicalSwitchCommand(transportzoneuuid, transportzoneisotype, name, context.getDomain().getName() + \"-\"\n                + context.getAccount().getAccountName());\n        final CreateLogicalSwitchAnswer answer = (CreateLogicalSwitchAnswer) agentMgr.easySend(niciraNvpHost.getId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"CreateLogicalSwitchCommand failed\");\n            return null;\n        }\n\n        try {\n            implemented.setBroadcastUri(new URI(\"lswitch\", answer.getLogicalSwitchUuid(), null));\n            implemented.setBroadcastDomainType(BroadcastDomainType.Lswitch);\n            s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n        } catch (final URISyntaxException e) {\n            s_logger.error(\"Unable to store logical switch id in broadcast uri, uuid = \" + implemented.getUuid(), e);\n            return null;\n        }\n\n        return implemented;\n    }\n","date":"2015-08-26 02:44:52","endLine":207,"groupId":"18260","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"implement","params":"(finalNetworknetwork@finalNetworkOfferingoffering@finalDeployDestinationdest@finalReservationContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/97/5ebd19aa083d92db84a3ac768116f1d812e78e.src","preCode":"    public Network implement(final Network network, final NetworkOffering offering, final DeployDestination dest, final ReservationContext context)\n            throws InsufficientVirtualNetworkCapacityException {\n        assert network.getState() == State.Implementing : \"Why are we implementing \" + network;\n\n        final long dcId = dest.getDataCenter().getId();\n\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        final NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(),\n                State.Allocated, network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO) network).getUuid();\n        }\n        if (name.length() > MAX_NAME_LENGTH) {\n            name = name.substring(0, MAX_NAME_LENGTH - 1);\n        }\n\n        final List<NiciraNvpDeviceVO> devices = niciraNvpDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No NiciraNvp Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        final NiciraNvpDeviceVO niciraNvpDevice = devices.get(0);\n        final HostVO niciraNvpHost = hostDao.findById(niciraNvpDevice.getHostId());\n        hostDao.loadDetails(niciraNvpHost);\n        final String transportzoneuuid = niciraNvpHost.getDetail(\"transportzoneuuid\");\n        final String transportzoneisotype = niciraNvpHost.getDetail(\"transportzoneisotype\");\n\n        final CreateLogicalSwitchCommand cmd = new CreateLogicalSwitchCommand(transportzoneuuid, transportzoneisotype, name, context.getDomain().getName() + \"-\"\n                + context.getAccount().getAccountName());\n        final CreateLogicalSwitchAnswer answer = (CreateLogicalSwitchAnswer) agentMgr.easySend(niciraNvpHost.getId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"CreateLogicalSwitchCommand failed\");\n            return null;\n        }\n\n        try {\n            implemented.setBroadcastUri(new URI(\"lswitch\", answer.getLogicalSwitchUuid(), null));\n            implemented.setBroadcastDomainType(BroadcastDomainType.Lswitch);\n            s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n        } catch (final URISyntaxException e) {\n            s_logger.error(\"Unable to store logical switch id in broadcast uri, uuid = \" + implemented.getUuid(), e);\n            return null;\n        }\n\n        return implemented;\n    }\n","realPath":"plugins/network-elements/nicira-nvp/src/main/java/com/cloud/network/guru/NiciraNvpGuestNetworkGuru.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":144,"status":"B"},{"authorDate":"2015-03-17 18:14:40","commitOrder":4,"curCode":"    public Network implement(Network network, NetworkOffering offering, DeployDestination dest, ReservationContext context) throws InsufficientVirtualNetworkCapacityException {\n        assert (network.getState() == State.Implementing) : \"Why are we implementing \" + network;\n\n        long dcId = dest.getDataCenter().getId();\n\n        \r\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(), State.Allocated,\n                network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO)network).getUuid();\n        }\n\n        List<OpenDaylightControllerVO> devices = openDaylightControllerMappingDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        OpenDaylightControllerVO controller = devices.get(0);\n\n        ConfigureNetworkCommand cmd = new ConfigureNetworkCommand(name, context.getAccount().getAccountName());\n        ConfigureNetworkAnswer answer = (ConfigureNetworkAnswer)agentManager.easySend(controller.getHostId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"ConfigureNetworkCommand failed\");\n            return null;\n        }\n\n        implemented.setBroadcastUri(BroadcastDomainType.OpenDaylight.toUri(answer.getNetworkUuid()));\n        implemented.setBroadcastDomainType(BroadcastDomainType.OpenDaylight);\n        s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n\n        return implemented;\n    }\n","date":"2015-03-17 18:14:57","endLine":182,"groupId":"25626","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"implement","params":"(Networknetwork@NetworkOfferingoffering@DeployDestinationdest@ReservationContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/cb/aa4d024b36c50fa9b765a7ccbf92e2bf5f6c96.src","preCode":"    public Network implement(Network network, NetworkOffering offering, DeployDestination dest, ReservationContext context) throws InsufficientVirtualNetworkCapacityException {\n        assert (network.getState() == State.Implementing) : \"Why are we implementing \" + network;\n\n        long dcId = dest.getDataCenter().getId();\n\n        \r\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(), State.Allocated,\n                network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO)network).getUuid();\n        }\n\n        List<OpenDaylightControllerVO> devices = openDaylightControllerMappingDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        OpenDaylightControllerVO controller = devices.get(0);\n\n        ConfigureNetworkCommand cmd = new ConfigureNetworkCommand(name, context.getAccount().getAccountName());\n        ConfigureNetworkAnswer answer = (ConfigureNetworkAnswer)agentManager.easySend(controller.getHostId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"ConfigureNetworkCommand failed\");\n            return null;\n        }\n\n        implemented.setBroadcastUri(BroadcastDomainType.OpenDaylight.toUri(answer.getNetworkUuid()));\n        implemented.setBroadcastDomainType(BroadcastDomainType.OpenDaylight);\n        s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n\n        return implemented;\n    }\n","realPath":"plugins/network-elements/opendaylight/src/main/java/org/apache/cloudstack/network/opendaylight/OpendaylightGuestNetworkGuru.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":132,"status":"NB"}],"commitId":"44ba14d17ba3b8fa00cd05c97eaceed49367816c","commitMessage":"@@@Merge pull request #737 from miguelaferreira/feature/mferreira/ncx-follow-redirects-gardened-rebase\n\nCLOUDSTACK-8758: Handle redirects in communication with NXS controller (a.k.a. Nicira NVP)When an NSX controller node is part of a cluster it will redirect API calls to the master controller. Because the ACS management server does not follow such redirects.  if there is a change of master within a NSX cluster.  the NSX device (a.k.a.  NiciraNvp) needs to be reconfigured (via the management server DB).\n\nThe goal of this PR is to enable ACS management server to follow HTTP redirects sent by NSX controllers. However.  other changes were made to the cloud-utils module that provides the REST client that the NSX plugin uses.\n\nCosmetic changes:\n* Upgrade maven module structure for cloud-utils and cloud-plugin-netowkr-nvp to comply with maven default\n* Several refactorings on both modules to consistently format the code.  remove unused code.  declare final when possible.  remove auto generated comments.  etc\n\nOther changes:\n* Upgrade HTTP library used in REST client to version 4.5 of Apache HTTP Components\n* Implement generic REST client that supports HTTP redirects\n* Implement NSX specific REST client\n* Simplify NSX api implementation\n* Previously existing unit tests for both the REST client and NSX api were either maintained in the same test classes.  moved to new test classes (because code under tests also moved).  or removed (because code under tests was also removed)\n* New Marvin tests for NSX controllers\n\nTesting:\n* Ran all unit tests present in the project\n* Ran Java Integration tests for NSX api targeting both a master and a slave controller\n* Ran new Marvin test for NSX controller\n* Manual inspection of logs to confirm redirection is taking place\n\n* pr/737:\n  Use NSX specific RestClient in API implementation (NiciraNvpApi)\n  Refactor NSX api implementation (NiciraNvpApi)\n  Add NSX specific RestClient implementation\n  Delegate HTTP protocol activity in RESTServiceConnector to RestClient\n  Add basic RestClient implentation based on HTTP Components 4.5\n  Code clean up in cloud-plugin-network-nvp project\n  Code clean up in cloud-utils project\n  Refactor cloud-plugin-network-nvp project into Maven default structure\n  Refactor cloud-utils project into Maven default structure\n  Fix unit-test library dependencies\n  Add Marvin test for Nicira NVP plugin\n  Create Nicira NVP devices and enable plugin at deploy\n\nSigned-off-by: Remi Bergsma <github@remi.nl>\n","date":"2015-08-26 02:44:52","modifiedFileCount":"0","status":"M","submitter":"Remi Bergsma"},{"authorTime":"2015-08-30 04:04:03","codes":[{"authorDate":"2015-08-30 04:04:03","commitOrder":5,"curCode":"    public Network implement(final Network network, final NetworkOffering offering, final DeployDestination dest, final ReservationContext context)\n            throws InsufficientVirtualNetworkCapacityException {\n        assert network.getState() == State.Implementing : \"Why are we implementing \" + network;\n\n        final long dcId = dest.getDataCenter().getId();\n\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        final NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(),\n                State.Allocated, network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO) network).getUuid();\n        }\n        if (name.length() > MAX_NAME_LENGTH) {\n            name = name.substring(0, MAX_NAME_LENGTH - 1);\n        }\n\n        final List<NiciraNvpDeviceVO> devices = niciraNvpDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            logger.error(\"No NiciraNvp Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        final NiciraNvpDeviceVO niciraNvpDevice = devices.get(0);\n        final HostVO niciraNvpHost = hostDao.findById(niciraNvpDevice.getHostId());\n        hostDao.loadDetails(niciraNvpHost);\n        final String transportzoneuuid = niciraNvpHost.getDetail(\"transportzoneuuid\");\n        final String transportzoneisotype = niciraNvpHost.getDetail(\"transportzoneisotype\");\n\n        final CreateLogicalSwitchCommand cmd = new CreateLogicalSwitchCommand(transportzoneuuid, transportzoneisotype, name, context.getDomain().getName() + \"-\"\n                + context.getAccount().getAccountName());\n        final CreateLogicalSwitchAnswer answer = (CreateLogicalSwitchAnswer) agentMgr.easySend(niciraNvpHost.getId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            logger.error(\"CreateLogicalSwitchCommand failed\");\n            return null;\n        }\n\n        try {\n            implemented.setBroadcastUri(new URI(\"lswitch\", answer.getLogicalSwitchUuid(), null));\n            implemented.setBroadcastDomainType(BroadcastDomainType.Lswitch);\n            logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n        } catch (final URISyntaxException e) {\n            logger.error(\"Unable to store logical switch id in broadcast uri, uuid = \" + implemented.getUuid(), e);\n            return null;\n        }\n\n        return implemented;\n    }\n","date":"2015-08-30 04:04:04","endLine":205,"groupId":"18260","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"implement","params":"(finalNetworknetwork@finalNetworkOfferingoffering@finalDeployDestinationdest@finalReservationContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/bf/ce33238bc1a43bacece49df0ce9adea82dc0b2.src","preCode":"    public Network implement(final Network network, final NetworkOffering offering, final DeployDestination dest, final ReservationContext context)\n            throws InsufficientVirtualNetworkCapacityException {\n        assert network.getState() == State.Implementing : \"Why are we implementing \" + network;\n\n        final long dcId = dest.getDataCenter().getId();\n\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        final NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(),\n                State.Allocated, network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO) network).getUuid();\n        }\n        if (name.length() > MAX_NAME_LENGTH) {\n            name = name.substring(0, MAX_NAME_LENGTH - 1);\n        }\n\n        final List<NiciraNvpDeviceVO> devices = niciraNvpDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No NiciraNvp Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        final NiciraNvpDeviceVO niciraNvpDevice = devices.get(0);\n        final HostVO niciraNvpHost = hostDao.findById(niciraNvpDevice.getHostId());\n        hostDao.loadDetails(niciraNvpHost);\n        final String transportzoneuuid = niciraNvpHost.getDetail(\"transportzoneuuid\");\n        final String transportzoneisotype = niciraNvpHost.getDetail(\"transportzoneisotype\");\n\n        final CreateLogicalSwitchCommand cmd = new CreateLogicalSwitchCommand(transportzoneuuid, transportzoneisotype, name, context.getDomain().getName() + \"-\"\n                + context.getAccount().getAccountName());\n        final CreateLogicalSwitchAnswer answer = (CreateLogicalSwitchAnswer) agentMgr.easySend(niciraNvpHost.getId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"CreateLogicalSwitchCommand failed\");\n            return null;\n        }\n\n        try {\n            implemented.setBroadcastUri(new URI(\"lswitch\", answer.getLogicalSwitchUuid(), null));\n            implemented.setBroadcastDomainType(BroadcastDomainType.Lswitch);\n            s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n        } catch (final URISyntaxException e) {\n            s_logger.error(\"Unable to store logical switch id in broadcast uri, uuid = \" + implemented.getUuid(), e);\n            return null;\n        }\n\n        return implemented;\n    }\n","realPath":"plugins/network-elements/nicira-nvp/src/main/java/com/cloud/network/guru/NiciraNvpGuestNetworkGuru.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":142,"status":"M"},{"authorDate":"2015-08-30 04:04:03","commitOrder":5,"curCode":"    public Network implement(Network network, NetworkOffering offering, DeployDestination dest, ReservationContext context) throws InsufficientVirtualNetworkCapacityException {\n        assert (network.getState() == State.Implementing) : \"Why are we implementing \" + network;\n\n        long dcId = dest.getDataCenter().getId();\n\n        \r\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(), State.Allocated,\n                network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO)network).getUuid();\n        }\n\n        List<OpenDaylightControllerVO> devices = openDaylightControllerMappingDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            logger.error(\"No Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        OpenDaylightControllerVO controller = devices.get(0);\n\n        ConfigureNetworkCommand cmd = new ConfigureNetworkCommand(name, context.getAccount().getAccountName());\n        ConfigureNetworkAnswer answer = (ConfigureNetworkAnswer)agentManager.easySend(controller.getHostId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            logger.error(\"ConfigureNetworkCommand failed\");\n            return null;\n        }\n\n        implemented.setBroadcastUri(BroadcastDomainType.OpenDaylight.toUri(answer.getNetworkUuid()));\n        implemented.setBroadcastDomainType(BroadcastDomainType.OpenDaylight);\n        logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n\n        return implemented;\n    }\n","date":"2015-08-30 04:04:04","endLine":180,"groupId":"25626","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"implement","params":"(Networknetwork@NetworkOfferingoffering@DeployDestinationdest@ReservationContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/35/532496c683162c822b1db2c2a3af34f6d84876.src","preCode":"    public Network implement(Network network, NetworkOffering offering, DeployDestination dest, ReservationContext context) throws InsufficientVirtualNetworkCapacityException {\n        assert (network.getState() == State.Implementing) : \"Why are we implementing \" + network;\n\n        long dcId = dest.getDataCenter().getId();\n\n        \r\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(), State.Allocated,\n                network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO)network).getUuid();\n        }\n\n        List<OpenDaylightControllerVO> devices = openDaylightControllerMappingDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        OpenDaylightControllerVO controller = devices.get(0);\n\n        ConfigureNetworkCommand cmd = new ConfigureNetworkCommand(name, context.getAccount().getAccountName());\n        ConfigureNetworkAnswer answer = (ConfigureNetworkAnswer)agentManager.easySend(controller.getHostId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"ConfigureNetworkCommand failed\");\n            return null;\n        }\n\n        implemented.setBroadcastUri(BroadcastDomainType.OpenDaylight.toUri(answer.getNetworkUuid()));\n        implemented.setBroadcastDomainType(BroadcastDomainType.OpenDaylight);\n        s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n\n        return implemented;\n    }\n","realPath":"plugins/network-elements/opendaylight/src/main/java/org/apache/cloudstack/network/opendaylight/OpendaylightGuestNetworkGuru.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":130,"status":"M"}],"commitId":"cd7218e241a8ac93df7a73f938320487aa526de6","commitMessage":"@@@Merge pull request #714 from rafaelweingartner/master-lrg-cs-hackday-003\n\nChanged variable s_logger to non-static and fixed its name in com.cloud.utils.component.ComponentLifecycleBase and its subclassesHi guys. \nWe have noticed that every single class that is a subclass of ComponentLifecycleBase instantiate their on logger manually and uses a nonstandard name. We fixed that by changing the variable in ComponentLifecycleBase to protected and non-static and instantiated it using the method getClass from Object class. Therefore.  we can reduce the code in a few hundred lines and use a more intuitive name for the logger variable.\n\nDuring that process we found a static method that used the s_logger variable in classes:\ncom.cloud.network.element.VirtualRouterElement\norg.apache.cloudstack.network.element.InternalLoadBalancerElement\n\nTo fix that we had to create a new class com.cloud.network.element.HAProxyLBRule.  instantiate it with @Componente and inject into the aforementioned classes.\n\nThe class that we create is com.cloud.network.element.HAProxyLBRule and has the following methods:\ncom.cloud.network.element.HAProxyLBRule.containsOnlyNumbers(String.  String)\ncom.cloud.network.element.HAProxyLBRule.validateHAProxyLBRule(LoadBalancingRule)\n\nSadly we could not write test cases to it; hence we did not fully understand those methods. However.  if anyone out there understands it.  we would appreciate some code to be added to it.\n\nAs minor this change may seem; we believe that it enhances a little bit the ACS code by using standard name to logger variable.\n\n* pr/714:\n  Solved jira ticket: CLOUDSTACK-8750\n\nSigned-off-by: Daan Hoogland <daan@onecht.net>\n","date":"2015-08-30 04:04:04","modifiedFileCount":"359","status":"M","submitter":"Daan Hoogland"},{"authorTime":"2015-08-31 13:44:05","codes":[{"authorDate":"2015-08-31 13:44:05","commitOrder":6,"curCode":"    public Network implement(final Network network, final NetworkOffering offering, final DeployDestination dest, final ReservationContext context)\n            throws InsufficientVirtualNetworkCapacityException {\n        assert network.getState() == State.Implementing : \"Why are we implementing \" + network;\n\n        final long dcId = dest.getDataCenter().getId();\n\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        final NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(),\n                State.Allocated, network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO) network).getUuid();\n        }\n        if (name.length() > MAX_NAME_LENGTH) {\n            name = name.substring(0, MAX_NAME_LENGTH - 1);\n        }\n\n        final List<NiciraNvpDeviceVO> devices = niciraNvpDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No NiciraNvp Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        final NiciraNvpDeviceVO niciraNvpDevice = devices.get(0);\n        final HostVO niciraNvpHost = hostDao.findById(niciraNvpDevice.getHostId());\n        hostDao.loadDetails(niciraNvpHost);\n        final String transportzoneuuid = niciraNvpHost.getDetail(\"transportzoneuuid\");\n        final String transportzoneisotype = niciraNvpHost.getDetail(\"transportzoneisotype\");\n\n        final CreateLogicalSwitchCommand cmd = new CreateLogicalSwitchCommand(transportzoneuuid, transportzoneisotype, name, context.getDomain().getName() + \"-\"\n                + context.getAccount().getAccountName());\n        final CreateLogicalSwitchAnswer answer = (CreateLogicalSwitchAnswer) agentMgr.easySend(niciraNvpHost.getId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"CreateLogicalSwitchCommand failed\");\n            return null;\n        }\n\n        try {\n            implemented.setBroadcastUri(new URI(\"lswitch\", answer.getLogicalSwitchUuid(), null));\n            implemented.setBroadcastDomainType(BroadcastDomainType.Lswitch);\n            s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n        } catch (final URISyntaxException e) {\n            s_logger.error(\"Unable to store logical switch id in broadcast uri, uuid = \" + implemented.getUuid(), e);\n            return null;\n        }\n\n        return implemented;\n    }\n","date":"2015-08-31 13:57:57","endLine":207,"groupId":"18260","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"implement","params":"(finalNetworknetwork@finalNetworkOfferingoffering@finalDeployDestinationdest@finalReservationContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/97/5ebd19aa083d92db84a3ac768116f1d812e78e.src","preCode":"    public Network implement(final Network network, final NetworkOffering offering, final DeployDestination dest, final ReservationContext context)\n            throws InsufficientVirtualNetworkCapacityException {\n        assert network.getState() == State.Implementing : \"Why are we implementing \" + network;\n\n        final long dcId = dest.getDataCenter().getId();\n\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        final NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(),\n                State.Allocated, network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO) network).getUuid();\n        }\n        if (name.length() > MAX_NAME_LENGTH) {\n            name = name.substring(0, MAX_NAME_LENGTH - 1);\n        }\n\n        final List<NiciraNvpDeviceVO> devices = niciraNvpDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            logger.error(\"No NiciraNvp Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        final NiciraNvpDeviceVO niciraNvpDevice = devices.get(0);\n        final HostVO niciraNvpHost = hostDao.findById(niciraNvpDevice.getHostId());\n        hostDao.loadDetails(niciraNvpHost);\n        final String transportzoneuuid = niciraNvpHost.getDetail(\"transportzoneuuid\");\n        final String transportzoneisotype = niciraNvpHost.getDetail(\"transportzoneisotype\");\n\n        final CreateLogicalSwitchCommand cmd = new CreateLogicalSwitchCommand(transportzoneuuid, transportzoneisotype, name, context.getDomain().getName() + \"-\"\n                + context.getAccount().getAccountName());\n        final CreateLogicalSwitchAnswer answer = (CreateLogicalSwitchAnswer) agentMgr.easySend(niciraNvpHost.getId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            logger.error(\"CreateLogicalSwitchCommand failed\");\n            return null;\n        }\n\n        try {\n            implemented.setBroadcastUri(new URI(\"lswitch\", answer.getLogicalSwitchUuid(), null));\n            implemented.setBroadcastDomainType(BroadcastDomainType.Lswitch);\n            logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n        } catch (final URISyntaxException e) {\n            logger.error(\"Unable to store logical switch id in broadcast uri, uuid = \" + implemented.getUuid(), e);\n            return null;\n        }\n\n        return implemented;\n    }\n","realPath":"plugins/network-elements/nicira-nvp/src/main/java/com/cloud/network/guru/NiciraNvpGuestNetworkGuru.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":144,"status":"M"},{"authorDate":"2015-08-31 13:44:05","commitOrder":6,"curCode":"    public Network implement(Network network, NetworkOffering offering, DeployDestination dest, ReservationContext context) throws InsufficientVirtualNetworkCapacityException {\n        assert (network.getState() == State.Implementing) : \"Why are we implementing \" + network;\n\n        long dcId = dest.getDataCenter().getId();\n\n        \r\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(), State.Allocated,\n                network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO)network).getUuid();\n        }\n\n        List<OpenDaylightControllerVO> devices = openDaylightControllerMappingDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        OpenDaylightControllerVO controller = devices.get(0);\n\n        ConfigureNetworkCommand cmd = new ConfigureNetworkCommand(name, context.getAccount().getAccountName());\n        ConfigureNetworkAnswer answer = (ConfigureNetworkAnswer)agentManager.easySend(controller.getHostId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"ConfigureNetworkCommand failed\");\n            return null;\n        }\n\n        implemented.setBroadcastUri(BroadcastDomainType.OpenDaylight.toUri(answer.getNetworkUuid()));\n        implemented.setBroadcastDomainType(BroadcastDomainType.OpenDaylight);\n        s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n\n        return implemented;\n    }\n","date":"2015-08-31 13:57:57","endLine":182,"groupId":"25626","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"implement","params":"(Networknetwork@NetworkOfferingoffering@DeployDestinationdest@ReservationContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/cb/aa4d024b36c50fa9b765a7ccbf92e2bf5f6c96.src","preCode":"    public Network implement(Network network, NetworkOffering offering, DeployDestination dest, ReservationContext context) throws InsufficientVirtualNetworkCapacityException {\n        assert (network.getState() == State.Implementing) : \"Why are we implementing \" + network;\n\n        long dcId = dest.getDataCenter().getId();\n\n        \r\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(), State.Allocated,\n                network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO)network).getUuid();\n        }\n\n        List<OpenDaylightControllerVO> devices = openDaylightControllerMappingDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            logger.error(\"No Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        OpenDaylightControllerVO controller = devices.get(0);\n\n        ConfigureNetworkCommand cmd = new ConfigureNetworkCommand(name, context.getAccount().getAccountName());\n        ConfigureNetworkAnswer answer = (ConfigureNetworkAnswer)agentManager.easySend(controller.getHostId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            logger.error(\"ConfigureNetworkCommand failed\");\n            return null;\n        }\n\n        implemented.setBroadcastUri(BroadcastDomainType.OpenDaylight.toUri(answer.getNetworkUuid()));\n        implemented.setBroadcastDomainType(BroadcastDomainType.OpenDaylight);\n        logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n\n        return implemented;\n    }\n","realPath":"plugins/network-elements/opendaylight/src/main/java/org/apache/cloudstack/network/opendaylight/OpendaylightGuestNetworkGuru.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":132,"status":"M"}],"commitId":"8bc029401416e4818492e1396ebf71fb38f8271e","commitMessage":"@@@Revert \"Merge pull request #714 from rafaelweingartner/master-lrg-cs-hackday-003\"\n\nThis reverts commit cd7218e241a8ac93df7a73f938320487aa526de6.  reversing\nchanges made to f5a7395cc2ec37364a2e210eac60720e9b327451.\n\nReason for Revert:\n\nnoredist build failed with the below error:\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.2:compile (default-compile) on project cloud-plugin-hypervisor-vmware: Compilation failure\n[ERROR] /home/jenkins/acs/workspace/build-master-noredist/plugins/hypervisors/vmware/src/com/cloud/hypervisor/guru/VMwareGuru.java:[484. 12] error: non-static variable logger cannot be referenced from a static context\n[ERROR] -> [Help 1]\n\neven the normal build is broken as reported by @koushik-das on dev list\nhttp://markmail.org/message/nngimssuzkj5gpbz\n","date":"2015-08-31 13:57:57","modifiedFileCount":"359","status":"M","submitter":"Rajani Karuturi"},{"authorTime":"2015-08-31 13:44:05","codes":[{"authorDate":"2015-12-28 18:21:56","commitOrder":7,"curCode":"    public Network implement(final Network network, final NetworkOffering offering, final DeployDestination dest, final ReservationContext context)\n            throws InsufficientVirtualNetworkCapacityException {\n        assert network.getState() == State.Implementing : \"Why are we implementing \" + network;\n\n        final long dcId = dest.getDataCenter().getId();\n\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        final NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(),\n                State.Allocated, network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO) network).getUuid();\n        }\n        if (name.length() > MAX_NAME_LENGTH) {\n            name = name.substring(0, MAX_NAME_LENGTH - 1);\n        }\n\n        final List<NiciraNvpDeviceVO> devices = niciraNvpDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No NiciraNvp Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        final NiciraNvpDeviceVO niciraNvpDevice = devices.get(0);\n        final HostVO niciraNvpHost = hostDao.findById(niciraNvpDevice.getHostId());\n        hostDao.loadDetails(niciraNvpHost);\n        final String transportzoneuuid = niciraNvpHost.getDetail(\"transportzoneuuid\");\n        final String transportzoneisotype = niciraNvpHost.getDetail(\"transportzoneisotype\");\n\n        if (offering.getGuestType().equals(GuestType.Shared)) {\n            try {\n                checkL2GatewayServiceSharedNetwork(niciraNvpHost);\n            }\n            catch (Exception e){\n                s_logger.error(\"L2 Gateway Service Issue: \" + e.getMessage());\n                return null;\n            }\n        }\n\n        final CreateLogicalSwitchCommand cmd = new CreateLogicalSwitchCommand(transportzoneuuid, transportzoneisotype, name, context.getDomain().getName() + \"-\"\n                + context.getAccount().getAccountName());\n        final CreateLogicalSwitchAnswer answer = (CreateLogicalSwitchAnswer) agentMgr.easySend(niciraNvpHost.getId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"CreateLogicalSwitchCommand failed\");\n            return null;\n        }\n\n        try {\n            implemented.setBroadcastUri(new URI(\"lswitch\", answer.getLogicalSwitchUuid(), null));\n            implemented.setBroadcastDomainType(BroadcastDomainType.Lswitch);\n            s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n        } catch (final URISyntaxException e) {\n            s_logger.error(\"Unable to store logical switch id in broadcast uri, uuid = \" + implemented.getUuid(), e);\n            return null;\n        }\n\n        return implemented;\n    }\n","date":"2015-12-28 18:21:56","endLine":244,"groupId":"18260","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"implement","params":"(finalNetworknetwork@finalNetworkOfferingoffering@finalDeployDestinationdest@finalReservationContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/55/1269cc84c48521cc8101b0f5e971de6d7514fe.src","preCode":"    public Network implement(final Network network, final NetworkOffering offering, final DeployDestination dest, final ReservationContext context)\n            throws InsufficientVirtualNetworkCapacityException {\n        assert network.getState() == State.Implementing : \"Why are we implementing \" + network;\n\n        final long dcId = dest.getDataCenter().getId();\n\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        final NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(),\n                State.Allocated, network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO) network).getUuid();\n        }\n        if (name.length() > MAX_NAME_LENGTH) {\n            name = name.substring(0, MAX_NAME_LENGTH - 1);\n        }\n\n        final List<NiciraNvpDeviceVO> devices = niciraNvpDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No NiciraNvp Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        final NiciraNvpDeviceVO niciraNvpDevice = devices.get(0);\n        final HostVO niciraNvpHost = hostDao.findById(niciraNvpDevice.getHostId());\n        hostDao.loadDetails(niciraNvpHost);\n        final String transportzoneuuid = niciraNvpHost.getDetail(\"transportzoneuuid\");\n        final String transportzoneisotype = niciraNvpHost.getDetail(\"transportzoneisotype\");\n\n        final CreateLogicalSwitchCommand cmd = new CreateLogicalSwitchCommand(transportzoneuuid, transportzoneisotype, name, context.getDomain().getName() + \"-\"\n                + context.getAccount().getAccountName());\n        final CreateLogicalSwitchAnswer answer = (CreateLogicalSwitchAnswer) agentMgr.easySend(niciraNvpHost.getId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"CreateLogicalSwitchCommand failed\");\n            return null;\n        }\n\n        try {\n            implemented.setBroadcastUri(new URI(\"lswitch\", answer.getLogicalSwitchUuid(), null));\n            implemented.setBroadcastDomainType(BroadcastDomainType.Lswitch);\n            s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n        } catch (final URISyntaxException e) {\n            s_logger.error(\"Unable to store logical switch id in broadcast uri, uuid = \" + implemented.getUuid(), e);\n            return null;\n        }\n\n        return implemented;\n    }\n","realPath":"plugins/network-elements/nicira-nvp/src/main/java/com/cloud/network/guru/NiciraNvpGuestNetworkGuru.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":171,"status":"M"},{"authorDate":"2015-08-31 13:44:05","commitOrder":7,"curCode":"    public Network implement(Network network, NetworkOffering offering, DeployDestination dest, ReservationContext context) throws InsufficientVirtualNetworkCapacityException {\n        assert (network.getState() == State.Implementing) : \"Why are we implementing \" + network;\n\n        long dcId = dest.getDataCenter().getId();\n\n        \r\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(), State.Allocated,\n                network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO)network).getUuid();\n        }\n\n        List<OpenDaylightControllerVO> devices = openDaylightControllerMappingDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        OpenDaylightControllerVO controller = devices.get(0);\n\n        ConfigureNetworkCommand cmd = new ConfigureNetworkCommand(name, context.getAccount().getAccountName());\n        ConfigureNetworkAnswer answer = (ConfigureNetworkAnswer)agentManager.easySend(controller.getHostId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"ConfigureNetworkCommand failed\");\n            return null;\n        }\n\n        implemented.setBroadcastUri(BroadcastDomainType.OpenDaylight.toUri(answer.getNetworkUuid()));\n        implemented.setBroadcastDomainType(BroadcastDomainType.OpenDaylight);\n        s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n\n        return implemented;\n    }\n","date":"2015-08-31 13:57:57","endLine":182,"groupId":"25626","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"implement","params":"(Networknetwork@NetworkOfferingoffering@DeployDestinationdest@ReservationContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/cb/aa4d024b36c50fa9b765a7ccbf92e2bf5f6c96.src","preCode":"    public Network implement(Network network, NetworkOffering offering, DeployDestination dest, ReservationContext context) throws InsufficientVirtualNetworkCapacityException {\n        assert (network.getState() == State.Implementing) : \"Why are we implementing \" + network;\n\n        long dcId = dest.getDataCenter().getId();\n\n        \r\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(), State.Allocated,\n                network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO)network).getUuid();\n        }\n\n        List<OpenDaylightControllerVO> devices = openDaylightControllerMappingDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        OpenDaylightControllerVO controller = devices.get(0);\n\n        ConfigureNetworkCommand cmd = new ConfigureNetworkCommand(name, context.getAccount().getAccountName());\n        ConfigureNetworkAnswer answer = (ConfigureNetworkAnswer)agentManager.easySend(controller.getHostId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"ConfigureNetworkCommand failed\");\n            return null;\n        }\n\n        implemented.setBroadcastUri(BroadcastDomainType.OpenDaylight.toUri(answer.getNetworkUuid()));\n        implemented.setBroadcastDomainType(BroadcastDomainType.OpenDaylight);\n        s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n\n        return implemented;\n    }\n","realPath":"plugins/network-elements/opendaylight/src/main/java/org/apache/cloudstack/network/opendaylight/OpendaylightGuestNetworkGuru.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":132,"status":"N"}],"commitId":"67b753c11bab236187a0a68d92ca8e49cef1b3fd","commitMessage":"@@@Merge pull request #1094 from nvazquez/sharedNiciraNVP\n\nCLOUDSTACK-9074: Support shared networking in NiciraNVP PluginJIRA TICKET:\nhttps://issues.apache.org/jira/browse/CLOUDSTACK-9074\n\nDesign Document:\nhttps://cwiki.apache.org/confluence/display/CLOUDSTACK/Support+shared+networking+in+NiciraNVP+Plugin\n\n* pr/1094:\n  CLOUDSTACK-9074: Move sql to 4.8.0 schema\n  CLOUDSTACK-9074: Add NetworkGuruAdditionalFunctions license\n  Use NSX specific config values instead of zone config values\n  Fix method call bugs when accessign non defined variables\n  Use helper method to migrate router vm\n  Add helper method to migrate router vms\n  Only set L2 Gateway in NSX device if defined\n  CLOUDSTACK-9074: Marvin tests for NSX Shared Networks Support\n  CLOUDSTACK-9074: Drop nicira_nvp_router_map unique index on logicalrouter_uuid\n  CLOUDSTACK-9074: API add Gateway Service Find method\n  CLOUDSTACK-9074: Support Shared Networks in NiciraNVP Plugin\n  CLOUDSTACK-9074: New NiciraNVP classes for FindLRouterPort and DeleteLRouterPort API methods\n  CLOUDSTACK-9074: New NiciraNVP classes to support Shared Networks\n  CLOUDSTACK-9074: API Changes: Add nsxLogicalSwitch and nsxLogicalSwitchPort to listNics\n  CLOUDSTACK-9074: API Changes: Add l2gatewayserviceuuid to NVP devices\n\nSigned-off-by: Remi Bergsma <github@remi.nl>\n","date":"2015-12-28 18:21:56","modifiedFileCount":"23","status":"M","submitter":"Remi Bergsma"},{"authorTime":"2018-09-22 23:20:48","codes":[{"authorDate":"2018-09-22 23:20:48","commitOrder":8,"curCode":"    public Network implement(final Network network, final NetworkOffering offering, final DeployDestination dest, final ReservationContext context)\n            throws InsufficientVirtualNetworkCapacityException {\n        assert network.getState() == State.Implementing : \"Why are we implementing \" + network;\n\n        final long dcId = dest.getDataCenter().getId();\n\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        final NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(),\n                State.Allocated, network.getDataCenterId(), physicalNetworkId, offering.isRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO) network).getUuid();\n        }\n        if (name.length() > MAX_NAME_LENGTH) {\n            name = name.substring(0, MAX_NAME_LENGTH - 1);\n        }\n\n        final List<NiciraNvpDeviceVO> devices = niciraNvpDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No NiciraNvp Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        final NiciraNvpDeviceVO niciraNvpDevice = devices.get(0);\n        final HostVO niciraNvpHost = hostDao.findById(niciraNvpDevice.getHostId());\n        hostDao.loadDetails(niciraNvpHost);\n        final String transportzoneuuid = niciraNvpHost.getDetail(\"transportzoneuuid\");\n        final String transportzoneisotype = niciraNvpHost.getDetail(\"transportzoneisotype\");\n\n        if (offering.getGuestType().equals(GuestType.Shared)) {\n            try {\n                checkL2GatewayServiceSharedNetwork(niciraNvpHost);\n            }\n            catch (Exception e){\n                s_logger.error(\"L2 Gateway Service Issue: \" + e.getMessage());\n                return null;\n            }\n        }\n\n        final CreateLogicalSwitchCommand cmd = new CreateLogicalSwitchCommand(transportzoneuuid, transportzoneisotype, name, context.getDomain().getName() + \"-\"\n                + context.getAccount().getAccountName());\n        final CreateLogicalSwitchAnswer answer = (CreateLogicalSwitchAnswer) agentMgr.easySend(niciraNvpHost.getId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"CreateLogicalSwitchCommand failed\");\n            return null;\n        }\n\n        try {\n            implemented.setBroadcastUri(new URI(\"lswitch\", answer.getLogicalSwitchUuid(), null));\n            implemented.setBroadcastDomainType(BroadcastDomainType.Lswitch);\n            s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n        } catch (final URISyntaxException e) {\n            s_logger.error(\"Unable to store logical switch id in broadcast uri, uuid = \" + implemented.getUuid(), e);\n            return null;\n        }\n\n        return implemented;\n    }\n","date":"2018-09-22 23:20:48","endLine":244,"groupId":"103866","id":9,"instanceNumber":1,"isCurCommit":1,"methodName":"implement","params":"(finalNetworknetwork@finalNetworkOfferingoffering@finalDeployDestinationdest@finalReservationContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/3f/fc601990cd3ffdea4448526c7ee4ec9119477c.src","preCode":"    public Network implement(final Network network, final NetworkOffering offering, final DeployDestination dest, final ReservationContext context)\n            throws InsufficientVirtualNetworkCapacityException {\n        assert network.getState() == State.Implementing : \"Why are we implementing \" + network;\n\n        final long dcId = dest.getDataCenter().getId();\n\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        final NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(),\n                State.Allocated, network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO) network).getUuid();\n        }\n        if (name.length() > MAX_NAME_LENGTH) {\n            name = name.substring(0, MAX_NAME_LENGTH - 1);\n        }\n\n        final List<NiciraNvpDeviceVO> devices = niciraNvpDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No NiciraNvp Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        final NiciraNvpDeviceVO niciraNvpDevice = devices.get(0);\n        final HostVO niciraNvpHost = hostDao.findById(niciraNvpDevice.getHostId());\n        hostDao.loadDetails(niciraNvpHost);\n        final String transportzoneuuid = niciraNvpHost.getDetail(\"transportzoneuuid\");\n        final String transportzoneisotype = niciraNvpHost.getDetail(\"transportzoneisotype\");\n\n        if (offering.getGuestType().equals(GuestType.Shared)) {\n            try {\n                checkL2GatewayServiceSharedNetwork(niciraNvpHost);\n            }\n            catch (Exception e){\n                s_logger.error(\"L2 Gateway Service Issue: \" + e.getMessage());\n                return null;\n            }\n        }\n\n        final CreateLogicalSwitchCommand cmd = new CreateLogicalSwitchCommand(transportzoneuuid, transportzoneisotype, name, context.getDomain().getName() + \"-\"\n                + context.getAccount().getAccountName());\n        final CreateLogicalSwitchAnswer answer = (CreateLogicalSwitchAnswer) agentMgr.easySend(niciraNvpHost.getId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"CreateLogicalSwitchCommand failed\");\n            return null;\n        }\n\n        try {\n            implemented.setBroadcastUri(new URI(\"lswitch\", answer.getLogicalSwitchUuid(), null));\n            implemented.setBroadcastDomainType(BroadcastDomainType.Lswitch);\n            s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n        } catch (final URISyntaxException e) {\n            s_logger.error(\"Unable to store logical switch id in broadcast uri, uuid = \" + implemented.getUuid(), e);\n            return null;\n        }\n\n        return implemented;\n    }\n","realPath":"plugins/network-elements/nicira-nvp/src/main/java/com/cloud/network/guru/NiciraNvpGuestNetworkGuru.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":171,"status":"M"},{"authorDate":"2018-09-22 23:20:48","commitOrder":8,"curCode":"    public Network implement(Network network, NetworkOffering offering, DeployDestination dest, ReservationContext context) throws InsufficientVirtualNetworkCapacityException {\n        assert (network.getState() == State.Implementing) : \"Why are we implementing \" + network;\n\n        long dcId = dest.getDataCenter().getId();\n\n        \r\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(), State.Allocated,\n                network.getDataCenterId(), physicalNetworkId, offering.isRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO)network).getUuid();\n        }\n\n        List<OpenDaylightControllerVO> devices = openDaylightControllerMappingDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        OpenDaylightControllerVO controller = devices.get(0);\n\n        ConfigureNetworkCommand cmd = new ConfigureNetworkCommand(name, context.getAccount().getAccountName());\n        ConfigureNetworkAnswer answer = (ConfigureNetworkAnswer)agentManager.easySend(controller.getHostId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"ConfigureNetworkCommand failed\");\n            return null;\n        }\n\n        implemented.setBroadcastUri(BroadcastDomainType.OpenDaylight.toUri(answer.getNetworkUuid()));\n        implemented.setBroadcastDomainType(BroadcastDomainType.OpenDaylight);\n        s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n\n        return implemented;\n    }\n","date":"2018-09-22 23:20:48","endLine":179,"groupId":"103866","id":10,"instanceNumber":2,"isCurCommit":1,"methodName":"implement","params":"(Networknetwork@NetworkOfferingoffering@DeployDestinationdest@ReservationContextcontext)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/e9/9ec555b889408db89bf8e75dc6e9e39b057f9b.src","preCode":"    public Network implement(Network network, NetworkOffering offering, DeployDestination dest, ReservationContext context) throws InsufficientVirtualNetworkCapacityException {\n        assert (network.getState() == State.Implementing) : \"Why are we implementing \" + network;\n\n        long dcId = dest.getDataCenter().getId();\n\n        \r\n        Long physicalNetworkId = network.getPhysicalNetworkId();\n\n        \r\n        if (physicalNetworkId == null) {\n            physicalNetworkId = networkModel.findPhysicalNetworkId(dcId, offering.getTags(), offering.getTrafficType());\n        }\n\n        NetworkVO implemented = new NetworkVO(network.getTrafficType(), network.getMode(), network.getBroadcastDomainType(), network.getNetworkOfferingId(), State.Allocated,\n                network.getDataCenterId(), physicalNetworkId, offering.getRedundantRouter());\n\n        if (network.getGateway() != null) {\n            implemented.setGateway(network.getGateway());\n        }\n\n        if (network.getCidr() != null) {\n            implemented.setCidr(network.getCidr());\n        }\n\n        \r\n        String name = network.getName();\n        if (name == null || name.isEmpty()) {\n            name = ((NetworkVO)network).getUuid();\n        }\n\n        List<OpenDaylightControllerVO> devices = openDaylightControllerMappingDao.listByPhysicalNetwork(physicalNetworkId);\n        if (devices.isEmpty()) {\n            s_logger.error(\"No Controller on physical network \" + physicalNetworkId);\n            return null;\n        }\n        OpenDaylightControllerVO controller = devices.get(0);\n\n        ConfigureNetworkCommand cmd = new ConfigureNetworkCommand(name, context.getAccount().getAccountName());\n        ConfigureNetworkAnswer answer = (ConfigureNetworkAnswer)agentManager.easySend(controller.getHostId(), cmd);\n\n        if (answer == null || !answer.getResult()) {\n            s_logger.error(\"ConfigureNetworkCommand failed\");\n            return null;\n        }\n\n        implemented.setBroadcastUri(BroadcastDomainType.OpenDaylight.toUri(answer.getNetworkUuid()));\n        implemented.setBroadcastDomainType(BroadcastDomainType.OpenDaylight);\n        s_logger.info(\"Implemented OK, network linked to  = \" + implemented.getBroadcastUri().toString());\n\n        return implemented;\n    }\n","realPath":"plugins/network-elements/opendaylight/src/main/java/org/apache/cloudstack/network/opendaylight/OpendaylightGuestNetworkGuru.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":129,"status":"M"}],"commitId":"d53fc944857eb6e6d9542eef915f14066dab5861","commitMessage":"@@@CLOUDSTACK-10365: Change the \"getXXX\" boolean method names to \"isXXX\" (#2847)\n\nThese boolean-return methods are named as \"getXXX\".\nOther boolean-return methods are named as \"isXXX\".\nConsidering there methods will return boolean values.  it should be more clear and consistent to rename them as \"isXXX\".\n(rebase #2602 and #2816)\n","date":"2018-09-22 23:20:48","modifiedFileCount":"77","status":"M","submitter":"Kui LIU"}]
