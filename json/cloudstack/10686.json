[{"authorTime":"2018-12-14 19:01:28","codes":[{"authorDate":"2018-12-14 19:01:28","commitOrder":1,"curCode":"    public void configureMigrateDiskInfoTest() {\n        VolumeObject srcVolumeInfo = Mockito.spy(new VolumeObject());\n        Mockito.doReturn(\"volume path\").when(srcVolumeInfo).getPath();\n        MigrateCommand.MigrateDiskInfo migrateDiskInfo = kvmNonManagedStorageDataMotionStrategy.configureMigrateDiskInfo(srcVolumeInfo, \"destPath\");\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DiskType.FILE, migrateDiskInfo.getDiskType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DriverType.QCOW2, migrateDiskInfo.getDriverType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.Source.FILE, migrateDiskInfo.getSource());\n        Assert.assertEquals(\"destPath\", migrateDiskInfo.getSourceText());\n        Assert.assertEquals(\"volume path\", migrateDiskInfo.getSerialNumber());\n    }\n","date":"2018-12-14 19:01:28","endLine":180,"groupId":"24116","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"configureMigrateDiskInfoTest","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/b3/44f83569a40508ed61b1802f2b1c042d62cc72.src","preCode":"    public void configureMigrateDiskInfoTest() {\n        VolumeObject srcVolumeInfo = Mockito.spy(new VolumeObject());\n        Mockito.doReturn(\"volume path\").when(srcVolumeInfo).getPath();\n        MigrateCommand.MigrateDiskInfo migrateDiskInfo = kvmNonManagedStorageDataMotionStrategy.configureMigrateDiskInfo(srcVolumeInfo, \"destPath\");\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DiskType.FILE, migrateDiskInfo.getDiskType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DriverType.QCOW2, migrateDiskInfo.getDriverType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.Source.FILE, migrateDiskInfo.getSource());\n        Assert.assertEquals(\"destPath\", migrateDiskInfo.getSourceText());\n        Assert.assertEquals(\"volume path\", migrateDiskInfo.getSerialNumber());\n    }\n","realPath":"engine/storage/datamotion/src/test/java/org/apache/cloudstack/storage/motion/KvmNonManagedStorageSystemDataMotionTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":171,"status":"B"},{"authorDate":"2018-12-14 19:01:28","commitOrder":1,"curCode":"    public void configureMigrateDiskInfoTest() {\n        VolumeObject srcVolumeInfo = Mockito.spy(new VolumeObject());\n        Mockito.doReturn(\"volume path\").when(srcVolumeInfo).getPath();\n        MigrateCommand.MigrateDiskInfo migrateDiskInfo = storageSystemDataMotionStrategy.configureMigrateDiskInfo(srcVolumeInfo, \"destPath\");\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DiskType.BLOCK, migrateDiskInfo.getDiskType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DriverType.RAW, migrateDiskInfo.getDriverType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.Source.DEV, migrateDiskInfo.getSource());\n        Assert.assertEquals(\"destPath\", migrateDiskInfo.getSourceText());\n        Assert.assertEquals(\"volume path\", migrateDiskInfo.getSerialNumber());\n    }\n","date":"2018-12-14 19:01:28","endLine":184,"groupId":"13917","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"configureMigrateDiskInfoTest","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/d7/6ff272830cc0b3d7499fe695139e9f28f3cf09.src","preCode":"    public void configureMigrateDiskInfoTest() {\n        VolumeObject srcVolumeInfo = Mockito.spy(new VolumeObject());\n        Mockito.doReturn(\"volume path\").when(srcVolumeInfo).getPath();\n        MigrateCommand.MigrateDiskInfo migrateDiskInfo = storageSystemDataMotionStrategy.configureMigrateDiskInfo(srcVolumeInfo, \"destPath\");\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DiskType.BLOCK, migrateDiskInfo.getDiskType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DriverType.RAW, migrateDiskInfo.getDriverType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.Source.DEV, migrateDiskInfo.getSource());\n        Assert.assertEquals(\"destPath\", migrateDiskInfo.getSourceText());\n        Assert.assertEquals(\"volume path\", migrateDiskInfo.getSerialNumber());\n    }\n","realPath":"engine/storage/datamotion/src/test/java/org/apache/cloudstack/storage/motion/StorageSystemDataMotionStrategyTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":175,"status":"B"}],"commitId":"bf209405e7d60b6a5abf87677d368c429359d98a","commitMessage":"@@@Allow KVM VM live migration with ROOT volume on file storage type (#2997)\n\n* Allow KVM VM live migration with ROOT volume on file\n\n* Allow KVM VM live migration with ROOT volume on file\n- Add JUnit tests\n\n* Address reviewers and change some variable names to ease future\nimplementation (developers can easily guess the name and use\nautocomplete)\n","date":"2018-12-14 19:01:28","modifiedFileCount":"14","status":"B","submitter":"Gabriel Beims Br?scher"},{"authorTime":"2019-06-10 18:05:26","codes":[{"authorDate":"2018-12-14 19:01:28","commitOrder":2,"curCode":"    public void configureMigrateDiskInfoTest() {\n        VolumeObject srcVolumeInfo = Mockito.spy(new VolumeObject());\n        Mockito.doReturn(\"volume path\").when(srcVolumeInfo).getPath();\n        MigrateCommand.MigrateDiskInfo migrateDiskInfo = kvmNonManagedStorageDataMotionStrategy.configureMigrateDiskInfo(srcVolumeInfo, \"destPath\");\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DiskType.FILE, migrateDiskInfo.getDiskType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DriverType.QCOW2, migrateDiskInfo.getDriverType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.Source.FILE, migrateDiskInfo.getSource());\n        Assert.assertEquals(\"destPath\", migrateDiskInfo.getSourceText());\n        Assert.assertEquals(\"volume path\", migrateDiskInfo.getSerialNumber());\n    }\n","date":"2018-12-14 19:01:28","endLine":180,"groupId":"10686","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"configureMigrateDiskInfoTest","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/b3/44f83569a40508ed61b1802f2b1c042d62cc72.src","preCode":"    public void configureMigrateDiskInfoTest() {\n        VolumeObject srcVolumeInfo = Mockito.spy(new VolumeObject());\n        Mockito.doReturn(\"volume path\").when(srcVolumeInfo).getPath();\n        MigrateCommand.MigrateDiskInfo migrateDiskInfo = kvmNonManagedStorageDataMotionStrategy.configureMigrateDiskInfo(srcVolumeInfo, \"destPath\");\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DiskType.FILE, migrateDiskInfo.getDiskType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DriverType.QCOW2, migrateDiskInfo.getDriverType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.Source.FILE, migrateDiskInfo.getSource());\n        Assert.assertEquals(\"destPath\", migrateDiskInfo.getSourceText());\n        Assert.assertEquals(\"volume path\", migrateDiskInfo.getSerialNumber());\n    }\n","realPath":"engine/storage/datamotion/src/test/java/org/apache/cloudstack/storage/motion/KvmNonManagedStorageSystemDataMotionTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":171,"status":"N"},{"authorDate":"2019-06-10 18:05:26","commitOrder":2,"curCode":"    public void configureMigrateDiskInfoTest() {\n        VolumeObject srcVolumeInfo = Mockito.spy(new VolumeObject());\n        Mockito.doReturn(\"volume path\").when(srcVolumeInfo).getPath();\n        MigrateCommand.MigrateDiskInfo migrateDiskInfo = strategy.configureMigrateDiskInfo(srcVolumeInfo, \"destPath\");\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DiskType.BLOCK, migrateDiskInfo.getDiskType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DriverType.RAW, migrateDiskInfo.getDriverType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.Source.DEV, migrateDiskInfo.getSource());\n        Assert.assertEquals(\"destPath\", migrateDiskInfo.getSourceText());\n        Assert.assertEquals(\"volume path\", migrateDiskInfo.getSerialNumber());\n    }\n","date":"2019-06-10 18:05:26","endLine":182,"groupId":"10686","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"configureMigrateDiskInfoTest","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/1b/383d91574c93b77bc370631f1158dede4afb62.src","preCode":"    public void configureMigrateDiskInfoTest() {\n        VolumeObject srcVolumeInfo = Mockito.spy(new VolumeObject());\n        Mockito.doReturn(\"volume path\").when(srcVolumeInfo).getPath();\n        MigrateCommand.MigrateDiskInfo migrateDiskInfo = storageSystemDataMotionStrategy.configureMigrateDiskInfo(srcVolumeInfo, \"destPath\");\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DiskType.BLOCK, migrateDiskInfo.getDiskType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.DriverType.RAW, migrateDiskInfo.getDriverType());\n        Assert.assertEquals(MigrateCommand.MigrateDiskInfo.Source.DEV, migrateDiskInfo.getSource());\n        Assert.assertEquals(\"destPath\", migrateDiskInfo.getSourceText());\n        Assert.assertEquals(\"volume path\", migrateDiskInfo.getSerialNumber());\n    }\n","realPath":"engine/storage/datamotion/src/test/java/org/apache/cloudstack/storage/motion/StorageSystemDataMotionStrategyTest.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":173,"status":"M"}],"commitId":"0fbf5006b87b6c5bc6188e3e1dd226a98c3bb453","commitMessage":"@@@kvm: live storage migration intra cluster from NFS source and destination (#2983)\n\nFeature Specification: https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=95653548\n\nLive storage migration on KVM under these conditions:\n\nFrom source and destination hosts within the same cluster\nFrom NFS primary storage to NFS cluster-wide primary storage\nSource NFS and destination NFS storage mounted on hosts\nIn order to enable this functionality.  database should be updated in order to enable live storage capacibilty for KVM.  if previous conditions are met. This is due to existing conflicts between qemu and libvirt versions. This has been tested on CentOS 6 hosts.\n\nAdditional notes:\n\nTo use this feature set the storage_motion_supported=1 in the hypervisor_capability table for KVM. This is done by default as the feature may not work in some environments.  read below.\nThis feature of online storage+VM migration for KVM will only work with CentOS6 and possible Ubuntu as KVM hosts but not with CentOS7 due to:\nhttps://bugs.centos.org/view.php?id=14026\nhttps://bugzilla.redhat.com/show_bug.cgi?id=1219541\nOn CentOS7 the error we see is: \" error: unable to execute QEMU command 'migrate': this feature or command is not currently supported\" (reference https://ask.openstack.org/en/question/94186/live-migration-unable-to-execute-qemu-command-migrate/). Reading through various lists looks like the migrate feature with qemu may be available with paid versions of RHEL-EV but not centos7 however this works with CentOS6.\nFix for CentOS 7:\n\nCreate repo file on /etc/yum.repos.d/:\n[qemu-kvm-rhev]\nname=oVirt rebuilds of qemu-kvm-rhev\nbaseurl=http://resources.ovirt.org/pub/ovirt-3.5/rpm/el7Server/\nmirrorlist=http://resources.ovirt.org/pub/yum-repo/mirrorlist-ovirt-3.5-el7Server\nenabled=1\nskip_if_unavailable=1\ngpgcheck=0\nyum install qemu-kvm-common-ev-2.3.0-29.1.el7.x86_64 qemu-kvm-ev-2.3.0-29.1.el7.x86_64 qemu-img-ev-2.3.0-29.1.el7.x86_64\nReboot host\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>","date":"2019-06-10 18:05:26","modifiedFileCount":"25","status":"M","submitter":"Nicolas Vazquez"}]
