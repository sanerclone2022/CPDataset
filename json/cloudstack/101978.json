[{"authorTime":"2018-01-20 05:49:27","codes":[{"authorDate":"2018-01-20 05:49:27","commitOrder":1,"curCode":"        public void onAgentDisconnect(long agentId, com.cloud.host.Status state) {\n\n            if (state == com.cloud.host.Status.Alert || state == com.cloud.host.Status.Disconnected) {\n                \r\n                \r\n                \r\n                \r\n                \r\n                \r\n                HostVO host = _hostDao.findById(agentId);\n                if (host.getType() == Type.ConsoleProxy) {\n                    String name = host.getName();\n                    if (s_logger.isInfoEnabled()) {\n                        s_logger.info(\"Console proxy agent disconnected, proxy: \" + name);\n                    }\n                    if (name != null && name.startsWith(\"v-\")) {\n                        String[] tokens = name.split(\"-\");\n                        long proxyVmId = 0;\n                        try {\n                            proxyVmId = Long.parseLong(tokens[1]);\n                        } catch (NumberFormatException e) {\n                            s_logger.error(\"Unexpected exception \" + e.getMessage(), e);\n                            return;\n                        }\n\n                        final ConsoleProxyVO proxy = _consoleProxyDao.findById(proxyVmId);\n                        if (proxy != null) {\n\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n\n                            \r\n\r\n\r\n\r\n\r\n\r\n\r\n\n                        } else {\n                            if (s_logger.isInfoEnabled()) {\n                                s_logger.info(\"Console proxy agent disconnected but corresponding console proxy VM no longer exists in DB, proxy: \" + name);\n                            }\n                        }\n                    } else {\n                        assert (false) : \"Invalid console proxy name: \" + name;\n                    }\n                }\n            }\n\n        }\n","date":"2018-01-20 05:49:27","endLine":352,"groupId":"23853","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"onAgentDisconnect","params":"(longagentId@com.cloud.host.Statusstate)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/28/fff3c7219cceb44a61a820fcddfdef364d7f89.src","preCode":"        public void onAgentDisconnect(long agentId, com.cloud.host.Status state) {\n\n            if (state == com.cloud.host.Status.Alert || state == com.cloud.host.Status.Disconnected) {\n                \r\n                \r\n                \r\n                \r\n                \r\n                \r\n                HostVO host = _hostDao.findById(agentId);\n                if (host.getType() == Type.ConsoleProxy) {\n                    String name = host.getName();\n                    if (s_logger.isInfoEnabled()) {\n                        s_logger.info(\"Console proxy agent disconnected, proxy: \" + name);\n                    }\n                    if (name != null && name.startsWith(\"v-\")) {\n                        String[] tokens = name.split(\"-\");\n                        long proxyVmId = 0;\n                        try {\n                            proxyVmId = Long.parseLong(tokens[1]);\n                        } catch (NumberFormatException e) {\n                            s_logger.error(\"Unexpected exception \" + e.getMessage(), e);\n                            return;\n                        }\n\n                        final ConsoleProxyVO proxy = _consoleProxyDao.findById(proxyVmId);\n                        if (proxy != null) {\n\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n\n                            \r\n\r\n\r\n\r\n\r\n\r\n\r\n\n                        } else {\n                            if (s_logger.isInfoEnabled()) {\n                                s_logger.info(\"Console proxy agent disconnected but corresponding console proxy VM no longer exists in DB, proxy: \" + name);\n                            }\n                        }\n                    } else {\n                        assert (false) : \"Invalid console proxy name: \" + name;\n                    }\n                }\n            }\n\n        }\n","realPath":"server/src/main/java/com/cloud/consoleproxy/ConsoleProxyManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":294,"status":"B"},{"authorDate":"2018-01-20 05:49:27","commitOrder":1,"curCode":"    public void handleAgentDisconnect(long agentId, com.cloud.host.Status state) {\n        if (state == com.cloud.host.Status.Alert || state == com.cloud.host.Status.Disconnected) {\n            \r\n            \r\n            \r\n            \r\n            HostVO host = _hostDao.findById(agentId);\n            if (host.getType() == Type.ConsoleProxy) {\n                String name = host.getName();\n                if (s_logger.isInfoEnabled()) {\n                    s_logger.info(\"Console proxy agent disconnected, proxy: \" + name);\n                }\n                if (name != null && name.startsWith(\"v-\")) {\n                    String[] tokens = name.split(\"-\");\n                    long proxyVmId = 0;\n                    try {\n                        proxyVmId = Long.parseLong(tokens[1]);\n                    } catch (NumberFormatException e) {\n                        s_logger.error(\"Unexpected exception \" + e.getMessage(), e);\n                        return;\n                    }\n\n                    final ConsoleProxyVO proxy = _consoleProxyDao.findById(proxyVmId);\n                    if (proxy != null) {\n\n                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n\n                        \r\n\r\n\r\n\r\n\r\n\r\n\n                    } else {\n                        if (s_logger.isInfoEnabled()) {\n                            s_logger.info(\"Console proxy agent disconnected but corresponding console proxy VM no longer exists in DB, proxy: \" + name);\n                        }\n                    }\n                } else {\n                    assert (false) : \"Invalid console proxy name: \" + name;\n                }\n            }\n        }\n    }\n","date":"2018-01-20 05:49:27","endLine":888,"groupId":"23853","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"handleAgentDisconnect","params":"(longagentId@com.cloud.host.Statusstate)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/28/fff3c7219cceb44a61a820fcddfdef364d7f89.src","preCode":"    public void handleAgentDisconnect(long agentId, com.cloud.host.Status state) {\n        if (state == com.cloud.host.Status.Alert || state == com.cloud.host.Status.Disconnected) {\n            \r\n            \r\n            \r\n            \r\n            HostVO host = _hostDao.findById(agentId);\n            if (host.getType() == Type.ConsoleProxy) {\n                String name = host.getName();\n                if (s_logger.isInfoEnabled()) {\n                    s_logger.info(\"Console proxy agent disconnected, proxy: \" + name);\n                }\n                if (name != null && name.startsWith(\"v-\")) {\n                    String[] tokens = name.split(\"-\");\n                    long proxyVmId = 0;\n                    try {\n                        proxyVmId = Long.parseLong(tokens[1]);\n                    } catch (NumberFormatException e) {\n                        s_logger.error(\"Unexpected exception \" + e.getMessage(), e);\n                        return;\n                    }\n\n                    final ConsoleProxyVO proxy = _consoleProxyDao.findById(proxyVmId);\n                    if (proxy != null) {\n\n                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n\n                        \r\n\r\n\r\n\r\n\r\n\r\n\n                    } else {\n                        if (s_logger.isInfoEnabled()) {\n                            s_logger.info(\"Console proxy agent disconnected but corresponding console proxy VM no longer exists in DB, proxy: \" + name);\n                        }\n                    }\n                } else {\n                    assert (false) : \"Invalid console proxy name: \" + name;\n                }\n            }\n        }\n    }\n","realPath":"server/src/main/java/com/cloud/consoleproxy/ConsoleProxyManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":838,"status":"B"}],"commitId":"893a88d225276e45f12f9490e6af2c94a81c2965","commitMessage":"@@@CLOUDSTACK-10105: Use maven standard project structure in all projects (#2283)\n\nRemove maven standard module (which only a few were using) and get ride of maven customization for the projects structure.\n\n- moved all directories to src/main/java.  src/main/resources.  src/main/scripts.  src/test/java.  src/test/resources\n- grep scan to search for src/com and src/org left over\n- grep for <project>/scripts to fix pom.xml configuration\n- remove custom <build> configuration in pom.xml\n\nSigned-off-by: Marc-Aur?le Brothier <m@brothier.org>","date":"2018-01-20 05:49:27","modifiedFileCount":"1","status":"B","submitter":"Marc-Aur?le Brothier"},{"authorTime":"2021-07-28 06:56:14","codes":[{"authorDate":"2021-07-28 06:56:14","commitOrder":2,"curCode":"        public void onAgentDisconnect(long agentId, com.cloud.host.Status state) {\n\n            if (state == com.cloud.host.Status.Alert || state == com.cloud.host.Status.Disconnected) {\n                HostVO host = _hostDao.findById(agentId);\n                if (host.getType() == Type.ConsoleProxy) {\n                    String name = host.getName();\n                    if (s_logger.isInfoEnabled()) {\n                        s_logger.info(\"Console proxy agent disconnected, proxy: \" + name);\n                    }\n                    if (name != null && name.startsWith(\"v-\")) {\n                        String[] tokens = name.split(\"-\");\n                        long proxyVmId;\n                        String tokenSecondElement = tokens[1];\n                        try {\n                            proxyVmId = Long.parseLong(tokenSecondElement);\n                        } catch (NumberFormatException e) {\n                            s_logger.error(String.format(\"[%s] is not a valid number, unable to parse [%s].\", tokenSecondElement, e.getMessage()), e);\n                            return;\n                        }\n\n                        final ConsoleProxyVO proxy = consoleProxyDao.findById(proxyVmId);\n                        if (proxy == null && s_logger.isInfoEnabled()) {\n                            s_logger.info(\"Console proxy agent disconnected but corresponding console proxy VM no longer exists in DB, proxy: \" + name);\n                        }\n                    } else {\n                        assert (false) : \"Invalid console proxy name: \" + name;\n                    }\n                }\n            }\n\n        }\n","date":"2021-07-28 06:56:14","endLine":302,"groupId":"101978","id":3,"instanceNumber":1,"isCurCommit":1,"methodName":"onAgentDisconnect","params":"(longagentId@com.cloud.host.Statusstate)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/6c/c0ace1e05600559e196cd0be536313c3c1cd80.src","preCode":"        public void onAgentDisconnect(long agentId, com.cloud.host.Status state) {\n\n            if (state == com.cloud.host.Status.Alert || state == com.cloud.host.Status.Disconnected) {\n                \r\n                \r\n                \r\n                \r\n                \r\n                \r\n                HostVO host = _hostDao.findById(agentId);\n                if (host.getType() == Type.ConsoleProxy) {\n                    String name = host.getName();\n                    if (s_logger.isInfoEnabled()) {\n                        s_logger.info(\"Console proxy agent disconnected, proxy: \" + name);\n                    }\n                    if (name != null && name.startsWith(\"v-\")) {\n                        String[] tokens = name.split(\"-\");\n                        long proxyVmId = 0;\n                        try {\n                            proxyVmId = Long.parseLong(tokens[1]);\n                        } catch (NumberFormatException e) {\n                            s_logger.error(\"Unexpected exception \" + e.getMessage(), e);\n                            return;\n                        }\n\n                        final ConsoleProxyVO proxy = _consoleProxyDao.findById(proxyVmId);\n                        if (proxy != null) {\n\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n                            \r\n\n                            \r\n\r\n\r\n\r\n\r\n\r\n\r\n\n                        } else {\n                            if (s_logger.isInfoEnabled()) {\n                                s_logger.info(\"Console proxy agent disconnected but corresponding console proxy VM no longer exists in DB, proxy: \" + name);\n                            }\n                        }\n                    } else {\n                        assert (false) : \"Invalid console proxy name: \" + name;\n                    }\n                }\n            }\n\n        }\n","realPath":"server/src/main/java/com/cloud/consoleproxy/ConsoleProxyManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":272,"status":"M"},{"authorDate":"2021-07-28 06:56:14","commitOrder":2,"curCode":"    public void handleAgentDisconnect(long agentId, com.cloud.host.Status state) {\n        if (state == com.cloud.host.Status.Alert || state == com.cloud.host.Status.Disconnected) {\n            HostVO host = hostDao.findById(agentId);\n            if (host.getType() == Type.ConsoleProxy) {\n                String name = host.getName();\n                if (s_logger.isInfoEnabled()) {\n                    s_logger.info(\"Console proxy agent disconnected, proxy: \" + name);\n                }\n                if (name != null && name.startsWith(\"v-\")) {\n                    String[] tokens = name.split(\"-\");\n                    long proxyVmId;\n                    try {\n                        proxyVmId = Long.parseLong(tokens[1]);\n                    } catch (NumberFormatException e) {\n                        s_logger.error(\"Unexpected exception \" + e.getMessage(), e);\n                        return;\n                    }\n\n                    final ConsoleProxyVO proxy = consoleProxyDao.findById(proxyVmId);\n                    if (proxy == null && s_logger.isInfoEnabled()) {\n                        s_logger.info(\"Console proxy agent disconnected but corresponding console proxy VM no longer exists in DB, proxy: \" + name);\n                    }\n                } else {\n                    assert (false) : \"Invalid console proxy name: \" + name;\n                }\n            }\n        }\n    }\n","date":"2021-07-28 06:56:14","endLine":748,"groupId":"101978","id":4,"instanceNumber":2,"isCurCommit":1,"methodName":"handleAgentDisconnect","params":"(longagentId@com.cloud.host.Statusstate)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/6c/c0ace1e05600559e196cd0be536313c3c1cd80.src","preCode":"    public void handleAgentDisconnect(long agentId, com.cloud.host.Status state) {\n        if (state == com.cloud.host.Status.Alert || state == com.cloud.host.Status.Disconnected) {\n            \r\n            \r\n            \r\n            \r\n            HostVO host = _hostDao.findById(agentId);\n            if (host.getType() == Type.ConsoleProxy) {\n                String name = host.getName();\n                if (s_logger.isInfoEnabled()) {\n                    s_logger.info(\"Console proxy agent disconnected, proxy: \" + name);\n                }\n                if (name != null && name.startsWith(\"v-\")) {\n                    String[] tokens = name.split(\"-\");\n                    long proxyVmId = 0;\n                    try {\n                        proxyVmId = Long.parseLong(tokens[1]);\n                    } catch (NumberFormatException e) {\n                        s_logger.error(\"Unexpected exception \" + e.getMessage(), e);\n                        return;\n                    }\n\n                    final ConsoleProxyVO proxy = _consoleProxyDao.findById(proxyVmId);\n                    if (proxy != null) {\n\n                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n\n                        \r\n\r\n\r\n\r\n\r\n\r\n\n                    } else {\n                        if (s_logger.isInfoEnabled()) {\n                            s_logger.info(\"Console proxy agent disconnected but corresponding console proxy VM no longer exists in DB, proxy: \" + name);\n                        }\n                    }\n                } else {\n                    assert (false) : \"Invalid console proxy name: \" + name;\n                }\n            }\n        }\n    }\n","realPath":"server/src/main/java/com/cloud/consoleproxy/ConsoleProxyManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":721,"status":"M"}],"commitId":"1f5ee5b3e3855c7f46d7e850465a8a0ec3a5c19c","commitMessage":"@@@Improve logs on ConsoleProxyManagerImpl and refactor a few process (#4959)\n\n","date":"2021-07-28 06:56:14","modifiedFileCount":"3","status":"M","submitter":"Daniel Augusto Veronezi Salvador"}]
