[{"authorTime":"2018-01-20 05:49:27","codes":[{"authorDate":"2018-01-20 05:49:27","commitOrder":1,"curCode":"    public String generateKeyStoreAndCsr(final Host host, final Map<String, String> sshAccessDetails) throws AgentUnavailableException, OperationTimedoutException {\n        final SetupKeyStoreCommand cmd = new SetupKeyStoreCommand(CertValidityPeriod.value());\n        if (sshAccessDetails != null && !sshAccessDetails.isEmpty()) {\n            cmd.setAccessDetail(sshAccessDetails);\n        }\n        CallContext.current().setEventDetails(\"generating keystore and CSR for host id: \" + host.getId());\n        final SetupKeystoreAnswer answer = (SetupKeystoreAnswer) agentManager.send(host.getId(), cmd);\n        return answer.getCsr();\n    }\n","date":"2018-01-20 05:49:27","endLine":211,"groupId":"7960","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"generateKeyStoreAndCsr","params":"(finalHosthost@finalMap<String@String>sshAccessDetails)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/3a/904315fe16604ed181b25145bbc575cba42b39.src","preCode":"    public String generateKeyStoreAndCsr(final Host host, final Map<String, String> sshAccessDetails) throws AgentUnavailableException, OperationTimedoutException {\n        final SetupKeyStoreCommand cmd = new SetupKeyStoreCommand(CertValidityPeriod.value());\n        if (sshAccessDetails != null && !sshAccessDetails.isEmpty()) {\n            cmd.setAccessDetail(sshAccessDetails);\n        }\n        CallContext.current().setEventDetails(\"generating keystore and CSR for host id: \" + host.getId());\n        final SetupKeystoreAnswer answer = (SetupKeystoreAnswer) agentManager.send(host.getId(), cmd);\n        return answer.getCsr();\n    }\n","realPath":"server/src/main/java/org/apache/cloudstack/ca/CAManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":203,"status":"B"},{"authorDate":"2018-01-20 05:49:27","commitOrder":1,"curCode":"    public boolean deployCertificate(final Host host, final Certificate certificate, final Boolean reconnect, final Map<String, String> sshAccessDetails) throws AgentUnavailableException, OperationTimedoutException {\n        final SetupCertificateCommand cmd = new SetupCertificateCommand(certificate);\n        if (sshAccessDetails != null && !sshAccessDetails.isEmpty()) {\n            cmd.setAccessDetail(sshAccessDetails);\n        }\n        CallContext.current().setEventDetails(\"deploying certificate for host id: \" + host.getId());\n        final SetupCertificateAnswer answer = (SetupCertificateAnswer) agentManager.send(host.getId(), cmd);\n        if (answer.getResult()) {\n            CallContext.current().setEventDetails(\"successfully deployed certificate for host id: \" + host.getId());\n        } else {\n            CallContext.current().setEventDetails(\"failed to deploy certificate for host id: \" + host.getId());\n        }\n\n        if (answer.getResult()) {\n            getActiveCertificatesMap().put(host.getPrivateIpAddress(), certificate.getClientCertificate());\n            if (sshAccessDetails == null && reconnect != null && reconnect) {\n                LOG.info(String.format(\"Successfully setup certificate on host, reconnecting with agent with id=%d, name=%s, address=%s\",\n                        host.getId(), host.getName(), host.getPublicIpAddress()));\n                return agentManager.reconnect(host.getId());\n            }\n            return true;\n        }\n        return false;\n    }\n","date":"2018-01-20 05:49:27","endLine":237,"groupId":"7960","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"deployCertificate","params":"(finalHosthost@finalCertificatecertificate@finalBooleanreconnect@finalMap<String@String>sshAccessDetails)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/3a/904315fe16604ed181b25145bbc575cba42b39.src","preCode":"    public boolean deployCertificate(final Host host, final Certificate certificate, final Boolean reconnect, final Map<String, String> sshAccessDetails) throws AgentUnavailableException, OperationTimedoutException {\n        final SetupCertificateCommand cmd = new SetupCertificateCommand(certificate);\n        if (sshAccessDetails != null && !sshAccessDetails.isEmpty()) {\n            cmd.setAccessDetail(sshAccessDetails);\n        }\n        CallContext.current().setEventDetails(\"deploying certificate for host id: \" + host.getId());\n        final SetupCertificateAnswer answer = (SetupCertificateAnswer) agentManager.send(host.getId(), cmd);\n        if (answer.getResult()) {\n            CallContext.current().setEventDetails(\"successfully deployed certificate for host id: \" + host.getId());\n        } else {\n            CallContext.current().setEventDetails(\"failed to deploy certificate for host id: \" + host.getId());\n        }\n\n        if (answer.getResult()) {\n            getActiveCertificatesMap().put(host.getPrivateIpAddress(), certificate.getClientCertificate());\n            if (sshAccessDetails == null && reconnect != null && reconnect) {\n                LOG.info(String.format(\"Successfully setup certificate on host, reconnecting with agent with id=%d, name=%s, address=%s\",\n                        host.getId(), host.getName(), host.getPublicIpAddress()));\n                return agentManager.reconnect(host.getId());\n            }\n            return true;\n        }\n        return false;\n    }\n","realPath":"server/src/main/java/org/apache/cloudstack/ca/CAManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":214,"status":"B"}],"commitId":"893a88d225276e45f12f9490e6af2c94a81c2965","commitMessage":"@@@CLOUDSTACK-10105: Use maven standard project structure in all projects (#2283)\n\nRemove maven standard module (which only a few were using) and get ride of maven customization for the projects structure.\n\n- moved all directories to src/main/java.  src/main/resources.  src/main/scripts.  src/test/java.  src/test/resources\n- grep scan to search for src/com and src/org left over\n- grep for <project>/scripts to fix pom.xml configuration\n- remove custom <build> configuration in pom.xml\n\nSigned-off-by: Marc-Aur?le Brothier <m@brothier.org>","date":"2018-01-20 05:49:27","modifiedFileCount":"1","status":"B","submitter":"Marc-Aur?le Brothier"},{"authorTime":"2018-03-15 02:27:43","codes":[{"authorDate":"2018-01-20 05:49:27","commitOrder":2,"curCode":"    public String generateKeyStoreAndCsr(final Host host, final Map<String, String> sshAccessDetails) throws AgentUnavailableException, OperationTimedoutException {\n        final SetupKeyStoreCommand cmd = new SetupKeyStoreCommand(CertValidityPeriod.value());\n        if (sshAccessDetails != null && !sshAccessDetails.isEmpty()) {\n            cmd.setAccessDetail(sshAccessDetails);\n        }\n        CallContext.current().setEventDetails(\"generating keystore and CSR for host id: \" + host.getId());\n        final SetupKeystoreAnswer answer = (SetupKeystoreAnswer) agentManager.send(host.getId(), cmd);\n        return answer.getCsr();\n    }\n","date":"2018-01-20 05:49:27","endLine":211,"groupId":"102062","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"generateKeyStoreAndCsr","params":"(finalHosthost@finalMap<String@String>sshAccessDetails)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/3a/904315fe16604ed181b25145bbc575cba42b39.src","preCode":"    public String generateKeyStoreAndCsr(final Host host, final Map<String, String> sshAccessDetails) throws AgentUnavailableException, OperationTimedoutException {\n        final SetupKeyStoreCommand cmd = new SetupKeyStoreCommand(CertValidityPeriod.value());\n        if (sshAccessDetails != null && !sshAccessDetails.isEmpty()) {\n            cmd.setAccessDetail(sshAccessDetails);\n        }\n        CallContext.current().setEventDetails(\"generating keystore and CSR for host id: \" + host.getId());\n        final SetupKeystoreAnswer answer = (SetupKeystoreAnswer) agentManager.send(host.getId(), cmd);\n        return answer.getCsr();\n    }\n","realPath":"server/src/main/java/org/apache/cloudstack/ca/CAManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":203,"status":"N"},{"authorDate":"2018-03-15 02:27:43","commitOrder":2,"curCode":"    public boolean deployCertificate(final Host host, final Certificate certificate, final Boolean reconnect, final Map<String, String> sshAccessDetails)\n            throws AgentUnavailableException, OperationTimedoutException {\n        final SetupCertificateCommand cmd = new SetupCertificateCommand(certificate);\n        if (sshAccessDetails != null && !sshAccessDetails.isEmpty()) {\n            cmd.setAccessDetail(sshAccessDetails);\n        }\n        CallContext.current().setEventDetails(\"deploying certificate for host id: \" + host.getId());\n        final SetupCertificateAnswer answer = (SetupCertificateAnswer)agentManager.send(host.getId(), cmd);\n        if (answer.getResult()) {\n            CallContext.current().setEventDetails(\"successfully deployed certificate for host id: \" + host.getId());\n        } else {\n            CallContext.current().setEventDetails(\"failed to deploy certificate for host id: \" + host.getId());\n        }\n\n        if (answer.getResult()) {\n            getActiveCertificatesMap().put(host.getPrivateIpAddress(), certificate.getClientCertificate());\n            if (sshAccessDetails == null && reconnect != null && reconnect) {\n                LOG.info(String.format(\"Successfully setup certificate on host, reconnecting with agent with id=%d, name=%s, address=%s\", host.getId(), host.getName(), host.getPublicIpAddress()));\n                try {\n                    agentManager.reconnect(host.getId());\n                } catch (AgentUnavailableException | CloudRuntimeException e) {\n                    LOG.debug(\"Error when reconnecting to host: \" + host.getUuid(), e);\n                }\n            }\n            return true;\n        }\n        return false;\n    }\n","date":"2018-03-15 02:27:43","endLine":242,"groupId":"102062","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"deployCertificate","params":"(finalHosthost@finalCertificatecertificate@finalBooleanreconnect@finalMap<String@String>sshAccessDetails)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-cloudstack-10-0.7/blobInfo/CC_OUT/blobs/02/e7a4231a490431f0e3c53ba0eed61730108108.src","preCode":"    public boolean deployCertificate(final Host host, final Certificate certificate, final Boolean reconnect, final Map<String, String> sshAccessDetails) throws AgentUnavailableException, OperationTimedoutException {\n        final SetupCertificateCommand cmd = new SetupCertificateCommand(certificate);\n        if (sshAccessDetails != null && !sshAccessDetails.isEmpty()) {\n            cmd.setAccessDetail(sshAccessDetails);\n        }\n        CallContext.current().setEventDetails(\"deploying certificate for host id: \" + host.getId());\n        final SetupCertificateAnswer answer = (SetupCertificateAnswer) agentManager.send(host.getId(), cmd);\n        if (answer.getResult()) {\n            CallContext.current().setEventDetails(\"successfully deployed certificate for host id: \" + host.getId());\n        } else {\n            CallContext.current().setEventDetails(\"failed to deploy certificate for host id: \" + host.getId());\n        }\n\n        if (answer.getResult()) {\n            getActiveCertificatesMap().put(host.getPrivateIpAddress(), certificate.getClientCertificate());\n            if (sshAccessDetails == null && reconnect != null && reconnect) {\n                LOG.info(String.format(\"Successfully setup certificate on host, reconnecting with agent with id=%d, name=%s, address=%s\",\n                        host.getId(), host.getName(), host.getPublicIpAddress()));\n                return agentManager.reconnect(host.getId());\n            }\n            return true;\n        }\n        return false;\n    }\n","realPath":"server/src/main/java/org/apache/cloudstack/ca/CAManagerImpl.java","repoName":"cloudstack","snippetEndLine":0,"snippetStartLine":0,"startLine":215,"status":"M"}],"commitId":"972b8b71d7fb60a64e8a05e7555f9f92ede7ff40","commitMessage":"@@@CLOUDSTACK-8855 Improve Error Message for Host Alert State and reconnect host API. (#2387)\n\n* CLOUDSTACK-8855 Improve Error Message for Host Alert State\n\n* [CLOUDSTACK-9846] create column to save the content of alert messages\n\nRemove declaration of throws CloudRuntimeException\nI also removed some unused variables and comments left behind\n\nThis closes #837\n\n* Isolate a problematic test \"smoke/test_certauthority_root\"\n","date":"2018-03-15 02:27:43","modifiedFileCount":"14","status":"M","submitter":"Rafael Weing?rtner"}]
