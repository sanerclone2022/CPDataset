[{"authorTime":"2016-09-05 18:01:11","codes":[{"authorDate":"2016-09-05 18:01:11","commitOrder":1,"curCode":"\tpublic void testNoTimerFiringForPurgedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, intListDescriptor, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 0L);\n\t\t\t\treturn TriggerResult.PURGE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(1, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.advanceTime(testHarness, 0L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, never(), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness)); \r\n\t}\n","date":"2017-01-24 17:42:34","endLine":1148,"groupId":"10168","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testNoTimerFiringForPurgedMergingWindow","params":"(finalTimeDomainAdaptortimeAdaptor)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/7c/4d71171f808dc4b8968f061629ea4a416f6967.src","preCode":"\tpublic void testNoTimerFiringForPurgedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, intListDescriptor, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 0L);\n\t\t\t\treturn TriggerResult.PURGE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(1, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.advanceTime(testHarness, 0L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, never(), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness)); \r\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorContractTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1101,"status":"B"},{"authorDate":"2016-09-05 18:01:11","commitOrder":1,"curCode":"\tpublic void testNoTimerFiringForGarbageCollectedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, intListDescriptor, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 10L);\n\t\t\t\treturn TriggerResult.CONTINUE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(2, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.shouldContinueOnTime(mockTrigger);\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 4L);\n\n\t\tverify(mockTrigger, times(1)).clear(anyTimeWindow(), anyTriggerContext());\n\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\t\t\r\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness));\n\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 10L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\t}\n","date":"2017-01-24 17:42:34","endLine":1225,"groupId":"10168","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testNoTimerFiringForGarbageCollectedMergingWindow","params":"(finalTimeDomainAdaptortimeAdaptor)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/7c/4d71171f808dc4b8968f061629ea4a416f6967.src","preCode":"\tpublic void testNoTimerFiringForGarbageCollectedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, intListDescriptor, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 10L);\n\t\t\t\treturn TriggerResult.CONTINUE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(2, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.shouldContinueOnTime(mockTrigger);\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 4L);\n\n\t\tverify(mockTrigger, times(1)).clear(anyTimeWindow(), anyTriggerContext());\n\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\t\t\r\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness));\n\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 10L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorContractTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1165,"status":"B"}],"commitId":"d1475ee86fb58ab70a6dc785d08f190189ede43d","commitMessage":"@@@[FLINK-4552] Refactor WindowOperator/Trigger Tests\n\nBefore.  tests for WindowOperator.  WindowAssigner.  Trigger and\nWindowFunction were all conflated in WindowOperatorTest. All of these\ntest that a certain combination of a Trigger.  WindowAssigner and\nWindowFunction produce the expected output.\n\nThis change modularizes these tests and spreads them out across multiple\nfiles. For example.  one per trigger/window assigner.\n\nThe new WindowOperatorContractTest verifies that the interaction between\nWindowOperator and the various other parts works as expected.  that the\ncorrect methods on Trigger and WindowFunction are called at the expected\ntime and that snapshotting.  timers.  cleanup etc. work correctly. These\ntests also verify that the different state types and WindowFunctions\nwork correctly.\n\nFor trigger tests this introduces TriggerTestHarness. This can be used\nto inject elements into Triggers they fire at the correct times. The\nactual output of the WindowFunction is not important for these tests.\nThe new tests also make sure that triggers correctly clean up state and\ntimers.\n\nWindowAssigner tests verify the behaviour of window assigners in\nisolation.  They also test.  for example.  whether offset parameter of\ntime-based windows work correctly.\n\nWe keep the old WindowOperatorTest because it still provides some level\nof coverage and doesn't take long to run.\n","date":"2017-01-24 17:42:34","modifiedFileCount":"16","status":"B","submitter":"Aljoscha Krettek"},{"authorTime":"2017-03-21 22:00:24","codes":[{"authorDate":"2017-03-21 22:00:24","commitOrder":2,"curCode":"\tpublic void testNoTimerFiringForPurgedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 0L);\n\t\t\t\treturn TriggerResult.PURGE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(1, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.advanceTime(testHarness, 0L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, never(), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness)); \r\n\t}\n","date":"2017-03-23 23:29:01","endLine":1119,"groupId":"10168","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testNoTimerFiringForPurgedMergingWindow","params":"(finalTimeDomainAdaptortimeAdaptor)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/ab/c7b3eb9415cfed7ad5989621aa40b3d9cc5963.src","preCode":"\tpublic void testNoTimerFiringForPurgedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, intListDescriptor, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 0L);\n\t\t\t\treturn TriggerResult.PURGE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(1, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.advanceTime(testHarness, 0L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, never(), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness)); \r\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorContractTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1072,"status":"M"},{"authorDate":"2017-03-21 22:00:24","commitOrder":2,"curCode":"\tpublic void testNoTimerFiringForGarbageCollectedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 10L);\n\t\t\t\treturn TriggerResult.CONTINUE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(2, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.shouldContinueOnTime(mockTrigger);\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 4L);\n\n\t\tverify(mockTrigger, times(1)).clear(anyTimeWindow(), anyTriggerContext());\n\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\t\t\r\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness));\n\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 10L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\t}\n","date":"2017-03-23 23:29:01","endLine":1196,"groupId":"10168","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testNoTimerFiringForGarbageCollectedMergingWindow","params":"(finalTimeDomainAdaptortimeAdaptor)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/ab/c7b3eb9415cfed7ad5989621aa40b3d9cc5963.src","preCode":"\tpublic void testNoTimerFiringForGarbageCollectedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, intListDescriptor, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 10L);\n\t\t\t\treturn TriggerResult.CONTINUE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(2, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.shouldContinueOnTime(mockTrigger);\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 4L);\n\n\t\tverify(mockTrigger, times(1)).clear(anyTimeWindow(), anyTriggerContext());\n\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\t\t\r\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness));\n\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 10L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorContractTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1136,"status":"M"}],"commitId":"3c4b156527e9ca7cb2dafdda706913e91d688133","commitMessage":"@@@[hotfix] Add EvictingWindowOperatorContractTest\n\nThe existing WindowOperatorContractTest is turned into a test base while\nRegularWindowOperatorContract test tests WindowOperator and\nEvictingWindowOperatorTest tests EvictingWindowOperator. For this to\nwork.  the base tests now always use List windows and we have specific\ntests for reducing/folding windows in RegularWindowOperatorContractTest.\n\nThis also patches in the missing side output support for\nEvictingWindowOperator.\n","date":"2017-03-23 23:29:01","modifiedFileCount":"3","status":"M","submitter":"Aljoscha Krettek"},{"authorTime":"2017-03-23 00:02:15","codes":[{"authorDate":"2017-03-23 00:02:15","commitOrder":3,"curCode":"\tprivate void testNoTimerFiringForPurgedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 0L);\n\t\t\t\treturn TriggerResult.PURGE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(1, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.advanceTime(testHarness, 0L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, never(), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness)); \r\n\t}\n","date":"2017-03-23 23:29:01","endLine":1120,"groupId":"10168","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testNoTimerFiringForPurgedMergingWindow","params":"(finalTimeDomainAdaptortimeAdaptor)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/aa/ea8b1e25243b465967fbb63047a9d6f8576ec4.src","preCode":"\tpublic void testNoTimerFiringForPurgedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 0L);\n\t\t\t\treturn TriggerResult.PURGE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(1, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.advanceTime(testHarness, 0L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, never(), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness)); \r\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorContractTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1073,"status":"M"},{"authorDate":"2017-03-23 00:02:15","commitOrder":3,"curCode":"\tprivate void testNoTimerFiringForGarbageCollectedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 10L);\n\t\t\t\treturn TriggerResult.CONTINUE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(2, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.shouldContinueOnTime(mockTrigger);\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 4L);\n\n\t\tverify(mockTrigger, times(1)).clear(anyTimeWindow(), anyTriggerContext());\n\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\t\t\r\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness));\n\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 10L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\t}\n","date":"2017-03-23 23:29:01","endLine":1196,"groupId":"10168","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testNoTimerFiringForGarbageCollectedMergingWindow","params":"(finalTimeDomainAdaptortimeAdaptor)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/aa/ea8b1e25243b465967fbb63047a9d6f8576ec4.src","preCode":"\tpublic void testNoTimerFiringForGarbageCollectedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 10L);\n\t\t\t\treturn TriggerResult.CONTINUE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(2, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.shouldContinueOnTime(mockTrigger);\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 4L);\n\n\t\tverify(mockTrigger, times(1)).clear(anyTimeWindow(), anyTriggerContext());\n\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\t\t\r\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness));\n\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 10L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorContractTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1137,"status":"M"}],"commitId":"25d52e4df216dc54d2d82e1f0b449871bda4ba74","commitMessage":"@@@[hotfix] Fix various small issues in WindowOperatorContractTest\n","date":"2017-03-23 23:29:01","modifiedFileCount":"1","status":"M","submitter":"Aljoscha Krettek"},{"authorTime":"2017-03-06 12:07:18","codes":[{"authorDate":"2017-03-06 12:07:18","commitOrder":4,"curCode":"\tprivate void testNoTimerFiringForPurgedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 0L);\n\t\t\t\treturn TriggerResult.PURGE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(1, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.advanceTime(testHarness, 0L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, never(), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.process(anyInt(), anyTimeWindow(), anyInternalWindowContext(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness)); \r\n\t}\n","date":"2017-03-25 23:59:17","endLine":1124,"groupId":"10168","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"testNoTimerFiringForPurgedMergingWindow","params":"(finalTimeDomainAdaptortimeAdaptor)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/fa/ab505873556fc6ca7cc3435664112acb73c14c.src","preCode":"\tprivate void testNoTimerFiringForPurgedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 0L);\n\t\t\t\treturn TriggerResult.PURGE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(1, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.advanceTime(testHarness, 0L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, never(), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness)); \r\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorContractTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1077,"status":"M"},{"authorDate":"2017-03-06 12:07:18","commitOrder":4,"curCode":"\tprivate void testNoTimerFiringForGarbageCollectedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 10L);\n\t\t\t\treturn TriggerResult.CONTINUE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(2, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.shouldContinueOnTime(mockTrigger);\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 4L);\n\n\t\tverify(mockTrigger, times(1)).clear(anyTimeWindow(), anyTriggerContext());\n\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\t\t\r\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness));\n\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.process(anyInt(), anyTimeWindow(), anyInternalWindowContext(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 10L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\t}\n","date":"2017-03-25 23:59:17","endLine":1200,"groupId":"10168","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testNoTimerFiringForGarbageCollectedMergingWindow","params":"(finalTimeDomainAdaptortimeAdaptor)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/fa/ab505873556fc6ca7cc3435664112acb73c14c.src","preCode":"\tprivate void testNoTimerFiringForGarbageCollectedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 10L);\n\t\t\t\treturn TriggerResult.CONTINUE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(2, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.shouldContinueOnTime(mockTrigger);\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 4L);\n\n\t\tverify(mockTrigger, times(1)).clear(anyTimeWindow(), anyTriggerContext());\n\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\t\t\r\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness));\n\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.apply(anyInt(), anyTimeWindow(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 10L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorContractTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1141,"status":"M"}],"commitId":"fad201bfb0b1f2757f68f7b3ffaf97a486eb93e8","commitMessage":"@@@[FLINK-5929] Allow Access to Per-Window State in ProcessWindowFunction\n","date":"2017-03-25 23:59:17","modifiedFileCount":"24","status":"M","submitter":"Seth Wiesman"},{"authorTime":"2017-03-06 12:07:18","codes":[{"authorDate":"2018-06-28 17:54:56","commitOrder":5,"curCode":"\tprivate void testNoTimerFiringForPurgedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 0L);\n\t\t\t\treturn TriggerResult.PURGE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(1, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.advanceTime(testHarness, 0L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.process(anyInt(), anyTimeWindow(), anyInternalWindowContext(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness)); \r\n\t}\n","date":"2018-07-11 19:35:46","endLine":1183,"groupId":"102790","id":9,"instanceNumber":1,"isCurCommit":0,"methodName":"testNoTimerFiringForPurgedMergingWindow","params":"(finalTimeDomainAdaptortimeAdaptor)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/8d/ee3b0fd5153b084a7971829b708bcfa142c965.src","preCode":"\tprivate void testNoTimerFiringForPurgedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 0L);\n\t\t\t\treturn TriggerResult.PURGE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(1, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.advanceTime(testHarness, 0L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, never(), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.process(anyInt(), anyTimeWindow(), anyInternalWindowContext(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness)); \r\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorContractTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1136,"status":"M"},{"authorDate":"2017-03-06 12:07:18","commitOrder":5,"curCode":"\tprivate void testNoTimerFiringForGarbageCollectedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 10L);\n\t\t\t\treturn TriggerResult.CONTINUE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(2, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.shouldContinueOnTime(mockTrigger);\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 4L);\n\n\t\tverify(mockTrigger, times(1)).clear(anyTimeWindow(), anyTriggerContext());\n\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\t\t\r\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness));\n\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.process(anyInt(), anyTimeWindow(), anyInternalWindowContext(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 10L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\t}\n","date":"2017-03-25 23:59:17","endLine":1200,"groupId":"102790","id":10,"instanceNumber":2,"isCurCommit":0,"methodName":"testNoTimerFiringForGarbageCollectedMergingWindow","params":"(finalTimeDomainAdaptortimeAdaptor)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/fa/ab505873556fc6ca7cc3435664112acb73c14c.src","preCode":"\tprivate void testNoTimerFiringForGarbageCollectedMergingWindow(final TimeDomainAdaptor timeAdaptor) throws Exception {\n\n\t\tMergingWindowAssigner<Integer, TimeWindow> mockAssigner = mockMergingAssigner();\n\t\ttimeAdaptor.setIsEventTime(mockAssigner);\n\t\tTrigger<Integer, TimeWindow> mockTrigger = mockTrigger();\n\n\t\t@SuppressWarnings(\"unchecked\")\n\t\tInternalWindowFunction<Iterable<Integer>, List<Integer>, Integer, TimeWindow> mockWindowFunction =\n\t\t\t\tmock(InternalWindowFunction.class);\n\n\t\tKeyedOneInputStreamOperatorTestHarness<Integer, Integer, List<Integer>> testHarness =\n\t\t\t\tcreateWindowOperator(mockAssigner, mockTrigger, 0L, mockWindowFunction);\n\n\t\ttestHarness.open();\n\n\t\ttimeAdaptor.advanceTime(testHarness, Long.MIN_VALUE);\n\n\t\twhen(mockAssigner.assignWindows(anyInt(), anyLong(), anyAssignerContext()))\n\t\t\t\t.thenReturn(Arrays.asList(new TimeWindow(2, 4)));\n\n\t\tassertEquals(0, testHarness.extractOutputStreamRecords().size());\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\n\t\tdoAnswer(new Answer<TriggerResult>() {\n\t\t\t@Override\n\t\t\tpublic TriggerResult answer(InvocationOnMock invocation) throws Exception {\n\t\t\t\tTrigger.TriggerContext context = (Trigger.TriggerContext) invocation.getArguments()[3];\n\t\t\t\t\r\n\t\t\t\ttimeAdaptor.registerTimer(context, 10L);\n\t\t\t\treturn TriggerResult.CONTINUE;\n\t\t\t}\n\t\t}).when(mockTrigger).onElement(Matchers.<Integer>anyObject(), anyLong(), anyTimeWindow(), anyTriggerContext());\n\n\t\ttestHarness.processElement(new StreamRecord<>(0, 0L));\n\n\t\tassertEquals(2, testHarness.numKeyedStateEntries()); \r\n\t\tassertEquals(2, timeAdaptor.numTimers(testHarness)); \r\n\n\t\ttimeAdaptor.shouldContinueOnTime(mockTrigger);\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 4L);\n\n\t\tverify(mockTrigger, times(1)).clear(anyTimeWindow(), anyTriggerContext());\n\n\t\tassertEquals(0, testHarness.numKeyedStateEntries());\n\t\t\r\n\t\tassertEquals(1, timeAdaptor.numTimers(testHarness));\n\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\n\t\tverify(mockWindowFunction, never())\n\t\t\t\t.process(anyInt(), anyTimeWindow(), anyInternalWindowContext(), anyIntIterable(), WindowOperatorContractTest.<List<Integer>>anyCollector());\n\n\t\t\r\n\t\ttimeAdaptor.advanceTime(testHarness, 10L);\n\n\t\t\r\n\t\ttimeAdaptor.verifyTriggerCallback(mockTrigger, times(1), null, null);\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorContractTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1141,"status":"N"}],"commitId":"fdce4b2ee0b4127c296f2d1e27fe9ecbbedc1676","commitMessage":"@@@[FLINK-5363] Fire timers when window state is currently empty\n\nBefore.  a window Trigger would not be invoked if the window is empty at\nthe time of the timer firing. Now the Trigger is always invoked.\n\nAs a side effect.  this resolves FLINK-9687.\n","date":"2018-07-11 19:35:46","modifiedFileCount":"4","status":"M","submitter":"minwenjun"}]
