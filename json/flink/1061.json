[{"authorTime":"2018-10-19 17:01:03","codes":[{"authorDate":"2018-10-19 17:01:03","commitOrder":1,"curCode":"\tpublic void testMetricMonitorLifecycle() throws Throwable {\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tRocksDBResource localRocksDBResource = new RocksDBResource();\n\t\tlocalRocksDBResource.before();\n\n\t\tSimpleMetricRegistry registry = new SimpleMetricRegistry();\n\t\tGenericMetricGroup group = new GenericMetricGroup(\n\t\t\tregistry,\n\t\t\tUnregisteredMetricGroups.createUnregisteredTaskMetricGroup(),\n\t\t\tOPERATOR_NAME\n\t\t);\n\n\t\tRocksDBNativeMetricOptions options = new RocksDBNativeMetricOptions();\n\t\t\r\n\t\t\r\n\t\t\r\n\t\toptions.enableSizeAllMemTables();\n\n\t\tRocksDBNativeMetricMonitor monitor = new RocksDBNativeMetricMonitor(\n\t\t\tlocalRocksDBResource.getRocksDB(),\n\t\t\toptions,\n\t\t\tgroup\n\t\t);\n\n\t\tColumnFamilyHandle handle = localRocksDBResource.createNewColumnFamily(COLUMN_FAMILY_NAME);\n\t\tmonitor.registerColumnFamily(COLUMN_FAMILY_NAME, handle);\n\n\t\tAssert.assertEquals(\"Failed to register metrics for column family\", 1, registry.metrics.size());\n\n\t\tRocksDBNativeMetricMonitor.RocksDBNativeMetricView view = registry.metrics.get(0);\n\n\t\tview.update();\n\n\t\tAssert.assertNotEquals(\"Failed to pull metric from RocksDB\", BigInteger.ZERO, view.getValue());\n\n\t\tview.setValue(0L);\n\n\t\t\r\n\t\t\r\n\t\tmonitor.close();\n\n\t\tlocalRocksDBResource.after();\n\n\t\tview.update();\n\n\t\tAssert.assertEquals(\"Failed to release RocksDB reference\", BigInteger.ZERO, view.getValue());\n\t}\n","date":"2018-10-19 17:01:03","endLine":101,"groupId":"38217","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testMetricMonitorLifecycle","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/7a/817ebb0e1991f5e55cec760abcca603ba0b087.src","preCode":"\tpublic void testMetricMonitorLifecycle() throws Throwable {\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tRocksDBResource localRocksDBResource = new RocksDBResource();\n\t\tlocalRocksDBResource.before();\n\n\t\tSimpleMetricRegistry registry = new SimpleMetricRegistry();\n\t\tGenericMetricGroup group = new GenericMetricGroup(\n\t\t\tregistry,\n\t\t\tUnregisteredMetricGroups.createUnregisteredTaskMetricGroup(),\n\t\t\tOPERATOR_NAME\n\t\t);\n\n\t\tRocksDBNativeMetricOptions options = new RocksDBNativeMetricOptions();\n\t\t\r\n\t\t\r\n\t\t\r\n\t\toptions.enableSizeAllMemTables();\n\n\t\tRocksDBNativeMetricMonitor monitor = new RocksDBNativeMetricMonitor(\n\t\t\tlocalRocksDBResource.getRocksDB(),\n\t\t\toptions,\n\t\t\tgroup\n\t\t);\n\n\t\tColumnFamilyHandle handle = localRocksDBResource.createNewColumnFamily(COLUMN_FAMILY_NAME);\n\t\tmonitor.registerColumnFamily(COLUMN_FAMILY_NAME, handle);\n\n\t\tAssert.assertEquals(\"Failed to register metrics for column family\", 1, registry.metrics.size());\n\n\t\tRocksDBNativeMetricMonitor.RocksDBNativeMetricView view = registry.metrics.get(0);\n\n\t\tview.update();\n\n\t\tAssert.assertNotEquals(\"Failed to pull metric from RocksDB\", BigInteger.ZERO, view.getValue());\n\n\t\tview.setValue(0L);\n\n\t\t\r\n\t\t\r\n\t\tmonitor.close();\n\n\t\tlocalRocksDBResource.after();\n\n\t\tview.update();\n\n\t\tAssert.assertEquals(\"Failed to release RocksDB reference\", BigInteger.ZERO, view.getValue());\n\t}\n","realPath":"flink-state-backends/flink-statebackend-rocksdb/src/test/java/org/apache/flink/contrib/streaming/state/RocksDBNativeMetricMonitorTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":53,"status":"B"},{"authorDate":"2018-10-19 17:01:03","commitOrder":1,"curCode":"\tpublic void testClosedGaugesDontRead() {\n\t\tSimpleMetricRegistry registry = new SimpleMetricRegistry();\n\t\tGenericMetricGroup group = new GenericMetricGroup(\n\t\t\tregistry,\n\t\t\tUnregisteredMetricGroups.createUnregisteredTaskMetricGroup(),\n\t\t\tOPERATOR_NAME\n\t\t);\n\n\t\tRocksDBNativeMetricOptions options = new RocksDBNativeMetricOptions();\n\t\toptions.enableSizeAllMemTables();\n\n\t\tRocksDBNativeMetricMonitor monitor = new RocksDBNativeMetricMonitor(\n\t\t\trocksDBResource.getRocksDB(),\n\t\t\toptions,\n\t\t\tgroup\n\t\t);\n\n\t\tColumnFamilyHandle handle = rocksDBResource.createNewColumnFamily(COLUMN_FAMILY_NAME);\n\t\tmonitor.registerColumnFamily(COLUMN_FAMILY_NAME, handle);\n\n\t\tRocksDBNativeMetricMonitor.RocksDBNativeMetricView view = registry.metrics.get(0);\n\n\t\tview.close();\n\t\tview.update();\n\n\t\tAssert.assertEquals(\"Closed gauge still queried RocksDB\", BigInteger.ZERO, view.getValue());\n\t}\n","date":"2018-10-19 17:01:03","endLine":157,"groupId":"38214","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testClosedGaugesDontRead","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/7a/817ebb0e1991f5e55cec760abcca603ba0b087.src","preCode":"\tpublic void testClosedGaugesDontRead() {\n\t\tSimpleMetricRegistry registry = new SimpleMetricRegistry();\n\t\tGenericMetricGroup group = new GenericMetricGroup(\n\t\t\tregistry,\n\t\t\tUnregisteredMetricGroups.createUnregisteredTaskMetricGroup(),\n\t\t\tOPERATOR_NAME\n\t\t);\n\n\t\tRocksDBNativeMetricOptions options = new RocksDBNativeMetricOptions();\n\t\toptions.enableSizeAllMemTables();\n\n\t\tRocksDBNativeMetricMonitor monitor = new RocksDBNativeMetricMonitor(\n\t\t\trocksDBResource.getRocksDB(),\n\t\t\toptions,\n\t\t\tgroup\n\t\t);\n\n\t\tColumnFamilyHandle handle = rocksDBResource.createNewColumnFamily(COLUMN_FAMILY_NAME);\n\t\tmonitor.registerColumnFamily(COLUMN_FAMILY_NAME, handle);\n\n\t\tRocksDBNativeMetricMonitor.RocksDBNativeMetricView view = registry.metrics.get(0);\n\n\t\tview.close();\n\t\tview.update();\n\n\t\tAssert.assertEquals(\"Closed gauge still queried RocksDB\", BigInteger.ZERO, view.getValue());\n\t}\n","realPath":"flink-state-backends/flink-statebackend-rocksdb/src/test/java/org/apache/flink/contrib/streaming/state/RocksDBNativeMetricMonitorTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":131,"status":"B"}],"commitId":"e62a7eabe34da42e4cb56d1b14905a3b9e9c9bd4","commitMessage":"@@@[FLINK-10423][rocksdb][metrics] Expose Rocksdb native metrics\n\n","date":"2018-10-19 17:01:03","modifiedFileCount":"22","status":"B","submitter":"Seth Wiesman"},{"authorTime":"2019-02-23 03:16:41","codes":[{"authorDate":"2019-02-23 03:16:41","commitOrder":2,"curCode":"\tpublic void testMetricMonitorLifecycle() throws Throwable {\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tRocksDBResource localRocksDBResource = new RocksDBResource();\n\t\tlocalRocksDBResource.before();\n\n\t\tSimpleMetricRegistry registry = new SimpleMetricRegistry();\n\t\tGenericMetricGroup group = new GenericMetricGroup(\n\t\t\tregistry,\n\t\t\tUnregisteredMetricGroups.createUnregisteredTaskMetricGroup(),\n\t\t\tOPERATOR_NAME\n\t\t);\n\n\t\tRocksDBNativeMetricOptions options = new RocksDBNativeMetricOptions();\n\t\t\r\n\t\t\r\n\t\t\r\n\t\toptions.enableSizeAllMemTables();\n\n\t\tRocksDBNativeMetricMonitor monitor = new RocksDBNativeMetricMonitor(\n\t\t\toptions,\n\t\t\tgroup,\n\t\t\tlocalRocksDBResource.getRocksDB()\n\t\t);\n\n\t\tColumnFamilyHandle handle = localRocksDBResource.createNewColumnFamily(COLUMN_FAMILY_NAME);\n\t\tmonitor.registerColumnFamily(COLUMN_FAMILY_NAME, handle);\n\n\t\tAssert.assertEquals(\"Failed to register metrics for column family\", 1, registry.metrics.size());\n\n\t\tRocksDBNativeMetricMonitor.RocksDBNativeMetricView view = registry.metrics.get(0);\n\n\t\tview.update();\n\n\t\tAssert.assertNotEquals(\"Failed to pull metric from RocksDB\", BigInteger.ZERO, view.getValue());\n\n\t\tview.setValue(0L);\n\n\t\t\r\n\t\t\r\n\t\tmonitor.close();\n\n\t\tlocalRocksDBResource.after();\n\n\t\tview.update();\n\n\t\tAssert.assertEquals(\"Failed to release RocksDB reference\", BigInteger.ZERO, view.getValue());\n\t}\n","date":"2019-02-23 03:16:41","endLine":101,"groupId":"1061","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testMetricMonitorLifecycle","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/92/f1b602e66e4e76f8f58eaee7035cfbe4724514.src","preCode":"\tpublic void testMetricMonitorLifecycle() throws Throwable {\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tRocksDBResource localRocksDBResource = new RocksDBResource();\n\t\tlocalRocksDBResource.before();\n\n\t\tSimpleMetricRegistry registry = new SimpleMetricRegistry();\n\t\tGenericMetricGroup group = new GenericMetricGroup(\n\t\t\tregistry,\n\t\t\tUnregisteredMetricGroups.createUnregisteredTaskMetricGroup(),\n\t\t\tOPERATOR_NAME\n\t\t);\n\n\t\tRocksDBNativeMetricOptions options = new RocksDBNativeMetricOptions();\n\t\t\r\n\t\t\r\n\t\t\r\n\t\toptions.enableSizeAllMemTables();\n\n\t\tRocksDBNativeMetricMonitor monitor = new RocksDBNativeMetricMonitor(\n\t\t\tlocalRocksDBResource.getRocksDB(),\n\t\t\toptions,\n\t\t\tgroup\n\t\t);\n\n\t\tColumnFamilyHandle handle = localRocksDBResource.createNewColumnFamily(COLUMN_FAMILY_NAME);\n\t\tmonitor.registerColumnFamily(COLUMN_FAMILY_NAME, handle);\n\n\t\tAssert.assertEquals(\"Failed to register metrics for column family\", 1, registry.metrics.size());\n\n\t\tRocksDBNativeMetricMonitor.RocksDBNativeMetricView view = registry.metrics.get(0);\n\n\t\tview.update();\n\n\t\tAssert.assertNotEquals(\"Failed to pull metric from RocksDB\", BigInteger.ZERO, view.getValue());\n\n\t\tview.setValue(0L);\n\n\t\t\r\n\t\t\r\n\t\tmonitor.close();\n\n\t\tlocalRocksDBResource.after();\n\n\t\tview.update();\n\n\t\tAssert.assertEquals(\"Failed to release RocksDB reference\", BigInteger.ZERO, view.getValue());\n\t}\n","realPath":"flink-state-backends/flink-statebackend-rocksdb/src/test/java/org/apache/flink/contrib/streaming/state/RocksDBNativeMetricMonitorTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":53,"status":"M"},{"authorDate":"2019-02-23 03:16:41","commitOrder":2,"curCode":"\tpublic void testClosedGaugesDontRead() {\n\t\tSimpleMetricRegistry registry = new SimpleMetricRegistry();\n\t\tGenericMetricGroup group = new GenericMetricGroup(\n\t\t\tregistry,\n\t\t\tUnregisteredMetricGroups.createUnregisteredTaskMetricGroup(),\n\t\t\tOPERATOR_NAME\n\t\t);\n\n\t\tRocksDBNativeMetricOptions options = new RocksDBNativeMetricOptions();\n\t\toptions.enableSizeAllMemTables();\n\n\t\tRocksDBNativeMetricMonitor monitor = new RocksDBNativeMetricMonitor(\n\t\t\toptions,\n\t\t\tgroup,\n\t\t\trocksDBResource.getRocksDB()\n\t\t);\n\n\t\tColumnFamilyHandle handle = rocksDBResource.createNewColumnFamily(COLUMN_FAMILY_NAME);\n\t\tmonitor.registerColumnFamily(COLUMN_FAMILY_NAME, handle);\n\n\t\tRocksDBNativeMetricMonitor.RocksDBNativeMetricView view = registry.metrics.get(0);\n\n\t\tview.close();\n\t\tview.update();\n\n\t\tAssert.assertEquals(\"Closed gauge still queried RocksDB\", BigInteger.ZERO, view.getValue());\n\t}\n","date":"2019-02-23 03:16:41","endLine":163,"groupId":"1061","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testClosedGaugesDontRead","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/92/f1b602e66e4e76f8f58eaee7035cfbe4724514.src","preCode":"\tpublic void testClosedGaugesDontRead() {\n\t\tSimpleMetricRegistry registry = new SimpleMetricRegistry();\n\t\tGenericMetricGroup group = new GenericMetricGroup(\n\t\t\tregistry,\n\t\t\tUnregisteredMetricGroups.createUnregisteredTaskMetricGroup(),\n\t\t\tOPERATOR_NAME\n\t\t);\n\n\t\tRocksDBNativeMetricOptions options = new RocksDBNativeMetricOptions();\n\t\toptions.enableSizeAllMemTables();\n\n\t\tRocksDBNativeMetricMonitor monitor = new RocksDBNativeMetricMonitor(\n\t\t\trocksDBResource.getRocksDB(),\n\t\t\toptions,\n\t\t\tgroup\n\t\t);\n\n\t\tColumnFamilyHandle handle = rocksDBResource.createNewColumnFamily(COLUMN_FAMILY_NAME);\n\t\tmonitor.registerColumnFamily(COLUMN_FAMILY_NAME, handle);\n\n\t\tRocksDBNativeMetricMonitor.RocksDBNativeMetricView view = registry.metrics.get(0);\n\n\t\tview.close();\n\t\tview.update();\n\n\t\tAssert.assertEquals(\"Closed gauge still queried RocksDB\", BigInteger.ZERO, view.getValue());\n\t}\n","realPath":"flink-state-backends/flink-statebackend-rocksdb/src/test/java/org/apache/flink/contrib/streaming/state/RocksDBNativeMetricMonitorTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":137,"status":"M"}],"commitId":"3bf06b9dd3dc66dcfdeccaaa591ace41ea51e343","commitMessage":"@@@[FLINK-10043] [State Backends] Refactor RocksDBKeyedStateBackend object construction/initialization/restore code\n\nThis closes #7674.\n","date":"2019-02-23 03:16:41","modifiedFileCount":"36","status":"M","submitter":"Yu Li"}]
