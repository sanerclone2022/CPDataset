[{"authorTime":"2019-06-12 15:21:31","codes":[{"authorDate":"2019-06-12 00:53:00","commitOrder":2,"curCode":"\tpublic CatalogTableStatistics getPartitionStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\treturn createCatalogTableStatistics(partition.getParameters());\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec, e);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get partition stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","date":"2019-07-06 03:06:34","endLine":1228,"groupId":"31385","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"getPartitionStatistics","params":"(ObjectPathtablePath@CatalogPartitionSpecpartitionSpec)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/fe/a0de4785b11260cec0763eb903c9ecabea6388.src","preCode":"\tpublic CatalogTableStatistics getPartitionStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\treturn createCatalogTableStatistics(partition.getParameters());\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec, e);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get partition stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","realPath":"flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/HiveCatalog.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1218,"status":"B"},{"authorDate":"2019-06-12 15:21:31","commitOrder":2,"curCode":"\tpublic CatalogColumnStatistics getPartitionColumnStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\tTable hiveTable = getHiveTable(tablePath);\n\t\t\tString partName = getPartitionName(tablePath, partitionSpec, hiveTable);\n\t\t\tList<String> partNames = new ArrayList<>();\n\t\t\tpartNames.add(partName);\n\t\t\tMap<String, List<ColumnStatisticsObj>> partitionColumnStatistics =\n\t\t\t\t\tclient.getPartitionColumnStatistics(partition.getDbName(), partition.getTableName(), partNames,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgetFieldNames(partition.getSd().getCols()));\n\t\t\tList<ColumnStatisticsObj> columnStatisticsObjs = partitionColumnStatistics.get(partName);\n\t\t\tif (columnStatisticsObjs != null && !columnStatisticsObjs.isEmpty()) {\n\t\t\t\treturn new CatalogColumnStatistics(HiveStatsUtil.createCatalogColumnStats(columnStatisticsObjs));\n\t\t\t} else {\n\t\t\t\treturn CatalogColumnStatistics.UNKNOWN;\n\t\t\t}\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get table stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","date":"2019-06-25 11:29:07","endLine":1176,"groupId":"39150","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"getPartitionColumnStatistics","params":"(ObjectPathtablePath@CatalogPartitionSpecpartitionSpec)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/96/4139aa7c421c04053ea04088722ece42220409.src","preCode":"\tpublic CatalogColumnStatistics getPartitionColumnStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\tTable hiveTable = getHiveTable(tablePath);\n\t\t\tString partName = getPartitionName(tablePath, partitionSpec, hiveTable);\n\t\t\tList<String> partNames = new ArrayList<>();\n\t\t\tpartNames.add(partName);\n\t\t\tMap<String, List<ColumnStatisticsObj>> partitionColumnStatistics =\n\t\t\t\t\tclient.getPartitionColumnStatistics(partition.getDbName(), partition.getTableName(), partNames,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgetFieldNames(partition.getSd().getCols()));\n\t\t\tList<ColumnStatisticsObj> columnStatisticsObjs = partitionColumnStatistics.get(partName);\n\t\t\tif (columnStatisticsObjs != null && !columnStatisticsObjs.isEmpty()) {\n\t\t\t\treturn new CatalogColumnStatistics(HiveStatsUtil.createCatalogColumnStats(columnStatisticsObjs));\n\t\t\t} else {\n\t\t\t\treturn CatalogColumnStatistics.UNKNOWN;\n\t\t\t}\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get table stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","realPath":"flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/HiveCatalog.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1154,"status":"NB"}],"commitId":"6d7a15e328e8af6f001d6191c3f167bd8038bf14","commitMessage":"@@@[FLINK-12237][hive]Support Hive table stats related operations in HiveCatalog\n\nThis pull request makes HiveCatalog support Hive table stats related operations.\n\nThis closes #8636.\n","date":"2019-07-06 03:06:34","modifiedFileCount":"9","status":"M","submitter":"zjuwangg"},{"authorTime":"2019-10-25 19:13:55","codes":[{"authorDate":"2019-06-12 00:53:00","commitOrder":3,"curCode":"\tpublic CatalogTableStatistics getPartitionStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\treturn createCatalogTableStatistics(partition.getParameters());\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec, e);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get partition stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","date":"2019-07-06 03:06:34","endLine":1228,"groupId":"31385","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"getPartitionStatistics","params":"(ObjectPathtablePath@CatalogPartitionSpecpartitionSpec)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/fe/a0de4785b11260cec0763eb903c9ecabea6388.src","preCode":"\tpublic CatalogTableStatistics getPartitionStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\treturn createCatalogTableStatistics(partition.getParameters());\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec, e);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get partition stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","realPath":"flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/HiveCatalog.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1218,"status":"N"},{"authorDate":"2019-10-25 19:13:55","commitOrder":3,"curCode":"\tpublic CatalogColumnStatistics getPartitionColumnStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\tTable hiveTable = getHiveTable(tablePath);\n\t\t\tString partName = getPartitionName(tablePath, partitionSpec, hiveTable);\n\t\t\tList<String> partNames = new ArrayList<>();\n\t\t\tpartNames.add(partName);\n\t\t\tMap<String, List<ColumnStatisticsObj>> partitionColumnStatistics =\n\t\t\t\t\tclient.getPartitionColumnStatistics(partition.getDbName(), partition.getTableName(), partNames,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgetFieldNames(partition.getSd().getCols()));\n\t\t\tList<ColumnStatisticsObj> columnStatisticsObjs = partitionColumnStatistics.get(partName);\n\t\t\tif (columnStatisticsObjs != null && !columnStatisticsObjs.isEmpty()) {\n\t\t\t\treturn new CatalogColumnStatistics(HiveStatsUtil.createCatalogColumnStats(columnStatisticsObjs, hiveVersion));\n\t\t\t} else {\n\t\t\t\treturn CatalogColumnStatistics.UNKNOWN;\n\t\t\t}\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get table stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","date":"2019-10-30 01:28:33","endLine":1298,"groupId":"39150","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"getPartitionColumnStatistics","params":"(ObjectPathtablePath@CatalogPartitionSpecpartitionSpec)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/49/ff7441c1677bc05b50da1011f05482f77cf97d.src","preCode":"\tpublic CatalogColumnStatistics getPartitionColumnStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\tTable hiveTable = getHiveTable(tablePath);\n\t\t\tString partName = getPartitionName(tablePath, partitionSpec, hiveTable);\n\t\t\tList<String> partNames = new ArrayList<>();\n\t\t\tpartNames.add(partName);\n\t\t\tMap<String, List<ColumnStatisticsObj>> partitionColumnStatistics =\n\t\t\t\t\tclient.getPartitionColumnStatistics(partition.getDbName(), partition.getTableName(), partNames,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgetFieldNames(partition.getSd().getCols()));\n\t\t\tList<ColumnStatisticsObj> columnStatisticsObjs = partitionColumnStatistics.get(partName);\n\t\t\tif (columnStatisticsObjs != null && !columnStatisticsObjs.isEmpty()) {\n\t\t\t\treturn new CatalogColumnStatistics(HiveStatsUtil.createCatalogColumnStats(columnStatisticsObjs));\n\t\t\t} else {\n\t\t\t\treturn CatalogColumnStatistics.UNKNOWN;\n\t\t\t}\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get table stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","realPath":"flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/HiveCatalog.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1276,"status":"M"}],"commitId":"6cc09ac6ed822e2b3d753b27c621f5122d353673","commitMessage":"@@@[FLINK-14526][hive] Support Hive version 1.1.0 and 1.1.1\n\nTo support Hive 1.1.0 and 1.1.1.\n\nThis closes #9995.\n","date":"2019-10-30 01:28:33","modifiedFileCount":"19","status":"M","submitter":"Rui Li"},{"authorTime":"2020-08-28 14:24:33","codes":[{"authorDate":"2019-06-12 00:53:00","commitOrder":4,"curCode":"\tpublic CatalogTableStatistics getPartitionStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\treturn createCatalogTableStatistics(partition.getParameters());\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec, e);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get partition stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","date":"2019-07-06 03:06:34","endLine":1228,"groupId":"101117","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"getPartitionStatistics","params":"(ObjectPathtablePath@CatalogPartitionSpecpartitionSpec)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/fe/a0de4785b11260cec0763eb903c9ecabea6388.src","preCode":"\tpublic CatalogTableStatistics getPartitionStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\treturn createCatalogTableStatistics(partition.getParameters());\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec, e);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get partition stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","realPath":"flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/HiveCatalog.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1218,"status":"N"},{"authorDate":"2020-08-28 14:24:33","commitOrder":4,"curCode":"\tpublic CatalogColumnStatistics getPartitionColumnStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\tTable hiveTable = getHiveTable(tablePath);\n\t\t\tString partName = getEscapedPartitionName(tablePath, partitionSpec, hiveTable);\n\t\t\tList<String> partNames = new ArrayList<>();\n\t\t\tpartNames.add(partName);\n\t\t\tMap<String, List<ColumnStatisticsObj>> partitionColumnStatistics =\n\t\t\t\t\tclient.getPartitionColumnStatistics(partition.getDbName(), partition.getTableName(), partNames,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgetFieldNames(partition.getSd().getCols()));\n\t\t\tList<ColumnStatisticsObj> columnStatisticsObjs = partitionColumnStatistics.get(partName);\n\t\t\tif (columnStatisticsObjs != null && !columnStatisticsObjs.isEmpty()) {\n\t\t\t\treturn new CatalogColumnStatistics(HiveStatsUtil.createCatalogColumnStats(columnStatisticsObjs, hiveVersion));\n\t\t\t} else {\n\t\t\t\treturn CatalogColumnStatistics.UNKNOWN;\n\t\t\t}\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get table stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","date":"2020-08-28 14:24:33","endLine":1394,"groupId":"101117","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"getPartitionColumnStatistics","params":"(ObjectPathtablePath@CatalogPartitionSpecpartitionSpec)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/e3/20144d0e4295f228740787ce1a6f06df6686fa.src","preCode":"\tpublic CatalogColumnStatistics getPartitionColumnStatistics(ObjectPath tablePath, CatalogPartitionSpec partitionSpec) throws PartitionNotExistException, CatalogException {\n\t\ttry {\n\t\t\tPartition partition = getHivePartition(tablePath, partitionSpec);\n\t\t\tTable hiveTable = getHiveTable(tablePath);\n\t\t\tString partName = getPartitionName(tablePath, partitionSpec, hiveTable);\n\t\t\tList<String> partNames = new ArrayList<>();\n\t\t\tpartNames.add(partName);\n\t\t\tMap<String, List<ColumnStatisticsObj>> partitionColumnStatistics =\n\t\t\t\t\tclient.getPartitionColumnStatistics(partition.getDbName(), partition.getTableName(), partNames,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgetFieldNames(partition.getSd().getCols()));\n\t\t\tList<ColumnStatisticsObj> columnStatisticsObjs = partitionColumnStatistics.get(partName);\n\t\t\tif (columnStatisticsObjs != null && !columnStatisticsObjs.isEmpty()) {\n\t\t\t\treturn new CatalogColumnStatistics(HiveStatsUtil.createCatalogColumnStats(columnStatisticsObjs, hiveVersion));\n\t\t\t} else {\n\t\t\t\treturn CatalogColumnStatistics.UNKNOWN;\n\t\t\t}\n\t\t} catch (TableNotExistException | PartitionSpecInvalidException e) {\n\t\t\tthrow new PartitionNotExistException(getName(), tablePath, partitionSpec);\n\t\t} catch (TException e) {\n\t\t\tthrow new CatalogException(String.format(\"Failed to get table stats of table %s 's partition %s\",\n\t\t\t\t\t\t\t\t\t\t\t\t\ttablePath.getFullName(), String.valueOf(partitionSpec)), e);\n\t\t}\n\t}\n","realPath":"flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/table/catalog/hive/HiveCatalog.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":1372,"status":"M"}],"commitId":"f924a665b6f0bff815f87a221495b101b035315e","commitMessage":"@@@[FLINK-19061][hive] HiveCatalog fails to get partition column stats if partition value contains special characters\n\nThis closes #13264","date":"2020-08-28 14:24:33","modifiedFileCount":"2","status":"M","submitter":"Rui Li"}]
