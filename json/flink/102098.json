[{"authorTime":"2020-09-10 16:22:59","codes":[{"authorDate":"2020-09-18 15:52:20","commitOrder":2,"curCode":"\tpublic void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema) throws Exception {\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n\t\t\t\"-U(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+U(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\t\r\n\t\tCanalJsonSerializationSchema serializationSchema = new CanalJsonSerializationSchema(\n\t\t\tSCHEMA,\n\t\t\tTimestampFormat.ISO_8601);\n\t\tserializationSchema.open(null);\n\n\t\tList<String> result = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tresult.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\tList<String> expectedResult = Arrays.asList(\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n\t\tassertEquals(expectedResult, result);\n\t}\n","date":"2020-09-18 15:52:20","endLine":193,"groupId":"41099","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"runTest","params":"(List<String>lines@CanalJsonDeserializationSchemadeserializationSchema)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/e8/f3401af961f33cbc496ccbf3d53962b6a80248.src","preCode":"\tpublic void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema) throws Exception {\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n\t\t\t\"-U(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+U(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\t\r\n\t\tCanalJsonSerializationSchema serializationSchema = new CanalJsonSerializationSchema(\n\t\t\tSCHEMA,\n\t\t\tTimestampFormat.ISO_8601);\n\t\tserializationSchema.open(null);\n\n\t\tList<String> result = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tresult.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\tList<String> expectedResult = Arrays.asList(\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n\t\tassertEquals(expectedResult, result);\n\t}\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/canal/CanalJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":86,"status":"B"},{"authorDate":"2020-09-10 16:22:59","commitOrder":2,"curCode":"\tprivate void testSerializationDeserialization(String resourceFile, boolean schemaInclude) throws Exception {\n\t\tList<String> lines = readLines(resourceFile);\n\t\tDebeziumJsonDeserializationSchema deserializationSchema = new DebeziumJsonDeserializationSchema(\n\t\t\tSCHEMA,\n\t\t\tInternalTypeInfo.of(SCHEMA),\n\t\t\tschemaInclude,\n\t\t\tfalse,\n\t\t\tTimestampFormat.ISO_8601);\n\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\tDebeziumJsonSerializationSchema serializationSchema = new DebeziumJsonSerializationSchema(\n\t\t\tSCHEMA,\n\t\t\tTimestampFormat.SQL);\n\t\tserializationSchema.open(null);\n\t\tactual = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tactual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\texpected = Arrays.asList(\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\"\n\t\t);\n\t\tassertEquals(expected, actual);\n\t}\n","date":"2020-09-10 16:22:59","endLine":211,"groupId":"26086","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testSerializationDeserialization","params":"(StringresourceFile@booleanschemaInclude)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/0c/4b1a620edd21c13f0712fbabb392f2dccba301.src","preCode":"\tprivate void testSerializationDeserialization(String resourceFile, boolean schemaInclude) throws Exception {\n\t\tList<String> lines = readLines(resourceFile);\n\t\tDebeziumJsonDeserializationSchema deserializationSchema = new DebeziumJsonDeserializationSchema(\n\t\t\tSCHEMA,\n\t\t\tInternalTypeInfo.of(SCHEMA),\n\t\t\tschemaInclude,\n\t\t\tfalse,\n\t\t\tTimestampFormat.ISO_8601);\n\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\tDebeziumJsonSerializationSchema serializationSchema = new DebeziumJsonSerializationSchema(\n\t\t\tSCHEMA,\n\t\t\tTimestampFormat.SQL);\n\t\tserializationSchema.open(null);\n\t\tactual = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tactual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\texpected = Arrays.asList(\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\"\n\t\t);\n\t\tassertEquals(expected, actual);\n\t}\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/debezium/DebeziumJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":111,"status":"NB"}],"commitId":"a3b4c93f82bb04d7313bd0ab34e584061cf22974","commitMessage":"@@@[FLINK-19002][canal][json] Support to only read changelogs of specific database and table for canal-json format\n\nThis closes  (#13294)","date":"2020-09-18 15:52:20","modifiedFileCount":"4","status":"M","submitter":"Jark Wu"},{"authorTime":"2020-11-03 22:55:58","codes":[{"authorDate":"2020-09-18 15:52:20","commitOrder":3,"curCode":"\tpublic void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema) throws Exception {\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n\t\t\t\"-U(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+U(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\t\r\n\t\tCanalJsonSerializationSchema serializationSchema = new CanalJsonSerializationSchema(\n\t\t\tSCHEMA,\n\t\t\tTimestampFormat.ISO_8601);\n\t\tserializationSchema.open(null);\n\n\t\tList<String> result = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tresult.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\tList<String> expectedResult = Arrays.asList(\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n\t\tassertEquals(expectedResult, result);\n\t}\n","date":"2020-09-18 15:52:20","endLine":193,"groupId":"41099","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"runTest","params":"(List<String>lines@CanalJsonDeserializationSchemadeserializationSchema)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/e8/f3401af961f33cbc496ccbf3d53962b6a80248.src","preCode":"\tpublic void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema) throws Exception {\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n\t\t\t\"-U(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+U(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\t\r\n\t\tCanalJsonSerializationSchema serializationSchema = new CanalJsonSerializationSchema(\n\t\t\tSCHEMA,\n\t\t\tTimestampFormat.ISO_8601);\n\t\tserializationSchema.open(null);\n\n\t\tList<String> result = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tresult.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\tList<String> expectedResult = Arrays.asList(\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n\t\tassertEquals(expectedResult, result);\n\t}\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/canal/CanalJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":86,"status":"N"},{"authorDate":"2020-11-03 22:55:58","commitOrder":3,"curCode":"\tprivate void testSerializationDeserialization(String resourceFile, boolean schemaInclude) throws Exception {\n\t\tList<String> lines = readLines(resourceFile);\n\t\tDebeziumJsonDeserializationSchema deserializationSchema = new DebeziumJsonDeserializationSchema(\n\t\t\tPHYSICAL_DATA_TYPE,\n\t\t\tCollections.emptyList(),\n\t\t\tInternalTypeInfo.of(PHYSICAL_DATA_TYPE.getLogicalType()),\n\t\t\tschemaInclude,\n\t\t\tfalse,\n\t\t\tTimestampFormat.ISO_8601);\n\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\tDebeziumJsonSerializationSchema serializationSchema = new DebeziumJsonSerializationSchema(\n\t\t\t(RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n\t\t\tTimestampFormat.SQL);\n\t\tserializationSchema.open(null);\n\t\tactual = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tactual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\texpected = Arrays.asList(\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\"\n\t\t);\n\t\tassertEquals(expected, actual);\n\t}\n","date":"2020-11-07 17:22:09","endLine":280,"groupId":"7757","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testSerializationDeserialization","params":"(StringresourceFile@booleanschemaInclude)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/00/e6ffbcdc1c56670144387313271ae788474e2f.src","preCode":"\tprivate void testSerializationDeserialization(String resourceFile, boolean schemaInclude) throws Exception {\n\t\tList<String> lines = readLines(resourceFile);\n\t\tDebeziumJsonDeserializationSchema deserializationSchema = new DebeziumJsonDeserializationSchema(\n\t\t\tSCHEMA,\n\t\t\tInternalTypeInfo.of(SCHEMA),\n\t\t\tschemaInclude,\n\t\t\tfalse,\n\t\t\tTimestampFormat.ISO_8601);\n\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\tDebeziumJsonSerializationSchema serializationSchema = new DebeziumJsonSerializationSchema(\n\t\t\tSCHEMA,\n\t\t\tTimestampFormat.SQL);\n\t\tserializationSchema.open(null);\n\t\tactual = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tactual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\texpected = Arrays.asList(\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\"\n\t\t);\n\t\tassertEquals(expected, actual);\n\t}\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/debezium/DebeziumJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":179,"status":"M"}],"commitId":"64b96651579d76c718d67ebf2caca526d402a70e","commitMessage":"@@@[FLINK-19276][json][connector-kafka] Support reading Debezium metadata\n\nThis exposes metadata for the Debezium JSON format according to FLIP-107.\n\n- Update the Kafka connector to expose format specific metadata.\n- Reconfigure the internal JsonRowDataDeserializationSchema to read additional fields.\n- Let DebeziumJsonDeserializationSchema access and convert those additional fields to metadata columns.\n\nThis closes #13910.\n","date":"2020-11-07 17:22:09","modifiedFileCount":"13","status":"M","submitter":"Timo Walther"},{"authorTime":"2020-11-11 10:58:04","codes":[{"authorDate":"2020-11-11 10:58:04","commitOrder":4,"curCode":"\tpublic void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema) throws Exception {\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n\t\t\t\"-U(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+U(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\t\r\n\t\tCanalJsonSerializationSchema serializationSchema = new CanalJsonSerializationSchema(\n\t\t\tSCHEMA,\n\t\t\tTimestampFormat.ISO_8601,\n\t\t\tJsonOptions.MapNullKeyMode.LITERAL,\n\t\t\t\"null\");\n\t\tserializationSchema.open(null);\n\n\t\tList<String> result = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tresult.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\tList<String> expectedResult = Arrays.asList(\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n\t\tassertEquals(expectedResult, result);\n\t}\n","date":"2020-11-11 10:58:04","endLine":196,"groupId":"8195","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"runTest","params":"(List<String>lines@CanalJsonDeserializationSchemadeserializationSchema)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/6d/3b76cdadc27221b5202f23c2486231f220c445.src","preCode":"\tpublic void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema) throws Exception {\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n\t\t\t\"-U(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+U(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(102,car battery,12V car battery,5.17)\",\n\t\t\t\"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\t\r\n\t\tCanalJsonSerializationSchema serializationSchema = new CanalJsonSerializationSchema(\n\t\t\tSCHEMA,\n\t\t\tTimestampFormat.ISO_8601);\n\t\tserializationSchema.open(null);\n\n\t\tList<String> result = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tresult.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\tList<String> expectedResult = Arrays.asList(\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n\t\t\t\"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n\t\tassertEquals(expectedResult, result);\n\t}\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/canal/CanalJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":87,"status":"M"},{"authorDate":"2020-11-11 10:58:04","commitOrder":4,"curCode":"\tprivate void testSerializationDeserialization(String resourceFile, boolean schemaInclude) throws Exception {\n\t\tList<String> lines = readLines(resourceFile);\n\t\tDebeziumJsonDeserializationSchema deserializationSchema = new DebeziumJsonDeserializationSchema(\n\t\t\tPHYSICAL_DATA_TYPE,\n\t\t\tCollections.emptyList(),\n\t\t\tInternalTypeInfo.of(PHYSICAL_DATA_TYPE.getLogicalType()),\n\t\t\tschemaInclude,\n\t\t\tfalse,\n\t\t\tTimestampFormat.ISO_8601);\n\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\tDebeziumJsonSerializationSchema serializationSchema = new DebeziumJsonSerializationSchema(\n\t\t\t(RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n\t\t\tTimestampFormat.SQL,\n\t\t\tJsonOptions.MapNullKeyMode.LITERAL,\n\t\t\t\"null\");\n\n\t\tserializationSchema.open(null);\n\t\tactual = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tactual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\texpected = Arrays.asList(\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\"\n\t\t);\n\t\tassertEquals(expected, actual);\n\t}\n","date":"2020-11-11 10:58:04","endLine":284,"groupId":"7757","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testSerializationDeserialization","params":"(StringresourceFile@booleanschemaInclude)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/c8/c1ef2f84f2d85e494624fd8e12c4cd88af3d2c.src","preCode":"\tprivate void testSerializationDeserialization(String resourceFile, boolean schemaInclude) throws Exception {\n\t\tList<String> lines = readLines(resourceFile);\n\t\tDebeziumJsonDeserializationSchema deserializationSchema = new DebeziumJsonDeserializationSchema(\n\t\t\tPHYSICAL_DATA_TYPE,\n\t\t\tCollections.emptyList(),\n\t\t\tInternalTypeInfo.of(PHYSICAL_DATA_TYPE.getLogicalType()),\n\t\t\tschemaInclude,\n\t\t\tfalse,\n\t\t\tTimestampFormat.ISO_8601);\n\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\tDebeziumJsonSerializationSchema serializationSchema = new DebeziumJsonSerializationSchema(\n\t\t\t(RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n\t\t\tTimestampFormat.SQL);\n\t\tserializationSchema.open(null);\n\t\tactual = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tactual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\texpected = Arrays.asList(\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\"\n\t\t);\n\t\tassertEquals(expected, actual);\n\t}\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/debezium/DebeziumJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":180,"status":"M"}],"commitId":"ba7c232cd2519995b693376cdf08b028e8f2e260","commitMessage":"@@@[FLINK-19912][json] Fix JSON format fails to serialize map value with null keys\n\nThis closes #13972","date":"2020-11-11 10:58:04","modifiedFileCount":"19","status":"M","submitter":"wangxlong"},{"authorTime":"2020-11-11 10:58:04","codes":[{"authorDate":"2020-12-31 10:34:00","commitOrder":5,"curCode":"    public void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema)\n            throws Exception {\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n                        \"-U(102,car battery,12V car battery,8.1)\",\n                        \"+U(102,car battery,12V car battery,5.17)\",\n                        \"-D(102,car battery,12V car battery,5.17)\",\n                        \"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        \r\n        CanalJsonSerializationSchema serializationSchema =\n                new CanalJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.ISO_8601,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\");\n        serializationSchema.open(null);\n\n        List<String> result = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            result.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        List<String> expectedResult =\n                Arrays.asList(\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n        assertEquals(expectedResult, result);\n    }\n","date":"2020-12-31 10:34:00","endLine":246,"groupId":"32179","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"runTest","params":"(List<String>lines@CanalJsonDeserializationSchemadeserializationSchema)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/fb/fd1544f2ca8214108ea1ff1f9cead18cd2b21a.src","preCode":"    public void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema)\n            throws Exception {\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n                        \"-U(102,car battery,12V car battery,8.1)\",\n                        \"+U(102,car battery,12V car battery,5.17)\",\n                        \"-D(102,car battery,12V car battery,5.17)\",\n                        \"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        \r\n        CanalJsonSerializationSchema serializationSchema =\n                new CanalJsonSerializationSchema(\n                        SCHEMA,\n                        TimestampFormat.ISO_8601,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\");\n        serializationSchema.open(null);\n\n        List<String> result = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            result.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        List<String> expectedResult =\n                Arrays.asList(\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n        assertEquals(expectedResult, result);\n    }\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/canal/CanalJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":132,"status":"M"},{"authorDate":"2020-11-11 10:58:04","commitOrder":5,"curCode":"\tprivate void testSerializationDeserialization(String resourceFile, boolean schemaInclude) throws Exception {\n\t\tList<String> lines = readLines(resourceFile);\n\t\tDebeziumJsonDeserializationSchema deserializationSchema = new DebeziumJsonDeserializationSchema(\n\t\t\tPHYSICAL_DATA_TYPE,\n\t\t\tCollections.emptyList(),\n\t\t\tInternalTypeInfo.of(PHYSICAL_DATA_TYPE.getLogicalType()),\n\t\t\tschemaInclude,\n\t\t\tfalse,\n\t\t\tTimestampFormat.ISO_8601);\n\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\tDebeziumJsonSerializationSchema serializationSchema = new DebeziumJsonSerializationSchema(\n\t\t\t(RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n\t\t\tTimestampFormat.SQL,\n\t\t\tJsonOptions.MapNullKeyMode.LITERAL,\n\t\t\t\"null\");\n\n\t\tserializationSchema.open(null);\n\t\tactual = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tactual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\texpected = Arrays.asList(\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\"\n\t\t);\n\t\tassertEquals(expected, actual);\n\t}\n","date":"2020-11-11 10:58:04","endLine":284,"groupId":"7757","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testSerializationDeserialization","params":"(StringresourceFile@booleanschemaInclude)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/c8/c1ef2f84f2d85e494624fd8e12c4cd88af3d2c.src","preCode":"\tprivate void testSerializationDeserialization(String resourceFile, boolean schemaInclude) throws Exception {\n\t\tList<String> lines = readLines(resourceFile);\n\t\tDebeziumJsonDeserializationSchema deserializationSchema = new DebeziumJsonDeserializationSchema(\n\t\t\tPHYSICAL_DATA_TYPE,\n\t\t\tCollections.emptyList(),\n\t\t\tInternalTypeInfo.of(PHYSICAL_DATA_TYPE.getLogicalType()),\n\t\t\tschemaInclude,\n\t\t\tfalse,\n\t\t\tTimestampFormat.ISO_8601);\n\n\t\tSimpleCollector collector = new SimpleCollector();\n\t\tfor (String line : lines) {\n\t\t\tdeserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n\t\t}\n\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tList<String> expected = Arrays.asList(\n\t\t\t\"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n\t\t\t\"+I(102,car battery,12V car battery,8.1)\",\n\t\t\t\"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n\t\t\t\"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n\t\t\t\"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n\t\t\t\"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+I(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+I(108,jacket,water resistent black wind breaker,0.1)\",\n\t\t\t\"+I(109,spare tire,24 inch spare tire,22.2)\",\n\t\t\t\"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n\t\t\t\"+U(106,hammer,18oz carpenter hammer,1.0)\",\n\t\t\t\"-U(107,rocks,box of assorted rocks,5.3)\",\n\t\t\t\"+U(107,rocks,box of assorted rocks,5.1)\",\n\t\t\t\"+I(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"-U(110,jacket,water resistent white wind breaker,0.2)\",\n\t\t\t\"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n\t\t\t\"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n\t\t\t\"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n\t\t\t\"-D(111,scooter,Big 2-wheel scooter ,5.17)\"\n\t\t);\n\t\tList<String> actual = collector.list.stream()\n\t\t\t.map(Object::toString)\n\t\t\t.collect(Collectors.toList());\n\t\tassertEquals(expected, actual);\n\n\t\tDebeziumJsonSerializationSchema serializationSchema = new DebeziumJsonSerializationSchema(\n\t\t\t(RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n\t\t\tTimestampFormat.SQL,\n\t\t\tJsonOptions.MapNullKeyMode.LITERAL,\n\t\t\t\"null\");\n\n\t\tserializationSchema.open(null);\n\t\tactual = new ArrayList<>();\n\t\tfor (RowData rowData : collector.list) {\n\t\t\tactual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n\t\t}\n\n\t\texpected = Arrays.asList(\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n\t\t\t\"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n\t\t\t\"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\"\n\t\t);\n\t\tassertEquals(expected, actual);\n\t}\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/debezium/DebeziumJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":180,"status":"N"}],"commitId":"814fe0eb06f1941247742de27e8150b7c9274b43","commitMessage":"@@@[FLINK-20385][canal-json] Allow to read metadata for canal-json format\n\n\nThis closes #14464","date":"2020-12-31 10:34:00","modifiedFileCount":"5","status":"M","submitter":"SteNicholas"},{"authorTime":"2021-01-13 20:15:49","codes":[{"authorDate":"2021-01-13 20:15:49","commitOrder":6,"curCode":"    public void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema)\n            throws Exception {\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n                        \"-U(102,car battery,12V car battery,8.1)\",\n                        \"+U(102,car battery,12V car battery,5.17)\",\n                        \"-D(102,car battery,12V car battery,5.17)\",\n                        \"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        \r\n        CanalJsonSerializationSchema serializationSchema =\n                new CanalJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.ISO_8601,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\",\n                        true);\n        serializationSchema.open(null);\n\n        List<String> result = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            result.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        List<String> expectedResult =\n                Arrays.asList(\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n        assertEquals(expectedResult, result);\n    }\n","date":"2021-01-13 20:15:49","endLine":259,"groupId":"32179","id":9,"instanceNumber":1,"isCurCommit":0,"methodName":"runTest","params":"(List<String>lines@CanalJsonDeserializationSchemadeserializationSchema)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/51/e82ece56fa589939f751a1d217d63edd34ec45.src","preCode":"    public void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema)\n            throws Exception {\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n                        \"-U(102,car battery,12V car battery,8.1)\",\n                        \"+U(102,car battery,12V car battery,5.17)\",\n                        \"-D(102,car battery,12V car battery,5.17)\",\n                        \"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        \r\n        CanalJsonSerializationSchema serializationSchema =\n                new CanalJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.ISO_8601,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\");\n        serializationSchema.open(null);\n\n        List<String> result = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            result.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        List<String> expectedResult =\n                Arrays.asList(\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n        assertEquals(expectedResult, result);\n    }\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/canal/CanalJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":144,"status":"M"},{"authorDate":"2021-01-13 20:15:49","commitOrder":6,"curCode":"    private void testSerializationDeserialization(String resourceFile, boolean schemaInclude)\n            throws Exception {\n        List<String> lines = readLines(resourceFile);\n        DebeziumJsonDeserializationSchema deserializationSchema =\n                new DebeziumJsonDeserializationSchema(\n                        PHYSICAL_DATA_TYPE,\n                        Collections.emptyList(),\n                        InternalTypeInfo.of(PHYSICAL_DATA_TYPE.getLogicalType()),\n                        schemaInclude,\n                        false,\n                        TimestampFormat.ISO_8601);\n\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        DebeziumJsonSerializationSchema serializationSchema =\n                new DebeziumJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.SQL,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\",\n                        true);\n\n        serializationSchema.open(null);\n        actual = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            actual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        expected =\n                Arrays.asList(\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\");\n        assertEquals(expected, actual);\n    }\n","date":"2021-01-13 20:15:49","endLine":292,"groupId":"37761","id":10,"instanceNumber":2,"isCurCommit":0,"methodName":"testSerializationDeserialization","params":"(StringresourceFile@booleanschemaInclude)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/db/98d89d8a5a5ebbcb8af41aa1e586c5cb4b465e.src","preCode":"    private void testSerializationDeserialization(String resourceFile, boolean schemaInclude)\n            throws Exception {\n        List<String> lines = readLines(resourceFile);\n        DebeziumJsonDeserializationSchema deserializationSchema =\n                new DebeziumJsonDeserializationSchema(\n                        PHYSICAL_DATA_TYPE,\n                        Collections.emptyList(),\n                        InternalTypeInfo.of(PHYSICAL_DATA_TYPE.getLogicalType()),\n                        schemaInclude,\n                        false,\n                        TimestampFormat.ISO_8601);\n\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        DebeziumJsonSerializationSchema serializationSchema =\n                new DebeziumJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.SQL,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\");\n\n        serializationSchema.open(null);\n        actual = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            actual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        expected =\n                Arrays.asList(\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\");\n        assertEquals(expected, actual);\n    }\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/debezium/DebeziumJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":182,"status":"M"}],"commitId":"5b9f4db30e5afcf23588f44da767aaa218df1207","commitMessage":"@@@[FLINK-20861][json] Introduce an option for serializing DECIMALs in JSON as plain number instead of scientific notation\n\nThis closes #14604","date":"2021-01-13 20:15:49","modifiedFileCount":"17","status":"M","submitter":"LM Kang"},{"authorTime":"2021-01-13 20:15:49","codes":[{"authorDate":"2021-01-22 13:53:20","commitOrder":7,"curCode":"    public void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema)\n            throws Exception {\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,null,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,null,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n                        \"-U(102,car battery,12V car battery,8.1)\",\n                        \"+U(102,car battery,12V car battery,5.17)\",\n                        \"-D(102,car battery,12V car battery,5.17)\",\n                        \"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        \r\n        CanalJsonSerializationSchema serializationSchema =\n                new CanalJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.ISO_8601,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\",\n                        true);\n        serializationSchema.open(null);\n\n        List<String> result = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            result.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        List<String> expectedResult =\n                Arrays.asList(\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":null,\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":null,\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n        assertEquals(expectedResult, result);\n    }\n","date":"2021-01-22 13:53:20","endLine":259,"groupId":"32179","id":11,"instanceNumber":1,"isCurCommit":0,"methodName":"runTest","params":"(List<String>lines@CanalJsonDeserializationSchemadeserializationSchema)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/37/cf8b7ee3edecd46cdb5365749d8e7ffcd8b369.src","preCode":"    public void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema)\n            throws Exception {\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n                        \"-U(102,car battery,12V car battery,8.1)\",\n                        \"+U(102,car battery,12V car battery,5.17)\",\n                        \"-D(102,car battery,12V car battery,5.17)\",\n                        \"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        \r\n        CanalJsonSerializationSchema serializationSchema =\n                new CanalJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.ISO_8601,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\",\n                        true);\n        serializationSchema.open(null);\n\n        List<String> result = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            result.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        List<String> expectedResult =\n                Arrays.asList(\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n        assertEquals(expectedResult, result);\n    }\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/canal/CanalJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":144,"status":"M"},{"authorDate":"2021-01-13 20:15:49","commitOrder":7,"curCode":"    private void testSerializationDeserialization(String resourceFile, boolean schemaInclude)\n            throws Exception {\n        List<String> lines = readLines(resourceFile);\n        DebeziumJsonDeserializationSchema deserializationSchema =\n                new DebeziumJsonDeserializationSchema(\n                        PHYSICAL_DATA_TYPE,\n                        Collections.emptyList(),\n                        InternalTypeInfo.of(PHYSICAL_DATA_TYPE.getLogicalType()),\n                        schemaInclude,\n                        false,\n                        TimestampFormat.ISO_8601);\n\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        DebeziumJsonSerializationSchema serializationSchema =\n                new DebeziumJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.SQL,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\",\n                        true);\n\n        serializationSchema.open(null);\n        actual = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            actual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        expected =\n                Arrays.asList(\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\");\n        assertEquals(expected, actual);\n    }\n","date":"2021-01-13 20:15:49","endLine":292,"groupId":"37761","id":12,"instanceNumber":2,"isCurCommit":0,"methodName":"testSerializationDeserialization","params":"(StringresourceFile@booleanschemaInclude)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/db/98d89d8a5a5ebbcb8af41aa1e586c5cb4b465e.src","preCode":"    private void testSerializationDeserialization(String resourceFile, boolean schemaInclude)\n            throws Exception {\n        List<String> lines = readLines(resourceFile);\n        DebeziumJsonDeserializationSchema deserializationSchema =\n                new DebeziumJsonDeserializationSchema(\n                        PHYSICAL_DATA_TYPE,\n                        Collections.emptyList(),\n                        InternalTypeInfo.of(PHYSICAL_DATA_TYPE.getLogicalType()),\n                        schemaInclude,\n                        false,\n                        TimestampFormat.ISO_8601);\n\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        DebeziumJsonSerializationSchema serializationSchema =\n                new DebeziumJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.SQL,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\",\n                        true);\n\n        serializationSchema.open(null);\n        actual = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            actual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        expected =\n                Arrays.asList(\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\");\n        assertEquals(expected, actual);\n    }\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/debezium/DebeziumJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":182,"status":"N"}],"commitId":"6ee32ee4a4cc24f2e519545f6c032f06849f08d1","commitMessage":"@@@[FLINK-19446][canal-json] Fix canal-json format parse UPDATE record with null value will get wrong result\n\nThis closes #14693","date":"2021-01-22 13:53:20","modifiedFileCount":"2","status":"M","submitter":"SteNicholas"},{"authorTime":"2021-06-30 18:15:34","codes":[{"authorDate":"2021-06-30 18:15:34","commitOrder":8,"curCode":"    public void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema)\n            throws Exception {\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,null,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,null,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n                        \"-U(102,car battery,12V car battery,8.1)\",\n                        \"+U(102,car battery,12V car battery,5.17)\",\n                        \"-D(102,car battery,12V car battery,5.17)\",\n                        \"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        \r\n        CanalJsonSerializationSchema serializationSchema =\n                new CanalJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.ISO_8601,\n                        JsonFormatOptions.MapNullKeyMode.LITERAL,\n                        \"null\",\n                        true);\n        serializationSchema.open(null);\n\n        List<String> result = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            result.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        List<String> expectedResult =\n                Arrays.asList(\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":null,\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":null,\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n        assertEquals(expectedResult, result);\n    }\n","date":"2021-07-12 18:56:17","endLine":261,"groupId":"102098","id":13,"instanceNumber":1,"isCurCommit":1,"methodName":"runTest","params":"(List<String>lines@CanalJsonDeserializationSchemadeserializationSchema)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/d7/f70ecc0c71d6eae6930ca9e97282f66f74d4fa.src","preCode":"    public void runTest(List<String> lines, CanalJsonDeserializationSchema deserializationSchema)\n            throws Exception {\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,null,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,null,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-U(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+U(101,scooter,Small 2-wheel scooter,5.17)\",\n                        \"-U(102,car battery,12V car battery,8.1)\",\n                        \"+U(102,car battery,12V car battery,5.17)\",\n                        \"-D(102,car battery,12V car battery,5.17)\",\n                        \"-D(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        \r\n        CanalJsonSerializationSchema serializationSchema =\n                new CanalJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.ISO_8601,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\",\n                        true);\n        serializationSchema.open(null);\n\n        List<String> result = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            result.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        List<String> expectedResult =\n                Arrays.asList(\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":null,\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":null,\\\"weight\\\":1.0}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"INSERT\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":5.17}],\\\"type\\\":\\\"DELETE\\\"}\",\n                        \"{\\\"data\\\":[{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8}],\\\"type\\\":\\\"DELETE\\\"}\");\n\n        assertEquals(expectedResult, result);\n    }\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/canal/CanalJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":146,"status":"M"},{"authorDate":"2021-06-30 18:15:34","commitOrder":8,"curCode":"    private void testSerializationDeserialization(String resourceFile, boolean schemaInclude)\n            throws Exception {\n        List<String> lines = readLines(resourceFile);\n        DebeziumJsonDeserializationSchema deserializationSchema =\n                new DebeziumJsonDeserializationSchema(\n                        PHYSICAL_DATA_TYPE,\n                        Collections.emptyList(),\n                        InternalTypeInfo.of(PHYSICAL_DATA_TYPE.getLogicalType()),\n                        schemaInclude,\n                        false,\n                        TimestampFormat.ISO_8601);\n\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        DebeziumJsonSerializationSchema serializationSchema =\n                new DebeziumJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.SQL,\n                        JsonFormatOptions.MapNullKeyMode.LITERAL,\n                        \"null\",\n                        true);\n\n        serializationSchema.open(null);\n        actual = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            actual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        expected =\n                Arrays.asList(\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\");\n        assertEquals(expected, actual);\n    }\n","date":"2021-07-12 18:56:17","endLine":292,"groupId":"102098","id":14,"instanceNumber":2,"isCurCommit":1,"methodName":"testSerializationDeserialization","params":"(StringresourceFile@booleanschemaInclude)","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/24/22dbd3a03e1ba8231a1d085dfd398704025504.src","preCode":"    private void testSerializationDeserialization(String resourceFile, boolean schemaInclude)\n            throws Exception {\n        List<String> lines = readLines(resourceFile);\n        DebeziumJsonDeserializationSchema deserializationSchema =\n                new DebeziumJsonDeserializationSchema(\n                        PHYSICAL_DATA_TYPE,\n                        Collections.emptyList(),\n                        InternalTypeInfo.of(PHYSICAL_DATA_TYPE.getLogicalType()),\n                        schemaInclude,\n                        false,\n                        TimestampFormat.ISO_8601);\n\n        SimpleCollector collector = new SimpleCollector();\n        for (String line : lines) {\n            deserializationSchema.deserialize(line.getBytes(StandardCharsets.UTF_8), collector);\n        }\n\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        \r\n        List<String> expected =\n                Arrays.asList(\n                        \"+I(101,scooter,Small 2-wheel scooter,3.14)\",\n                        \"+I(102,car battery,12V car battery,8.1)\",\n                        \"+I(103,12-pack drill bits,12-pack of drill bits with sizes ranging from #40 to #3,0.8)\",\n                        \"+I(104,hammer,12oz carpenter's hammer,0.75)\",\n                        \"+I(105,hammer,14oz carpenter's hammer,0.875)\",\n                        \"+I(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+I(107,rocks,box of assorted rocks,5.3)\",\n                        \"+I(108,jacket,water resistent black wind breaker,0.1)\",\n                        \"+I(109,spare tire,24 inch spare tire,22.2)\",\n                        \"-U(106,hammer,16oz carpenter's hammer,1.0)\",\n                        \"+U(106,hammer,18oz carpenter hammer,1.0)\",\n                        \"-U(107,rocks,box of assorted rocks,5.3)\",\n                        \"+U(107,rocks,box of assorted rocks,5.1)\",\n                        \"+I(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+I(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"-U(110,jacket,water resistent white wind breaker,0.2)\",\n                        \"+U(110,jacket,new water resistent white wind breaker,0.5)\",\n                        \"-U(111,scooter,Big 2-wheel scooter ,5.18)\",\n                        \"+U(111,scooter,Big 2-wheel scooter ,5.17)\",\n                        \"-D(111,scooter,Big 2-wheel scooter ,5.17)\");\n        List<String> actual =\n                collector.list.stream().map(Object::toString).collect(Collectors.toList());\n        assertEquals(expected, actual);\n\n        DebeziumJsonSerializationSchema serializationSchema =\n                new DebeziumJsonSerializationSchema(\n                        (RowType) PHYSICAL_DATA_TYPE.getLogicalType(),\n                        TimestampFormat.SQL,\n                        JsonOptions.MapNullKeyMode.LITERAL,\n                        \"null\",\n                        true);\n\n        serializationSchema.open(null);\n        actual = new ArrayList<>();\n        for (RowData rowData : collector.list) {\n            actual.add(new String(serializationSchema.serialize(rowData), StandardCharsets.UTF_8));\n        }\n\n        expected =\n                Arrays.asList(\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":101,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Small 2-wheel scooter\\\",\\\"weight\\\":3.14},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":102,\\\"name\\\":\\\"car battery\\\",\\\"description\\\":\\\"12V car battery\\\",\\\"weight\\\":8.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":103,\\\"name\\\":\\\"12-pack drill bits\\\",\\\"description\\\":\\\"12-pack of drill bits with sizes ranging from #40 to #3\\\",\\\"weight\\\":0.8},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":104,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"12oz carpenter's hammer\\\",\\\"weight\\\":0.75},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":105,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"14oz carpenter's hammer\\\",\\\"weight\\\":0.875},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":108,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent black wind breaker\\\",\\\"weight\\\":0.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":109,\\\"name\\\":\\\"spare tire\\\",\\\"description\\\":\\\"24 inch spare tire\\\",\\\"weight\\\":22.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"16oz carpenter's hammer\\\",\\\"weight\\\":1.0},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":106,\\\"name\\\":\\\"hammer\\\",\\\"description\\\":\\\"18oz carpenter hammer\\\",\\\"weight\\\":1.0},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.3},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":107,\\\"name\\\":\\\"rocks\\\",\\\"description\\\":\\\"box of assorted rocks\\\",\\\"weight\\\":5.1},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"water resistent white wind breaker\\\",\\\"weight\\\":0.2},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":110,\\\"name\\\":\\\"jacket\\\",\\\"description\\\":\\\"new water resistent white wind breaker\\\",\\\"weight\\\":0.5},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.18},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\",\n                        \"{\\\"before\\\":null,\\\"after\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"op\\\":\\\"c\\\"}\",\n                        \"{\\\"before\\\":{\\\"id\\\":111,\\\"name\\\":\\\"scooter\\\",\\\"description\\\":\\\"Big 2-wheel scooter \\\",\\\"weight\\\":5.17},\\\"after\\\":null,\\\"op\\\":\\\"d\\\"}\");\n        assertEquals(expected, actual);\n    }\n","realPath":"flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/debezium/DebeziumJsonSerDeSchemaTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":182,"status":"M"}],"commitId":"4fb9287e1d9da63d49d963e2120d79cf822f028c","commitMessage":"@@@[FLINK-23064][format-json] Make JsonOptions PublicEvolving\n","date":"2021-07-12 18:56:17","modifiedFileCount":"17","status":"M","submitter":"Ingo B?rk"}]
