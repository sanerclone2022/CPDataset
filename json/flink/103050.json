[{"authorTime":"2017-10-27 01:17:55","codes":[{"authorDate":"2017-10-27 01:17:55","commitOrder":1,"curCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringCommit() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\t\tharness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.notifyOfCompletedCheckpoint(1);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","date":"2017-11-02 12:32:14","endLine":250,"groupId":"19364","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testLogTimeoutAlmostReachedWarningDuringCommit","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/c0/044234432388b35fb7852384c09a9322ac12be.src","preCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringCommit() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\t\tharness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.notifyOfCompletedCheckpoint(1);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":229,"status":"B"},{"authorDate":"2017-10-27 01:17:55","commitOrder":1,"curCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringRecovery() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\n\t\tfinal OperatorStateHandles snapshot = harness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.initializeState(snapshot);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","date":"2017-11-02 12:32:14","endLine":275,"groupId":"47733","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testLogTimeoutAlmostReachedWarningDuringRecovery","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/c0/044234432388b35fb7852384c09a9322ac12be.src","preCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringRecovery() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\n\t\tfinal OperatorStateHandles snapshot = harness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.initializeState(snapshot);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":253,"status":"B"}],"commitId":"8cdf2ff7e5817acc0c239ce31c098daf33d326b7","commitMessage":"@@@[FLINK-7784] [kafka011-producer] Make TwoPhaseCommitSinkFunction aware of transaction timeouts.\n\nTwoPhaseCommitSinkFunction allows to configure a transaction timeout. The\ntimeout can be used to log warnings if the transaction's age is appraoching\nthe timeout.  and it can be used to swallow exceptions that are likely\nirrecoverable. This commit also integrates these changes to the\nFlinkKafkaProducer011.\n\nThis closes #4910.\n","date":"2017-11-02 12:32:14","modifiedFileCount":"4","status":"B","submitter":"gyao"},{"authorTime":"2018-02-23 17:36:09","codes":[{"authorDate":"2017-10-27 01:17:55","commitOrder":2,"curCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringCommit() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\t\tharness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.notifyOfCompletedCheckpoint(1);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","date":"2017-11-02 12:32:14","endLine":250,"groupId":"19364","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testLogTimeoutAlmostReachedWarningDuringCommit","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/c0/044234432388b35fb7852384c09a9322ac12be.src","preCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringCommit() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\t\tharness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.notifyOfCompletedCheckpoint(1);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":229,"status":"N"},{"authorDate":"2018-02-23 17:36:09","commitOrder":2,"curCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringRecovery() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\n\t\tfinal OperatorSubtaskState snapshot = harness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.initializeState(snapshot);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","date":"2018-02-25 22:10:28","endLine":263,"groupId":"1480","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testLogTimeoutAlmostReachedWarningDuringRecovery","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/16/6dc5a622a74d389e84ab50a7dc52a66692ca64.src","preCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringRecovery() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\n\t\tfinal OperatorStateHandles snapshot = harness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.initializeState(snapshot);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":241,"status":"M"}],"commitId":"617e67c2f540b62b97ca5198b6a5c42b89b6f392","commitMessage":"@@@[hotfix] Remove outdated class OperatorStateHandles and replace it with OperatorSubtaskState\n","date":"2018-02-25 22:10:28","modifiedFileCount":"34","status":"M","submitter":"Stefan Richter"},{"authorTime":"2018-08-16 19:58:42","codes":[{"authorDate":"2017-10-27 01:17:55","commitOrder":3,"curCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringCommit() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\t\tharness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.notifyOfCompletedCheckpoint(1);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","date":"2017-11-02 12:32:14","endLine":250,"groupId":"19364","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testLogTimeoutAlmostReachedWarningDuringCommit","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/c0/044234432388b35fb7852384c09a9322ac12be.src","preCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringCommit() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\t\tharness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.notifyOfCompletedCheckpoint(1);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":229,"status":"N"},{"authorDate":"2018-08-16 19:58:42","commitOrder":3,"curCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringRecovery() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\n\t\tfinal OperatorSubtaskState snapshot = harness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\n\t\tcloseTestHarness();\n\t\tsetUpTestHarness();\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.initializeState(snapshot);\n\t\tharness.open();\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tcloseTestHarness();\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","date":"2018-08-17 15:33:03","endLine":276,"groupId":"1480","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testLogTimeoutAlmostReachedWarningDuringRecovery","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/29/70b87789d3b2c3cba6abf88c0fb4f3acc94d05.src","preCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringRecovery() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\n\t\tfinal OperatorSubtaskState snapshot = harness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.initializeState(snapshot);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":245,"status":"M"}],"commitId":"99582b998b4c8251ed0d1469c2d3f361cdd5b8bf","commitMessage":"@@@[FLINK-10159][tests] Fail TestHarness.initializeState if harness has already been initialized\n\nThis is a change in tests only. Previously it was technically possible to call first `harness.open()`\nfollowed by `harness.initializeState(fooBar)`. However this was incorrect.  since `open()` was already\ncalling `initializeState(null)`.  which was leading to quirks. This commit adds a `checkState` which\nmakes sure that `initializeState` is called only once.\n","date":"2018-08-17 15:33:03","modifiedFileCount":"4","status":"M","submitter":"Piotr Nowojski"},{"authorTime":"2020-01-24 20:49:28","codes":[{"authorDate":"2020-01-24 20:49:28","commitOrder":4,"curCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringCommit() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\t\tharness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.notifyOfCompletedCheckpoint(1);\n\n\t\tassertThat(\n\t\t\ttestLoggerResource.getMessages(),\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","date":"2020-02-21 21:48:16","endLine":217,"groupId":"103050","id":7,"instanceNumber":1,"isCurCommit":0,"methodName":"testLogTimeoutAlmostReachedWarningDuringCommit","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/7d/5e0921b00356f7242ef6602ba78415f2a84ada.src","preCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringCommit() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\t\tharness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\t\tharness.notifyOfCompletedCheckpoint(1);\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":199,"status":"M"},{"authorDate":"2020-01-24 20:49:28","commitOrder":4,"curCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringRecovery() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\n\t\tfinal OperatorSubtaskState snapshot = harness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\n\t\tcloseTestHarness();\n\t\tsetUpTestHarness();\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.initializeState(snapshot);\n\t\tharness.open();\n\n\t\tcloseTestHarness();\n\n\t\tassertThat(\n\t\t\ttestLoggerResource.getMessages(),\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","date":"2020-02-21 21:48:16","endLine":248,"groupId":"103050","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testLogTimeoutAlmostReachedWarningDuringRecovery","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/7d/5e0921b00356f7242ef6602ba78415f2a84ada.src","preCode":"\tpublic void testLogTimeoutAlmostReachedWarningDuringRecovery() throws Exception {\n\t\tclock.setEpochMilli(0);\n\n\t\tfinal long transactionTimeout = 1000;\n\t\tfinal double warningRatio = 0.5;\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.open();\n\n\t\tfinal OperatorSubtaskState snapshot = harness.snapshot(0, 1);\n\t\tfinal long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);\n\t\tclock.setEpochMilli(elapsedTime);\n\n\t\tcloseTestHarness();\n\t\tsetUpTestHarness();\n\t\tsinkFunction.setTransactionTimeout(transactionTimeout);\n\t\tsinkFunction.enableTransactionTimeoutWarnings(warningRatio);\n\n\t\tharness.initializeState(snapshot);\n\t\tharness.open();\n\n\t\tfinal List<String> logMessages =\n\t\t\tloggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());\n\n\t\tcloseTestHarness();\n\n\t\tassertThat(\n\t\t\tlogMessages,\n\t\t\thasItem(containsString(\"has been open for 502 ms. \" +\n\t\t\t\t\"This is close to or even exceeding the transaction timeout of 1000 ms.\")));\n\t}\n","realPath":"flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":220,"status":"M"}],"commitId":"e396e7c9907be91c80ca26a6465e2bf6ec06d281","commitMessage":"@@@[FLINK-15672][build] Migrate to log4j2\n","date":"2020-02-21 21:48:16","modifiedFileCount":"13","status":"M","submitter":"Chesnay Schepler"}]
