[{"authorTime":"2021-07-12 15:32:54","codes":[{"authorDate":"2020-04-23 23:22:55","commitOrder":2,"curCode":"\tpublic void testStaticJobId() throws Throwable {\n\t\tfinal JobID testJobID = new JobID(0, 2);\n\n\t\tfinal Configuration configurationUnderTest = getConfiguration();\n\t\tconfigurationUnderTest.set(PipelineOptionsInternal.PIPELINE_FIXED_JOB_ID, testJobID.toHexString());\n\n\t\tfinal CompletableFuture<JobID> submittedJobId = new CompletableFuture<>();\n\n\t\tfinal TestingDispatcherGateway.Builder dispatcherBuilder = new TestingDispatcherGateway.Builder()\n\t\t\t\t.setSubmitFunction(jobGraph -> {\n\t\t\t\t\tsubmittedJobId.complete(jobGraph.getJobID());\n\t\t\t\t\treturn CompletableFuture.completedFuture(Acknowledge.get());\n\t\t\t\t})\n\t\t\t\t.setRequestJobStatusFunction(jobId -> CompletableFuture.completedFuture(JobStatus.FINISHED))\n\t\t\t\t.setRequestJobResultFunction(jobId -> CompletableFuture.completedFuture(createSuccessfulJobResult(jobId)));\n\n\t\tfinal CompletableFuture<Void> applicationFuture =\n\t\t\t\trunApplication(dispatcherBuilder, configurationUnderTest, 1);\n\n\t\tapplicationFuture.get(TIMEOUT_SECONDS, TimeUnit.SECONDS);\n\n\t\tassertThat(submittedJobId.get(TIMEOUT_SECONDS, TimeUnit.SECONDS), is(new JobID(0L, 2L)));\n\t}\n","date":"2020-05-01 04:08:04","endLine":177,"groupId":"6826","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testStaticJobId","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/cc/52abd0251233c297a69faa42a1b007fdfb039c.src","preCode":"\tpublic void testStaticJobId() throws Throwable {\n\t\tfinal JobID testJobID = new JobID(0, 2);\n\n\t\tfinal Configuration configurationUnderTest = getConfiguration();\n\t\tconfigurationUnderTest.set(PipelineOptionsInternal.PIPELINE_FIXED_JOB_ID, testJobID.toHexString());\n\n\t\tfinal CompletableFuture<JobID> submittedJobId = new CompletableFuture<>();\n\n\t\tfinal TestingDispatcherGateway.Builder dispatcherBuilder = new TestingDispatcherGateway.Builder()\n\t\t\t\t.setSubmitFunction(jobGraph -> {\n\t\t\t\t\tsubmittedJobId.complete(jobGraph.getJobID());\n\t\t\t\t\treturn CompletableFuture.completedFuture(Acknowledge.get());\n\t\t\t\t})\n\t\t\t\t.setRequestJobStatusFunction(jobId -> CompletableFuture.completedFuture(JobStatus.FINISHED))\n\t\t\t\t.setRequestJobResultFunction(jobId -> CompletableFuture.completedFuture(createSuccessfulJobResult(jobId)));\n\n\t\tfinal CompletableFuture<Void> applicationFuture =\n\t\t\t\trunApplication(dispatcherBuilder, configurationUnderTest, 1);\n\n\t\tapplicationFuture.get(TIMEOUT_SECONDS, TimeUnit.SECONDS);\n\n\t\tassertThat(submittedJobId.get(TIMEOUT_SECONDS, TimeUnit.SECONDS), is(new JobID(0L, 2L)));\n\t}\n","realPath":"flink-clients/src/test/java/org/apache/flink/client/deployment/application/ApplicationDispatcherBootstrapTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":155,"status":"NB"},{"authorDate":"2021-07-12 15:32:54","commitOrder":2,"curCode":"    public void testDuplicateJobSubmissionWithTerminatedJobIdWithUnknownResultAttached()\n            throws Throwable {\n        final JobID testJobID = new JobID(0, 2);\n        final Configuration configurationUnderTest = getConfiguration();\n        configurationUnderTest.set(\n                PipelineOptionsInternal.PIPELINE_FIXED_JOB_ID, testJobID.toHexString());\n        configurationUnderTest.set(\n                HighAvailabilityOptions.HA_MODE, HighAvailabilityMode.ZOOKEEPER.name());\n        final TestingDispatcherGateway.Builder dispatcherBuilder =\n                new TestingDispatcherGateway.Builder()\n                        .setSubmitFunction(\n                                jobGraph ->\n                                        FutureUtils.completedExceptionally(\n                                                new DuplicateJobSubmissionException(\n                                                        testJobID, true)))\n                        .setRequestJobStatusFunction(\n                                jobId ->\n                                        FutureUtils.completedExceptionally(\n                                                new FlinkJobNotFoundException(jobId)))\n                        .setRequestJobResultFunction(\n                                jobId ->\n                                        FutureUtils.completedExceptionally(\n                                                new FlinkJobNotFoundException(jobId)));\n        final CompletableFuture<Void> applicationFuture =\n                runApplication(dispatcherBuilder, configurationUnderTest, 1);\n        applicationFuture.get(TIMEOUT_SECONDS, TimeUnit.SECONDS);\n    }\n","date":"2021-07-15 17:19:29","endLine":753,"groupId":"29058","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testDuplicateJobSubmissionWithTerminatedJobIdWithUnknownResultAttached","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/e1/606a140257c442804b9de23127a1cfcae85b45.src","preCode":"    public void testDuplicateJobSubmissionWithTerminatedJobIdWithUnknownResultAttached()\n            throws Throwable {\n        final JobID testJobID = new JobID(0, 2);\n        final Configuration configurationUnderTest = getConfiguration();\n        configurationUnderTest.set(\n                PipelineOptionsInternal.PIPELINE_FIXED_JOB_ID, testJobID.toHexString());\n        configurationUnderTest.set(\n                HighAvailabilityOptions.HA_MODE, HighAvailabilityMode.ZOOKEEPER.name());\n        final TestingDispatcherGateway.Builder dispatcherBuilder =\n                new TestingDispatcherGateway.Builder()\n                        .setSubmitFunction(\n                                jobGraph ->\n                                        FutureUtils.completedExceptionally(\n                                                new DuplicateJobSubmissionException(\n                                                        testJobID, true)))\n                        .setRequestJobStatusFunction(\n                                jobId ->\n                                        FutureUtils.completedExceptionally(\n                                                new FlinkJobNotFoundException(jobId)))\n                        .setRequestJobResultFunction(\n                                jobId ->\n                                        FutureUtils.completedExceptionally(\n                                                new FlinkJobNotFoundException(jobId)));\n        final CompletableFuture<Void> applicationFuture =\n                runApplication(dispatcherBuilder, configurationUnderTest, 1);\n        applicationFuture.get(TIMEOUT_SECONDS, TimeUnit.SECONDS);\n    }\n","realPath":"flink-clients/src/test/java/org/apache/flink/client/deployment/application/ApplicationDispatcherBootstrapTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":727,"status":"B"}],"commitId":"172b9e322151c079cb1c31323ec6697da48e67de","commitMessage":"@@@[FLINK-21928][clients] JobManager failover should succeed.  when trying to resubmit already terminated job in application mode.\n\n[FLINK-21928][clients] Tolerate missing job result for already terminated jobs after JM failover in application mode.\n","date":"2021-07-15 17:19:29","modifiedFileCount":"8","status":"M","submitter":"David Moravek"},{"authorTime":"2021-07-12 22:51:55","codes":[{"authorDate":"2020-04-23 23:22:55","commitOrder":3,"curCode":"\tpublic void testStaticJobId() throws Throwable {\n\t\tfinal JobID testJobID = new JobID(0, 2);\n\n\t\tfinal Configuration configurationUnderTest = getConfiguration();\n\t\tconfigurationUnderTest.set(PipelineOptionsInternal.PIPELINE_FIXED_JOB_ID, testJobID.toHexString());\n\n\t\tfinal CompletableFuture<JobID> submittedJobId = new CompletableFuture<>();\n\n\t\tfinal TestingDispatcherGateway.Builder dispatcherBuilder = new TestingDispatcherGateway.Builder()\n\t\t\t\t.setSubmitFunction(jobGraph -> {\n\t\t\t\t\tsubmittedJobId.complete(jobGraph.getJobID());\n\t\t\t\t\treturn CompletableFuture.completedFuture(Acknowledge.get());\n\t\t\t\t})\n\t\t\t\t.setRequestJobStatusFunction(jobId -> CompletableFuture.completedFuture(JobStatus.FINISHED))\n\t\t\t\t.setRequestJobResultFunction(jobId -> CompletableFuture.completedFuture(createSuccessfulJobResult(jobId)));\n\n\t\tfinal CompletableFuture<Void> applicationFuture =\n\t\t\t\trunApplication(dispatcherBuilder, configurationUnderTest, 1);\n\n\t\tapplicationFuture.get(TIMEOUT_SECONDS, TimeUnit.SECONDS);\n\n\t\tassertThat(submittedJobId.get(TIMEOUT_SECONDS, TimeUnit.SECONDS), is(new JobID(0L, 2L)));\n\t}\n","date":"2020-05-01 04:08:04","endLine":177,"groupId":"101734","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testStaticJobId","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/cc/52abd0251233c297a69faa42a1b007fdfb039c.src","preCode":"\tpublic void testStaticJobId() throws Throwable {\n\t\tfinal JobID testJobID = new JobID(0, 2);\n\n\t\tfinal Configuration configurationUnderTest = getConfiguration();\n\t\tconfigurationUnderTest.set(PipelineOptionsInternal.PIPELINE_FIXED_JOB_ID, testJobID.toHexString());\n\n\t\tfinal CompletableFuture<JobID> submittedJobId = new CompletableFuture<>();\n\n\t\tfinal TestingDispatcherGateway.Builder dispatcherBuilder = new TestingDispatcherGateway.Builder()\n\t\t\t\t.setSubmitFunction(jobGraph -> {\n\t\t\t\t\tsubmittedJobId.complete(jobGraph.getJobID());\n\t\t\t\t\treturn CompletableFuture.completedFuture(Acknowledge.get());\n\t\t\t\t})\n\t\t\t\t.setRequestJobStatusFunction(jobId -> CompletableFuture.completedFuture(JobStatus.FINISHED))\n\t\t\t\t.setRequestJobResultFunction(jobId -> CompletableFuture.completedFuture(createSuccessfulJobResult(jobId)));\n\n\t\tfinal CompletableFuture<Void> applicationFuture =\n\t\t\t\trunApplication(dispatcherBuilder, configurationUnderTest, 1);\n\n\t\tapplicationFuture.get(TIMEOUT_SECONDS, TimeUnit.SECONDS);\n\n\t\tassertThat(submittedJobId.get(TIMEOUT_SECONDS, TimeUnit.SECONDS), is(new JobID(0L, 2L)));\n\t}\n","realPath":"flink-clients/src/test/java/org/apache/flink/client/deployment/application/ApplicationDispatcherBootstrapTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":155,"status":"N"},{"authorDate":"2021-07-12 22:51:55","commitOrder":3,"curCode":"    public void testDuplicateJobSubmissionWithTerminatedJobIdWithUnknownResultAttached()\n            throws Throwable {\n        final JobID testJobID = new JobID(0, 2);\n        final Configuration configurationUnderTest = getConfiguration();\n        configurationUnderTest.set(\n                PipelineOptionsInternal.PIPELINE_FIXED_JOB_ID, testJobID.toHexString());\n        configurationUnderTest.set(\n                HighAvailabilityOptions.HA_MODE, HighAvailabilityMode.ZOOKEEPER.name());\n        final TestingDispatcherGateway.Builder dispatcherBuilder =\n                new TestingDispatcherGateway.Builder()\n                        .setSubmitFunction(\n                                jobGraph ->\n                                        FutureUtils.completedExceptionally(\n                                                DuplicateJobSubmissionException\n                                                        .ofGloballyTerminated(testJobID)))\n                        .setRequestJobStatusFunction(\n                                jobId ->\n                                        FutureUtils.completedExceptionally(\n                                                new FlinkJobNotFoundException(jobId)))\n                        .setRequestJobResultFunction(\n                                jobId ->\n                                        FutureUtils.completedExceptionally(\n                                                new FlinkJobNotFoundException(jobId)));\n        final CompletableFuture<Void> applicationFuture =\n                runApplication(dispatcherBuilder, configurationUnderTest, 1);\n        applicationFuture.get(TIMEOUT_SECONDS, TimeUnit.SECONDS);\n    }\n","date":"2021-07-15 17:19:32","endLine":753,"groupId":"101734","id":4,"instanceNumber":2,"isCurCommit":1,"methodName":"testDuplicateJobSubmissionWithTerminatedJobIdWithUnknownResultAttached","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-flink-10-0.7/blobInfo/CC_OUT/blobs/87/8ebcbeb39890cf66be5fcfc86fb0f88b015e08.src","preCode":"    public void testDuplicateJobSubmissionWithTerminatedJobIdWithUnknownResultAttached()\n            throws Throwable {\n        final JobID testJobID = new JobID(0, 2);\n        final Configuration configurationUnderTest = getConfiguration();\n        configurationUnderTest.set(\n                PipelineOptionsInternal.PIPELINE_FIXED_JOB_ID, testJobID.toHexString());\n        configurationUnderTest.set(\n                HighAvailabilityOptions.HA_MODE, HighAvailabilityMode.ZOOKEEPER.name());\n        final TestingDispatcherGateway.Builder dispatcherBuilder =\n                new TestingDispatcherGateway.Builder()\n                        .setSubmitFunction(\n                                jobGraph ->\n                                        FutureUtils.completedExceptionally(\n                                                new DuplicateJobSubmissionException(\n                                                        testJobID, true)))\n                        .setRequestJobStatusFunction(\n                                jobId ->\n                                        FutureUtils.completedExceptionally(\n                                                new FlinkJobNotFoundException(jobId)))\n                        .setRequestJobResultFunction(\n                                jobId ->\n                                        FutureUtils.completedExceptionally(\n                                                new FlinkJobNotFoundException(jobId)));\n        final CompletableFuture<Void> applicationFuture =\n                runApplication(dispatcherBuilder, configurationUnderTest, 1);\n        applicationFuture.get(TIMEOUT_SECONDS, TimeUnit.SECONDS);\n    }\n","realPath":"flink-clients/src/test/java/org/apache/flink/client/deployment/application/ApplicationDispatcherBootstrapTest.java","repoName":"flink","snippetEndLine":0,"snippetStartLine":0,"startLine":727,"status":"M"}],"commitId":"4a78097d0385749daceafd8326930c8cc5f26f1a","commitMessage":"@@@[FLINK-21928][clients][runtime] Introduce static method constructors of DuplicateJobSubmissionException for better readability.\n\nThis closes #16464.\n","date":"2021-07-15 17:19:32","modifiedFileCount":"6","status":"M","submitter":"David Moravek"}]
