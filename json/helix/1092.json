[{"authorTime":"2017-11-08 08:48:26","codes":[{"authorDate":"2018-11-02 07:54:48","commitOrder":4,"curCode":"  public void testWorkflowCreationNoDuplicates() {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n    for (int i = 0; i < 8; i++) {\n      builder.enqueueJob(\"JOB\" + i, jobBuilder);\n    }\n\n    \r\n    _driver.createQueue(builder.build());\n    Assert.assertNotNull(_driver.getWorkflowConfig(queue));\n\n    \r\n    _driver.createQueue(builder.build());\n  }\n","date":"2018-11-02 07:54:48","endLine":54,"groupId":"4964","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testWorkflowCreationNoDuplicates","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-helix-10-0.7/blobInfo/CC_OUT/blobs/bd/def11b7070454af144a8e3253ccd78e51e9852.src","preCode":"  public void testWorkflowCreationNoDuplicates() {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n    for (int i = 0; i < 8; i++) {\n      builder.enqueueJob(\"JOB\" + i, jobBuilder);\n    }\n\n    \r\n    _driver.createQueue(builder.build());\n    Assert.assertNotNull(_driver.getWorkflowConfig(queue));\n\n    \r\n    _driver.createQueue(builder.build());\n  }\n","realPath":"helix-core/src/test/java/org/apache/helix/task/TestWorkflowCreation.java","repoName":"helix","snippetEndLine":0,"snippetStartLine":0,"startLine":37,"status":"B"},{"authorDate":"2017-11-08 08:48:26","commitOrder":4,"curCode":"  void testNotCleanJobsDueToParentFail() throws Exception {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n\n    long startTime = System.currentTimeMillis();\n    builder.enqueueJob(\"JOB0\", jobBuilder);\n    builder.enqueueJob(\"JOB1\", jobBuilder);\n    builder.addParentChildDependency(\"JOB0\", \"JOB1\");\n    TaskUtil.setJobContext(_manager, TaskUtil.getNamespacedJobName(queue, \"JOB0\"),\n        TaskTestUtil.buildJobContext(startTime, startTime, TaskPartitionState.COMPLETED));\n\n    WorkflowContext workflowContext = TaskTestUtil\n        .buildWorkflowContext(queue, TaskState.IN_PROGRESS, null, TaskState.FAILED,\n            TaskState.FAILED);\n    _driver.start(builder.build());\n    _cache = TaskTestUtil.buildClusterDataCache(_manager.getHelixDataAccessor(), CLUSTER_NAME);\n    TaskUtil.setWorkflowContext(_manager, queue, workflowContext);\n    TaskTestUtil.calculateBestPossibleState(_cache, _manager);\n    WorkflowConfig workflowConfig = _driver.getWorkflowConfig(queue);\n    Assert.assertEquals(workflowConfig.getJobDag().getAllNodes().size(), 2);\n  }\n","date":"2017-11-08 08:48:26","endLine":118,"groupId":"1677","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testNotCleanJobsDueToParentFail","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-helix-10-0.7/blobInfo/CC_OUT/blobs/c5/13c01c60d49e57145c2c5dc9271d6016abeb4c.src","preCode":"  void testNotCleanJobsDueToParentFail() throws Exception {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n\n    long startTime = System.currentTimeMillis();\n    builder.enqueueJob(\"JOB0\", jobBuilder);\n    builder.enqueueJob(\"JOB1\", jobBuilder);\n    builder.addParentChildDependency(\"JOB0\", \"JOB1\");\n    TaskUtil.setJobContext(_manager, TaskUtil.getNamespacedJobName(queue, \"JOB0\"),\n        TaskTestUtil.buildJobContext(startTime, startTime, TaskPartitionState.COMPLETED));\n\n    WorkflowContext workflowContext = TaskTestUtil\n        .buildWorkflowContext(queue, TaskState.IN_PROGRESS, null, TaskState.FAILED,\n            TaskState.FAILED);\n    _driver.start(builder.build());\n    _cache = TaskTestUtil.buildClusterDataCache(_manager.getHelixDataAccessor(), CLUSTER_NAME);\n    TaskUtil.setWorkflowContext(_manager, queue, workflowContext);\n    TaskTestUtil.calculateBestPossibleState(_cache, _manager);\n    WorkflowConfig workflowConfig = _driver.getWorkflowConfig(queue);\n    Assert.assertEquals(workflowConfig.getJobDag().getAllNodes().size(), 2);\n  }\n","realPath":"helix-core/src/test/java/org/apache/helix/task/TestCleanExpiredJobs.java","repoName":"helix","snippetEndLine":0,"snippetStartLine":0,"startLine":94,"status":"NB"}],"commitId":"3844ad60034b029f3bbd916f629a7969117c1b26","commitMessage":"@@@[HELIX-782] TASK: Make TaskDriver use ZKClient's create when creating workflows\n\nTaskDriver should use create() but currently is using set().  which just overwrites ZNodes that are in ZK. This is undesirable and we need to fix it.  especially in the wake of ZNode restructuring.\n\nAC:\n1. Make TaskDriver use create() instead of set()\n2. Add an integration test: TestWorkflowCreation:testWorkflowCreationNoDuplicates()\n","date":"2018-11-02 07:54:48","modifiedFileCount":"2","status":"M","submitter":"narendly"},{"authorTime":"2018-11-06 08:55:22","codes":[{"authorDate":"2018-11-02 07:54:48","commitOrder":5,"curCode":"  public void testWorkflowCreationNoDuplicates() {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n    for (int i = 0; i < 8; i++) {\n      builder.enqueueJob(\"JOB\" + i, jobBuilder);\n    }\n\n    \r\n    _driver.createQueue(builder.build());\n    Assert.assertNotNull(_driver.getWorkflowConfig(queue));\n\n    \r\n    _driver.createQueue(builder.build());\n  }\n","date":"2018-11-02 07:54:48","endLine":54,"groupId":"4964","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testWorkflowCreationNoDuplicates","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-helix-10-0.7/blobInfo/CC_OUT/blobs/bd/def11b7070454af144a8e3253ccd78e51e9852.src","preCode":"  public void testWorkflowCreationNoDuplicates() {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n    for (int i = 0; i < 8; i++) {\n      builder.enqueueJob(\"JOB\" + i, jobBuilder);\n    }\n\n    \r\n    _driver.createQueue(builder.build());\n    Assert.assertNotNull(_driver.getWorkflowConfig(queue));\n\n    \r\n    _driver.createQueue(builder.build());\n  }\n","realPath":"helix-core/src/test/java/org/apache/helix/task/TestWorkflowCreation.java","repoName":"helix","snippetEndLine":0,"snippetStartLine":0,"startLine":37,"status":"N"},{"authorDate":"2018-11-06 08:55:22","commitOrder":5,"curCode":"  void testNotCleanJobsDueToParentFail() throws Exception {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n\n    long startTime = System.currentTimeMillis();\n    builder.enqueueJob(\"JOB0\", jobBuilder);\n    builder.enqueueJob(\"JOB1\", jobBuilder);\n    builder.addParentChildDependency(\"JOB0\", \"JOB1\");\n    TaskUtil.setJobContext(_manager, TaskUtil.getNamespacedJobName(queue, \"JOB0\"),\n        TaskTestUtil.buildJobContext(startTime, startTime, TaskPartitionState.COMPLETED));\n\n    WorkflowContext workflowContext = TaskTestUtil\n        .buildWorkflowContext(queue, TaskState.IN_PROGRESS, null, TaskState.FAILED,\n            TaskState.FAILED);\n    _driver.start(builder.build());\n    _cache = TaskTestUtil.buildClusterDataCache(_manager.getHelixDataAccessor(), CLUSTER_NAME);\n    TaskUtil.setWorkflowContext(_manager, queue, workflowContext);\n    TaskTestUtil.calculateTaskSchedulingStage(_cache, _manager);\n    WorkflowConfig workflowConfig = _driver.getWorkflowConfig(queue);\n    Assert.assertEquals(workflowConfig.getJobDag().getAllNodes().size(), 2);\n  }\n","date":"2019-02-26 08:59:48","endLine":123,"groupId":"1677","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testNotCleanJobsDueToParentFail","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-helix-10-0.7/blobInfo/CC_OUT/blobs/79/c5067b6e6ab66e1b2d3b0359a5337c36e3f351.src","preCode":"  void testNotCleanJobsDueToParentFail() throws Exception {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n\n    long startTime = System.currentTimeMillis();\n    builder.enqueueJob(\"JOB0\", jobBuilder);\n    builder.enqueueJob(\"JOB1\", jobBuilder);\n    builder.addParentChildDependency(\"JOB0\", \"JOB1\");\n    TaskUtil.setJobContext(_manager, TaskUtil.getNamespacedJobName(queue, \"JOB0\"),\n        TaskTestUtil.buildJobContext(startTime, startTime, TaskPartitionState.COMPLETED));\n\n    WorkflowContext workflowContext = TaskTestUtil\n        .buildWorkflowContext(queue, TaskState.IN_PROGRESS, null, TaskState.FAILED,\n            TaskState.FAILED);\n    _driver.start(builder.build());\n    _cache = TaskTestUtil.buildClusterDataCache(_manager.getHelixDataAccessor(), CLUSTER_NAME);\n    TaskUtil.setWorkflowContext(_manager, queue, workflowContext);\n    TaskTestUtil.calculateBestPossibleState(_cache, _manager);\n    WorkflowConfig workflowConfig = _driver.getWorkflowConfig(queue);\n    Assert.assertEquals(workflowConfig.getJobDag().getAllNodes().size(), 2);\n  }\n","realPath":"helix-core/src/test/java/org/apache/helix/task/TestCleanExpiredJobs.java","repoName":"helix","snippetEndLine":0,"snippetStartLine":0,"startLine":99,"status":"M"}],"commitId":"dad3f36a1b8aeb7590214069141915a8bf932ec6","commitMessage":"@@@Integrate JobIterator for existing pipeline\n\nExisting pipeline still looping all the jobs inside the workflow. When JobIterator is ready.  we shall change the looping mechanism to apply the JobIterator and skip the jobs when quota is used out.\n","date":"2019-02-26 08:59:48","modifiedFileCount":"18","status":"M","submitter":"Junkai Xue"},{"authorTime":"2019-02-26 09:36:00","codes":[{"authorDate":"2018-11-02 07:54:48","commitOrder":6,"curCode":"  public void testWorkflowCreationNoDuplicates() {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n    for (int i = 0; i < 8; i++) {\n      builder.enqueueJob(\"JOB\" + i, jobBuilder);\n    }\n\n    \r\n    _driver.createQueue(builder.build());\n    Assert.assertNotNull(_driver.getWorkflowConfig(queue));\n\n    \r\n    _driver.createQueue(builder.build());\n  }\n","date":"2018-11-02 07:54:48","endLine":54,"groupId":"1092","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testWorkflowCreationNoDuplicates","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-helix-10-0.7/blobInfo/CC_OUT/blobs/bd/def11b7070454af144a8e3253ccd78e51e9852.src","preCode":"  public void testWorkflowCreationNoDuplicates() {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n    for (int i = 0; i < 8; i++) {\n      builder.enqueueJob(\"JOB\" + i, jobBuilder);\n    }\n\n    \r\n    _driver.createQueue(builder.build());\n    Assert.assertNotNull(_driver.getWorkflowConfig(queue));\n\n    \r\n    _driver.createQueue(builder.build());\n  }\n","realPath":"helix-core/src/test/java/org/apache/helix/task/TestWorkflowCreation.java","repoName":"helix","snippetEndLine":0,"snippetStartLine":0,"startLine":37,"status":"N"},{"authorDate":"2019-02-26 09:36:00","commitOrder":6,"curCode":"  void testNotCleanJobsDueToParentFail() throws Exception {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n\n    long startTime = System.currentTimeMillis();\n    builder.enqueueJob(\"JOB0\", jobBuilder);\n    builder.enqueueJob(\"JOB1\", jobBuilder);\n    builder.addParentChildDependency(\"JOB0\", \"JOB1\");\n    TaskUtil.setJobContext(_manager, TaskUtil.getNamespacedJobName(queue, \"JOB0\"),\n        TaskTestUtil.buildJobContext(startTime, startTime, TaskPartitionState.COMPLETED));\n\n    WorkflowContext workflowContext = TaskTestUtil\n        .buildWorkflowContext(queue, TaskState.IN_PROGRESS, null, TaskState.FAILED,\n            TaskState.FAILED);\n    _driver.start(builder.build());\n    _cache = TaskTestUtil.buildDataProvider(_manager.getHelixDataAccessor(), CLUSTER_NAME);\n    TaskUtil.setWorkflowContext(_manager, queue, workflowContext);\n    TaskTestUtil.calculateTaskSchedulingStage(_cache, _manager);\n    WorkflowConfig workflowConfig = _driver.getWorkflowConfig(queue);\n    Assert.assertEquals(workflowConfig.getJobDag().getAllNodes().size(), 2);\n  }\n","date":"2019-02-26 09:36:00","endLine":122,"groupId":"1092","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testNotCleanJobsDueToParentFail","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-helix-10-0.7/blobInfo/CC_OUT/blobs/86/7036f8270c3d9473ecc3d659cfe928a9da3158.src","preCode":"  void testNotCleanJobsDueToParentFail() throws Exception {\n    String queue = TestHelper.getTestMethodName();\n    JobQueue.Builder builder = TaskTestUtil.buildJobQueue(queue);\n    JobConfig.Builder jobBuilder =\n        new JobConfig.Builder().setTargetResource(WorkflowGenerator.DEFAULT_TGT_DB)\n            .setCommand(MockTask.TASK_COMMAND).setMaxAttemptsPerTask(2)\n            .setJobCommandConfigMap(WorkflowGenerator.DEFAULT_COMMAND_CONFIG).setExpiry(1L);\n\n    long startTime = System.currentTimeMillis();\n    builder.enqueueJob(\"JOB0\", jobBuilder);\n    builder.enqueueJob(\"JOB1\", jobBuilder);\n    builder.addParentChildDependency(\"JOB0\", \"JOB1\");\n    TaskUtil.setJobContext(_manager, TaskUtil.getNamespacedJobName(queue, \"JOB0\"),\n        TaskTestUtil.buildJobContext(startTime, startTime, TaskPartitionState.COMPLETED));\n\n    WorkflowContext workflowContext = TaskTestUtil\n        .buildWorkflowContext(queue, TaskState.IN_PROGRESS, null, TaskState.FAILED,\n            TaskState.FAILED);\n    _driver.start(builder.build());\n    _cache = TaskTestUtil.buildClusterDataCache(_manager.getHelixDataAccessor(), CLUSTER_NAME);\n    TaskUtil.setWorkflowContext(_manager, queue, workflowContext);\n    TaskTestUtil.calculateTaskSchedulingStage(_cache, _manager);\n    WorkflowConfig workflowConfig = _driver.getWorkflowConfig(queue);\n    Assert.assertEquals(workflowConfig.getJobDag().getAllNodes().size(), 2);\n  }\n","realPath":"helix-core/src/test/java/org/apache/helix/task/TestCleanExpiredJobs.java","repoName":"helix","snippetEndLine":0,"snippetStartLine":0,"startLine":98,"status":"M"}],"commitId":"fbb679c5f4804652ea730bf5cd4ee6bf1329efc3","commitMessage":"@@@split data cache\n","date":"2019-02-26 09:36:00","modifiedFileCount":"95","status":"M","submitter":"Harry Zhang"}]
