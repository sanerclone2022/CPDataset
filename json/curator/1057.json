[{"authorTime":"2014-06-18 12:07:43","codes":[{"authorDate":"2014-07-23 05:05:19","commitOrder":7,"curCode":"    public void testConnectionStateNewClient() throws Exception\n    {\n        Timing timing = new Timing();\n        TestingCluster cluster = new TestingCluster(3);\n        CuratorFramework client = null;\n        try\n        {\n            cluster.start();\n\n            client = CuratorFrameworkFactory.newClient(cluster.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(100));\n            client.start();\n            client.checkExists().forPath(\"/\");\n            client.close();\n            client = null;\n\n            System.out.println(\"killing 2 instances\");\n            Iterator<InstanceSpec> iterator = cluster.getInstances().iterator();\n            for ( int i = 0; i < 2; ++i )\n            {\n                cluster.killServer(iterator.next());\n            }\n\n            System.out.println(\"reconnecting client\");\n            client = CuratorFrameworkFactory.builder()\n                .connectString(cluster.getConnectString())\n                .sessionTimeoutMs(timing.session())\n                .connectionTimeoutMs(timing.connection())\n                .retryPolicy(new RetryNTimes(3, timing.milliseconds()))\n                .canBeReadOnly(true)\n                .build();\n\n            final BlockingQueue<ConnectionState> states = Queues.newLinkedBlockingQueue();\n            client.getConnectionStateListenable().addListener\n            (\n                new ConnectionStateListener()\n                {\n                    @Override\n                    public void stateChanged(CuratorFramework client, ConnectionState newState)\n                    {\n                        states.add(newState);\n                    }\n                }\n            );\n            client.start();\n\n            System.out.println(\"making api call\");\n            client.checkExists().forPath(\"/\");\n\n            ConnectionState state = states.poll(timing.forWaiting().milliseconds(), TimeUnit.MILLISECONDS);\n            Assert.assertEquals(state, ConnectionState.READ_ONLY);\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n            CloseableUtils.closeQuietly(cluster);\n        }\n    }\n","date":"2014-07-23 05:05:19","endLine":114,"groupId":"655","id":1,"instanceNumber":1,"isCurCommit":0,"methodName":"testConnectionStateNewClient","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-curator-10-0.7/blobInfo/CC_OUT/blobs/d6/d63f8622947325d1e94831e771de4945f40f41.src","preCode":"    public void testConnectionStateNewClient() throws Exception\n    {\n        Timing timing = new Timing();\n        TestingCluster cluster = new TestingCluster(3);\n        CuratorFramework client = null;\n        try\n        {\n            cluster.start();\n\n            client = CuratorFrameworkFactory.newClient(cluster.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(100));\n            client.start();\n            client.checkExists().forPath(\"/\");\n            client.close();\n            client = null;\n\n            System.out.println(\"killing 2 instances\");\n            Iterator<InstanceSpec> iterator = cluster.getInstances().iterator();\n            for ( int i = 0; i < 2; ++i )\n            {\n                cluster.killServer(iterator.next());\n            }\n\n            System.out.println(\"reconnecting client\");\n            client = CuratorFrameworkFactory.builder()\n                .connectString(cluster.getConnectString())\n                .sessionTimeoutMs(timing.session())\n                .connectionTimeoutMs(timing.connection())\n                .retryPolicy(new RetryNTimes(3, timing.milliseconds()))\n                .canBeReadOnly(true)\n                .build();\n\n            final BlockingQueue<ConnectionState> states = Queues.newLinkedBlockingQueue();\n            client.getConnectionStateListenable().addListener\n            (\n                new ConnectionStateListener()\n                {\n                    @Override\n                    public void stateChanged(CuratorFramework client, ConnectionState newState)\n                    {\n                        states.add(newState);\n                    }\n                }\n            );\n            client.start();\n\n            System.out.println(\"making api call\");\n            client.checkExists().forPath(\"/\");\n\n            ConnectionState state = states.poll(timing.forWaiting().milliseconds(), TimeUnit.MILLISECONDS);\n            Assert.assertEquals(state, ConnectionState.READ_ONLY);\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n            CloseableUtils.closeQuietly(cluster);\n        }\n    }\n","realPath":"curator-framework/src/test/java/org/apache/curator/framework/imps/TestReadOnly.java","repoName":"curator","snippetEndLine":0,"snippetStartLine":0,"startLine":58,"status":"B"},{"authorDate":"2014-06-18 12:07:43","commitOrder":7,"curCode":"    public void testRetry() throws Exception\n    {\n        final int MAX_RETRIES = 3;\n\n        final CuratorFramework client = CuratorFrameworkFactory.newClient(server.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(10));\n        client.start();\n        try\n        {\n            final AtomicInteger retries = new AtomicInteger(0);\n            final Semaphore semaphore = new Semaphore(0);\n            RetryPolicy policy = new RetryPolicy()\n            {\n                @Override\n                public boolean allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper)\n                {\n                    semaphore.release();\n                    if ( retries.incrementAndGet() == MAX_RETRIES )\n                    {\n                        try\n                        {\n                            server.restart();\n                        }\n                        catch ( Exception e )\n                        {\n                            throw new Error(e);\n                        }\n                    }\n                    try\n                    {\n                        sleeper.sleepFor(100, TimeUnit.MILLISECONDS);\n                    }\n                    catch ( InterruptedException e )\n                    {\n                        Thread.currentThread().interrupt();\n                    }\n                    return true;\n                }\n            };\n            client.getZookeeperClient().setRetryPolicy(policy);\n\n            server.stop();\n\n            \r\n            client.checkExists().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n\n            \r\n            client.getZookeeperClient().setRetryPolicy(new RetryOneTime(100));\n            client.checkExists().forPath(\"/hey\");\n\n            client.getZookeeperClient().setRetryPolicy(policy);\n            semaphore.drainPermits();\n            retries.set(0);\n\n            server.stop();\n\n            \r\n            client.checkExists().inBackground().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n        }\n    }\n","date":"2014-06-18 12:07:43","endLine":403,"groupId":"579","id":2,"instanceNumber":2,"isCurCommit":0,"methodName":"testRetry","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-curator-10-0.7/blobInfo/CC_OUT/blobs/9c/02c7d9dcd413bb7ab3e5f874b931db523fda1b.src","preCode":"    public void testRetry() throws Exception\n    {\n        final int MAX_RETRIES = 3;\n\n        final CuratorFramework client = CuratorFrameworkFactory.newClient(server.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(10));\n        client.start();\n        try\n        {\n            final AtomicInteger retries = new AtomicInteger(0);\n            final Semaphore semaphore = new Semaphore(0);\n            RetryPolicy policy = new RetryPolicy()\n            {\n                @Override\n                public boolean allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper)\n                {\n                    semaphore.release();\n                    if ( retries.incrementAndGet() == MAX_RETRIES )\n                    {\n                        try\n                        {\n                            server.restart();\n                        }\n                        catch ( Exception e )\n                        {\n                            throw new Error(e);\n                        }\n                    }\n                    try\n                    {\n                        sleeper.sleepFor(100, TimeUnit.MILLISECONDS);\n                    }\n                    catch ( InterruptedException e )\n                    {\n                        Thread.currentThread().interrupt();\n                    }\n                    return true;\n                }\n            };\n            client.getZookeeperClient().setRetryPolicy(policy);\n\n            server.stop();\n\n            \r\n            client.checkExists().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n\n            \r\n            client.getZookeeperClient().setRetryPolicy(new RetryOneTime(100));\n            client.checkExists().forPath(\"/hey\");\n\n            client.getZookeeperClient().setRetryPolicy(policy);\n            semaphore.drainPermits();\n            retries.set(0);\n\n            server.stop();\n\n            \r\n            client.checkExists().inBackground().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n        }\n    }\n","realPath":"curator-framework/src/test/java/org/apache/curator/framework/imps/TestFrameworkEdges.java","repoName":"curator","snippetEndLine":0,"snippetStartLine":0,"startLine":339,"status":"NB"}],"commitId":"feb13e1c16de7078dfc1310d9403441d1b2dae9e","commitMessage":"@@@Test case that shows the problem\n","date":"2014-07-23 05:05:19","modifiedFileCount":"1","status":"M","submitter":"randgalt"},{"authorTime":"2014-06-18 12:07:43","codes":[{"authorDate":"2014-07-23 06:46:19","commitOrder":8,"curCode":"    public void testConnectionStateNewClient() throws Exception\n    {\n        Timing timing = new Timing();\n        TestingCluster cluster = new TestingCluster(3);\n        CuratorFramework client = null;\n        try\n        {\n            cluster.start();\n\n            client = CuratorFrameworkFactory.newClient(cluster.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(100));\n            client.start();\n            client.checkExists().forPath(\"/\");\n            client.close();\n            client = null;\n\n            Iterator<InstanceSpec> iterator = cluster.getInstances().iterator();\n            for ( int i = 0; i < 2; ++i )\n            {\n                cluster.killServer(iterator.next());\n            }\n\n            client = CuratorFrameworkFactory.builder()\n                .connectString(cluster.getConnectString())\n                .sessionTimeoutMs(timing.session())\n                .connectionTimeoutMs(timing.connection())\n                .retryPolicy(new RetryNTimes(3, timing.milliseconds()))\n                .canBeReadOnly(true)\n                .build();\n\n            final BlockingQueue<ConnectionState> states = Queues.newLinkedBlockingQueue();\n            client.getConnectionStateListenable().addListener\n            (\n                new ConnectionStateListener()\n                {\n                    @Override\n                    public void stateChanged(CuratorFramework client, ConnectionState newState)\n                    {\n                        states.add(newState);\n                    }\n                }\n            );\n            client.start();\n\n            client.checkExists().forPath(\"/\");\n\n            ConnectionState state = states.poll(timing.forWaiting().milliseconds(), TimeUnit.MILLISECONDS);\n            Assert.assertEquals(state, ConnectionState.READ_ONLY);\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n            CloseableUtils.closeQuietly(cluster);\n        }\n    }\n","date":"2014-07-23 06:46:19","endLine":111,"groupId":"655","id":3,"instanceNumber":1,"isCurCommit":0,"methodName":"testConnectionStateNewClient","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-curator-10-0.7/blobInfo/CC_OUT/blobs/13/ceec61dcd80c35776fba2a827a98a106e3e6e1.src","preCode":"    public void testConnectionStateNewClient() throws Exception\n    {\n        Timing timing = new Timing();\n        TestingCluster cluster = new TestingCluster(3);\n        CuratorFramework client = null;\n        try\n        {\n            cluster.start();\n\n            client = CuratorFrameworkFactory.newClient(cluster.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(100));\n            client.start();\n            client.checkExists().forPath(\"/\");\n            client.close();\n            client = null;\n\n            System.out.println(\"killing 2 instances\");\n            Iterator<InstanceSpec> iterator = cluster.getInstances().iterator();\n            for ( int i = 0; i < 2; ++i )\n            {\n                cluster.killServer(iterator.next());\n            }\n\n            System.out.println(\"reconnecting client\");\n            client = CuratorFrameworkFactory.builder()\n                .connectString(cluster.getConnectString())\n                .sessionTimeoutMs(timing.session())\n                .connectionTimeoutMs(timing.connection())\n                .retryPolicy(new RetryNTimes(3, timing.milliseconds()))\n                .canBeReadOnly(true)\n                .build();\n\n            final BlockingQueue<ConnectionState> states = Queues.newLinkedBlockingQueue();\n            client.getConnectionStateListenable().addListener\n            (\n                new ConnectionStateListener()\n                {\n                    @Override\n                    public void stateChanged(CuratorFramework client, ConnectionState newState)\n                    {\n                        states.add(newState);\n                    }\n                }\n            );\n            client.start();\n\n            System.out.println(\"making api call\");\n            client.checkExists().forPath(\"/\");\n\n            ConnectionState state = states.poll(timing.forWaiting().milliseconds(), TimeUnit.MILLISECONDS);\n            Assert.assertEquals(state, ConnectionState.READ_ONLY);\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n            CloseableUtils.closeQuietly(cluster);\n        }\n    }\n","realPath":"curator-framework/src/test/java/org/apache/curator/framework/imps/TestReadOnly.java","repoName":"curator","snippetEndLine":0,"snippetStartLine":0,"startLine":58,"status":"M"},{"authorDate":"2014-06-18 12:07:43","commitOrder":8,"curCode":"    public void testRetry() throws Exception\n    {\n        final int MAX_RETRIES = 3;\n\n        final CuratorFramework client = CuratorFrameworkFactory.newClient(server.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(10));\n        client.start();\n        try\n        {\n            final AtomicInteger retries = new AtomicInteger(0);\n            final Semaphore semaphore = new Semaphore(0);\n            RetryPolicy policy = new RetryPolicy()\n            {\n                @Override\n                public boolean allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper)\n                {\n                    semaphore.release();\n                    if ( retries.incrementAndGet() == MAX_RETRIES )\n                    {\n                        try\n                        {\n                            server.restart();\n                        }\n                        catch ( Exception e )\n                        {\n                            throw new Error(e);\n                        }\n                    }\n                    try\n                    {\n                        sleeper.sleepFor(100, TimeUnit.MILLISECONDS);\n                    }\n                    catch ( InterruptedException e )\n                    {\n                        Thread.currentThread().interrupt();\n                    }\n                    return true;\n                }\n            };\n            client.getZookeeperClient().setRetryPolicy(policy);\n\n            server.stop();\n\n            \r\n            client.checkExists().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n\n            \r\n            client.getZookeeperClient().setRetryPolicy(new RetryOneTime(100));\n            client.checkExists().forPath(\"/hey\");\n\n            client.getZookeeperClient().setRetryPolicy(policy);\n            semaphore.drainPermits();\n            retries.set(0);\n\n            server.stop();\n\n            \r\n            client.checkExists().inBackground().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n        }\n    }\n","date":"2014-06-18 12:07:43","endLine":403,"groupId":"579","id":4,"instanceNumber":2,"isCurCommit":0,"methodName":"testRetry","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-curator-10-0.7/blobInfo/CC_OUT/blobs/9c/02c7d9dcd413bb7ab3e5f874b931db523fda1b.src","preCode":"    public void testRetry() throws Exception\n    {\n        final int MAX_RETRIES = 3;\n\n        final CuratorFramework client = CuratorFrameworkFactory.newClient(server.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(10));\n        client.start();\n        try\n        {\n            final AtomicInteger retries = new AtomicInteger(0);\n            final Semaphore semaphore = new Semaphore(0);\n            RetryPolicy policy = new RetryPolicy()\n            {\n                @Override\n                public boolean allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper)\n                {\n                    semaphore.release();\n                    if ( retries.incrementAndGet() == MAX_RETRIES )\n                    {\n                        try\n                        {\n                            server.restart();\n                        }\n                        catch ( Exception e )\n                        {\n                            throw new Error(e);\n                        }\n                    }\n                    try\n                    {\n                        sleeper.sleepFor(100, TimeUnit.MILLISECONDS);\n                    }\n                    catch ( InterruptedException e )\n                    {\n                        Thread.currentThread().interrupt();\n                    }\n                    return true;\n                }\n            };\n            client.getZookeeperClient().setRetryPolicy(policy);\n\n            server.stop();\n\n            \r\n            client.checkExists().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n\n            \r\n            client.getZookeeperClient().setRetryPolicy(new RetryOneTime(100));\n            client.checkExists().forPath(\"/hey\");\n\n            client.getZookeeperClient().setRetryPolicy(policy);\n            semaphore.drainPermits();\n            retries.set(0);\n\n            server.stop();\n\n            \r\n            client.checkExists().inBackground().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n        }\n    }\n","realPath":"curator-framework/src/test/java/org/apache/curator/framework/imps/TestFrameworkEdges.java","repoName":"curator","snippetEndLine":0,"snippetStartLine":0,"startLine":339,"status":"N"}],"commitId":"5f5ee966569064a8d75fd19f32cb7e7a2bd7b0e1","commitMessage":"@@@removed printlns\n","date":"2014-07-23 06:46:19","modifiedFileCount":"1","status":"M","submitter":"randgalt"},{"authorTime":"2014-06-18 12:07:43","codes":[{"authorDate":"2020-03-24 04:11:18","commitOrder":9,"curCode":"    public void testConnectionStateNewClient() throws Exception\n    {\n        Timing timing = new Timing();\n        CuratorFramework client = null;\n        TestingCluster cluster = createAndStartCluster(3);\n        try\n        {\n            client = CuratorFrameworkFactory.newClient(cluster.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(100));\n            client.start();\n            client.checkExists().forPath(\"/\");\n            client.close();\n            client = null;\n\n            Iterator<InstanceSpec> iterator = cluster.getInstances().iterator();\n            for ( int i = 0; i < 2; ++i )\n            {\n                cluster.killServer(iterator.next());\n            }\n\n            client = CuratorFrameworkFactory.builder()\n                .connectString(cluster.getConnectString())\n                .sessionTimeoutMs(timing.session())\n                .connectionTimeoutMs(timing.connection())\n                .retryPolicy(new RetryNTimes(3, timing.milliseconds()))\n                .canBeReadOnly(true)\n                .build();\n\n            final BlockingQueue<ConnectionState> states = Queues.newLinkedBlockingQueue();\n            client.getConnectionStateListenable().addListener\n            (\n                new ConnectionStateListener()\n                {\n                    @Override\n                    public void stateChanged(CuratorFramework client, ConnectionState newState)\n                    {\n                        states.add(newState);\n                    }\n                }\n            );\n            client.start();\n\n            client.checkExists().forPath(\"/\");\n\n            ConnectionState state = states.poll(timing.forWaiting().milliseconds(), TimeUnit.MILLISECONDS);\n            Assert.assertEquals(state, ConnectionState.READ_ONLY);\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n            CloseableUtils.closeQuietly(cluster);\n        }\n    }\n","date":"2020-03-24 04:11:18","endLine":110,"groupId":"655","id":5,"instanceNumber":1,"isCurCommit":0,"methodName":"testConnectionStateNewClient","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-curator-10-0.7/blobInfo/CC_OUT/blobs/b5/f90ae3fc72e8a4e5677ac4e452a4cf9f36cd3f.src","preCode":"    public void testConnectionStateNewClient() throws Exception\n    {\n        Timing timing = new Timing();\n        TestingCluster cluster = new TestingCluster(3);\n        CuratorFramework client = null;\n        try\n        {\n            cluster.start();\n\n            client = CuratorFrameworkFactory.newClient(cluster.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(100));\n            client.start();\n            client.checkExists().forPath(\"/\");\n            client.close();\n            client = null;\n\n            Iterator<InstanceSpec> iterator = cluster.getInstances().iterator();\n            for ( int i = 0; i < 2; ++i )\n            {\n                cluster.killServer(iterator.next());\n            }\n\n            client = CuratorFrameworkFactory.builder()\n                .connectString(cluster.getConnectString())\n                .sessionTimeoutMs(timing.session())\n                .connectionTimeoutMs(timing.connection())\n                .retryPolicy(new RetryNTimes(3, timing.milliseconds()))\n                .canBeReadOnly(true)\n                .build();\n\n            final BlockingQueue<ConnectionState> states = Queues.newLinkedBlockingQueue();\n            client.getConnectionStateListenable().addListener\n            (\n                new ConnectionStateListener()\n                {\n                    @Override\n                    public void stateChanged(CuratorFramework client, ConnectionState newState)\n                    {\n                        states.add(newState);\n                    }\n                }\n            );\n            client.start();\n\n            client.checkExists().forPath(\"/\");\n\n            ConnectionState state = states.poll(timing.forWaiting().milliseconds(), TimeUnit.MILLISECONDS);\n            Assert.assertEquals(state, ConnectionState.READ_ONLY);\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n            CloseableUtils.closeQuietly(cluster);\n        }\n    }\n","realPath":"curator-framework/src/test/java/org/apache/curator/framework/imps/TestReadOnly.java","repoName":"curator","snippetEndLine":0,"snippetStartLine":0,"startLine":59,"status":"M"},{"authorDate":"2014-06-18 12:07:43","commitOrder":9,"curCode":"    public void testRetry() throws Exception\n    {\n        final int MAX_RETRIES = 3;\n\n        final CuratorFramework client = CuratorFrameworkFactory.newClient(server.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(10));\n        client.start();\n        try\n        {\n            final AtomicInteger retries = new AtomicInteger(0);\n            final Semaphore semaphore = new Semaphore(0);\n            RetryPolicy policy = new RetryPolicy()\n            {\n                @Override\n                public boolean allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper)\n                {\n                    semaphore.release();\n                    if ( retries.incrementAndGet() == MAX_RETRIES )\n                    {\n                        try\n                        {\n                            server.restart();\n                        }\n                        catch ( Exception e )\n                        {\n                            throw new Error(e);\n                        }\n                    }\n                    try\n                    {\n                        sleeper.sleepFor(100, TimeUnit.MILLISECONDS);\n                    }\n                    catch ( InterruptedException e )\n                    {\n                        Thread.currentThread().interrupt();\n                    }\n                    return true;\n                }\n            };\n            client.getZookeeperClient().setRetryPolicy(policy);\n\n            server.stop();\n\n            \r\n            client.checkExists().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n\n            \r\n            client.getZookeeperClient().setRetryPolicy(new RetryOneTime(100));\n            client.checkExists().forPath(\"/hey\");\n\n            client.getZookeeperClient().setRetryPolicy(policy);\n            semaphore.drainPermits();\n            retries.set(0);\n\n            server.stop();\n\n            \r\n            client.checkExists().inBackground().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n        }\n    }\n","date":"2014-06-18 12:07:43","endLine":403,"groupId":"579","id":6,"instanceNumber":2,"isCurCommit":0,"methodName":"testRetry","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-curator-10-0.7/blobInfo/CC_OUT/blobs/9c/02c7d9dcd413bb7ab3e5f874b931db523fda1b.src","preCode":"    public void testRetry() throws Exception\n    {\n        final int MAX_RETRIES = 3;\n\n        final CuratorFramework client = CuratorFrameworkFactory.newClient(server.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(10));\n        client.start();\n        try\n        {\n            final AtomicInteger retries = new AtomicInteger(0);\n            final Semaphore semaphore = new Semaphore(0);\n            RetryPolicy policy = new RetryPolicy()\n            {\n                @Override\n                public boolean allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper)\n                {\n                    semaphore.release();\n                    if ( retries.incrementAndGet() == MAX_RETRIES )\n                    {\n                        try\n                        {\n                            server.restart();\n                        }\n                        catch ( Exception e )\n                        {\n                            throw new Error(e);\n                        }\n                    }\n                    try\n                    {\n                        sleeper.sleepFor(100, TimeUnit.MILLISECONDS);\n                    }\n                    catch ( InterruptedException e )\n                    {\n                        Thread.currentThread().interrupt();\n                    }\n                    return true;\n                }\n            };\n            client.getZookeeperClient().setRetryPolicy(policy);\n\n            server.stop();\n\n            \r\n            client.checkExists().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n\n            \r\n            client.getZookeeperClient().setRetryPolicy(new RetryOneTime(100));\n            client.checkExists().forPath(\"/hey\");\n\n            client.getZookeeperClient().setRetryPolicy(policy);\n            semaphore.drainPermits();\n            retries.set(0);\n\n            server.stop();\n\n            \r\n            client.checkExists().inBackground().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n        }\n    }\n","realPath":"curator-framework/src/test/java/org/apache/curator/framework/imps/TestFrameworkEdges.java","repoName":"curator","snippetEndLine":0,"snippetStartLine":0,"startLine":339,"status":"N"}],"commitId":"f204083e3d1d887971aa6ed34cc8d7f4cd1ecb5e","commitMessage":"@@@CURATOR-564 (#351)\n\nLike was done for TestingServer.  catch startup issues for TestingCluster and then re-recreate and re-start the cluster one time. Hopefully this will make the tests more stable.\n\nCo-authored-by: randgalt <randgalt@apache.org>","date":"2020-03-24 04:11:18","modifiedFileCount":"10","status":"M","submitter":"Jordan Zimmerman"},{"authorTime":"2020-10-20 21:18:25","codes":[{"authorDate":"2020-10-20 21:18:25","commitOrder":10,"curCode":"    public void testConnectionStateNewClient() throws Exception\n    {\n        Timing timing = new Timing();\n        CuratorFramework client = null;\n        TestingCluster cluster = createAndStartCluster(3);\n        try\n        {\n            client = CuratorFrameworkFactory.newClient(cluster.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(100));\n            client.start();\n            client.checkExists().forPath(\"/\");\n            client.close();\n            client = null;\n\n            Iterator<InstanceSpec> iterator = cluster.getInstances().iterator();\n            for ( int i = 0; i < 2; ++i )\n            {\n                cluster.killServer(iterator.next());\n            }\n\n            client = CuratorFrameworkFactory.builder()\n                .connectString(cluster.getConnectString())\n                .sessionTimeoutMs(timing.session())\n                .connectionTimeoutMs(timing.connection())\n                .retryPolicy(new RetryNTimes(3, timing.milliseconds()))\n                .canBeReadOnly(true)\n                .build();\n\n            final BlockingQueue<ConnectionState> states = Queues.newLinkedBlockingQueue();\n            client.getConnectionStateListenable().addListener\n            (\n                new ConnectionStateListener()\n                {\n                    @Override\n                    public void stateChanged(CuratorFramework client, ConnectionState newState)\n                    {\n                        states.add(newState);\n                    }\n                }\n            );\n            client.start();\n\n            client.checkExists().forPath(\"/\");\n\n            ConnectionState state = states.poll(timing.forWaiting().milliseconds(), TimeUnit.MILLISECONDS);\n            assertEquals(state, ConnectionState.READ_ONLY);\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n            CloseableUtils.closeQuietly(cluster);\n        }\n    }\n","date":"2020-10-20 21:18:25","endLine":112,"groupId":"1057","id":7,"instanceNumber":1,"isCurCommit":1,"methodName":"testConnectionStateNewClient","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-curator-10-0.7/blobInfo/CC_OUT/blobs/2a/f98b26372c0f5783f236f4b3af16ee65011bc0.src","preCode":"    public void testConnectionStateNewClient() throws Exception\n    {\n        Timing timing = new Timing();\n        CuratorFramework client = null;\n        TestingCluster cluster = createAndStartCluster(3);\n        try\n        {\n            client = CuratorFrameworkFactory.newClient(cluster.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(100));\n            client.start();\n            client.checkExists().forPath(\"/\");\n            client.close();\n            client = null;\n\n            Iterator<InstanceSpec> iterator = cluster.getInstances().iterator();\n            for ( int i = 0; i < 2; ++i )\n            {\n                cluster.killServer(iterator.next());\n            }\n\n            client = CuratorFrameworkFactory.builder()\n                .connectString(cluster.getConnectString())\n                .sessionTimeoutMs(timing.session())\n                .connectionTimeoutMs(timing.connection())\n                .retryPolicy(new RetryNTimes(3, timing.milliseconds()))\n                .canBeReadOnly(true)\n                .build();\n\n            final BlockingQueue<ConnectionState> states = Queues.newLinkedBlockingQueue();\n            client.getConnectionStateListenable().addListener\n            (\n                new ConnectionStateListener()\n                {\n                    @Override\n                    public void stateChanged(CuratorFramework client, ConnectionState newState)\n                    {\n                        states.add(newState);\n                    }\n                }\n            );\n            client.start();\n\n            client.checkExists().forPath(\"/\");\n\n            ConnectionState state = states.poll(timing.forWaiting().milliseconds(), TimeUnit.MILLISECONDS);\n            Assert.assertEquals(state, ConnectionState.READ_ONLY);\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n            CloseableUtils.closeQuietly(cluster);\n        }\n    }\n","realPath":"curator-framework/src/test/java/org/apache/curator/framework/imps/TestReadOnly.java","repoName":"curator","snippetEndLine":0,"snippetStartLine":0,"startLine":61,"status":"M"},{"authorDate":"2020-10-20 21:18:25","commitOrder":10,"curCode":"    public void testRetry() throws Exception\n    {\n        final int MAX_RETRIES = 3;\n\n        final CuratorFramework client = CuratorFrameworkFactory.newClient(server.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(10));\n        client.start();\n        try\n        {\n            final AtomicInteger retries = new AtomicInteger(0);\n            final Semaphore semaphore = new Semaphore(0);\n            RetryPolicy policy = new RetryPolicy()\n            {\n                @Override\n                public boolean allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper)\n                {\n                    semaphore.release();\n                    if ( retries.incrementAndGet() == MAX_RETRIES )\n                    {\n                        try\n                        {\n                            server.restart();\n                        }\n                        catch ( Exception e )\n                        {\n                            throw new Error(e);\n                        }\n                    }\n                    try\n                    {\n                        sleeper.sleepFor(100, TimeUnit.MILLISECONDS);\n                    }\n                    catch ( InterruptedException e )\n                    {\n                        Thread.currentThread().interrupt();\n                    }\n                    return true;\n                }\n            };\n            client.getZookeeperClient().setRetryPolicy(policy);\n\n            server.stop();\n\n            \r\n            client.checkExists().forPath(\"/hey\");\n            assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n\n            \r\n            client.getZookeeperClient().setRetryPolicy(new RetryOneTime(100));\n            client.checkExists().forPath(\"/hey\");\n\n            client.getZookeeperClient().setRetryPolicy(policy);\n            semaphore.drainPermits();\n            retries.set(0);\n\n            server.stop();\n\n            \r\n            client.checkExists().inBackground().forPath(\"/hey\");\n            assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n        }\n    }\n","date":"2020-10-20 21:18:25","endLine":748,"groupId":"1057","id":8,"instanceNumber":2,"isCurCommit":0,"methodName":"testRetry","params":"()","path":"/mnt/clonedata/CloneManagementServer/ManagementServer/consistResult/result-curator-10-0.7/blobInfo/CC_OUT/blobs/1f/da24870f488fc96f258b772f35da0396d1f2e2.src","preCode":"    public void testRetry() throws Exception\n    {\n        final int MAX_RETRIES = 3;\n\n        final CuratorFramework client = CuratorFrameworkFactory.newClient(server.getConnectString(), timing.session(), timing.connection(), new RetryOneTime(10));\n        client.start();\n        try\n        {\n            final AtomicInteger retries = new AtomicInteger(0);\n            final Semaphore semaphore = new Semaphore(0);\n            RetryPolicy policy = new RetryPolicy()\n            {\n                @Override\n                public boolean allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper)\n                {\n                    semaphore.release();\n                    if ( retries.incrementAndGet() == MAX_RETRIES )\n                    {\n                        try\n                        {\n                            server.restart();\n                        }\n                        catch ( Exception e )\n                        {\n                            throw new Error(e);\n                        }\n                    }\n                    try\n                    {\n                        sleeper.sleepFor(100, TimeUnit.MILLISECONDS);\n                    }\n                    catch ( InterruptedException e )\n                    {\n                        Thread.currentThread().interrupt();\n                    }\n                    return true;\n                }\n            };\n            client.getZookeeperClient().setRetryPolicy(policy);\n\n            server.stop();\n\n            \r\n            client.checkExists().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n\n            \r\n            client.getZookeeperClient().setRetryPolicy(new RetryOneTime(100));\n            client.checkExists().forPath(\"/hey\");\n\n            client.getZookeeperClient().setRetryPolicy(policy);\n            semaphore.drainPermits();\n            retries.set(0);\n\n            server.stop();\n\n            \r\n            client.checkExists().inBackground().forPath(\"/hey\");\n            Assert.assertTrue(semaphore.tryAcquire(MAX_RETRIES, timing.forWaiting().seconds(), TimeUnit.SECONDS), \"Remaining leases: \" + semaphore.availablePermits());\n        }\n        finally\n        {\n            CloseableUtils.closeQuietly(client);\n        }\n    }\n","realPath":"curator-framework/src/test/java/org/apache/curator/framework/imps/TestFrameworkEdges.java","repoName":"curator","snippetEndLine":0,"snippetStartLine":0,"startLine":684,"status":"M"}],"commitId":"7a148288603ae5db0c232142f7dc07d43e01bea3","commitMessage":"@@@CURATOR-582: Migrate to jUnit 5.6 (#372)\n\n","date":"2020-10-20 21:18:25","modifiedFileCount":"125","status":"M","submitter":"Tam?s P?nzes"}]
